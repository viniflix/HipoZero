import{q as Te,r as t,j as e,ai as me,aj as xe,ak as ue,al as he,au as pe,s as ce,B as _,V as ze,an as be,X as Se,ae as js,C as se,c as fe,d as ge,e as ae,F as Le,b as ss,T as vs,ar as Ue,v as Ns,a as as,I as Fe,L as Ee,E as Ie,A as ts,h as rs,i as ls,k as os,l as ns,n as is,o as cs,p as ds,as as ys,u as bs,D as ws,x as Cs,y as _s,z as Ce,aG as Ve}from"./index-D2NJdUSJ.js";import{I as te}from"./input-Cr1iH3ZE.js";import{B as Ne}from"./badge-quOZaxai.js";import{A as Pe,a as Me}from"./alert-Cx35-eJf.js";import{L as ee}from"./label-QWp1Wm8s.js";import{T as $e}from"./textarea-d6HTe7Mt.js";import{C as De}from"./checkbox-Ci7bKmPv.js";import{S as ms,a as xs,b as us,c as hs,d as Oe}from"./select-22t74Wcr.js";import{S as Ss,a as Ae}from"./SmartFoodForm-Cd6DkBl9.js";import{P as ye}from"./plus-C4tpCd6P.js";import{S as Be}from"./search-CagxFl4M.js";import{f as ps}from"./measureTranslations-AG6EuUvS.js";import{P as _e}from"./pen-square-DP4ogB0z.js";import{R as Fs}from"./ReferenceValuesModal-Bu1iQs6T.js";import{F as We}from"./flame-Hk3mOLxQ.js";import{B as qe}from"./bar-chart-3-kQ61yXEq.js";import{T as He}from"./trending-down-WK8LFfS-.js";import{M as ks}from"./minus-BUeduRWo.js";import{getReferenceValues as fs,getTemplates as Ps,getMealPlanById as ke,applyTemplateToPatient as Ms,getMealPlans as As,getActiveMealPlan as Ts,updateFullMealPlan as Es,createMealPlan as zs,addMealToPlan as Is,addFoodToMeal as Ds,archiveMealPlan as Os,setActiveMealPlan as qs,deleteMealPlan as Rs,copyMealPlanToPatient as Ls,savePlanAsTemplate as $s}from"./meal-plan-queries-BFEogqU0.js";import{S as Bs}from"./save-DXH0pvth.js";import{g as Gs}from"./anamnesis-queries-Bq-Hx5hY.js";import{R as Us}from"./ruler-CXsc1po2.js";import{e as Vs}from"./pdfUtils-IK8UVR09.js";import{E as Ws,a as Hs}from"./jspdf.plugin.autotable-B3lmZXbY.js";import{t as Qs}from"./mealTranslations-B1KHhmEq.js";import{A as Qe}from"./arrow-left-D2cQpp1K.js";import{R as Ke}from"./refresh-cw-CXNT6Ec_.js";import{M as Ks}from"./more-vertical-2qCG1je2.js";import{D as Ye}from"./download-CGPadVFs.js";import"./index-C7gAjCuG.js";import"./extends-CF3RwP-h.js";import"./progress-M5OS4qQN.js";import"./tabs-0BuTkdtm.js";import"./foodService-DgcWp_QN.js";import"./info-2L85nFdh.js";import"./chevron-left-CMjaZDoo.js";import"./check-circle-2-DDcrxKFQ.js";import"./popover-DNWgtwUH.js";import"./html2canvas.esm-B0tyYwQk.js";const Ys=Te("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Re=Te("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Xe=Te("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Ze=Te("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function Xs({open:o,onOpenChange:m,initialName:l="",onFoodCreated:f}){const s=t.useRef(null),u=v=>{f&&f(v),i()},i=()=>{m(!1)};return e.jsx(me,{open:o,onOpenChange:i,children:e.jsxs(xe,{className:"max-w-4xl max-h-[95vh] overflow-y-auto",children:[e.jsxs(ue,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Cadastrar Alimento Personalizado"]}),e.jsx(pe,{children:"Preencha o formul√°rio passo a passo para criar um alimento customizado. Voc√™ pode buscar produtos no OpenFoodFacts ou preencher manualmente."})]}),e.jsx(Ss,{ref:s,mode:"full",initialName:l,onSuccess:u})]})})}const Zs=({isOpen:o,onClose:m,onSelect:l})=>{const[f,s]=t.useState(""),[u,i]=t.useState([]),[v,j]=t.useState(!1),[k,c]=t.useState(null),[F,g]=t.useState(null),[M,C]=t.useState(!1),P=[{value:null,label:"Todos"},{value:"TACO",label:"TACO"},{value:"IBGE",label:"IBGE"},{value:"USDA",label:"USDA"},{value:"Tucunduva",label:"Tucunduva"},{value:"TBCA",label:"TBCA"},{value:"custom",label:"Personalizados"}];t.useEffect(()=>{o&&A()},[o,f,F]);const A=async()=>{if(f.length<2){i([]);return}j(!0);try{let a=ce.from("foods").select("id, name, group, description, source, calories, protein, carbs, fat, fiber, sodium").eq("is_active",!0).ilike("name",`%${f}%`).order("name",{ascending:!0}).limit(50);F&&(a=a.eq("source",F));const{data:w,error:S}=await a;if(S)throw S;i(w||[])}catch(a){console.error("Erro ao buscar alimentos:",a),i([])}finally{j(!1)}},E=()=>{k&&(l(k),O())},O=()=>{s(""),i([]),c(null),g(null),m()},h=async a=>{C(!1),i([a,...u]),c(a),f&&await A()};return e.jsxs(me,{open:o,onOpenChange:O,children:[e.jsxs(xe,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Buscar Alimento"}),e.jsx(pe,{children:"Procure alimentos por nome nas bases de dados nutricionais"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"search",children:"Nome do Alimento"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{id:"search",placeholder:"Digite pelo menos 2 caracteres...",value:f,onChange:a=>s(a.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:P.map(a=>e.jsx(Ne,{variant:F===a.value?"default":"outline",className:"cursor-pointer",onClick:()=>g(a.value),children:a.label},a.value||"all"))}),e.jsxs(Ae,{className:"h-[400px] border rounded-md p-4",children:[v&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Buscando..."}),!v&&f.length<2&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Digite pelo menos 2 caracteres para buscar"}),!v&&f.length>=2&&u.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhum alimento encontrado"}),e.jsxs(_,{variant:"outline",onClick:()=>C(!0),className:"mx-auto",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Cadastrar '",f,"' agora"]})]}),!v&&u.length>0&&e.jsx("div",{className:"space-y-2",children:u.map(a=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${k?.id===a.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>c(a),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),k?.id===a.id&&e.jsx(ze,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ne,{variant:"outline",className:"text-xs",children:a.source||"N/A"}),a.group&&e.jsx("span",{className:"text-xs text-muted-foreground",children:a.group})]}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:a.description})]}),e.jsxs("div",{className:"ml-4 text-right text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[a.calories," kcal"]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["P: ",a.protein,"g | C: ",a.carbs,"g | G: ",a.fat,"g"]})]})]})},a.id))})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:O,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:E,disabled:!k,children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Selecionar"]})]})]}),e.jsx(Xs,{open:M,onOpenChange:C,initialName:f,onFoodCreated:h})]})},Js=async()=>{try{const{data:o,error:m}=await ce.from("household_measures").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(m)throw m;return{data:o||[],error:null}}catch(o){return console.error("Erro ao buscar medidas caseiras:",o),{data:null,error:o}}},ea=async o=>{try{const{data:m,error:l}=await ce.from("food_household_measures").select(`
        id,
        food_id,
        measure_id,
        quantity,
        grams,
        created_at,
        updated_at,
        measure:household_measures(
          id,
          name,
          code,
          category,
          description,
          ml_equivalent,
          grams_equivalent,
          order_index
        )
      `).eq("food_id",o).order("measure(order_index)",{ascending:!0});if(l)throw l;return{data:m||[],error:null}}catch(m){return console.error("Erro ao buscar medidas do alimento:",m),{data:null,error:m}}},sa=o=>{const[m,l]=t.useState([]),[f,s]=t.useState(!1),[u,i]=t.useState(null),v=t.useCallback(async()=>{if(!o){l([]);return}s(!0),i(null);try{const j=await ea(o);if(j.error)throw j.error;l(j.data||[])}catch(j){console.error("Erro ao carregar medidas:",j),i(j),l([])}finally{s(!1)}},[o]);return t.useEffect(()=>{v()},[v]),{data:m,isLoading:f,error:u,refetch:v}},aa=(o={})=>{const[m,l]=t.useState([]),[f,s]=t.useState(!0),[u,i]=t.useState(null),v=t.useCallback(async()=>{s(!0),i(null);try{const j=await Js();if(j.error)throw j.error;l(j.data||[])}catch(j){console.error("Erro ao carregar medidas caseiras:",j),i(j),l([])}finally{s(!1)}},[]);return t.useEffect(()=>{v()},[v]),{data:m,isLoading:f,error:u,refetch:v}};function ta({food:o,value:m={quantity:100,measureId:null},onChange:l,showNutrition:f=!0,className:s="",onNutritionChange:u=null}){const{data:i=[],isLoading:v}=aa(),{data:j=[],isLoading:k}=sa(o?.id),c=v||k,F=t.useMemo(()=>i.map(h=>({...h,hasSpecificConversion:j.some(a=>a.measure_id===h.id)})),[i,j]),g=t.useMemo(()=>{if(!m.measureId||m.measureId==="grams"||j.find(w=>w.measure_id===m.measureId))return!1;const a=i.find(w=>w.id===m.measureId);return a&&a.grams_equivalent?!1:!!a},[m.measureId,j,i]),M=t.useMemo(()=>{if(!o||!m.quantity)return 0;if(m.measureId===null||m.measureId==="grams")return m.quantity;const h=j.find(w=>w.measure_id===m.measureId);if(h)return h.grams*m.quantity/h.quantity;const a=i.find(w=>w.id===m.measureId);return a&&a.grams_equivalent?a.grams_equivalent*m.quantity:a?(console.warn(`Usando portion_size como fallback para medida "${a.name}"`),(o.portion_size||100)*m.quantity):(console.error(`Medida ${m.measureId} n√£o encontrada`),0)},[o,m,j,i]),C=t.useMemo(()=>{if(!o||M===0)return{grams:0,calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0};const h=M/100,a=(o.protein||0)*h,w=(o.carbs||0)*h,S=(o.fat||0)*h,H=a*4+w*4+S*9;return{grams:M,calories:parseFloat(H.toFixed(2)),protein:parseFloat(a.toFixed(2)),carbs:parseFloat(w.toFixed(2)),fat:parseFloat(S.toFixed(2)),fiber:o.fiber?parseFloat((o.fiber*h).toFixed(2)):0,sodium:o.sodium?parseFloat((o.sodium*h).toFixed(2)):0}},[o,M]);t.useEffect(()=>{u&&u(C)},[C,u]);const P=h=>{l({...m,quantity:parseFloat(h)||0})},A=h=>{l({...m,measureId:h==="grams"?null:parseInt(h)})},E=t.useMemo(()=>F.reduce((h,a)=>{const w=a.category||"other";return h[w]||(h[w]=[]),h[w].push(a),h},{}),[F]),O={volume:"Medidas de Volume",weight:"Medidas de Peso",unit:"Unidades",other:"Outras"};return e.jsxs("div",{className:`space-y-2 ${s}`,children:[e.jsx(ee,{children:"Por√ß√£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{type:"number",value:m.quantity,onChange:h=>P(h.target.value),min:0,step:.5,className:"w-24",placeholder:"0",disabled:!o}),e.jsxs(ms,{value:m.measureId?.toString()??"grams",onValueChange:A,disabled:!o||c,children:[e.jsx(xs,{className:"w-40",children:e.jsx(us,{placeholder:c?"Carregando...":"Selecione"})}),e.jsxs(hs,{className:"max-h-[300px]",children:[e.jsx(Oe,{value:"grams",children:"g"}),e.jsx("div",{className:"overflow-y-auto max-h-[280px]",children:Object.entries(E).map(([h,a])=>e.jsxs(js.Fragment,{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground sticky top-0 bg-popover",children:O[h]||h}),a.map(w=>e.jsxs(Oe,{value:w.id.toString(),className:"pl-6",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:w.name}),w.hasSpecificConversion&&e.jsx("span",{className:"ml-2 text-xs text-primary",children:"‚òÖ"})]}),w.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:w.description})]},w.id))]},h))})]})]}),f&&o&&M>0&&e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["‚âà ",C.grams.toFixed(0),"g | ",Math.round(C.calories)," kcal"]})]}),o&&!c&&j.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"‚òÖ = Convers√£o espec√≠fica para este alimento"}),g&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-950/30 p-2 rounded border border-amber-200 dark:border-amber-800",children:["‚ö†Ô∏è Estimativa aproximada (",o.portion_size||100,"g por unidade). Para maior precis√£o, cadastre a convers√£o espec√≠fica."]})]})}const ra=({isOpen:o,onClose:m,onAdd:l,mealName:f,initialData:s=null})=>{const[u,i]=t.useState(null),[v,j]=t.useState({quantity:100,measureId:null}),[k,c]=t.useState(""),[F,g]=t.useState(null),[M,C]=t.useState(!1),[P,A]=t.useState({});t.useEffect(()=>{s&&(i(s.food),j({quantity:s.quantity||100,measureId:s.unit==="gram"?null:s.unit}),c(s.notes||""),g({calories:s.calories||0,protein:s.protein||0,carbs:s.carbs||0,fat:s.fat||0}))},[s]);const E=S=>{i(S),C(!1),j({quantity:100,measureId:null}),g(null)},O=S=>{g(S)},h=()=>{const S={};return u||(S.food="Selecione um alimento"),(!v.quantity||v.quantity<=0)&&(S.portion="Quantidade deve ser maior que zero"),A(S),Object.keys(S).length===0},a=()=>{if(!h())return;const S={food_id:u.id,food:u,quantity:v.quantity,unit:v.measureId||"gram",calories:F?.calories||0,protein:F?.protein||0,carbs:F?.carbs||0,fat:F?.fat||0,notes:k.trim()||null};l(S),w()},w=()=>{i(null),j({quantity:100,measureId:null}),c(""),g(null),A({}),m()};return e.jsxs(e.Fragment,{children:[e.jsx(me,{open:o,onOpenChange:w,children:e.jsxs(xe,{className:"max-w-2xl",children:[e.jsxs(ue,{children:[e.jsx(he,{children:s?"Editar Alimento":"Adicionar Alimento"}),e.jsx(pe,{children:s?`Editar alimento: ${s.food?.name||""}`:f?`Adicionar alimento √† refei√ß√£o: ${f}`:"Adicionar novo alimento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ee,{children:["Alimento ",e.jsx("span",{className:"text-destructive",children:"*"})]}),u?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:u.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[u.group," ‚Ä¢ ",u.source]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Base 100g: ",u.calories," kcal | P: ",u.protein,"g | C: ",u.carbs,"g | G: ",u.fat,"g"]})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>C(!0),children:"Trocar"})]}):e.jsxs(_,{variant:"outline",className:"w-full",onClick:()=>C(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Buscar Alimento"]}),P.food&&e.jsx("p",{className:"text-xs text-destructive",children:P.food})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ta,{food:u,value:v,onChange:j,showNutrition:!1,onNutritionChange:O}),P.portion&&e.jsx("p",{className:"text-xs text-destructive",children:P.portion})]}),F&&e.jsx(Pe,{className:"bg-primary/5",children:e.jsxs(Me,{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Valores Nutricionais:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:Math.round(F.calories)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:F.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:F.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:F.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx($e,{id:"notes",rows:2,placeholder:"Ex: sem sal, sem a√ß√∫car, etc.",value:k,onChange:S=>c(S.target.value)})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:w,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:a,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s?"Atualizar":"Adicionar"]})]})]})}),e.jsx(Zs,{isOpen:M,onClose:()=>C(!1),onSelect:E})]})},la=({isOpen:o,onClose:m,onSave:l,initialData:f=null})=>{const[s,u]=t.useState({name:"",meal_type:"",meal_time:"",notes:""}),[i,v]=t.useState([]),[j,k]=t.useState(!1),[c,F]=t.useState(null),[g,M]=t.useState({}),C=[{value:"breakfast",label:"Caf√© da Manh√£"},{value:"morning_snack",label:"Lanche da Manh√£"},{value:"lunch",label:"Almo√ßo"},{value:"afternoon_snack",label:"Lanche da Tarde"},{value:"dinner",label:"Jantar"},{value:"supper",label:"Ceia"},{value:"pre_workout",label:"Pr√©-Treino"},{value:"post_workout",label:"P√≥s-Treino"},{value:"other",label:"Outro"}];t.useEffect(()=>{f&&(u({name:f.name||"",meal_type:f.meal_type||"",meal_time:f.meal_time||"",notes:f.notes||""}),v(f.foods||[]))},[f]);const P=(p,q)=>{u(B=>{const W={...B,[p]:q};return p==="meal_type"&&q!=="other"&&(W.name=""),W}),g[p]&&M(B=>({...B,[p]:null}))},A=p=>{v(q=>[...q,{...p,tempId:Date.now()}])},E=p=>{F(p),k(!0)},O=p=>{v(q=>q.map(B=>B.tempId===c.tempId?{...p,tempId:B.tempId}:B)),F(null)},h=p=>{v(q=>q.filter(B=>B.tempId!==p))},a=()=>{k(!1),F(null)},w=()=>i.reduce((p,q)=>({calories:p.calories+(q.calories||0),protein:p.protein+(q.protein||0),carbs:p.carbs+(q.carbs||0),fat:p.fat+(q.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),S=()=>{const p={};return s.meal_type||(p.meal_type="Tipo de refei√ß√£o √© obrigat√≥rio"),s.meal_type==="other"&&!s.name.trim()&&(p.name='Nome da refei√ß√£o √© obrigat√≥rio quando tipo √© "Outro"'),i.length===0&&(p.foods="Adicione pelo menos um alimento"),M(p),Object.keys(p).length===0},H=()=>{if(!S())return;const p=w(),B={name:s.meal_type==="other"?s.name:C.find(W=>W.value===s.meal_type)?.label||"",meal_type:s.meal_type,meal_time:s.meal_time,notes:s.notes,foods:i,...p};l(B),Z()},Z=()=>{u({name:"",meal_type:"",meal_time:"",notes:""}),v([]),M({}),m()},T=w();return e.jsxs(e.Fragment,{children:[e.jsx(me,{open:o,onOpenChange:Z,children:e.jsxs(xe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ue,{children:[e.jsx(he,{children:f?"Editar Refei√ß√£o":"Nova Refei√ß√£o"}),e.jsx(pe,{children:"Configure a refei√ß√£o e adicione os alimentos"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(fe,{children:e.jsx(ge,{className:"text-lg",children:"Informa√ß√µes da Refei√ß√£o"})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ee,{htmlFor:"meal_type",children:["Tipo de Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ms,{value:s.meal_type,onValueChange:p=>P("meal_type",p),children:[e.jsx(xs,{id:"meal_type",className:g.meal_type?"border-destructive":"",children:e.jsx(us,{placeholder:"Selecione o tipo"})}),e.jsx(hs,{children:C.map(p=>e.jsx(Oe,{value:p.value,children:p.label},p.value))})]}),g.meal_type&&e.jsx("p",{className:"text-xs text-destructive",children:g.meal_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"meal_time",children:"Hor√°rio (opcional)"}),e.jsx(te,{id:"meal_time",type:"time",value:s.meal_time,onChange:p=>P("meal_time",p.target.value)})]})]}),s.meal_type==="other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ee,{htmlFor:"name",children:["Nome da Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"name",placeholder:"Ex: Lanche Noturno, Suplementa√ß√£o",value:s.name,onChange:p=>P("name",p.target.value),className:g.name?"border-destructive":""}),g.name&&e.jsx("p",{className:"text-xs text-destructive",children:g.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx($e,{id:"notes",rows:2,placeholder:"Observa√ß√µes sobre a refei√ß√£o...",value:s.notes,onChange:p=>P("notes",p.target.value)})]})]})]}),e.jsxs(se,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ge,{className:"text-lg",children:"Alimentos"}),e.jsxs(_,{size:"sm",onClick:()=>k(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Alimento"]})]})}),e.jsx(ae,{children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhum alimento adicionado ainda",g.foods&&e.jsx("p",{className:"text-destructive mt-2",children:g.foods})]}):e.jsxs("div",{className:"space-y-2",children:[i.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:p.food.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[ps(p.quantity,p.unit,p.measure)," ‚Ä¢"," ",p.calories," kcal ‚Ä¢ P: ",p.protein,"g ‚Ä¢ C: ",p.carbs,"g ‚Ä¢ G: ",p.fat,"g"]}),p.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:p.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>E(p),title:"Editar alimento",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>h(p.tempId),title:"Remover alimento",children:e.jsx(Le,{className:"h-4 w-4 text-destructive"})})]})]},p.tempId)),e.jsxs("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Totais da Refei√ß√£o:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:T.calories.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:T.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:T.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:T.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})]})})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:Z,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:H,children:[f?"Atualizar":"Adicionar"," Refei√ß√£o"]})]})]})}),e.jsx(ra,{isOpen:j,onClose:a,onAdd:c?O:A,initialData:c,mealName:s.meal_type==="other"?s.name:C.find(p=>p.value===s.meal_type)?.label})]})},gs=({protein:o,carbs:m,fat:l,calories:f,patientId:s,planId:u,referenceValues:i,onReferenceUpdate:v,readOnly:j=!1})=>{const k=ss(),[c,F]=t.useState(!1),g={protein:"#8B3BF2",carbs:"#3B6FF2",fat:"#F28B3B"},M=o*4,C=m*4,P=l*9,A=M+C+P,E=A>0?M/A*100:0,O=A>0?C/A*100:0,h=A>0?P/A*100:0,a=i?.weight_kg?parseFloat(i.weight_kg):null,w=a?o/a:null,S=a?m/a:null,H=a?l/a:null,T=(()=>{if(!i)return null;const x=parseFloat(i.weight_kg),N=parseFloat(i.total_energy_kcal);if(!x||!N)return null;let z,D,G;return i.macro_mode==="percentage"?(z=N*i.protein_percentage/4,D=N*i.carbs_percentage/4,G=N*i.fat_percentage/9):(z=x*i.protein_g_per_kg,D=x*i.carbs_g_per_kg,G=x*i.fat_g_per_kg),{calories:N,protein:z,carbs:D,fat:G,proteinPerKg:z/x,carbsPerKg:D/x,fatPerKg:G/x}})(),p=(x,N)=>{if(!N||N===0)return null;const z=x/N*100,D=x-N,G=z-100;let K="adequate";return z<95||z>105?K="inadequate":z<100?K="below":z>100&&(K="above"),{percentage:z,diff:D,diffPerc:G,status:K}},q=T?p(f,T.calories):null,B=T?p(o,T.protein):null,W=T?p(m,T.carbs):null,je=T?p(l,T.fat):null,re=({adequacy:x,compact:N=!1})=>{if(!x)return null;const D=(G=>{switch(G){case"adequate":return{color:"bg-green-100 text-green-700 border-green-300",icon:e.jsx(ks,{className:"w-3 h-3"}),label:"OK"};case"below":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(He,{className:"w-3 h-3"}),label:x.diffPerc.toFixed(0)};case"above":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(Ue,{className:"w-3 h-3"}),label:`+${x.diffPerc.toFixed(0)}`};case"inadequate":return{color:x.percentage<95?"bg-red-100 text-red-700 border-red-300":"bg-orange-100 text-orange-700 border-orange-300",icon:x.percentage<95?e.jsx(He,{className:"w-3 h-3"}):e.jsx(Ue,{className:"w-3 h-3"}),label:x.percentage<95?x.diffPerc.toFixed(0):`+${x.diffPerc.toFixed(0)}`};default:return null}})(x.status);return D?N?e.jsxs("div",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-md border text-xs font-semibold ${D.color}`,children:[D.icon,e.jsxs("span",{children:[D.label,"%"]})]}):e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md border text-xs font-semibold ${D.color}`,children:[D.icon,e.jsxs("span",{children:[x.percentage.toFixed(0),"%"]})]}):null},oe=()=>{const G=(V,Y)=>{const ie=K(75,75,60,Y),ve=K(75,75,60,V),de=Y-V<=180?"0":"1";return["M",75,75,"L",ie.x,ie.y,"A",60,60,0,de,0,ve.x,ve.y,"Z"].join(" ")},K=(V,Y,ie,ve)=>{const de=(ve-90)*Math.PI/180;return{x:V+ie*Math.cos(de),y:Y+ie*Math.sin(de)}};let Q=0;const le=E/100*360,ne=O/100*360;return e.jsxs("svg",{width:150,height:150,viewBox:"0 0 150 150",className:"mx-auto",children:[E>0&&e.jsx("path",{d:G(Q,Q+le),fill:g.protein,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),O>0&&e.jsx("path",{d:G(Q+le,Q+le+ne),fill:g.carbs,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),h>0&&e.jsx("path",{d:G(Q+le+ne,360),fill:g.fat,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),e.jsx("circle",{cx:75,cy:75,r:38,fill:"#fefae0"}),e.jsx("text",{x:75,y:72,textAnchor:"middle",className:"text-xl font-bold",fill:"#000",children:f.toFixed(0)}),e.jsx("text",{x:75,y:87,textAnchor:"middle",className:"text-[10px]",fill:"#666",children:"kcal"})]})},d=({label:x,color:N,current:z,target:D,currentPerKg:G,targetPerKg:K,percentage:Q,adequacy:le,unit:ne="g",isEnergy:V=!1})=>e.jsxs("div",{className:"p-2 rounded-lg border transition-colors",style:N?{backgroundColor:`${N}0D`,borderColor:`${N}33`}:{backgroundColor:"rgb(250 250 249 / 0.3)",borderColor:"rgb(228 228 231)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[N&&!V&&e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:N}}),V&&e.jsx(We,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${N&&!V?"":"text-muted-foreground"}`,style:N&&!V?{color:N}:void 0,children:x})]}),le&&e.jsx(re,{adequacy:le,compact:!0})]}),e.jsxs("div",{className:"flex items-baseline justify-between gap-2 flex-wrap min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-1 flex-wrap min-w-0",children:[e.jsx("span",{className:`text-lg font-bold ${N&&!V?"":"text-foreground"}`,style:N&&!V?{color:N}:void 0,children:z.toFixed(V?0:1)}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:ne}),G&&!V&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["(",G.toFixed(1)," g/kg)"]}),Q!==void 0&&!V&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["‚Ä¢ ",Q.toFixed(0),"%"]})]}),D&&e.jsxs("div",{className:"flex items-baseline gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"text-muted-foreground font-medium whitespace-nowrap",children:"Meta:"}),e.jsxs("span",{className:"font-bold text-foreground whitespace-nowrap",children:[D.toFixed(V?0:1),ne]}),K&&!V&&e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["(",K.toFixed(1)," g/kg)"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(se,{className:"h-full bg-gradient-to-br from-[#fefae0]/30 to-[#f9ebc7]/30 border-[#a9b388]",children:[e.jsx(fe,{className:"pb-2",children:e.jsxs(ge,{className:"text-base flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-[#c4661f]"}),"Distribui√ß√£o de Macronutrientes"]})}),e.jsxs(ae,{className:"space-y-2",children:[e.jsx(oe,{}),e.jsxs("div",{className:"space-y-1",children:[T&&e.jsx(d,{label:"Energia",current:f,target:T.calories,adequacy:q,unit:"kcal",isEnergy:!0}),e.jsx(d,{label:"Prote√≠nas",color:g.protein,current:o,target:T?.protein,currentPerKg:w,targetPerKg:T?.proteinPerKg,percentage:E,adequacy:B}),e.jsx(d,{label:"Carboidratos",color:g.carbs,current:m,target:T?.carbs,currentPerKg:S,targetPerKg:T?.carbsPerKg,percentage:O,adequacy:W}),e.jsx(d,{label:"Gorduras",color:g.fat,current:l,target:T?.fat,currentPerKg:H,targetPerKg:T?.fatPerKg,percentage:h,adequacy:je})]}),T&&e.jsx("div",{className:"flex items-center justify-center pt-1 border-t",children:[q,B,W,je].every(x=>x?.status==="adequate")?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-green-700 bg-green-50 px-3 py-1.5 rounded-full border border-green-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Plano adequado"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-yellow-700 bg-yellow-50 px-3 py-1.5 rounded-full border border-yellow-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Ajustes sugeridos"})]})}),!j&&e.jsxs("div",{className:"pt-1.5 border-t space-y-1",children:[e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>F(!0),className:"w-full gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),T?"Editar Valores de Refer√™ncia":"Configurar Valores de Refer√™ncia"]}),u&&e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>k(`/nutritionist/patients/${s}/meal-plan/${u}/summary`),className:"w-full gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Ver Resumo Nutricional Completo"]}),!T&&e.jsx("div",{className:"text-[10px] text-muted-foreground bg-[#fefae0] p-2 rounded-lg border border-[#a9b388]/30 text-center",children:"üí° Configure os valores de refer√™ncia para ver an√°lise de adequa√ß√£o e g/kg"})]})]})]}),u&&e.jsx(Fs,{isOpen:c,onClose:()=>{F(!1),v&&v()},planId:u})]})},oa=({patientId:o,nutritionistId:m,initialData:l=null,onSubmit:f,onCancel:s,loading:u=!1})=>{const[i,v]=t.useState({name:"",description:"",start_date:new Date().toISOString().split("T")[0],end_date:"",active_days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]}),[j,k]=t.useState([]),[c,F]=t.useState(!1),[g,M]=t.useState(null),[C,P]=t.useState({}),[A,E]=t.useState(null),O=[{value:"monday",label:"Segunda"},{value:"tuesday",label:"Ter√ßa"},{value:"wednesday",label:"Quarta"},{value:"thursday",label:"Quinta"},{value:"friday",label:"Sexta"},{value:"saturday",label:"S√°bado"},{value:"sunday",label:"Domingo"}],h=t.useCallback(async()=>{if(l?.id){const{data:d}=await fs(l.id);E(d)}},[l?.id]);t.useEffect(()=>{if(l){v({name:l.name||"",description:l.description||"",start_date:l.start_date||new Date().toISOString().split("T")[0],end_date:l.end_date||"",active_days:l.active_days||[]});const d=(l.meals||[]).map((x,N)=>({...x,tempId:x.tempId||Date.now()+N,foods:(x.foods||[]).map((z,D)=>({...z,tempId:z.tempId||Date.now()+N+D+1e3}))}));k(d),h()}},[l,h]);const a=(d,x)=>{v(N=>({...N,[d]:x})),C[d]&&P(N=>({...N,[d]:null}))},w=d=>{v(x=>({...x,active_days:x.active_days.includes(d)?x.active_days.filter(N=>N!==d):[...x.active_days,d]}))},S=()=>{v(d=>({...d,active_days:d.active_days.length===7?[]:O.map(x=>x.value)}))},H=()=>{const d=["monday","tuesday","wednesday","thursday","friday"];v(x=>({...x,active_days:d}))},Z=()=>{const d=["saturday","sunday"];v(x=>({...x,active_days:d}))},T=d=>{k(x=>[...x,{...d,tempId:Date.now(),order_index:x.length}])},p=d=>{M(d),F(!0)},q=d=>{k(x=>x.map(N=>N.tempId===g.tempId?{...d,tempId:N.tempId}:N)),M(null)},B=d=>{k(x=>x.filter(N=>N.tempId!==d))},W=()=>j.reduce((d,x)=>({calories:d.calories+(x.calories||0),protein:d.protein+(x.protein||0),carbs:d.carbs+(x.carbs||0),fat:d.fat+(x.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),je=()=>{const d={};return i.name.trim()||(d.name="Nome do plano √© obrigat√≥rio"),i.active_days.length===0&&(d.active_days="Selecione pelo menos um dia da semana"),i.start_date||(d.start_date="Data de in√≠cio √© obrigat√≥ria"),i.end_date&&i.end_date<i.start_date&&(d.end_date="Data final deve ser posterior √† data inicial"),j.length===0&&(d.meals="Adicione pelo menos uma refei√ß√£o"),P(d),Object.keys(d).length===0},re=d=>{if(d.preventDefault(),!je())return;const x=W(),N={patient_id:o,nutritionist_id:m,...i,...x,meals:j};f(N,l?.id)},oe=W();return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(fe,{children:e.jsx(ge,{className:"text-lg",children:"Informa√ß√µes do Plano"})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ee,{htmlFor:"name",children:["Nome do Plano ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"name",placeholder:"Ex: Dieta Hipertrofia",value:i.name,onChange:d=>a("name",d.target.value),className:C.name?"border-destructive":"",disabled:u}),C.name&&e.jsx("p",{className:"text-xs text-destructive",children:C.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"description",children:"Descri√ß√£o (opcional)"}),e.jsx($e,{id:"description",rows:3,placeholder:"Descreva os objetivos e caracter√≠sticas do plano alimentar...",value:i.description,onChange:d=>a("description",d.target.value),disabled:u})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ee,{htmlFor:"start_date",children:["Data de In√≠cio ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"start_date",type:"date",value:i.start_date,onChange:d=>a("start_date",d.target.value),className:C.start_date?"border-destructive":"",disabled:u}),C.start_date&&e.jsx("p",{className:"text-xs text-destructive",children:C.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"end_date",children:"Data de T√©rmino (opcional)"}),e.jsx(te,{id:"end_date",type:"date",value:i.end_date,onChange:d=>a("end_date",d.target.value),className:C.end_date?"border-destructive":"",disabled:u}),C.end_date&&e.jsx("p",{className:"text-xs text-destructive",children:C.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs(ee,{children:["Dias Ativos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:H,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Dias √∫teis"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Z,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Fins de semana"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:S,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:i.active_days.length===7?"Limpar":"Todos"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:O.map(d=>e.jsxs("label",{className:`
                                            flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-1 sm:px-3 py-2 border rounded-lg cursor-pointer transition-colors text-xs sm:text-sm
                                            ${i.active_days.includes(d.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"}
                                        `,children:[e.jsx(De,{checked:i.active_days.includes(d.value),onCheckedChange:()=>w(d.value),disabled:u,className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-[10px] sm:text-sm leading-tight text-center",children:d.label})]},d.value))}),C.active_days&&e.jsx("p",{className:"text-xs text-destructive",children:C.active_days})]})]})]}),j.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:e.jsxs(se,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ge,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{M(null),F(!0)},disabled:u,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(ae,{children:e.jsx("div",{className:"space-y-3",children:j.map((d,x)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",x+1]}),e.jsx("h4",{className:"font-semibold",children:d.name}),d.meal_time&&e.jsxs(Ne,{variant:"outline",children:[e.jsx(Ns,{className:"h-3 w-3 mr-1"}),d.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[d.foods?.length||0," alimento(s) ‚Ä¢"," ",d.calories?.toFixed(0)||0," kcal ‚Ä¢ P: ",d.protein?.toFixed(1)||0,"g ‚Ä¢ C: ",d.carbs?.toFixed(1)||0,"g ‚Ä¢ G: ",d.fat?.toFixed(1)||0,"g"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>p(d),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>B(d.tempId),children:e.jsx(Le,{className:"h-4 w-4 text-destructive"})})]})]})},d.tempId))})})]})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(gs,{protein:oe.protein,carbs:oe.carbs,fat:oe.fat,calories:oe.calories,patientId:o,planId:l?.id,referenceValues:A,onReferenceUpdate:h})})]}),j.length===0&&e.jsxs(se,{children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ge,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{M(null),F(!0)},disabled:u,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhuma refei√ß√£o adicionada ainda",C.meals&&e.jsx("p",{className:"text-destructive mt-2",children:C.meals})]})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(_,{type:"button",variant:"outline",onClick:s,disabled:u,children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{type:"submit",disabled:u,children:[e.jsx(Bs,{className:"w-4 h-4 mr-2"}),u?"Salvando...":l?"Atualizar Plano":"Criar Plano"]})]})]}),e.jsx(la,{isOpen:c,onClose:()=>{F(!1),M(null)},onSave:g?q:T,initialData:g})]})},na=({isOpen:o,onClose:m,planId:l,planName:f,onCopy:s})=>{const[u,i]=t.useState([]),[v,j]=t.useState([]),[k,c]=t.useState(""),[F,g]=t.useState(null),[M,C]=t.useState(!1),[P,A]=t.useState(!1);t.useEffect(()=>{o&&E()},[o]),t.useEffect(()=>{if(k){const a=u.filter(w=>w.name?.toLowerCase().includes(k.toLowerCase())||w.email?.toLowerCase().includes(k.toLowerCase()));j(a)}else j(u)},[k,u]);const E=async()=>{C(!0);try{const{data:{user:a}}=await ce.auth.getUser();if(!a)return;const{data:w,error:S}=await ce.from("user_profiles").select("id, name, email").eq("user_type","patient").eq("nutritionist_id",a.id).order("name",{ascending:!0});if(S)throw S;i(w||[]),j(w||[])}catch(a){console.error("Erro ao carregar pacientes:",a)}finally{C(!1)}},O=async()=>{if(F){A(!0);try{await s(F.id),h()}catch(a){console.error("Erro ao copiar modelo:",a)}finally{A(!1)}}},h=()=>{c(""),g(null),m()};return e.jsx(me,{open:o,onOpenChange:h,children:e.jsxs(xe,{className:"max-w-2xl",children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Copiar Modelo de Dieta"}),e.jsxs(pe,{children:["Selecione o paciente para aplicar o plano: ",e.jsx("strong",{children:f})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{htmlFor:"search",children:"Buscar Paciente"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{id:"search",placeholder:"Digite o nome ou email do paciente...",value:k,onChange:a=>c(a.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsxs(Ae,{className:"h-[400px] border rounded-md p-4",children:[M&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando pacientes..."}),!M&&v.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:k?"Nenhum paciente encontrado":"Voc√™ n√£o tem pacientes cadastrados"}),!M&&v.length>0&&e.jsx("div",{className:"space-y-2",children:v.map(a=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${F?.id===a.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>g(a),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),F?.id===a.id&&e.jsx(ze,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.email})]})})},a.id))})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:h,disabled:P,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:O,disabled:!F||P,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),P?"Copiando...":"Copiar Modelo"]})]})]})})};function ia(o,m){if(!o||!m||m.length===0)return null;const l=o.toLowerCase();for(const f of m)if(f&&l.includes(f.toLowerCase()))return f;return null}function Je({open:o,onOpenChange:m,patientId:l,nutritionistId:f,onTemplateApplied:s}){const{toast:u}=as(),[i,v]=t.useState([]),[j,k]=t.useState([]),[c,F]=t.useState(null),[g,M]=t.useState(null),[C,P]=t.useState(""),[A,E]=t.useState(null),[O,h]=t.useState(!1),[a,w]=t.useState(!1),[S,H]=t.useState(null),[Z,T]=t.useState(!1),[p,q]=t.useState(1),[B,W]=t.useState(!1),[je,re]=t.useState([]),[oe,d]=t.useState(null),[x,N]=t.useState(new Set);t.useEffect(()=>{o&&f&&D(),o&&l&&K()},[o,f,l]),t.useEffect(()=>{let n=i;C&&(n=n.filter(b=>b.name.toLowerCase().includes(C.toLowerCase())||b.description&&b.description.toLowerCase().includes(C.toLowerCase()))),A&&(n=n.filter(b=>b.template_tags?(Array.isArray(b.template_tags)?b.template_tags:[b.template_tags]).some(I=>I.toLowerCase()===A.toLowerCase()):!1)),k(n)},[i,C,A]);const z=(n,b=null)=>!n||!n.meals?{calories:0,protein:0,carbs:0,fat:0}:(b&&b.size>0?n.meals.filter(I=>b.has(I.id)):n.meals).reduce((I,X)=>({calories:I.calories+(parseFloat(X.total_calories)||0),protein:I.protein+(parseFloat(X.total_protein)||0),carbs:I.carbs+(parseFloat(X.total_carbs)||0),fat:I.fat+(parseFloat(X.total_fat)||0)}),{calories:0,protein:0,carbs:0,fat:0});t.useEffect(()=>{c&&G(c.id)},[c]),t.useEffect(()=>{if(g&&S&&Z&&x.size>0){const n=z(g,x).calories;if(n>0){const b=S/n;q(b)}}else q(1)},[g,S,Z,x]);const D=async()=>{h(!0);try{const{data:n,error:b}=await Ps(f);if(b)throw b;v(n||[]),k(n||[])}catch(n){console.error("Erro ao carregar templates:",n),u({title:"Erro",description:"N√£o foi poss√≠vel carregar os templates.",variant:"destructive"})}finally{h(!1)}},G=async n=>{try{const{data:b,error:L}=await ke(n);if(L)throw L;if(M(b),T(!1),b?.meals){const I=new Set(b.meals.map(X=>X.id));N(I)}else N(new Set)}catch(b){console.error("Erro ao carregar detalhes do template:",b),M(null),N(new Set)}},K=async()=>{if(l)try{const{data:n}=await ce.from("patient_goals").select("daily_calorie_goal").eq("patient_id",l).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(n?.daily_calorie_goal){H(parseFloat(n.daily_calorie_goal));return}const b=new Date().toISOString().split("T")[0],{data:L}=await ce.from("prescriptions").select("calories").eq("patient_id",l).lte("start_date",b).or(`end_date.is.null,end_date.gte.${b}`).order("start_date",{ascending:!1}).limit(1).maybeSingle();if(L?.calories){H(parseFloat(L.calories));return}const{data:I}=await ce.from("energy_expenditure_calculations").select("total_daily_energy_expenditure").eq("patient_id",l).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(I?.total_daily_energy_expenditure){H(parseFloat(I.total_daily_energy_expenditure));return}H(null)}catch(n){console.error("Erro ao buscar meta cal√≥rica do paciente:",n),H(null)}},Q=async()=>{if(!g||!l)return[];try{const{data:n,error:b}=await Gs(l,!0);if(b||!n||!n.content)return[];const L=n.content,X=(L.historico_clinico?.alergias||[]).filter(R=>R&&R.alimento).map(R=>R.alimento.trim()).filter(R=>R.length>0),r=(L.habitos_alimentares?.alimentos_nao_gosta||"").split(/[,;]/).map(R=>R.trim()).filter(R=>R.length>0),y=[...X,...r];if(y.length===0)return[];const $=[];if(g.meals){for(const R of g.meals)if(x.has(R.id)&&R.foods)for(const U of R.foods){const Ge=U.food?.name||U.foods?.name||U.name||"";Ge&&$.push(Ge)}}const J=[];for(const R of $)ia(R,y)&&(J.includes(R)||J.push(R));return J}catch(n){return console.error("Erro ao verificar conflitos de alimentos:",n),[]}},le=async(n=!1)=>{if(!(!c||!l)){if(x.size===0){u({title:"Nenhuma Refei√ß√£o Selecionada",description:"Selecione pelo menos uma refei√ß√£o para importar.",variant:"destructive"});return}if(!n){const b=await Q();if(b.length>0){re(b),W(!0),d({templateId:c.id,patientId:l,scaleFactor:Z?p:1,selectedMealIds:Array.from(x)});return}}w(!0);try{const b=oe||{templateId:c.id,patientId:l,scaleFactor:Z?p:1,selectedMealIds:Array.from(x)},{data:L,error:I}=await Ms(b.templateId,b.patientId,null,b.scaleFactor,b.selectedMealIds);if(I)throw I;const X=b.scaleFactor!==1?` (quantidades ajustadas para ${Math.round(S)} kcal)`:"",we=b.selectedMealIds?.length||x.size,r=we<(g?.meals?.length||0)?` (${we} de ${g?.meals?.length||0} refei√ß√µes importadas)`:"";u({title:"Template Aplicado",description:`O template "${c.name}" foi aplicado ao paciente com sucesso.${X}${r}`}),s&&s(L),d(null),re([]),W(!1),m(!1)}catch(b){console.error("Erro ao aplicar template:",b),u({title:"Erro",description:"N√£o foi poss√≠vel aplicar o template.",variant:"destructive"})}finally{w(!1)}}},ne=()=>{W(!1),le(!0)},V=Array.from(new Set(i.filter(n=>n.template_tags).flatMap(n=>Array.isArray(n.template_tags)?n.template_tags:[n.template_tags]))),Y=g?z(g,x):null,ie=Y&&S&&Y.calories>0,ve=ie?Math.abs((Y.calories-S)/Y.calories)*100:0,de=ie&&ve>10;return e.jsxs(me,{open:o,onOpenChange:m,children:[e.jsxs(xe,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(ue,{children:[e.jsxs(he,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Meus Modelos de Dieta"]}),e.jsx(pe,{children:"Selecione um template para aplicar ao paciente"})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 flex flex-col border-r pr-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Buscar templates...",value:C,onChange:n=>P(n.target.value),className:"pl-8"})]})}),V.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Filtrar por Tag:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{variant:A===null?"default":"outline",size:"sm",onClick:()=>E(null),children:"Todos"}),V.map(n=>e.jsx(_,{variant:A===n?"default":"outline",size:"sm",onClick:()=>E(n),children:n},n))]})]}),e.jsx(Ae,{className:"flex-1",children:O?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Ee,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Fe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum template encontrado"})]}):e.jsx("div",{className:"space-y-2",children:j.map(n=>e.jsx(se,{className:`cursor-pointer transition-colors ${c?.id===n.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>F(n),children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:n.name}),n.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:n.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Ie,{className:"w-3 h-3"}),e.jsx("span",{children:n.daily_calories?`${Math.round(n.daily_calories)} kcal`:"N/A"})]}),n.template_tags&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(Array.isArray(n.template_tags)?n.template_tags:[n.template_tags]).map((b,L)=>e.jsxs(Ne,{variant:"secondary",className:"text-xs",children:[e.jsx(Ze,{className:"w-2 h-2 mr-1"}),b]},L))})]})})},n.id))})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:c?e.jsxs(e.Fragment,{children:[g?e.jsx(Ae,{className:"flex-1",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(se,{children:[e.jsxs(fe,{children:[e.jsx(ge,{children:g.name}),g.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:g.description})]}),e.jsxs(ae,{children:[Y&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Y.calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prote√≠nas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Y.protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Y.carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Y.fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsxs("span",{children:[g.meals?.length||0," refei√ß√µes"]})]}),g.template_tags&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Ze,{className:"w-4 h-4 text-muted-foreground"}),(Array.isArray(g.template_tags)?g.template_tags:[g.template_tags]).map((n,b)=>e.jsx(Ne,{variant:"secondary",children:n},b))]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Selecione as Refei√ß√µes para Importar:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>{if(g?.meals){const n=new Set(g.meals.map(b=>b.id));N(n)}},className:"text-xs h-7",children:"Selecionar Todas"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>N(new Set),className:"text-xs h-7",children:"Desmarcar Todas"})]})]}),e.jsx("div",{className:"space-y-2",children:g.meals?.map((n,b)=>{const L=x.has(n.id);return e.jsx(se,{className:`cursor-pointer transition-colors ${L?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>{const I=new Set(x);L?I.delete(n.id):I.add(n.id),N(I)},children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{checked:L,onCheckedChange:I=>{const X=new Set(x);I?X.add(n.id):X.delete(n.id),N(X)},onClick:I=>I.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:n.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.meal_type})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[Math.round(n.total_calories||0)," kcal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",Math.round(n.total_protein||0),"g | C: ",Math.round(n.total_carbs||0),"g | G: ",Math.round(n.total_fat||0),"g"]})]})]}),n.foods&&n.foods.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.foods.length," alimento(s)"]})})]})]})})},n.id||b)})}),g.meals&&g.meals.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[x.size," de ",g.meals.length," refei√ß√µes selecionadas"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Ee,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),de&&e.jsxs(Pe,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(Us,{className:"h-4 w-4 text-blue-600"}),e.jsx(Me,{children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{id:"auto-scale",checked:Z,onCheckedChange:n=>T(n===!0)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(ee,{htmlFor:"auto-scale",className:"text-sm font-medium cursor-pointer",children:["Ajustar quantidades automaticamente para atingir ",Math.round(S)," kcal?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["O template tem ",Math.round(Y.calories)," kcal.",Z&&e.jsxs("span",{className:"block mt-1",children:["As por√ß√µes ser√£o ajustadas por um fator de ",p.toFixed(2),"x (aproximadamente ",Math.round(Y.calories*p)," kcal ap√≥s ajuste)."]})]})]})]})})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsx(_,{onClick:le,disabled:a||!l,className:"w-full sm:w-auto",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4 mr-2 animate-spin"}),"Aplicando..."]}):e.jsx(e.Fragment,{children:"Aplicar este Modelo"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecione um template para visualizar os detalhes"})]})})})]})]}),e.jsx(ts,{open:B,onOpenChange:W,children:e.jsxs(rs,{children:[e.jsxs(ls,{children:[e.jsx(os,{className:"flex items-center gap-2",children:"‚ö†Ô∏è Alerta de Restri√ß√£o Alimentar"}),e.jsxs(ns,{className:"space-y-3",children:[e.jsx("p",{children:"Este modelo cont√©m alimentos que o paciente marcou como alergia ou avers√£o:"}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:je.map((n,b)=>e.jsx("li",{className:"font-semibold text-destructive",children:n},b))})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Deseja continuar mesmo assim? Esta a√ß√£o pode causar rea√ß√µes adversas no paciente."})]})]}),e.jsxs(is,{children:[e.jsx(cs,{onClick:()=>{W(!1),re([]),d(null)},children:"Cancelar Importa√ß√£o"}),e.jsx(ds,{onClick:ne,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Ignorar e Aplicar"})]})]})})]})}const ca=async(o,m="Paciente")=>{if(!o||!o.meals||o.meals.length===0)throw new Error("Plano alimentar inv√°lido ou sem refei√ß√µes");const l=da(o.meals),f=ma(l),s=new Ws("p","mm","a4"),u=s.internal.pageSize.width,i=s.internal.pageSize.height,v=[70,125,70],j=[68,64,60],k=[120,113,108];let c=20;s.setFont("helvetica");try{const E=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(O=>{const h=new Image;h.onload=()=>{const a=u*.15,w=h.height/h.width*a,S=new FileReader;S.onloadend=()=>{const H=S.result;s.addImage(H,"PNG",14,10,a,w),O()},S.readAsDataURL(E)},h.src=URL.createObjectURL(E)})}catch(P){console.error("Erro ao carregar logo:",P)}s.setFontSize(20),s.setTextColor(...v),s.setFont("helvetica","bold"),s.text("Lista de Compras",u/2,c,{align:"center"}),c+=8,s.setFontSize(12),s.setTextColor(...j),s.setFont("helvetica","normal"),s.text(`Paciente: ${m}`,14,c),c+=6;const F=new Date().toLocaleDateString("pt-BR");s.setFontSize(10),s.setTextColor(...k),s.text(`Gerado em: ${F}`,14,c),c+=10,s.setDrawColor(...v),s.setLineWidth(.5),s.line(14,c,u-14,c),c+=8;const g=Object.keys(f).sort();for(let P=0;P<g.length;P++){const A=g[P],E=f[A];c>i-60&&(s.addPage(),c=20),s.setFontSize(14),s.setTextColor(...v),s.setFont("helvetica","bold"),s.text(A,14,c),c+=6;const O=E.map(h=>["",h.name,h.totalQuantity]);Hs(s,{startY:c,head:[["","Item","Quantidade Total"]],body:O,theme:"grid",headStyles:{fillColor:v,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{textColor:j,fontSize:10},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:"auto",halign:"left"},2:{cellWidth:50,halign:"right"}},margin:{left:14,right:14},styles:{lineColor:[200,200,200],lineWidth:.1},didParseCell:function(h){if(h.column.index===0&&h.row.index>=0){const a=h.cell.x+2,w=h.cell.y+2,S=4;s.setDrawColor(150,150,150),s.setLineWidth(.3),s.rect(a,w,S,S)}}}),c=s.lastAutoTable.finalY+8,P<g.length-1&&(c+=5)}const M=i-15;s.setFontSize(8),s.setTextColor(...k),s.setFont("helvetica","italic"),s.text("Gerado por HipoZero",u/2,M,{align:"center"});const C=`lista_compras_${m.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(C)};function da(o){const m=new Map;for(const l of o)if(!(!l.foods||l.foods.length===0))for(const f of l.foods){const s=f.foods?.name||f.food?.name||f.name||"Alimento n√£o identificado",u=parseFloat(f.quantity)||0,i=f.unit||"g",v=f.foods?.group||f.food?.group||"Outros",j=`${s.toLowerCase()}_${i}`;if(m.has(j)){const k=m.get(j);k.totalQuantity=es(k.totalQuantityValue+u,i),k.totalQuantityValue+=u}else m.set(j,{name:s,unit:i,category:v,totalQuantity:es(u,i),totalQuantityValue:u})}return Array.from(m.values())}function ma(o){const m={},l={"Cereais e derivados":"Cereais e Derivados","Verduras, hortali√ßas e derivados":"Verduras e Hortali√ßas","Frutas e sucos":"Frutas","Carnes e derivados":"Carnes","Leite e derivados":"Latic√≠nios","√ìleos e gorduras":"√ìleos e Gorduras","Pescados e frutos do mar":"Peixes e Frutos do Mar",Leguminosas:"Leguminosas","Nozes e sementes":"Nozes e Sementes",Bebidas:"Bebidas",Outros:"Outros"};for(const f of o){const s=l[f.category]||f.category||"Outros";m[s]||(m[s]=[]),m[s].push(f)}for(const f in m)m[f].sort((s,u)=>s.name.localeCompare(u.name,"pt-BR"));return m}function es(o,m){const l=Math.round(o*100)/100;return l%1===0?`${l} ${m}`:`${l.toFixed(2)} ${m}`}const Xa=()=>{const{patientId:o}=ys(),m=ss(),{toast:l}=as(),{user:f}=bs(),[s,u]=t.useState(!0),[i,v]=t.useState(!1),[j,k]=t.useState([]),[c,F]=t.useState(null),[g,M]=t.useState(""),[C,P]=t.useState(null),[A,E]=t.useState(!1),[O,h]=t.useState(null),[a,w]=t.useState(null),[S,H]=t.useState(!1),[Z,T]=t.useState(null),[p,q]=t.useState(!1),[B,W]=t.useState(null),[je,re]=t.useState(!1),[oe,d]=t.useState(!1),[x,N]=t.useState(!1),[z,D]=t.useState(""),[G,K]=t.useState("");t.useEffect(()=>{(async()=>{const{data:{user:y}}=await ce.auth.getUser();y&&w(y.id)})()},[]),t.useEffect(()=>{(async()=>{if(o)try{const{data:y,error:$}=await ce.from("user_profiles").select("name").eq("id",o).single();!$&&y&&M(y.name)}catch(y){console.error("Erro ao carregar nome do paciente:",y)}})()},[o]);const Q=t.useCallback(async()=>{if(o){u(!0);try{const[r,y]=await Promise.all([As(o),Ts(o)]);if(r.error)throw r.error;k(r.data||[]),F(y.data)}catch(r){console.error("Erro ao carregar planos:",r),l({title:"Erro",description:"N√£o foi poss√≠vel carregar os planos alimentares",variant:"destructive"})}finally{u(!1)}}},[o,l]);t.useEffect(()=>{Q()},[Q]),t.useEffect(()=>{(async()=>{if(c?.id){const{data:y}=await fs(c.id);P(y)}else P(null)})()},[c?.id]);const le=async(r,y=null)=>{v(!0);try{if(y){const $=await Es(y,r);if($.error)throw $.error}else{const $=await zs({patient_id:r.patient_id,nutritionist_id:r.nutritionist_id,name:r.name,description:r.description,active_days:r.active_days,start_date:r.start_date,end_date:r.end_date||null});if($.error)throw $.error;for(const J of r.meals){const R=await Is({meal_plan_id:$.data.id,name:J.name,meal_type:J.meal_type,meal_time:J.meal_time,notes:J.notes,order_index:J.order_index});if(R.error)throw R.error;for(const U of J.foods||[])await Ds({meal_plan_meal_id:R.data.id,food_id:U.food_id,quantity:U.quantity,unit:U.unit,calories:U.calories,protein:U.protein,carbs:U.carbs,fat:U.fat,notes:U.notes,order_index:U.order_index||0})}}l({title:"Sucesso",description:y?"Plano atualizado com sucesso":"Plano criado com sucesso",variant:"success"}),E(!1),h(null),await Q()}catch($){console.error("Erro ao salvar plano:",$),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o plano alimentar",variant:"destructive"})}finally{v(!1)}},ne=async r=>{try{const y=await ke(r);if(y.error)throw y.error;h(y.data),E(!0)}catch(y){console.error("Erro ao carregar plano para edi√ß√£o:",y),l({title:"Erro",description:"N√£o foi poss√≠vel carregar o plano para edi√ß√£o",variant:"destructive"})}},V=async r=>{try{const y=await Os(r);if(y.error)throw y.error;l({title:"Sucesso",description:"Plano arquivado com sucesso",variant:"success"}),await Q()}catch(y){console.error("Erro ao arquivar plano:",y),l({title:"Erro",description:"N√£o foi poss√≠vel arquivar o plano",variant:"destructive"})}},Y=async r=>{try{const y=await qs(r);if(y.error)throw y.error;l({title:"Sucesso",description:"Plano ativado com sucesso",variant:"success"}),await Q()}catch(y){console.error("Erro ao ativar plano:",y),l({title:"Erro",description:"N√£o foi poss√≠vel ativar o plano",variant:"destructive"})}},ie=r=>{const y=j.find($=>$.id===r)||c;y&&(W(y),q(!0))},ve=async r=>{try{const y=await Ls(B.id,r);if(y.error)throw y.error;l({title:"Sucesso",description:"Plano copiado para o paciente com sucesso",variant:"success"}),q(!1),W(null)}catch(y){console.error("Erro ao copiar modelo:",y),l({title:"Erro",description:"N√£o foi poss√≠vel copiar o modelo para o paciente",variant:"destructive"})}},de=async()=>{if(!c){l({title:"Erro",description:"Nenhum plano ativo encontrado.",variant:"destructive"});return}try{const r=await ke(c.id);if(r.error)throw r.error;const y=r.data;await ca(y,g),l({title:"Lista de Compras gerada!",description:"O PDF foi baixado com sucesso."})}catch(r){console.error("Erro ao gerar lista de compras:",r),l({title:"Erro",description:"N√£o foi poss√≠vel gerar a lista de compras. Tente novamente.",variant:"destructive"})}},n=async r=>{if(c)try{re(!1);const y=await ke(c.id);if(y.error)throw y.error;const $=y.data;await Vs($,g,f?.profile?.name,r,Qs,ps),l({title:"PDF gerado!",description:"Plano alimentar exportado com sucesso.",variant:"success"})}catch(y){console.error("Erro ao exportar PDF:",y),l({title:"Erro",description:"N√£o foi poss√≠vel exportar o plano alimentar",variant:"destructive"})}},b=async()=>{if(Z)try{const r=await Rs(Z);if(r.error)throw r.error;l({title:"Sucesso",description:"Plano deletado com sucesso",variant:"success"}),T(null),H(!1),await Q()}catch(r){console.error("Erro ao deletar plano:",r),l({title:"Erro",description:"N√£o foi poss√≠vel deletar o plano",variant:"destructive"})}},L=r=>r?new Date(r).toLocaleDateString("pt-BR"):null,I=r=>{if(!r||r.length===0)return"Nenhum dia";if(r.length===7)return"Todos os dias";const y=["monday","tuesday","wednesday","thursday","friday"],$=["saturday","sunday"],J=y.every(U=>r.includes(U))&&!$.some(U=>r.includes(U)),R=$.every(U=>r.includes(U))&&!y.some(U=>r.includes(U));return J?"Dias √∫teis":R?"Fins de semana":`${r.length} dias`},X=async()=>{if(!(!c||!z.trim())){v(!0);try{const r=G?G.split(",").map(J=>J.trim()).filter(J=>J.length>0):[],{data:y,error:$}=await $s(c.id,z.trim(),r);if($)throw $;l({title:"Template Salvo",description:`O plano foi salvo como template "${z}" com sucesso.`,variant:"success"}),N(!1),D(""),K("")}catch(r){console.error("Erro ao salvar template:",r),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o template.",variant:"destructive"})}finally{v(!1)}}},we=async r=>{await Q(),r&&F(r)};return s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Carregando..."})}):A?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(_,{variant:"ghost",onClick:()=>{E(!1),h(null)},children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Voltar"]})}),e.jsx(oa,{patientId:o,nutritionistId:a,initialData:O,onSubmit:le,onCancel:()=>{E(!1),h(null)},loading:i})]}):e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>m(`/nutritionist/patients/${o}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(Qe,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:Q,className:"flex-shrink-0",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Ie,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"truncate",children:"Planos Alimentares"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gerencie os planos alimentares do paciente"})]}),e.jsxs(_,{size:"sm",onClick:()=>E(!0),className:"w-full sm:w-auto",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Novo Plano"]})]})]}),c&&e.jsxs(se,{className:"mb-6 border-primary shadow-sm",children:[e.jsx(fe,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(ge,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx("span",{className:"break-words",children:c.name}),e.jsx(Ne,{className:"bg-primary",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>ne(c.id),className:"hidden sm:flex",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(_,{size:"sm",onClick:()=>m(`/nutritionist/patients/${o}/meal-plan/${c.id}/summary`),className:"hidden sm:flex",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Resumo Nutricional"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:de,className:"hidden sm:flex",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Lista de Compras"]}),e.jsxs(ws,{children:[e.jsx(Cs,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:e.jsx(Ks,{className:"h-4 w-4"})})}),e.jsxs(_s,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsxs(Ce,{onClick:()=>ne(c.id),children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Editar Plano"]}),e.jsxs(Ce,{onClick:()=>m(`/nutritionist/patients/${o}/meal-plan/${c.id}/summary`),children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Ver Resumo Nutricional"]}),e.jsx(Ve,{})]}),e.jsxs(Ce,{onClick:()=>re(!0),children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),e.jsxs(Ce,{onClick:de,children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Gerar Lista de Compras"]}),e.jsxs(Ce,{onClick:()=>ie(c.id),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Copiar como Modelo"]}),e.jsx(Ve,{}),e.jsxs(Ce,{onClick:()=>V(c.id),className:"text-destructive focus:text-destructive",children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Arquivar Plano"]})]})]})]})]})})}),e.jsxs(ae,{children:[c.description&&e.jsx("p",{className:"text-muted-foreground mb-4",children:c.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"In√≠cio"}),e.jsx("div",{className:"font-semibold",children:L(c.start_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"T√©rmino"}),e.jsx("div",{className:"font-semibold",children:c.end_date?L(c.end_date):"Indeterminado"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dias Ativos"}),e.jsx("div",{className:"font-semibold",children:I(c.active_days)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Refei√ß√µes"}),e.jsx("div",{className:"font-semibold",children:c.meals?.length||0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:c.meals&&c.meals.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold mb-3",children:"Refei√ß√µes:"}),c.meals.map((r,y)=>e.jsx("div",{className:"p-3 border rounded-lg bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[y+1,". ",r.name,r.meal_time&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["√†s ",r.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.foods?.length||0," alimento(s) ‚Ä¢"," ",r.total_calories?.toFixed(0)||0," kcal"]})]})})},r.id))]}):e.jsx(Pe,{children:e.jsx(Me,{children:"Nenhuma refei√ß√£o adicionada ainda."})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(gs,{protein:c.daily_protein||0,carbs:c.daily_carbs||0,fat:c.daily_fat||0,calories:c.daily_calories||0,patientId:o,planId:null,referenceValues:C,onReferenceUpdate:null,readOnly:!0})})]})]})]}),e.jsxs(se,{children:[e.jsx(fe,{children:e.jsx(ge,{children:"Todos os Planos"})}),e.jsx(ae,{children:j.length===0?e.jsx(Pe,{children:e.jsx(Me,{children:'Nenhum plano alimentar criado ainda. Clique em "Novo Plano" para come√ßar.'})}):e.jsx("div",{className:"space-y-3",children:j.map(r=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:r.name}),r.is_active&&e.jsx(Ne,{variant:"outline",children:"Ativo"}),!r.is_active&&e.jsx(Ne,{variant:"secondary",children:"Arquivado"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[L(r.start_date),r.end_date&&` at√© ${L(r.end_date)}`," ","‚Ä¢ ",I(r.active_days)," ","‚Ä¢ ",r.daily_calories?.toFixed(0)||0," kcal/dia"]})]}),e.jsxs("div",{className:"flex gap-2",children:[!r.is_active&&e.jsx(_,{variant:"default",size:"sm",onClick:()=>Y(r.id),title:"Ativar este plano",children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>ne(r.id),title:"Editar plano",children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>ie(r.id),title:"Copiar modelo",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>{T(r.id),H(!0)},title:"Deletar plano",children:e.jsx(Le,{className:"h-4 w-4 text-destructive"})})]})]})},r.id))})})]}),e.jsx(ts,{open:S,onOpenChange:H,children:e.jsxs(rs,{children:[e.jsxs(ls,{children:[e.jsx(os,{children:"Confirmar Exclus√£o"}),e.jsx(ns,{children:"Tem certeza que deseja deletar este plano alimentar? Esta a√ß√£o n√£o pode ser desfeita."})]}),e.jsxs(is,{children:[e.jsx(cs,{onClick:()=>T(null),children:"Cancelar"}),e.jsx(ds,{onClick:b,className:"bg-destructive",children:"Deletar"})]})]})}),e.jsx(na,{isOpen:p,onClose:()=>{q(!1),W(null)},planId:B?.id,planName:B?.name,onCopy:ve}),e.jsx(me,{open:x,onOpenChange:N,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Salvar Plano como Modelo"}),e.jsx(pe,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:z,onChange:r=>D(r.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por v√≠rgula)"}),e.jsx(te,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:G,onChange:r=>K(r.target.value),disabled:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(be,{children:[e.jsx(_,{variant:"outline",onClick:()=>{N(!1),D(""),K("")},disabled:i,children:"Cancelar"}),e.jsx(_,{onClick:X,disabled:i||!z.trim(),children:i?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(Je,{open:oe,onOpenChange:d,patientId:o,nutritionistId:a,onTemplateApplied:we}),e.jsx(me,{open:je,onOpenChange:re,children:e.jsxs(xe,{className:"sm:max-w-md",children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Exportar Plano Alimentar"}),e.jsx(pe,{children:"Escolha o formato de exporta√ß√£o para PDF"})]}),e.jsxs("div",{className:"grid gap-3 py-4",children:[e.jsx(se,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>n(!1),children:e.jsxs(ae,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Simples"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macronutrientes b√°sicos (calorias, prote√≠nas, carboidratos e gorduras)"})]})]})}),e.jsx(se,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>n(!0),children:e.jsxs(ae,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-secondary/10 text-secondary",children:e.jsx(Ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Completo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macros + micronutrientes (fibras, vitaminas, minerais)"})]})]})})]}),e.jsx(be,{className:"sm:justify-start",children:e.jsx(_,{variant:"ghost",onClick:()=>re(!1),className:"w-full sm:w-auto",children:"Cancelar"})})]})}),e.jsx(me,{open:x,onOpenChange:N,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Salvar Plano como Modelo"}),e.jsx(pe,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:z,onChange:r=>D(r.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por v√≠rgula)"}),e.jsx(te,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:G,onChange:r=>K(r.target.value),disabled:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(be,{children:[e.jsx(_,{variant:"outline",onClick:()=>{N(!1),D(""),K("")},disabled:i,children:"Cancelar"}),e.jsx(_,{onClick:X,disabled:i||!z.trim(),children:i?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(Je,{open:oe,onOpenChange:d,patientId:o,nutritionistId:a,onTemplateApplied:we})]})};export{Xa as default};
