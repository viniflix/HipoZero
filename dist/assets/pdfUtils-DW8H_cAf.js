import{E as L}from"./jspdf.es.min-DtjUTZMk.js";import{a as T}from"./jspdf.plugin.autotable-C3NxY6Hi.js";import"./html2canvas.esm-B0tyYwQk.js";const W=(g,b,$)=>{const d=new L,a="Nutricionista";d.setFontSize(18),d.text(`Relatório Financeiro - ${$}`,14,22),d.setFontSize(11),d.text(`Gerado por: ${a}`,14,30),d.text(`Data: ${new Date().toLocaleDateString("pt-BR")}`,14,36);const S=b?.income||0,t=b?.expenses||0,p=b?.netResult||S-t;T(d,{startY:45,head:[["Resumo","Valor"]],body:[["Receitas",`R$ ${S.toFixed(2)}`],["Despesas",`R$ ${t.toFixed(2)}`],["Saldo",`R$ ${p.toFixed(2)}`]],theme:"striped"});const C=["Data","Tipo","Descrição","Categoria","Valor (R$)"],h=[];g.forEach(_=>{const x=_.amount||0,v=[new Date(_.transaction_date+"T00:00:00").toLocaleDateString("pt-BR"),_.type==="income"?"Receita":"Despesa",_.description||"",_.category||(_.income_source==="patient_payment"?"Pag. Paciente":"Outra"),x.toFixed(2)];h.push(v)}),T(d,{head:[C],body:h,startY:d.lastAutoTable.finalY+10}),d.save(`relatorio_financeiro_${$}.pdf`)},E=async(g,b,$,d)=>{const a=new L,S=[70,125,70],t=[68,64,60],p=[120,113,108],C="https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png";let h=null;try{const u=await(await fetch(C)).blob();h=await new Promise(y=>{const R=new FileReader;R.onloadend=()=>y(R.result),R.readAsDataURL(u)}),a.addImage(h,"PNG",14,10,40,10)}catch(s){console.error("Erro ao carregar logo:",s)}a.setFont("helvetica","bold"),a.setFontSize(20),a.setTextColor(...S),a.text("AGENDA DE CONSULTAS",105,20,{align:"center"}),a.setFont("helvetica","normal"),a.setFontSize(10),a.setTextColor(...t),a.text(`Período: ${$}`,14,30);const x=d&&d!=="Nutricionista"?(s=>s?s.toLowerCase().split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" "):"Não informado")(d):"Não informado";a.text(`Nutricionista: ${x}`,14,35),a.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} às ${new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`,14,40),a.setFontSize(9),a.setTextColor(...p),a.text(`Total de consultas: ${g.length}`,14,46),a.setLineWidth(.5),a.setDrawColor(...S),a.line(14,50,196,50);const v=[],D={scheduled:"Agendada",confirmed:"Confirmada",awaiting_confirmation:"Aguardando",completed:"Realizada",cancelled:"Cancelada",no_show:"Faltou"},o={first_appointment:"Primeira Consulta",return:"Retorno",evaluation:"Avaliação",online:"Online",in_person:"Presencial"};g.forEach(s=>{const u=new Date(s.appointment_time),y=u.toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit"}),R=u.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),w=s.duration||60,i=new Date(u.getTime()+w*6e4).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),r=`${R} - ${i}`;v.push([y,r,s.patient?.name||"Não identificado",o[s.appointment_type]||"Não especificado",D[s.status]||"Agendada"])}),T(a,{startY:54,head:[["Data","Horário","Paciente","Tipo","Status"]],body:v,theme:"striped",headStyles:{fillColor:S,textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:8,textColor:t,font:"helvetica"},columnStyles:{0:{cellWidth:28,halign:"center"},1:{cellWidth:32,halign:"center"},2:{cellWidth:55,halign:"left",fontStyle:"bold"},3:{cellWidth:40,halign:"center"},4:{cellWidth:27,halign:"center"}},margin:{top:54,left:14,right:14},alternateRowStyles:{fillColor:[237,236,237]}});const c=a.internal.getNumberOfPages();for(let s=1;s<=c;s++)a.setPage(s),a.setFont("helvetica","normal"),a.setFontSize(8),a.setTextColor(...p),a.text(`Página ${s} de ${c} • HipoZero © ${new Date().getFullYear()}`,a.internal.pageSize.getWidth()/2,a.internal.pageSize.getHeight()-10,{align:"center"});const F=`agenda_${b}_${new Date().toISOString().split("T")[0]}.pdf`;a.save(F)},I=async(g,b,$,d,a,S)=>{const t=new L,p=t.internal.pageSize.width,C=t.internal.pageSize.height,h=[70,125,70],_=[238,103,6],x=[68,64,60],v=[120,113,108],D=[245,245,244];let o=20;t.setFont("helvetica");try{const f=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(l=>{const n=new Image;n.onload=()=>{const e=p*.2,z=n.height/n.width*e,m=new FileReader;m.onloadend=()=>{const O=m.result;t.addImage(O,"PNG",14,10,e,z),l()},m.readAsDataURL(f)},n.src=URL.createObjectURL(f)})}catch(i){console.error("Erro ao carregar logo:",i)}if(t.setFontSize(20),t.setTextColor(...h),t.setFont("helvetica","bold"),t.text("Plano Alimentar",p/2,20,{align:"center"}),t.setDrawColor(...h),t.setLineWidth(.5),t.line(14,24,p-14,24),o=32,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(...x),b&&(t.text(`Paciente: ${b}`,14,o),o+=5),$){const i=r=>r?r.toLowerCase().split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" "):"Não informado";t.text(`Nutricionista: ${i($)}`,14,o),o+=5}if(g.start_date){const i=new Date(g.start_date).toLocaleDateString("pt-BR"),r=g.end_date?new Date(g.end_date).toLocaleDateString("pt-BR"):"Indeterminado";t.text(`Período: ${i} até ${r}`,14,o),o+=5}t.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} às ${new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`,14,o),o+=10;const c=(g.meals||[]).reduce((i,r)=>{const l=(r.foods||[]).reduce((n,e)=>({calories:n.calories+(e.calories||0),protein:n.protein+(e.protein||0),carbs:n.carbs+(e.carbs||0),fat:n.fat+(e.fat||0),fiber:n.fiber+(e.food?.fiber?e.food.fiber*(e.quantity||0)/100:0),sodium:n.sodium+(e.food?.sodium?e.food.sodium*(e.quantity||0)/100:0),calcium:n.calcium+(e.food?.calcium?e.food.calcium*(e.quantity||0)/100:0),iron:n.iron+(e.food?.iron?e.food.iron*(e.quantity||0)/100:0),magnesium:n.magnesium+(e.food?.magnesium?e.food.magnesium*(e.quantity||0)/100:0),potassium:n.potassium+(e.food?.potassium?e.food.potassium*(e.quantity||0)/100:0),zinc:n.zinc+(e.food?.zinc?e.food.zinc*(e.quantity||0)/100:0),vitamin_a:n.vitamin_a+(e.food?.vitamin_a?e.food.vitamin_a*(e.quantity||0)/100:0),vitamin_c:n.vitamin_c+(e.food?.vitamin_c?e.food.vitamin_c*(e.quantity||0)/100:0),vitamin_d:n.vitamin_d+(e.food?.vitamin_d?e.food.vitamin_d*(e.quantity||0)/100:0)}),{calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0,calcium:0,iron:0,magnesium:0,potassium:0,zinc:0,vitamin_a:0,vitamin_c:0,vitamin_d:0});return{calories:i.calories+l.calories,protein:i.protein+l.protein,carbs:i.carbs+l.carbs,fat:i.fat+l.fat,fiber:i.fiber+l.fiber,sodium:i.sodium+l.sodium,calcium:i.calcium+l.calcium,iron:i.iron+l.iron,magnesium:i.magnesium+l.magnesium,potassium:i.potassium+l.potassium,zinc:i.zinc+l.zinc,vitamin_a:i.vitamin_a+l.vitamin_a,vitamin_c:i.vitamin_c+l.vitamin_c,vitamin_d:i.vitamin_d+l.vitamin_d}},{calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0,calcium:0,iron:0,magnesium:0,potassium:0,zinc:0,vitamin_a:0,vitamin_c:0,vitamin_d:0});t.setFillColor(...D),t.roundedRect(14,o,p-28,20,2,2,"F"),t.setFontSize(9),t.setTextColor(...x),t.setFont("helvetica","bold"),t.text("Meta Diária Total:",18,o+6),t.setFont("helvetica","normal"),t.setTextColor(...v);const F=`${Math.round(c.calories)} kcal  •  Proteínas: ${Math.round(c.protein)}g  •  Carboidratos: ${Math.round(c.carbs)}g  •  Gorduras: ${Math.round(c.fat)}g`;t.text(F,18,o+13),o+=28;const s=["breakfast","morning_snack","lunch","afternoon_snack","dinner","supper"],u=[...g.meals||[]].sort((i,r)=>s.indexOf(i.meal_type)-s.indexOf(r.meal_type));for(let i=0;i<u.length;i++){const r=u[i],f=r.foods||[],l=15+(f.length+1)*7+(r.notes?10:0);o+l>C-30&&(t.addPage(),o=20),t.setFontSize(12),t.setTextColor(...h),t.setFont("helvetica","bold");const n=a?a(r.meal_type):r.name,e=r.meal_time||"";if(t.text(`${n}${e?` • ${e}`:""}`,14,o),o+=7,f.length>0){const z=f.map(m=>[m.food?.name||"Alimento",S?S(m.quantity||0,m.unit||"",m.measure):`${m.quantity||0} ${m.unit||""}`,Math.round(m.calories||0),Math.round(m.protein||0),Math.round(m.carbs||0),Math.round(m.fat||0)]);T(t,{startY:o,head:[["Alimento","Quantidade","Calorias","Proteína","Carboidrato","Gordura"]],body:z,theme:"striped",headStyles:{fillColor:h,textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:8,textColor:x,font:"helvetica"},columnStyles:{0:{halign:"left",cellWidth:"auto"},1:{halign:"center",cellWidth:30},2:{halign:"center",cellWidth:23},3:{halign:"center",cellWidth:23},4:{halign:"center",cellWidth:28},5:{halign:"center",cellWidth:23}},alternateRowStyles:{fillColor:D},margin:{left:14,right:14}}),o=t.lastAutoTable.finalY+3}r.notes&&(t.setFontSize(8),t.setTextColor(...v),t.setFont("helvetica","italic"),t.text(`Obs: ${r.notes}`,14,o),o+=6),i<u.length-1&&(o+=5)}if(d){o+80>C-30?(t.addPage(),o=20):o+=10,t.setFontSize(14),t.setTextColor(...h),t.setFont("helvetica","bold"),t.text("Resumo de Micronutrientes",14,o),o+=10;const i=[["Fibras",`${Math.round(c.fiber)}g`],["Sódio",`${Math.round(c.sodium)}mg`],["Cálcio",`${Math.round(c.calcium)}mg`],["Ferro",`${Math.round(c.iron)}mg`],["Magnésio",`${Math.round(c.magnesium)}mg`],["Potássio",`${Math.round(c.potassium)}mg`],["Zinco",`${Math.round(c.zinc)}mg`],["Vitamina A",`${Math.round(c.vitamin_a)}µg`],["Vitamina C",`${Math.round(c.vitamin_c)}mg`],["Vitamina D",`${Math.round(c.vitamin_d)}µg`]];T(t,{startY:o,head:[["Micronutriente","Quantidade Total"]],body:i,theme:"striped",headStyles:{fillColor:_,textColor:[255,255,255],fontSize:10,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:9,textColor:x,font:"helvetica"},columnStyles:{0:{halign:"left",cellWidth:100},1:{halign:"center",cellWidth:"auto"}},alternateRowStyles:{fillColor:D},margin:{left:14,right:14}}),o=t.lastAutoTable.finalY+10}const y=t.internal.getNumberOfPages();for(let i=1;i<=y;i++)t.setPage(i),t.setFontSize(8),t.setTextColor(...v),t.setFont("helvetica","normal"),t.text(`Página ${i} de ${y}`,p-14,C-10,{align:"right"});const w=`plano-alimentar-${d?"completo":"simples"}-${b?.replace(/\s+/g,"-").toLowerCase()||"paciente"}-${new Date().toISOString().split("T")[0]}.pdf`;t.save(w)};export{W as a,E as b,I as e};
