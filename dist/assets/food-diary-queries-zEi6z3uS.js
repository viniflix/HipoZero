import{s as g}from"./index-DL6VMzkS.js";import{f as y,g as D}from"./date-C2sroe8F.js";import{l as h}from"./query-helpers-mbysFH2_.js";const E=async(t,e={},r=50,a=0)=>{try{let o=g.from("meals").select(`
                *,
                meal_items (
                    *
                )
            `).eq("patient_id",t).order("meal_date",{ascending:!1}).order("meal_time",{ascending:!1}).range(a,a+r-1);e.startDate&&(o=o.gte("meal_date",e.startDate)),e.endDate&&(o=o.lte("meal_date",e.endDate)),e.mealType&&(o=o.eq("meal_type",e.mealType));const{data:n,error:l,count:s}=await o;if(l)throw l;return{data:n,error:null,count:s}}catch(o){return h("Erro ao buscar refeições",o),{data:null,error:o}}},q=async t=>{try{const{data:e,error:r}=await g.from("meal_audit_log").select("*").eq("meal_id",t).order("created_at",{ascending:!1});if(r)throw r;return{data:e,error:null}}catch(e){return h("Erro ao buscar histórico de auditoria",e),{data:null,error:e}}},C=async(t,e={},r=100)=>{try{let a=g.from("meal_audit_log").select("*").eq("patient_id",t).order("created_at",{ascending:!1}).limit(r);e.action&&(a=a.eq("action",e.action)),e.startDate&&(a=a.gte("meal_date",e.startDate)),e.endDate&&(a=a.lte("meal_date",e.endDate));const{data:o,error:n}=await a;if(n)throw n;return{data:o,error:null}}catch(a){return h("Erro ao buscar histórico completo",a),{data:null,error:a}}},P=async(t,e=30)=>{try{const r=new Date;r.setDate(r.getDate()-e);const a=y(r),{data:o,error:n}=await g.from("meals").select("meal_date").eq("patient_id",t).gte("meal_date",a);if(n)throw n;const l=new Set(o.map(m=>m.meal_date)),s=l.size,d=s/e*100;let c=0;const u=D(),i=Array.from(l).sort().reverse();for(let m=0;m<e;m++){const b=new Date;b.setDate(b.getDate()-m);const f=y(b);if(i.includes(f))c++;else if(f!==u)break}return{data:{totalDays:e,daysWithRecords:s,adherencePercentage:Math.round(d),currentStreak:c,totalMeals:o.length},error:null}}catch(r){return h("Erro ao calcular adesão",r),{data:null,error:r}}},v=async(t,e,r)=>{try{const{data:a,error:o}=await g.from("meals").select(`
                *,
                meal_items (
                    quantity,
                    calories,
                    protein,
                    carbs,
                    fat
                )
            `).eq("patient_id",t).gte("meal_date",e).lte("meal_date",r);if(o)throw o;let n=0,l=0,s=0,d=0;a.forEach(u=>{u.meal_items?.forEach(i=>{n+=i.calories||0,l+=i.protein||0,s+=i.carbs||0,d+=i.fat||0})});const c=a.length>0?new Set(a.map(u=>u.meal_date)).size:1;return{data:{totalMeals:a.length,days:c,avgCaloriesPerDay:Math.round(n/c),avgProteinPerDay:Math.round(l/c),avgCarbsPerDay:Math.round(s/c),avgFatPerDay:Math.round(d/c),totals:{calories:Math.round(n),protein:Math.round(l),carbs:Math.round(s),fat:Math.round(d)}},error:null}}catch(a){return h("Erro ao calcular resumo nutricional",a),{data:null,error:a}}},A=t=>{const e={create:{icon:"Plus",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",label:"Registrou",description:"Nova refeição adicionada"},update:{icon:"Edit",color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",label:"Editou",description:"Refeição modificada"},delete:{icon:"Trash2",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",label:"Excluiu",description:"Refeição removida"}};return e[t.action]||e.create},S=t=>{if(!t||!t.changes)return[];const e=[];return Object.keys(t.changes).forEach(r=>{const a=t.changes[r];e.push({field:r,oldValue:a.old,newValue:a.new,label:_(r)})}),e},_=t=>({meal_type:"Tipo de Refeição",meal_date:"Data",meal_time:"Horário",notes:"Observações",foods:"Alimentos"})[t]||t;export{E as a,C as b,P as c,q as d,S as e,A as f,v as g};
