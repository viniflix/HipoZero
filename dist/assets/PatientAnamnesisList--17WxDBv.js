import{b as Q,a5 as U,u as W,r as a,j as e,L as A,B as o,A as X,h as Y,i as Z,k as ee,l as se,n as te,o as ae,p as re,C as E,e as S,$ as j,E as ne,D as ie,x as le,y as oe,z as ce,T as de,J as me,K as xe,M as he,N as fe,ad as ue,O as pe}from"./index-DL6VMzkS.js";import{B as k}from"./badge-CMQ26CgR.js";import{A as ge,a as je}from"./alert-WBazYc63.js";import{a as Ne,b as be,l as we}from"./anamnesis-queries-aQPvoJcl.js";import{f as ve}from"./patient-queries-DGcE69Ge.js";import{C as T}from"./clipboard-list-BCXGfh2G.js";import{P}from"./plus-D17bPVCi.js";import{A as De}from"./alert-circle-C4M18OPV.js";import{F as Ce}from"./file-text-C4_WSc72.js";import{C as ye}from"./calendar-jIa_pVTS.js";import{M as Ae}from"./more-vertical-C9pHiQH7.js";import"./date-C2sroe8F.js";import"./query-helpers-mbysFH2_.js";import"./mealTranslations-B1KHhmEq.js";const qe=()=>{const d=Q(),{patientId:r}=U(),{user:m}=W(),[N,L]=a.useState(null),[u,b]=a.useState([]),[x,M]=a.useState([]),[R,w]=a.useState(!0),[v,h]=a.useState(null),[B,f]=a.useState(!1),[n,$]=a.useState(null),[z,p]=a.useState(!1),[i,D]=a.useState(null),[g,C]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!r||!m?.id)){w(!0),h(null);try{const{data:t,error:l}=await ve(r,m.id);if(l)throw new Error("Erro ao buscar dados do paciente");L(t);const{data:c,error:J}=await Ne(r);if(J)throw new Error("Erro ao buscar anamneses");b(c||[]);const{data:K,error:G}=await be(m.id);if(G)throw new Error("Erro ao buscar templates");M(K||[])}catch(t){console.error("Erro ao carregar dados:",t),h(t.message)}finally{w(!1)}}})()},[r,m?.id]);const y=()=>{if(x.length===0){h("Nenhum template disponível. Entre em contato com o suporte.");return}if(x.length===1){d(`/nutritionist/patients/${r}/anamnesis/new?templateId=${x[0].id}`);return}f(!0)},_=()=>{n&&(f(!1),d(`/nutritionist/patients/${r}/anamnesis/new?templateId=${n}`))},F=s=>{d(`/nutritionist/patients/${r}/anamnesis/${s}/edit`)},I=(s,t)=>{t.stopPropagation(),D(s),p(!0)},q=async()=>{if(i){C(!0);try{const{error:s}=await we(i.id);if(s)throw s;b(t=>t.filter(l=>l.id!==i.id)),p(!1),D(null)}catch(s){console.error("Erro ao excluir anamnese:",s),h("Erro ao excluir anamnese. Tente novamente.")}finally{C(!1)}}};if(R)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-[#5f6f52] mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando anamneses..."})]})});const H=()=>e.jsx(E,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30",children:e.jsxs(S,{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-[#fefae0] flex items-center justify-center mb-6",children:e.jsx(T,{className:"w-10 h-10 text-[#5f6f52]"})}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-3",children:"Nenhuma Anamnese Registrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-8 max-w-md",children:"Aqui fica o histórico clínico do paciente. Inicie a primeira investigação agora."}),e.jsxs(o,{onClick:y,size:"lg",className:"gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Registrar Primeira Anamnese"]})]})}),O=({anamnesis:s})=>{const t={draft:{label:"Rascunho",color:"bg-yellow-100 text-yellow-800 border-yellow-300"},completed:{label:"Completa",color:"bg-green-100 text-green-800 border-green-300"}},l=t[s.status]||t.draft;return e.jsx(E,{className:"hover:shadow-md transition-all hover:border-[#5f6f52]",children:e.jsx(S,{className:"p-0",children:e.jsxs("div",{className:"flex items-start gap-4 p-6 group",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[#5f6f52]/10 flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-[#5f6f52]"})})}),e.jsxs("button",{onClick:()=>F(s.id),className:"flex-1 min-w-0 text-left hover:bg-[#fefae0]/30 -mx-4 -my-6 px-4 py-6 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-semibold text-base text-foreground",children:s.template?.title||"Anamnese"}),e.jsx(k,{variant:"outline",className:j("text-xs",l.color),children:l.label})]}),e.jsx(ne,{className:"w-5 h-5 text-muted-foreground flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ye,{className:"w-4 h-4"}),new Date(s.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]}),s.updated_at&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Última modificação: ",new Date(s.updated_at).toLocaleDateString("pt-BR")," às"," ",new Date(s.updated_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),s.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-2",children:s.notes})]}),e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:c=>c.stopPropagation(),children:e.jsx(Ae,{className:"h-4 w-4"})})}),e.jsx(oe,{align:"end",children:e.jsxs(ce,{onClick:c=>I(s,c),className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Excluir"]})})]})]})})})},V=()=>e.jsx(me,{open:B,onOpenChange:f,children:e.jsxs(xe,{className:"max-w-md",children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Escolher Modelo de Anamnese"}),e.jsx(ue,{children:"Selecione o template que deseja utilizar para esta anamnese"})]}),e.jsx("div",{className:"space-y-2 py-4",children:x.map(s=>e.jsx("button",{onClick:()=>$(s.id),className:j("w-full text-left p-4 rounded-lg border-2 transition-all",n===s.id?"border-[#5f6f52] bg-[#5f6f52]/5":"border-gray-200 hover:border-[#5f6f52]/50"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:j("w-5 h-5 rounded-full border-2 flex items-center justify-center flex-shrink-0 mt-0.5",n===s.id?"border-[#5f6f52] bg-[#5f6f52]":"border-gray-300"),children:n===s.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:s.title}),s.is_system_default&&e.jsx(k,{variant:"outline",className:"text-xs bg-[#5f6f52]/10 text-[#5f6f52] border-[#5f6f52]",children:"Padrão"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]})},s.id))}),e.jsxs(pe,{children:[e.jsx(o,{variant:"outline",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(o,{onClick:_,disabled:!n,children:"Continuar"})]})]})});return e.jsxs("div",{className:"min-h-screen bg-background overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-5xl mx-auto p-4 md:p-6 space-y-6 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 md:gap-3 mb-2",children:e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>d(`/nutritionist/patients/${r}/hub`),children:"← Voltar ao Prontuário"})}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2 md:gap-3 break-words",children:[e.jsx(T,{className:"w-6 h-6 md:w-8 md:h-8 text-[#5f6f52] shrink-0"}),"Histórico de Anamneses"]}),N&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1 truncate",children:["Paciente: ",e.jsx("span",{className:"font-medium text-foreground",children:N.full_name})]})]}),u.length>0&&e.jsxs(o,{onClick:y,size:"lg",className:"gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Nova Anamnese"]})]}),v&&e.jsxs(ge,{variant:"destructive",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx(je,{children:v})]}),u.length===0?e.jsx(H,{}):e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsx(O,{anamnesis:s},s.id))})]}),e.jsx(V,{}),e.jsx(X,{open:z,onOpenChange:p,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Confirmar Exclusão"}),e.jsxs(se,{children:["Tem certeza que deseja excluir esta anamnese? Esta ação não pode ser desfeita.",i&&e.jsxs("div",{className:"mt-3 p-3 bg-[#fefae0] rounded-lg border border-[#a9b388]",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:i.template?.title||"Anamnese"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Data: ",new Date(i.date).toLocaleDateString("pt-BR")]})]})]})]}),e.jsxs(te,{children:[e.jsx(ae,{disabled:g,children:"Cancelar"}),e.jsx(re,{onClick:q,disabled:g,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:g?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),"Excluindo..."]}):"Excluir"})]})]})})]})};export{qe as default};
