import{q as U,r,j as s,R as z,u as K,a as Q,L as E,m as Y,C as B,c as M,U as A,B as S,d as D,w as I,e as T,s as N}from"./index-CcAkuQOE.js";import{I as $}from"./input-D9F4g-Hh.js";import{L as v}from"./label-Bd-4jfJh.js";import{_ as w}from"./extends-CF3RwP-h.js";import{T as ee}from"./textarea-Bd9gTp9v.js";import{S as se,a as te,b as ae,c as re,d as ne}from"./select-oDZE1VMR.js";import{U as oe}from"./upload-7SpNhT9A.js";import{P as ce,M as ie}from"./phone-Otgh--2H.js";import{B as le}from"./briefcase-BOtW1BDI.js";import{I as de}from"./info-DiLFARq2.js";const ue=U("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]),fe=U("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function pe(e,n,{checkForDefaultPrevented:a=!0}={}){return function(o){if(e?.(o),a===!1||!o.defaultPrevented)return n?.(o)}}function he(e,n){typeof e=="function"?e(n):e!=null&&(e.current=n)}function L(...e){return n=>e.forEach(a=>he(a,n))}function me(...e){return r.useCallback(L(...e),e)}function xe(e,n=[]){let a=[];function c(d,t){const i=r.createContext(t),u=a.length;a=[...a,t];function f(p){const{scope:h,children:j,...x}=p,C=h?.[e][u]||i,l=r.useMemo(()=>x,Object.values(x));return r.createElement(C.Provider,{value:l},j)}function b(p,h){const j=h?.[e][u]||i,x=r.useContext(j);if(x)return x;if(t!==void 0)return t;throw new Error(`\`${p}\` must be used within \`${d}\``)}return f.displayName=d+"Provider",[f,b]}const o=()=>{const d=a.map(t=>r.createContext(t));return function(i){const u=i?.[e]||d;return r.useMemo(()=>({[`__scope${e}`]:{...i,[e]:u}}),[i,u])}};return o.scopeName=e,[c,be(o,...n)]}function be(...e){const n=e[0];if(e.length===1)return n;const a=()=>{const c=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(d){const t=c.reduce((i,{useScope:u,scopeName:f})=>{const p=u(d)[`__scope${f}`];return{...i,...p}},{});return r.useMemo(()=>({[`__scope${n.scopeName}`]:t}),[t])}};return a.scopeName=n.scopeName,a}function V(e){const n=r.useRef(e);return r.useEffect(()=>{n.current=e}),r.useMemo(()=>(...a)=>{var c;return(c=n.current)===null||c===void 0?void 0:c.call(n,...a)},[])}function ve({prop:e,defaultProp:n,onChange:a=()=>{}}){const[c,o]=ge({defaultProp:n,onChange:a}),d=e!==void 0,t=d?e:c,i=V(a),u=r.useCallback(f=>{if(d){const p=typeof f=="function"?f(e):f;p!==e&&i(p)}else o(f)},[d,e,o,i]);return[t,u]}function ge({defaultProp:e,onChange:n}){const a=r.useState(e),[c]=a,o=r.useRef(c),d=V(n);return r.useEffect(()=>{o.current!==c&&(d(c),o.current=c)},[c,o,d]),a}function $e(e){const n=r.useRef({value:e,previous:e});return r.useMemo(()=>(n.current.value!==e&&(n.current.previous=n.current.value,n.current.value=e),n.current.previous),[e])}const je=globalThis?.document?r.useLayoutEffect:()=>{};function Ce(e){const[n,a]=r.useState(void 0);return je(()=>{if(e){a({width:e.offsetWidth,height:e.offsetHeight});const c=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const d=o[0];let t,i;if("borderBoxSize"in d){const u=d.borderBoxSize,f=Array.isArray(u)?u[0]:u;t=f.inlineSize,i=f.blockSize}else t=e.offsetWidth,i=e.offsetHeight;a({width:t,height:i})});return c.observe(e,{box:"border-box"}),()=>c.unobserve(e)}else a(void 0)},[e]),n}const q=r.forwardRef((e,n)=>{const{children:a,...c}=e,o=r.Children.toArray(a),d=o.find(we);if(d){const t=d.props.children,i=o.map(u=>u===d?r.Children.count(t)>1?r.Children.only(null):r.isValidElement(t)?t.props.children:null:u);return r.createElement(P,w({},c,{ref:n}),r.isValidElement(t)?r.cloneElement(t,void 0,i):null)}return r.createElement(P,w({},c,{ref:n}),a)});q.displayName="Slot";const P=r.forwardRef((e,n)=>{const{children:a,...c}=e;return r.isValidElement(a)?r.cloneElement(a,{...ye(c,a.props),ref:n?L(n,a.ref):a.ref}):r.Children.count(a)>1?r.Children.only(null):null});P.displayName="SlotClone";const Ne=({children:e})=>r.createElement(r.Fragment,null,e);function we(e){return r.isValidElement(e)&&e.type===Ne}function ye(e,n){const a={...n};for(const c in n){const o=e[c],d=n[c];/^on[A-Z]/.test(c)?o&&d?a[c]=(...i)=>{d(...i),o(...i)}:o&&(a[c]=o):c==="style"?a[c]={...o,...d}:c==="className"&&(a[c]=[o,d].filter(Boolean).join(" "))}return{...e,...a}}const Se=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],O=Se.reduce((e,n)=>{const a=r.forwardRef((c,o)=>{const{asChild:d,...t}=c,i=d?q:n;return r.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),r.createElement(i,w({},t,{ref:o}))});return a.displayName=`Primitive.${n}`,{...e,[n]:a}},{}),H="Switch",[ke]=xe(H),[Ee,Pe]=ke(H),_e=r.forwardRef((e,n)=>{const{__scopeSwitch:a,name:c,checked:o,defaultChecked:d,required:t,disabled:i,value:u="on",onCheckedChange:f,...b}=e,[p,h]=r.useState(null),j=me(n,g=>h(g)),x=r.useRef(!1),C=p?!!p.closest("form"):!0,[l=!1,m]=ve({prop:o,defaultProp:d,onChange:f});return r.createElement(Ee,{scope:a,checked:l,disabled:i},r.createElement(O.button,w({type:"button",role:"switch","aria-checked":l,"aria-required":t,"data-state":W(l),"data-disabled":i?"":void 0,disabled:i,value:u},b,{ref:j,onClick:pe(e.onClick,g=>{m(y=>!y),C&&(x.current=g.isPropagationStopped(),x.current||g.stopPropagation())})})),C&&r.createElement(ze,{control:p,bubbles:!x.current,name:c,value:u,checked:l,required:t,disabled:i,style:{transform:"translateX(-100%)"}}))}),Fe="SwitchThumb",Re=r.forwardRef((e,n)=>{const{__scopeSwitch:a,...c}=e,o=Pe(Fe,a);return r.createElement(O.span,w({"data-state":W(o.checked),"data-disabled":o.disabled?"":void 0},c,{ref:n}))}),ze=e=>{const{control:n,checked:a,bubbles:c=!0,...o}=e,d=r.useRef(null),t=$e(a),i=Ce(n);return r.useEffect(()=>{const u=d.current,f=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(f,"checked").set;if(t!==a&&p){const h=new Event("click",{bubbles:c});p.call(u,a),u.dispatchEvent(h)}},[t,a,c]),r.createElement("input",w({type:"checkbox","aria-hidden":!0,defaultChecked:a},o,{tabIndex:-1,ref:d,style:{...e.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function W(e){return e?"checked":"unchecked"}const G=_e,Be=Re,_=r.forwardRef(({className:e,...n},a)=>s.jsx(G,{className:z("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...n,ref:a,children:s.jsx(Be,{className:z("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));_.displayName=G.displayName;const Me=["Nutrição Clínica","Nutrição Esportiva","Nutrição Materno-Infantil","Saúde Pública","Comportamento Alimentar"],We=()=>{const{user:e,signOut:n,updateUserProfile:a}=K(),{toast:c}=Q(),[o,d]=r.useState(!1),[t,i]=r.useState({name:"",crn:"",phone:"",education:"",bio:"",address:{street:"",city:"",state:"",zip:""},specialties:[],preferences:{showDevBar:!1,showFinancials:!1},avatar_url:""}),[u,f]=r.useState(!1),b=r.useRef(null),[p,h]=r.useState(!1);r.useEffect(()=>{e&&e.profile&&i({name:e.profile.name||"",crn:e.profile.crn||"",phone:e.profile.phone||"",education:e.profile.education||"",bio:e.profile.bio||"",address:e.profile.address||{street:"",city:"",state:"",zip:""},specialties:e.profile.specialties||[],preferences:{showDevBar:e.profile.preferences?.showDevBar||!1,showFinancials:e.profile.preferences?.showFinancials||!1},avatar_url:e.profile.avatar_url||""})},[e]);const j=async()=>{h(!0);const{data:l,error:m}=await N.from("user_profiles").update({name:t.name,crn:t.crn,phone:t.phone,education:t.education,bio:t.bio,address:t.address,specialties:t.specialties,preferences:t.preferences}).eq("id",e.id).select().single();m?c({title:"Erro",description:"Não foi possível salvar as alterações.",variant:"destructive"}):(a(l),c({title:"Perfil atualizado!",description:"Suas informações foram salvas com sucesso."}),d(!1)),h(!1)},x=async l=>{const m=l.target.files[0];if(!m)return;f(!0);const{data:g}=await N.storage.from("avatars").list(e.id);if(g&&g.length>0){const k=g.map(J=>`${e.id}/${J.name}`);await N.storage.from("avatars").remove(k)}const y=`${e.id}/${Date.now()}_${m.name}`,{error:F}=await N.storage.from("avatars").upload(y,m);if(F){c({title:"Erro no Upload",description:F.message,variant:"destructive"}),f(!1);return}const{data:{publicUrl:R}}=N.storage.from("avatars").getPublicUrl(y),{data:X,error:Z}=await N.from("user_profiles").update({avatar_url:R}).eq("id",e.id).select().single();Z?c({title:"Erro ao salvar",description:"Não foi possível salvar a nova foto de perfil.",variant:"destructive"}):(a(X),i(k=>({...k,avatar_url:R})),c({title:"Foto de perfil atualizada!"})),f(!1)},C=()=>{e&&e.profile&&i({name:e.profile.name||"",crn:e.profile.crn||"",phone:e.profile.phone||"",education:e.profile.education||"",bio:e.profile.bio||"",address:e.profile.address||{street:"",city:"",state:"",zip:""},specialties:e.profile.specialties||[],preferences:{showDevBar:e.profile.preferences?.showDevBar||!1,showFinancials:e.profile.preferences?.showFinancials||!1},avatar_url:e.profile.avatar_url||""}),d(!1)};return!e||!e.profile?s.jsx("div",{className:"flex items-center justify-center h-screen",children:s.jsx(E,{className:"w-8 h-8 animate-spin"})}):s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[s.jsxs(B,{children:[s.jsx(M,{children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-primary/20 bg-secondary flex items-center justify-center overflow-hidden",children:t.avatar_url?s.jsx("img",{src:t.avatar_url,alt:"Foto de perfil",className:"w-full h-full object-cover"}):s.jsx(A,{className:"w-12 h-12 text-muted-foreground"})}),(o||u)&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"file",ref:b,onChange:x,accept:"image/*",className:"hidden",disabled:u}),s.jsx(S,{size:"icon",className:"absolute bottom-0 right-0 rounded-full h-8 w-8",onClick:()=>b.current.click(),disabled:u,children:u?s.jsx(E,{className:"w-4 h-4 animate-spin"}):s.jsx(oe,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{children:[s.jsx(D,{children:t.name||"Nome do Nutricionista"}),s.jsx(I,{children:e.email})]})]}),o?s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(S,{variant:"outline",onClick:C,disabled:p,children:"Cancelar"}),s.jsx(S,{onClick:j,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):"Salvar"})]}):s.jsx(S,{onClick:()=>d(!0),children:"Editar"})]})}),s.jsxs(T,{className:"space-y-6 pt-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"name",children:"Nome completo"}),o?s.jsx($,{id:"name",value:t.name,onChange:l=>i({...t,name:l.target.value})}):s.jsxs("p",{className:"flex items-center gap-2 p-2",children:[s.jsx(A,{className:"w-4 h-4 text-muted-foreground"})," ",t.name||"-"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"crn",children:"CRN"}),o?s.jsx($,{id:"crn",value:t.crn,onChange:l=>i({...t,crn:l.target.value})}):s.jsxs("p",{className:"flex items-center gap-2 p-2",children:[s.jsx(fe,{className:"w-4 h-4 text-muted-foreground"})," ",t.crn||"Não informado"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"phone",children:"Telefone"}),o?s.jsx($,{id:"phone",value:t.phone,onChange:l=>i({...t,phone:l.target.value})}):s.jsxs("p",{className:"flex items-center gap-2 p-2",children:[s.jsx(ce,{className:"w-4 h-4 text-muted-foreground"})," ",t.phone||"Não informado"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{htmlFor:"education",children:"Formação Acadêmica"}),o?s.jsx($,{id:"education",value:t.education,onChange:l=>i({...t,education:l.target.value})}):s.jsxs("p",{className:"flex items-center gap-2 p-2",children:[s.jsx(ue,{className:"w-4 h-4 text-muted-foreground"})," ",t.education||"Não informado"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Especialidades"}),o?s.jsxs(se,{onValueChange:l=>i({...t,specialties:[l]}),defaultValue:t.specialties[0],children:[s.jsx(te,{children:s.jsx(ae,{placeholder:"Selecione as especialidades"})}),s.jsx(re,{children:Me.map(l=>s.jsx(ne,{value:l,children:l},l))})]}):s.jsxs("div",{className:"flex flex-wrap gap-2 p-2",children:[s.jsx(le,{className:"w-4 h-4 text-muted-foreground mt-1"})," ",t.specialties.length>0?t.specialties.map(l=>s.jsx("span",{className:"bg-secondary text-secondary-foreground text-xs font-medium px-2.5 py-0.5 rounded-full",children:l},l)):"Nenhuma especialidade informada"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Endereço do Consultório"}),o?s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx($,{placeholder:"Rua",value:t.address.street,onChange:l=>i({...t,address:{...t.address,street:l.target.value}})}),s.jsx($,{placeholder:"Cidade",value:t.address.city,onChange:l=>i({...t,address:{...t.address,city:l.target.value}})}),s.jsx($,{placeholder:"Estado",value:t.address.state,onChange:l=>i({...t,address:{...t.address,state:l.target.value}})}),s.jsx($,{placeholder:"CEP",value:t.address.zip,onChange:l=>i({...t,address:{...t.address,zip:l.target.value}})})]}):s.jsxs("p",{className:"flex items-center gap-2 p-2",children:[s.jsx(ie,{className:"w-4 h-4 text-muted-foreground"})," ",t.address.street?`${t.address.street}, ${t.address.city} - ${t.address.state}`:"Não informado"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(v,{children:"Biografia Profissional"}),o?s.jsx(ee,{value:t.bio,onChange:l=>i({...t,bio:l.target.value})}):s.jsxs("p",{className:"flex items-start gap-2 p-2",children:[s.jsx(de,{className:"w-4 h-4 text-muted-foreground mt-1 flex-shrink-0"})," ",s.jsx("span",{className:"whitespace-pre-wrap",children:t.bio||"Não informado"})]})]})]})]}),s.jsxs(B,{children:[s.jsxs(M,{children:[s.jsx(D,{children:"Preferências da Interface"}),s.jsx(I,{children:"Personalize sua experiência na plataforma."})]}),s.jsxs(T,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[s.jsxs("div",{children:[s.jsx(v,{htmlFor:"dev-bar",className:"font-semibold",children:"Exibir Barra de Desenvolvedor"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Mostra atalhos e informações úteis no rodapé do dashboard."})]}),s.jsx(_,{id:"dev-bar",checked:t.preferences.showDevBar,onCheckedChange:l=>{i(m=>({...m,preferences:{...m.preferences,showDevBar:l}})),d(!0)}})]}),s.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[s.jsxs("div",{children:[s.jsx(v,{htmlFor:"financials-module",className:"font-semibold",children:"Exibir Módulo Financeiro"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Ativa a página para controle de receitas e despesas."})]}),s.jsx(_,{id:"financials-module",checked:t.preferences.showFinancials,onCheckedChange:l=>{i(m=>({...m,preferences:{...m.preferences,showFinancials:l}})),d(!0)}})]})]})]})]})})})};export{We as default};
