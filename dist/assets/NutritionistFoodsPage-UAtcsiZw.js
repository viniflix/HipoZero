import{a as re,r as a,s as w,j as e,J as B,K as I,M as G,N as R,ad as H,C as n,c as U,d as W,w as Y,e as o,B as S,L as q,T as me,X as xe,t as Z,u as ue,b as he,m as $}from"./index-BvWB-6Y-.js";import{I as V}from"./input-OBodSLFw.js";import{s as fe}from"./foodService-BaXPLfK4.js";import{u as pe}from"./useDebounce-BaDvLWlZ.js";import{L as h}from"./label-Dds-NHUC.js";import{T as je,a as ge,b as ee,c as se}from"./tabs-CA5k0aJI.js";import{A as Ne,a as ve}from"./alert-BZscs13a.js";import{P as X}from"./plus-BWNKYoo4.js";import{I as be}from"./info-Cibi8VF-.js";import{S as ae}from"./SmartFoodForm-aP96dP9u.js";import{S as ye}from"./shield-alert-eDSxLMFm.js";import{D as O}from"./database-Bk9_HnQ_.js";import{P as we}from"./package-C4ZqzRtG.js";import{S as Se}from"./search-DAzfs9rU.js";import{P as te}from"./pen-square-OCV3PTXs.js";import"./query-helpers-mbysFH2_.js";import"./badge-CCK5Bs0D.js";import"./progress-Di_AUcQX.js";import"./extends-CF3RwP-h.js";import"./chevron-left-FDyjizdT.js";import"./check-circle-2-DqvAHxH6.js";function Ce({food:r,isOpen:N,onClose:f}){const{toast:l}=re(),[k,d]=a.useState([]),[A,m]=a.useState(!1),[x,v]=a.useState(!1),[b,C]=a.useState(""),[u,p]=a.useState("");a.useEffect(()=>{r&&N&&D()},[r,N]);const D=async()=>{if(r?.id){m(!0);try{const{data:t,error:c}=await w.from("food_measures").select("*").eq("food_id",r.id).order("created_at",{ascending:!0});if(c)throw c;d(t||[])}catch(t){console.error("Erro ao carregar medidas:",t),l({title:"Erro",description:"Não foi possível carregar as medidas.",variant:"destructive"}),d([])}finally{m(!1)}}},P=async()=>{if(!b.trim()||!u||parseFloat(u)<=0){l({title:"Erro",description:"Preencha todos os campos corretamente.",variant:"destructive"});return}v(!0);try{const{data:t,error:c}=await w.from("food_measures").insert({food_id:r.id,measure_label:b.trim(),quantity_grams:parseFloat(u)}).select().single();if(c)throw c;d(_=>[..._,t]),C(""),p(""),l({title:"Sucesso!",description:"Medida adicionada com sucesso."})}catch(t){console.error("Erro ao adicionar medida:",t),l({title:"Erro",description:Z(t,"Não foi possível adicionar a medida."),variant:"destructive"})}finally{v(!1)}},E=async t=>{if(confirm("Tem certeza que deseja excluir esta medida?")){v(!0);try{const{error:c}=await w.from("food_measures").delete().eq("id",t);if(c)throw c;d(_=>_.filter(F=>F.id!==t)),l({title:"Sucesso!",description:"Medida excluída com sucesso."})}catch(c){console.error("Erro ao excluir medida:",c),l({title:"Erro",description:Z(c,"Não foi possível excluir a medida."),variant:"destructive"})}finally{v(!1)}}},M=()=>{C(""),p(""),d([]),f()};return e.jsx(B,{open:N,onOpenChange:M,children:e.jsxs(I,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsxs(R,{children:["Gerenciar Alimento: ",r?.name]}),e.jsx(H,{children:"Edite as informações e medidas caseiras deste alimento"})]}),e.jsxs(je,{defaultValue:"measures",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-2",children:[e.jsx(ee,{value:"info",children:"Informações Básicas"}),e.jsx(ee,{value:"measures",children:"Medidas Caseiras"})]}),e.jsx(se,{value:"info",className:"space-y-4 mt-4",children:e.jsxs(n,{children:[e.jsxs(U,{children:[e.jsx(W,{children:"Informações Nutricionais"}),e.jsx(Y,{children:"Dados base do alimento (100g)"})]}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Nome"}),e.jsx("p",{className:"font-medium",children:r?.name})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Grupo"}),e.jsx("p",{className:"font-medium",children:r?.group||"Não informado"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Calorias"}),e.jsxs("p",{className:"font-medium",children:[r?.calories," kcal"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Proteínas"}),e.jsxs("p",{className:"font-medium",children:[r?.protein,"g"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Carboidratos"}),e.jsxs("p",{className:"font-medium",children:[r?.carbs,"g"]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Gorduras"}),e.jsxs("p",{className:"font-medium",children:[r?.fat,"g"]})]})]}),r?.description&&e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Descrição"}),e.jsx("p",{className:"text-sm",children:r.description})]})]})]})}),e.jsx(se,{value:"measures",className:"space-y-4 mt-4",children:e.jsxs(n,{children:[e.jsxs(U,{children:[e.jsx(W,{children:"Medidas Caseiras"}),e.jsx(Y,{children:'Defina medidas específicas para este alimento (ex: "1 Colher de Sopa = 15g")'})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-muted/30",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Adicionar Nova Medida"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{htmlFor:"measure-label",children:"Nome da Medida"}),e.jsx(V,{id:"measure-label",placeholder:"Ex: Colher de Sopa, Fatia, Xícara...",value:b,onChange:t=>C(t.target.value),disabled:x})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"measure-grams",children:"Peso (gramas)"}),e.jsx(V,{id:"measure-grams",type:"number",step:"0.1",min:"0",placeholder:"Ex: 15",value:u,onChange:t=>p(t.target.value),disabled:x})]})]}),e.jsx(S,{onClick:P,disabled:x||!b.trim()||!u,className:"mt-3 w-full md:w-auto",children:x?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Adicionar Medida"]})})]}),A?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(q,{className:"w-6 h-6 animate-spin text-primary"})}):k.length===0?e.jsxs(Ne,{children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx(ve,{children:"Nenhuma medida caseira cadastrada para este alimento. Adicione medidas acima para facilitar o registro dos pacientes."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Medidas Cadastradas"}),k.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.measure_label}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.quantity_grams,"g por unidade"]})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>E(t.id),disabled:x,className:"text-destructive hover:text-destructive",children:e.jsx(me,{className:"w-4 h-4"})})]},t.id))]})]})]})})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4 border-t",children:e.jsxs(S,{variant:"outline",onClick:M,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Fechar"]})})]})})}function Ke(){const{user:r}=ue(),N=he(),{toast:f}=re(),[l,k]=a.useState(""),d=r?.profile?.is_admin===!0;if(a.useEffect(()=>{r&&!d&&(f({title:"Acesso Negado",description:"Esta página é restrita a administradores.",variant:"destructive"}),N("/nutritionist",{replace:!0}))},[r,d,N,f]),!r||!d)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(n,{className:"max-w-md",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx(ye,{className:"w-12 h-12 text-destructive"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Acesso Negado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Esta página é restrita a administradores."})]}),e.jsx(S,{onClick:()=>N("/nutritionist"),children:"Voltar ao Dashboard"})]})})})});const[A,m]=a.useState([]),[x,v]=a.useState(!1),[b,C]=a.useState(0),[u,p]=a.useState(!1),[D,P]=a.useState(!1),[E,M]=a.useState(null),[t,c]=a.useState(!1),[_,F]=a.useState(!1),[ie,L]=a.useState(!1),[J,K]=a.useState({total:0,custom:0}),Q=a.useRef(null),j=pe(l,500);a.useEffect(()=>{(async()=>{try{const[i,g]=await Promise.all([w.from("foods").select("id",{count:"exact",head:!0}).eq("is_active",!0),w.from("foods").select("id",{count:"exact",head:!0}).eq("is_active",!0).eq("source","custom")]);K({total:i.count||0,custom:g.count||0})}catch(i){console.error("Erro ao buscar estatísticas:",i)}})()},[]);const T=a.useCallback(async(s=0,i=!1)=>{if(!j.trim()||j.length<2){m([]),p(!1);return}i&&s>0?P(!0):v(!0);try{const y=await fe(j,s);m(i?de=>[...de,...y.data]:y.data),p(y.hasMore)}catch(y){console.error("Erro ao buscar alimentos:",y),f({title:"Erro",description:"Não foi possível buscar alimentos.",variant:"destructive"}),i||m([]),p(!1)}finally{v(!1),P(!1)}},[j,f]);a.useEffect(()=>{C(0),m([]),j.trim().length>=2?T(0,!1):(m([]),p(!1))},[j]);const z=a.useCallback(()=>{if(u&&!x&&!D){const s=b+1;C(s),T(s,!0)}},[u,x,D,b,T]);a.useEffect(()=>{const s=new IntersectionObserver(g=>{g[0].isIntersecting&&z()},{threshold:.1}),i=Q.current;return i&&s.observe(i),()=>{i&&s.unobserve(i)}},[z]);const le=s=>{M(s),L(!0)},ce=()=>{c(!1),M(null),j.trim().length>=2&&T(0,!1)},ne=s=>{F(!1),f({title:"Sucesso!",description:"Alimento criado com sucesso."}),(async()=>{try{const[g,y]=await Promise.all([w.from("foods").select("id",{count:"exact",head:!0}).eq("is_active",!0),w.from("foods").select("id",{count:"exact",head:!0}).eq("is_active",!0).eq("source","custom")]);K({total:g.count||0,custom:y.count||0})}catch(g){console.error("Erro ao atualizar estatísticas:",g)}})()},oe=s=>{L(!1),M(null),f({title:"Sucesso!",description:"Alimento atualizado com sucesso."}),j.trim().length>=2&&T(0,!1)};return e.jsxs("div",{className:"flex flex-col min-h-screen bg-background overflow-x-hidden",children:[e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-4 md:py-8 space-y-6 min-w-0",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0",children:[e.jsx(O,{className:"w-7 h-7 md:w-8 md:h-8 text-primary shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground break-words",children:"Admin: Alimentos"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs font-medium mt-1",children:"Administrador"})]})]}),e.jsxs(S,{onClick:()=>F(!0),children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Novo Alimento"]})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Busque e gerencie alimentos e medidas caseiras (Backoffice)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total de Alimentos"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:J.total.toLocaleString()})]}),e.jsx(we,{className:"w-8 h-8 text-primary opacity-50"})]})})}),e.jsx(n,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Alimentos Personalizados"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:J.custom.toLocaleString()})]}),e.jsx(O,{className:"w-8 h-8 text-primary opacity-50"})]})})})]}),e.jsx(n,{children:e.jsxs(o,{className:"pt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-3 h-5 w-5 text-muted-foreground"}),e.jsx(V,{placeholder:"Buscar alimento (ex: Arroz, Abacate, Frango)...",value:l,onChange:s=>k(s.target.value),className:"pl-10"})]}),l.length>0&&l.length<2&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Digite pelo menos 2 caracteres para buscar"})]})}),l.length>=2&&e.jsx($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:x&&A.length===0?e.jsx(n,{children:e.jsx(o,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(q,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Buscando alimentos..."})]})})}):A.length===0?e.jsx(n,{children:e.jsx(o,{className:"py-12 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:['Nenhum alimento encontrado para "',l,'"']})})}):e.jsxs("div",{className:"space-y-3",children:[A.map(s=>e.jsx($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-foreground mb-1",children:s.name}),s.group&&e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.group}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s.calories," kcal/100g"]}),e.jsxs("span",{children:["P: ",s.protein,"g"]}),e.jsxs("span",{children:["C: ",s.carbs,"g"]}),e.jsxs("span",{children:["G: ",s.fat,"g"]})]}),s.food_measures&&s.food_measures.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Medidas cadastradas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.food_measures.map(i=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-primary/10 text-primary text-xs font-medium",children:[i.measure_label," (",i.quantity_grams,"g)"]},i.id))})]})]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>le(s),className:"flex-shrink-0",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Editar"]})]})})})},s.id)),u&&e.jsx("div",{ref:Q,className:"py-4 text-center",children:D?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(q,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Carregando mais..."})]}):e.jsx(S,{variant:"ghost",size:"sm",onClick:z,children:"Carregar mais"})})]})}),l.length<2&&e.jsx(n,{children:e.jsxs(o,{className:"py-12 text-center",children:[e.jsx(O,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Digite o nome de um alimento para começar a buscar"})]})})]}),e.jsx(B,{open:_,onOpenChange:F,children:e.jsxs(I,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Novo Alimento"]}),e.jsx(H,{children:"Crie um alimento customizado com busca por código de barras e cálculo automático"})]}),e.jsx(ae,{mode:"full",onSuccess:ne})]})}),e.jsx(B,{open:ie,onOpenChange:L,children:e.jsxs(I,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Editar Alimento"]}),e.jsx(H,{children:"Edite as informações nutricionais e medidas caseiras"})]}),E&&e.jsx(ae,{mode:"full",initialData:E,onSuccess:oe})]})}),E&&e.jsx(Ce,{food:E,isOpen:t,onClose:ce})]})}export{Ke as default};
