import{E as z,a as D}from"./jspdf.plugin.autotable-DRlii-60.js";import"./html2canvas.esm-B0tyYwQk.js";const N=(h,f,_)=>{const d=new z,i="Nutricionista";d.setFontSize(18),d.text(`Relatório Financeiro - ${_}`,14,22),d.setFontSize(11),d.text(`Gerado por: ${i}`,14,30),d.text(`Data: ${new Date().toLocaleDateString("pt-BR")}`,14,36),D(d,{startY:45,head:[["Resumo","Valor"]],body:[["Receitas",`R$ ${f.income.toFixed(2)}`],["Despesas",`R$ ${f.expense.toFixed(2)}`],["Saldo",`R$ ${f.balance.toFixed(2)}`]],theme:"striped"});const b=["Data","Tipo","Descrição","Categoria","Valor (R$)"],t=[];h.forEach(m=>{const v=[new Date(m.transaction_date+"T00:00:00").toLocaleDateString("pt-BR"),m.type==="income"?"Receita":"Despesa",m.description,m.category||(m.income_source==="patient_payment"?"Pag. Paciente":"Outra"),m.amount.toFixed(2)];t.push(v)}),D(d,{head:[b],body:t,startY:d.lastAutoTable.finalY+10}),d.save(`relatorio_financeiro_${_}.pdf`)},W=async(h,f,_,d)=>{const i=new z,b=[70,125,70],t=[68,64,60],m=[120,113,108],v="https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png";let S=null;try{const g=await(await fetch(v)).blob();S=await new Promise(C=>{const y=new FileReader;y.onloadend=()=>C(y.result),y.readAsDataURL(g)}),i.addImage(S,"PNG",14,10,40,10)}catch(r){console.error("Erro ao carregar logo:",r)}i.setFont("helvetica","bold"),i.setFontSize(20),i.setTextColor(...b),i.text("AGENDA DE CONSULTAS",105,20,{align:"center"}),i.setFont("helvetica","normal"),i.setFontSize(10),i.setTextColor(...t),i.text(`Período: ${_}`,14,30);const x=d&&d!=="Nutricionista"?(r=>r?r.toLowerCase().split(" ").map(g=>g.charAt(0).toUpperCase()+g.slice(1)).join(" "):"Não informado")(d):"Não informado";i.text(`Nutricionista: ${x}`,14,35),i.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} às ${new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`,14,40),i.setFontSize(9),i.setTextColor(...m),i.text(`Total de consultas: ${h.length}`,14,46),i.setLineWidth(.5),i.setDrawColor(...b),i.line(14,50,196,50);const $=[],R={scheduled:"Agendada",confirmed:"Confirmada",awaiting_confirmation:"Aguardando",completed:"Realizada",cancelled:"Cancelada",no_show:"Faltou"},o={first_appointment:"Primeira Consulta",return:"Retorno",evaluation:"Avaliação",online:"Online",in_person:"Presencial"};h.forEach(r=>{const g=new Date(r.appointment_time),C=g.toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit"}),y=g.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),F=r.duration||60,a=new Date(g.getTime()+F*6e4).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),s=`${y} - ${a}`;$.push([C,s,r.patient?.name||"Não identificado",o[r.appointment_type]||"Não especificado",R[r.status]||"Agendada"])}),D(i,{startY:54,head:[["Data","Horário","Paciente","Tipo","Status"]],body:$,theme:"striped",headStyles:{fillColor:b,textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:8,textColor:t,font:"helvetica"},columnStyles:{0:{cellWidth:28,halign:"center"},1:{cellWidth:32,halign:"center"},2:{cellWidth:55,halign:"left",fontStyle:"bold"},3:{cellWidth:40,halign:"center"},4:{cellWidth:27,halign:"center"}},margin:{top:54,left:14,right:14},alternateRowStyles:{fillColor:[237,236,237]}});const c=i.internal.getNumberOfPages();for(let r=1;r<=c;r++)i.setPage(r),i.setFont("helvetica","normal"),i.setFontSize(8),i.setTextColor(...m),i.text(`Página ${r} de ${c} • HipoZero © ${new Date().getFullYear()}`,i.internal.pageSize.getWidth()/2,i.internal.pageSize.getHeight()-10,{align:"center"});const T=`agenda_${f}_${new Date().toISOString().split("T")[0]}.pdf`;i.save(T)},E=async(h,f,_,d,i,b)=>{const t=new z,m=t.internal.pageSize.width,v=t.internal.pageSize.height,S=[70,125,70],L=[238,103,6],x=[68,64,60],$=[120,113,108],R=[245,245,244];let o=20;t.setFont("helvetica");try{const p=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(l=>{const n=new Image;n.onload=()=>{const e=m*.2,w=n.height/n.width*e,u=new FileReader;u.onloadend=()=>{const O=u.result;t.addImage(O,"PNG",14,10,e,w),l()},u.readAsDataURL(p)},n.src=URL.createObjectURL(p)})}catch(a){console.error("Erro ao carregar logo:",a)}if(t.setFontSize(20),t.setTextColor(...S),t.setFont("helvetica","bold"),t.text("Plano Alimentar",m/2,20,{align:"center"}),t.setDrawColor(...S),t.setLineWidth(.5),t.line(14,24,m-14,24),o=32,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(...x),f&&(t.text(`Paciente: ${f}`,14,o),o+=5),_){const a=s=>s?s.toLowerCase().split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" "):"Não informado";t.text(`Nutricionista: ${a(_)}`,14,o),o+=5}if(h.start_date){const a=new Date(h.start_date).toLocaleDateString("pt-BR"),s=h.end_date?new Date(h.end_date).toLocaleDateString("pt-BR"):"Indeterminado";t.text(`Período: ${a} até ${s}`,14,o),o+=5}t.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")} às ${new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`,14,o),o+=10;const c=(h.meals||[]).reduce((a,s)=>{const l=(s.foods||[]).reduce((n,e)=>({calories:n.calories+(e.calories||0),protein:n.protein+(e.protein||0),carbs:n.carbs+(e.carbs||0),fat:n.fat+(e.fat||0),fiber:n.fiber+(e.food?.fiber?e.food.fiber*(e.quantity||0)/100:0),sodium:n.sodium+(e.food?.sodium?e.food.sodium*(e.quantity||0)/100:0),calcium:n.calcium+(e.food?.calcium?e.food.calcium*(e.quantity||0)/100:0),iron:n.iron+(e.food?.iron?e.food.iron*(e.quantity||0)/100:0),magnesium:n.magnesium+(e.food?.magnesium?e.food.magnesium*(e.quantity||0)/100:0),potassium:n.potassium+(e.food?.potassium?e.food.potassium*(e.quantity||0)/100:0),zinc:n.zinc+(e.food?.zinc?e.food.zinc*(e.quantity||0)/100:0),vitamin_a:n.vitamin_a+(e.food?.vitamin_a?e.food.vitamin_a*(e.quantity||0)/100:0),vitamin_c:n.vitamin_c+(e.food?.vitamin_c?e.food.vitamin_c*(e.quantity||0)/100:0),vitamin_d:n.vitamin_d+(e.food?.vitamin_d?e.food.vitamin_d*(e.quantity||0)/100:0)}),{calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0,calcium:0,iron:0,magnesium:0,potassium:0,zinc:0,vitamin_a:0,vitamin_c:0,vitamin_d:0});return{calories:a.calories+l.calories,protein:a.protein+l.protein,carbs:a.carbs+l.carbs,fat:a.fat+l.fat,fiber:a.fiber+l.fiber,sodium:a.sodium+l.sodium,calcium:a.calcium+l.calcium,iron:a.iron+l.iron,magnesium:a.magnesium+l.magnesium,potassium:a.potassium+l.potassium,zinc:a.zinc+l.zinc,vitamin_a:a.vitamin_a+l.vitamin_a,vitamin_c:a.vitamin_c+l.vitamin_c,vitamin_d:a.vitamin_d+l.vitamin_d}},{calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0,calcium:0,iron:0,magnesium:0,potassium:0,zinc:0,vitamin_a:0,vitamin_c:0,vitamin_d:0});t.setFillColor(...R),t.roundedRect(14,o,m-28,20,2,2,"F"),t.setFontSize(9),t.setTextColor(...x),t.setFont("helvetica","bold"),t.text("Meta Diária Total:",18,o+6),t.setFont("helvetica","normal"),t.setTextColor(...$);const T=`${Math.round(c.calories)} kcal  •  Proteínas: ${Math.round(c.protein)}g  •  Carboidratos: ${Math.round(c.carbs)}g  •  Gorduras: ${Math.round(c.fat)}g`;t.text(T,18,o+13),o+=28;const r=["breakfast","morning_snack","lunch","afternoon_snack","dinner","supper"],g=[...h.meals||[]].sort((a,s)=>r.indexOf(a.meal_type)-r.indexOf(s.meal_type));for(let a=0;a<g.length;a++){const s=g[a],p=s.foods||[],l=15+(p.length+1)*7+(s.notes?10:0);o+l>v-30&&(t.addPage(),o=20),t.setFontSize(12),t.setTextColor(...S),t.setFont("helvetica","bold");const n=i?i(s.meal_type):s.name,e=s.meal_time||"";if(t.text(`${n}${e?` • ${e}`:""}`,14,o),o+=7,p.length>0){const w=p.map(u=>[u.food?.name||"Alimento",b?b(u.quantity||0,u.unit||"",u.measure):`${u.quantity||0} ${u.unit||""}`,Math.round(u.calories||0),Math.round(u.protein||0),Math.round(u.carbs||0),Math.round(u.fat||0)]);D(t,{startY:o,head:[["Alimento","Quantidade","Calorias","Proteína","Carboidrato","Gordura"]],body:w,theme:"striped",headStyles:{fillColor:S,textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:8,textColor:x,font:"helvetica"},columnStyles:{0:{halign:"left",cellWidth:"auto"},1:{halign:"center",cellWidth:30},2:{halign:"center",cellWidth:23},3:{halign:"center",cellWidth:23},4:{halign:"center",cellWidth:28},5:{halign:"center",cellWidth:23}},alternateRowStyles:{fillColor:R},margin:{left:14,right:14}}),o=t.lastAutoTable.finalY+3}s.notes&&(t.setFontSize(8),t.setTextColor(...$),t.setFont("helvetica","italic"),t.text(`Obs: ${s.notes}`,14,o),o+=6),a<g.length-1&&(o+=5)}if(d){o+80>v-30?(t.addPage(),o=20):o+=10,t.setFontSize(14),t.setTextColor(...S),t.setFont("helvetica","bold"),t.text("Resumo de Micronutrientes",14,o),o+=10;const a=[["Fibras",`${Math.round(c.fiber)}g`],["Sódio",`${Math.round(c.sodium)}mg`],["Cálcio",`${Math.round(c.calcium)}mg`],["Ferro",`${Math.round(c.iron)}mg`],["Magnésio",`${Math.round(c.magnesium)}mg`],["Potássio",`${Math.round(c.potassium)}mg`],["Zinco",`${Math.round(c.zinc)}mg`],["Vitamina A",`${Math.round(c.vitamin_a)}µg`],["Vitamina C",`${Math.round(c.vitamin_c)}mg`],["Vitamina D",`${Math.round(c.vitamin_d)}µg`]];D(t,{startY:o,head:[["Micronutriente","Quantidade Total"]],body:a,theme:"striped",headStyles:{fillColor:L,textColor:[255,255,255],fontSize:10,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:9,textColor:x,font:"helvetica"},columnStyles:{0:{halign:"left",cellWidth:100},1:{halign:"center",cellWidth:"auto"}},alternateRowStyles:{fillColor:R},margin:{left:14,right:14}}),o=t.lastAutoTable.finalY+10}const C=t.internal.getNumberOfPages();for(let a=1;a<=C;a++)t.setPage(a),t.setFontSize(8),t.setTextColor(...$),t.setFont("helvetica","normal"),t.text(`Página ${a} de ${C}`,m-14,v-10,{align:"right"});const F=`plano-alimentar-${d?"completo":"simples"}-${f?.replace(/\s+/g,"-").toLowerCase()||"paciente"}-${new Date().toISOString().split("T")[0]}.pdf`;t.save(F)};export{N as a,W as b,E as e};
