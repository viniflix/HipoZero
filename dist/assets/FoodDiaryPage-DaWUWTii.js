import{q as de,au as ce,b as oe,r as l,s as E,j as e,B as xe,E as b,C as m,e as h,at as me,c as he,d as ue,v as F,K as fe,ap as v,I as je,V as pe,W as Ne,Y as ge,Z as be,aw as ve}from"./index-CzP_nI2M.js";import{I as O}from"./input-DpEF2plu.js";import{L}from"./label-DACsPsNs.js";import{S as ye,a as we,b as _e,c as De,d as p}from"./select-D3LMCr-h.js";import{B as y}from"./badge-NOGldadv.js";import{T as Ce,a as Se,b as q,c as J}from"./tabs-Ky7EuQAW.js";import{a as A,b as K,c as Me,g as Te,d as ke,f as z,e as G}from"./food-diary-queries-8Ob5rWe2.js";import{A as Le}from"./arrow-left-BnQHWRYJ.js";import{A as Ae}from"./activity-CD_GjOXq.js";import{F as Fe}from"./flame-Bmh33S_W.js";import{C as W}from"./clock-Bx-qP7aU.js";import"./extends-CF3RwP-h.js";const U=de("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Ye=()=>{const{patientId:a}=ce(),c=oe(),[o,n]=l.useState(!0),[x,t]=l.useState(""),[r,u]=l.useState("meals"),[N,j]=l.useState([]),[w,H]=l.useState([]),[_,Y]=l.useState(null),[Z,$]=l.useState(null),[f,I]=l.useState({startDate:"",endDate:"",mealType:""}),[D,Q]=l.useState(!1),[P,V]=l.useState(null),[X,B]=l.useState([]),[ee,C]=l.useState(!1);l.useEffect(()=>{se()},[a]),l.useEffect(()=>{!o&&f.startDate&&f.endDate&&ae()},[f]);const se=async()=>{n(!0);try{const{data:s}=await E.from("user_profiles").select("name").eq("id",a).single();s&&t(s.name);const{data:i}=await E.from("meal_plans").select("start_date").eq("patient_id",a).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle(),d=new Date().toISOString().split("T")[0],g=i?.start_date||d;I({startDate:g,endDate:d,mealType:""});const{data:T}=await A(a,{startDate:g,endDate:d,mealType:""});j(T||[]);const{data:le}=await K(a,{startDate:g,endDate:d});H(le||[]);const{data:re}=await Me(a,30);Y(re);const k=new Date;k.setDate(k.getDate()-7);const ne=k.toISOString().split("T")[0],{data:ie}=await Te(a,ne,d);$(ie)}catch(s){console.error("Erro ao carregar dados:",s)}finally{n(!1)}},ae=async()=>{try{const{data:s}=await A(a,f);j(s||[]);const{data:i}=await K(a,f);H(i||[])}catch(s){console.error("Erro ao buscar refeições:",s)}},R=async s=>{V(s);const{data:i}=await ke(s.id);B(i||[]),C(!0)},S=(s,i)=>{I(d=>({...d,[s]:i}))},M=s=>({breakfast:"Café da Manhã",morning_snack:"Lanche da Manhã",lunch:"Almoço",afternoon_snack:"Lanche da Tarde",dinner:"Jantar",supper:"Ceia"})[s]||s,te=s=>({breakfast:{bg:"bg-orange-500",border:"#f97316"},morning_snack:{bg:"bg-yellow-500",border:"#eab308"},lunch:{bg:"bg-green-600",border:"#16a34a"},afternoon_snack:{bg:"bg-blue-500",border:"#3b82f6"},dinner:{bg:"bg-purple-600",border:"#9333ea"},supper:{bg:"bg-indigo-500",border:"#6366f1"}})[s]||{bg:"bg-[#5f6f52]",border:"#5f6f52"};return o?null:e.jsx("div",{className:"flex flex-col min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-6 py-4 md:py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(xe,{variant:"ghost",size:"sm",onClick:()=>c(`/nutritionist/patients/${a}/hub?tab=nutrition`),className:"mb-3 -ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(Le,{className:"w-4 h-4 mr-1"}),"Voltar"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(b,{className:"w-7 h-7 text-[#5f6f52]"}),"Diário Alimentar"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:x})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Adesão 30d"}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-[#5f6f52] truncate",children:[_?.adherencePercentage||0,"%"]})]}),e.jsx(me,{className:"w-6 h-6 text-[#5f6f52] opacity-30 flex-shrink-0"})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Sequência"}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-[#c4661f] truncate",children:[_?.currentStreak||0," dias"]})]}),e.jsx(Ae,{className:"w-6 h-6 text-[#c4661f] opacity-30 flex-shrink-0"})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Média Cal. 7d"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-foreground truncate",children:Z?.avgCaloriesPerDay||0})]}),e.jsx(Fe,{className:"w-6 h-6 text-orange-500 opacity-30 flex-shrink-0"})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Refeições"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-foreground truncate",children:_?.totalMeals||0})]}),e.jsx(b,{className:"w-6 h-6 text-[#5f6f52] opacity-30 flex-shrink-0"})]})})})]}),e.jsxs(m,{className:"mb-6",children:[e.jsx(he,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>Q(!D),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ue,{className:"text-base flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-[#5f6f52]"}),"Filtros"]}),e.jsx(fe,{className:v("w-5 h-5 text-muted-foreground transition-transform",D&&"rotate-180")})]})}),D&&e.jsx(h,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"start_date",className:"text-sm",children:"Data Inicial"}),e.jsx(O,{id:"start_date",type:"date",value:f.startDate,onChange:s=>S("startDate",s.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"end_date",className:"text-sm",children:"Data Final"}),e.jsx(O,{id:"end_date",type:"date",value:f.endDate,onChange:s=>S("endDate",s.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"meal_type",className:"text-sm",children:"Tipo de Refeição"}),e.jsxs(ye,{value:f.mealType||"all",onValueChange:s=>S("mealType",s==="all"?"":s),children:[e.jsx(we,{id:"meal_type",className:"h-9",children:e.jsx(_e,{placeholder:"Todas"})}),e.jsxs(De,{children:[e.jsx(p,{value:"all",children:"Todas"}),e.jsx(p,{value:"breakfast",children:"Café da Manhã"}),e.jsx(p,{value:"morning_snack",children:"Lanche da Manhã"}),e.jsx(p,{value:"lunch",children:"Almoço"}),e.jsx(p,{value:"afternoon_snack",children:"Lanche da Tarde"}),e.jsx(p,{value:"dinner",children:"Jantar"}),e.jsx(p,{value:"supper",children:"Ceia"})]})]})]})]})})]}),e.jsxs(Ce,{value:r,onValueChange:u,children:[e.jsxs(Se,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(q,{value:"meals",className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Refeições"}),e.jsx(y,{variant:"secondary",className:"ml-1",children:N.length})]}),e.jsxs(q,{value:"audit",className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Histórico"}),e.jsx(y,{variant:"secondary",className:"ml-1",children:w.length})]})]}),e.jsx(J,{value:"meals",className:"mt-0",children:N.length===0?e.jsx(m,{children:e.jsx(h,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma refeição registrada no período selecionado"})]})})}):e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsx(He,{meal:s,onClick:()=>R(s),getMealTypeLabel:M,getMealTypeColor:te},s.id))})}),e.jsx(J,{value:"audit",className:"mt-0",children:w.length===0?e.jsx(m,{children:e.jsx(h,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma alteração registrada no período"})]})})}):e.jsx("div",{className:"space-y-3",children:w.map((s,i)=>e.jsx(Ie,{log:s,getMealTypeLabel:M,onClick:async()=>{if(s.meal_id&&s.action!=="delete"){const{data:d}=await A(a,{},1,0),g=d?.find(T=>T.id===s.meal_id);g&&await R(g)}else if(s.action==="delete"){const d={meal_type:s.meal_type,meal_date:s.meal_date,meal_time:s.meal_time,total_calories:s.details?.total_calories||0,total_protein:s.details?.total_protein||0,total_carbs:s.details?.total_carbs||0,total_fat:s.details?.total_fat||0,meal_items:s.details?.meal_items||[],notes:s.details?.notes};V(d),B([s]),C(!0)}}},s.id||i))})})]}),P&&e.jsx(Pe,{meal:P,history:X,open:ee,onClose:()=>C(!1),getMealTypeLabel:M})]})})},He=({meal:a,onClick:c,getMealTypeLabel:o,getMealTypeColor:n})=>{const x=n(a.meal_type);return e.jsx(m,{className:"hover:shadow-md transition-shadow cursor-pointer border-l-4",style:{borderLeftColor:x.border},onClick:c,children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:v("w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",x.bg),children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:o(a.meal_type)}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mt-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),new Date(a.meal_date).toLocaleDateString("pt-BR")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"}),a.meal_time]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 sm:gap-3 text-center text-xs flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Kcal"}),e.jsx("p",{className:"font-semibold text-[#5f6f52]",children:Math.round(a.total_calories)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"PTN"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_protein),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"CHO"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_carbs),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"LIP"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_fat),"g"]})]})]})]}),a.is_edited&&e.jsxs(y,{variant:"outline",className:"mt-3 text-xs",children:[e.jsx(je,{className:"w-3 h-3 mr-1"}),"Editada"]})]})})},Ie=({log:a,getMealTypeLabel:c,onClick:o})=>{const n=z(a),x=G(a.details),t=r=>r==="create"?"default":r==="update"?"secondary":"destructive";return e.jsx(m,{className:v("border-l-4 transition-shadow",n.borderColor.replace("border-","border-l-"),o&&"cursor-pointer hover:shadow-md"),onClick:o,children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(y,{variant:t(a.action),children:n.label}),a.meal_type&&e.jsx("span",{className:"text-sm font-medium truncate",children:c(a.meal_type)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),new Date(a.created_at).toLocaleDateString("pt-BR")]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(W,{className:"w-3 h-3"}),new Date(a.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]}),x.length>0&&e.jsx("div",{className:v("text-xs space-y-1 pt-3 border-t",n.bgColor),children:x.map((r,u)=>e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-muted-foreground",children:[r.label,":"]}),r.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-through text-red-600",children:r.oldValue}),e.jsx("span",{children:"→"})]}),e.jsx("span",{className:"text-green-600 font-medium",children:r.newValue})]},u))})]})})},Pe=({meal:a,history:c,open:o,onClose:n,getMealTypeLabel:x})=>e.jsx(pe,{open:o,onOpenChange:n,children:e.jsxs(Ne,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsxs(be,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-[#5f6f52]"}),x(a.meal_type)]}),e.jsxs(ve,{children:[new Date(a.meal_date).toLocaleDateString("pt-BR")," às ",a.meal_time]})]}),e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:"Totais Nutricionais"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold text-[#5f6f52]",children:Math.round(a.total_calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Proteínas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:["Alimentos Consumidos (",a.meal_items?.length||0,")"]}),e.jsx("div",{className:"space-y-2",children:a.meal_items?.map((t,r)=>e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:t.name}),e.jsxs(y,{variant:"outline",className:"text-xs",children:[t.quantity," ",t.unit||"g"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[Math.round(t.calories||0)," kcal"]}),e.jsxs("span",{children:[Math.round(t.protein||0),"g PTN"]}),e.jsxs("span",{children:[Math.round(t.carbs||0),"g CHO"]}),e.jsxs("span",{children:[Math.round(t.fat||0),"g LIP"]})]})]},r))})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-[#5f6f52]",children:"Observações"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-[#fefae0]/30 p-3 rounded border",children:a.notes})]}),c&&c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:"Histórico de Alterações"}),e.jsx("div",{className:"space-y-2",children:c.map((t,r)=>{const u=z(t),N=G(t.details);return e.jsxs("div",{className:v("p-3 rounded border text-sm",u.bgColor,u.borderColor),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(y,{className:v("text-xs",u.color),children:u.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(t.created_at).toLocaleDateString("pt-BR")," às"," ",new Date(t.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),N.length>0&&e.jsx("div",{className:"text-xs space-y-1",children:N.map((j,w)=>e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium",children:[j.label,":"]}),j.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-through text-red-600",children:j.oldValue}),e.jsx("span",{children:"→"})]}),e.jsx("span",{className:"text-green-600 font-medium",children:j.newValue})]},w))})]},r)})})]})]})]})});export{Ye as default};
