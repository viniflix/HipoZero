import{q as at,as as W,r as p,F as d,j as e,J as fe,K as je,M as ye,N as ve,I as De,O as Le,B as h,s as z,u as st,a as nt,b as it,at as rt,m as ot,C as se,e as ne,E as pe,ad as Se,c as ue,d as xe,w as Me,X as lt,U as dt,T as ct,A as mt,h as pt,i as ut,k as xt,l as ht,n as gt,o as ft,p as jt,t as yt,a3 as vt,au as wt}from"./index-qjbGaV1R.js";import{i as bt,a as $e,C as ke,e as Ee,s as Nt}from"./calendar-BroojJTJ.js";import{I as R}from"./input-DMmXNW5d.js";import{L as N}from"./label-TnYOms6c.js";import{S as B,a as U,b as J,c as K,d as M}from"./select-DG44e7yv.js";import{B as Ae}from"./badge-Du_-s9xo.js";import{b as _t}from"./pdfUtils-D-Cl83wN.js";import{D as Ct,T as Dt,C as Te}from"./date-input-UcZ3CJMj.js";import{S as we}from"./search-CZaMVAuB.js";import{l as St,g as Mt}from"./financial-queries-BBpUcv4V.js";import{l as be}from"./query-helpers-CC2p4I3d.js";import{c as qe}from"./constructNow-Bf7Fz9zL.js";import{P as kt}from"./plus-D0VXwTZj.js";import{C as he}from"./chevron-left-Klv_B5pP.js";import{C as Et}from"./calendar-CuwgVPpP.js";import{F as At}from"./filter-Cms1GFVZ.js";import{C as Tt}from"./clock-B7zC15FM.js";import{E as Ft}from"./eye-Bb_eQPku.js";import{P as Pt}from"./pen-square-DMkr_5gI.js";import{i as zt}from"./isTomorrow-DrpmFG6S.js";import{p as v}from"./pt-BR-Dk83-zmM.js";import{i as Fe}from"./isSameDay-BT2gHB-J.js";import{i as S}from"./isToday-QWdTw9av.js";import{s as Ot}from"./subMonths-CJgc4ly4.js";import{a as Lt}from"./addMonths-ChI471e9.js";import{e as $t}from"./endOfMonth-Dlk4l2Ma.js";import"./extends-CF3RwP-h.js";import"./jspdf.es.min-CUHz9K8Q.js";import"./jspdf.plugin.autotable-C3NxY6Hi.js";import"./html2canvas.esm-B0tyYwQk.js";import"./popover-BDxVETTl.js";import"./parseISO-CVV90SIz.js";const Pe=at("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);function qt(c,_,i){const w=W(c,i),g=W(_,i);return+w==+g}function ze(c){return bt(c,qe(c))}function Oe(c,_){return qt(c,qe(c),_)}function It(c,_){return $e(c,-1)}const ge="custom";function Ht({open:c,onOpenChange:_,appointment:i,patients:w=[],services:g=[],nutritionistId:ee,preSelectedDate:k,onSave:X}){const[o,u]=p.useState({patient_id:"",appointment_time_date:k?d(k,"yyyy-MM-dd"):d(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),[r,j]=p.useState(""),[G,C]=p.useState(!1),O=w.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())).slice(0,5),E=[{value:"first_appointment",label:"Primeira Consulta"},{value:"return",label:"Retorno"},{value:"evaluation",label:"Avalia√ß√£o"},{value:"online",label:"Online"},{value:"in_person",label:"Presencial"}],T=[{value:"scheduled",label:"Agendada"},{value:"confirmed",label:"Confirmada"},{value:"awaiting_confirmation",label:"Aguardando Confirma√ß√£o"},{value:"completed",label:"Realizada"},{value:"cancelled",label:"Cancelada"},{value:"no_show",label:"Faltou"}],A=[{value:30,label:"30 minutos"},{value:45,label:"45 minutos"},{value:60,label:"1 hora"},{value:90,label:"1h 30min"},{value:120,label:"2 horas"}];p.useEffect(()=>{if(i){if(u({patient_id:i.patient_id||"",appointment_time_date:i.appointment_time?d(new Date(i.appointment_time),"yyyy-MM-dd"):d(new Date,"yyyy-MM-dd"),appointment_time_hour:i.appointment_time?d(new Date(i.appointment_time),"HH:mm"):"",duration:i.duration||60,appointment_type:i.appointment_type||"first_appointment",status:i.status||"scheduled",notes:i.notes||"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),i.patient_id){const s=w.find(l=>l.id===i.patient_id);s&&j(s.name)}}else u({patient_id:"",appointment_time_date:k?d(k,"yyyy-MM-dd"):d(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),j("")},[i,c,k,w]);const y=s=>{s===ge?u(l=>({...l,service_id:"",use_custom_price:!0})):(g.find(l=>l.id.toString()===s),u(l=>({...l,service_id:s,use_custom_price:!1,custom_price:"",custom_description:""})))},D=s=>{if(s.preventDefault(),!o.patient_id||!o.appointment_time_date||!o.appointment_time_hour)return;const[l,Q,P]=o.appointment_time_date.split("-").map(Number),[te,ie]=o.appointment_time_hour.split(":").map(Number),Y=new Date(l,Q-1,P,te,ie),re={...i,patient_id:o.patient_id,appointment_time:Y.toISOString(),notes:o.notes,duration:o.duration,appointment_type:o.appointment_type,status:o.status},L={service_id:o.use_custom_price?null:o.service_id||null,custom_price:o.use_custom_price?o.custom_price:null,custom_description:o.use_custom_price?o.custom_description:null};X(re,L)},b=g.find(s=>s.id.toString()===o.service_id);return e.jsx(fe,{open:c,onOpenChange:_,children:e.jsxs(je,{className:"w-[calc(100vw-2rem)] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(ve,{children:i?"Editar Agendamento":"Novo Agendamento"})}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{htmlFor:"patient_search",children:"Paciente *"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(R,{id:"patient_search",type:"text",placeholder:"Buscar paciente pelo nome...",value:r,onChange:s=>{j(s.target.value),C(!0),s.target.value||u(l=>({...l,patient_id:""}))},onFocus:()=>C(!0),className:"pl-9",required:!o.patient_id})]}),G&&r&&O.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-lg max-h-60 overflow-auto",children:O.map(s=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-accent hover:text-accent-foreground text-sm",onClick:()=>{u(l=>({...l,patient_id:s.id})),j(s.name),C(!1)},children:s.name},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"date",children:"Data *"}),e.jsx(Ct,{id:"date",required:!0,value:o.appointment_time_date,onChange:s=>u(l=>({...l,appointment_time_date:s}))})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"time",children:"Hora *"}),e.jsx(Dt,{id:"time",required:!0,value:o.appointment_time_hour,onChange:s=>u(l=>({...l,appointment_time_hour:s}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"duration",children:"Dura√ß√£o *"}),e.jsxs(B,{required:!0,value:String(o.duration),onValueChange:s=>u(l=>({...l,duration:Number(s)})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:A.map(s=>e.jsx(M,{value:String(s.value),children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"appointment_type",children:"Tipo *"}),e.jsxs(B,{required:!0,value:o.appointment_type,onValueChange:s=>u(l=>({...l,appointment_type:s})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:E.map(s=>e.jsx(M,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"status",children:"Status *"}),e.jsxs(B,{required:!0,value:o.status,onValueChange:s=>u(l=>({...l,status:s})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:T.map(s=>e.jsx(M,{value:s.value,children:s.label},s.value))})]})]}),!i&&e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-base font-semibold",children:"Informa√ß√µes Financeiras"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um servi√ßo padr√£o ou defina um valor personalizado"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"service",children:"Servi√ßo"}),e.jsxs(B,{value:o.use_custom_price?ge:o.service_id||"",onValueChange:y,children:[e.jsx(U,{children:e.jsx(J,{placeholder:"Selecione um servi√ßo ou valor personalizado"})}),e.jsxs(K,{children:[g.map(s=>e.jsxs(M,{value:s.id.toString(),children:[s.name," - ",De(s.price)]},s.id)),e.jsx(M,{value:ge,children:"üí∞ Valor Personalizado / Outro"})]})]})]}),o.use_custom_price?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"custom_price",children:"Valor Personalizado (R$) *"}),e.jsx(R,{id:"custom_price",type:"number",step:"0.01",min:"0",required:o.use_custom_price,value:o.custom_price,onChange:s=>u(l=>({...l,custom_price:s.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"custom_description",children:"Descri√ß√£o do Servi√ßo"}),e.jsx(R,{id:"custom_description",value:o.custom_description,onChange:s=>u(l=>({...l,custom_description:s.target.value})),placeholder:"Ex: Consulta especializada"})]})]}):b?e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valor do servi√ßo:"}),e.jsx("p",{className:"text-lg font-semibold text-primary",children:De(b.price)})]}):null]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"notes",children:"Observa√ß√µes"}),e.jsx(R,{id:"notes",value:o.notes,onChange:s=>u(l=>({...l,notes:s.target.value})),placeholder:"Informa√ß√µes adicionais (opcional)"})]}),e.jsxs(Le,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>_(!1),children:"Cancelar"}),e.jsx(h,{type:"submit",children:i?"Atualizar":"Salvar"})]})]})]})})}async function Vt(c,_){const{nutritionist_id:i,patient_id:w,appointment_time:g,notes:ee,duration:k,appointment_type:X,status:o}=c,{service_id:u,custom_price:r,custom_description:j}=_,{data:G,error:C}=await z.from("appointments").insert({nutritionist_id:i,patient_id:w,appointment_time:g,notes:ee,duration:k||60,appointment_type:X||"first_appointment",status:o||"scheduled"}).select().single();if(C)throw be("Error creating appointment",C),C;const{data:O}=await z.from("user_profiles").select("name").eq("id",w).single(),E=O?.name||"Paciente";let T=0,A="";if(u){const{data:D}=await z.from("services").select("name, price, category").eq("id",u).single();D&&(T=parseFloat(D.price),A=`Agendamento: ${E} - ${D.name}`)}else r&&(T=parseFloat(r),A=j?`Agendamento: ${E} - ${j}`:`Agendamento: ${E}`);let y=null;if(T>0&&A)try{const D=new Date(g);y=await St({nutritionist_id:i,patient_id:w,type:"income",category:u?"consulta":"outros",description:A,amount:T,transaction_date:d(D,"yyyy-MM-dd"),status:"pending",due_date:d(D,"yyyy-MM-dd")})}catch(D){be("Error creating financial transaction",D)}return{appointment:G,transaction:y}}async function Wt(c,_){const{data:i,error:w}=await z.from("appointments").update(_).eq("id",c).select().single();if(w)throw be("Error updating appointment",w),w;return i}function Na(){const{user:c,signOut:_}=st(),{toast:i}=nt(),w=it(),[g,ee]=p.useState([]),[k,X]=p.useState([]),[o,u]=p.useState([]),[r,j]=p.useState(null),[G,C]=p.useState(!1),[O,E]=p.useState(null),[T,A]=p.useState(!0),[y,D]=p.useState("all"),[b,s]=p.useState(""),[l,Q]=p.useState(!1),[P,te]=p.useState(null),[ie,Y]=p.useState(!1),[re,L]=p.useState(!1),[Z,Ie]=p.useState("week"),[$,oe]=p.useState(W(new Date,{locale:v})),[q,le]=p.useState(new Date),ae=p.useCallback(async()=>{if(!c)return;A(!0);const{data:t,error:a}=await z.from("appointments").select("*, patient:user_profiles!appointments_patient_id_fkey(name, id)").eq("nutritionist_id",c.id).limit(1e3);a?i({title:"Erro",description:a.message,variant:"destructive"}):ee(t||[]);const{data:n,error:m}=await z.from("user_profiles").select("id, name").eq("nutritionist_id",c.id).limit(500);m?i({title:"Erro",description:"N√£o foi poss√≠vel carregar os pacientes.",variant:"destructive"}):X(n||[]);try{const x=await Mt(c.id);u(x||[])}catch(x){console.error("Error loading services:",x),u([])}A(!1)},[c,i]);p.useEffect(()=>{ae()},[ae]);const He=async(t,a)=>{const{patient_id:n,appointment_time:m,notes:x,duration:f,appointment_type:H,status:V}=t,Ce=new Date(m),tt=new Date(Ce.getTime()+f*6e4);if(g.some(F=>{if(t.id&&F.id===t.id)return!1;const ce=new Date(F.appointment_time),me=new Date(ce.getTime()+(F.duration||60)*6e4);return Ce<me&&tt>ce})){i({title:"Conflito de Hor√°rio",description:"J√° existe um agendamento neste hor√°rio. Por favor, escolha outro hor√°rio.",variant:"destructive"});return}try{if(t.id)await Wt(t.id,{patient_id:n,appointment_time:m,notes:x,duration:f||60,appointment_type:H||"first_appointment",status:V||"scheduled"}),i({title:"Sucesso!",description:"Agendamento atualizado com sucesso."});else{const F={nutritionist_id:c.id,patient_id:n,appointment_time:m,notes:x,duration:f||60,appointment_type:H||"first_appointment",status:V||"scheduled"},{appointment:ce,transaction:me}=await Vt(F,a);i(me?{title:"Sucesso!",description:"Agendamento criado e registro financeiro gerado automaticamente."}:{title:"Sucesso!",description:"Agendamento criado com sucesso."})}C(!1),E(null),ae()}catch(F){console.error("Error saving appointment:",F),i({title:"Erro",description:yt(F,"N√£o foi poss√≠vel salvar o agendamento."),variant:"destructive"})}},Ve=t=>{te(t),Q(!0)},We=async()=>{if(!P)return;const{error:t}=await z.from("appointments").delete().eq("id",P.id);t?i({title:"Erro",description:"N√£o foi poss√≠vel deletar o agendamento.",variant:"destructive"}):(i({title:"Sucesso!",description:"Agendamento deletado com sucesso."}),ae()),Q(!1),te(null)},Ne=p.useMemo(()=>{const t=new Date;let a=[...g].sort((n,m)=>new Date(n.appointment_time)-new Date(m.appointment_time));if(r)a=a.filter(n=>Fe(new Date(n.appointment_time),r));else switch(y){case"today":a=a.filter(n=>S(new Date(n.appointment_time)));break;case"week":a=a.filter(n=>Oe(new Date(n.appointment_time),{locale:v}));break;case"month":a=a.filter(n=>ze(new Date(n.appointment_time)));break;default:a=a.filter(n=>new Date(n.appointment_time)>=rt(t))}if(b.trim()){const n=b.toLowerCase();a=a.filter(m=>m.patient?.name?.toLowerCase().includes(n))}return a},[g,y,r,b]),_e=p.useMemo(()=>{const t={};return Ne.forEach(a=>{const n=d(new Date(a.appointment_time),"yyyy-MM-dd");t[n]||(t[n]=[]),t[n].push(a)}),t},[Ne]),I=p.useMemo(()=>{const t={};return g.forEach(a=>{const n=d(new Date(a.appointment_time),"yyyy-MM-dd");t[n]=(t[n]||0)+1}),t},[g]),Re=t=>{const a={scheduled:{label:"Agendada",variant:"outline",color:"text-blue-600 bg-blue-50"},confirmed:{label:"Confirmada",variant:"default",color:"text-green-600 bg-green-50"},awaiting_confirmation:{label:"Aguardando",variant:"secondary",color:"text-yellow-600 bg-yellow-50"},completed:{label:"Realizada",variant:"secondary",color:"text-gray-600 bg-gray-100"},cancelled:{label:"Cancelada",variant:"destructive",color:"text-red-600 bg-red-50"},no_show:{label:"Faltou",variant:"destructive",color:"text-orange-600 bg-orange-50"}};return a[t]||a.scheduled},Be=t=>{const a={first_appointment:{label:"Primeira Consulta"},return:{label:"Retorno"},evaluation:{label:"Avalia√ß√£o"},online:{label:"Online"},in_person:{label:"Presencial"}};return a[t]||a.first_appointment},Ue=(t,a)=>{const n=new Date(new Date(t).getTime()+(a||60)*6e4);return d(n,"HH:mm")},Je=t=>{const[a,n,m]=t.split("-").map(Number),x=new Date(a,n-1,m),f=d(x,"EEEE",{locale:v}),H=f.charAt(0).toUpperCase()+f.slice(1),V=d(x,"dd 'de' MMMM",{locale:v});return S(x)?`Hoje ‚Ä¢ ${H}, ${V}`:zt(x)?`Amanh√£ ‚Ä¢ ${H}, ${V}`:`${H}, ${V}`},Ke=()=>{j(vt(r||new Date,1))},Xe=()=>{j(wt(r||new Date,1))},Ge=()=>{j(new Date)},Qe=()=>{j(null)},Ye=t=>{r&&Fe(t,r)?j(null):j(t)},Ze=t=>{j(t),Y(!1)},de=t=>t>=5?"text-secondary font-bold":t>=3?"text-yellow-600 font-bold":t>=1?"text-primary font-bold":"text-muted-foreground font-bold",et=async()=>{try{let t="",a=[],n,m;if(Z==="week"?(n=W($,{locale:v}),m=Ee($,{locale:v}),t=`Semana de ${d(n,"dd/MM")} a ${d(m,"dd/MM/yyyy")}`,a=g.filter(x=>{const f=new Date(x.appointment_time);return f>=n&&f<=m}).sort((x,f)=>new Date(x.appointment_time)-new Date(f.appointment_time))):(n=Nt(q),m=$t(q),t=d(q,"MMMM 'de' yyyy",{locale:v}),t=t.charAt(0).toUpperCase()+t.slice(1),a=g.filter(x=>{const f=new Date(x.appointment_time);return f>=n&&f<=m}).sort((x,f)=>new Date(x.appointment_time)-new Date(f.appointment_time))),a.length===0){i({title:"Sem agendamentos",description:`N√£o h√° agendamentos para ${t.toLowerCase()}.`,variant:"default"});return}await _t(a,Z,t,c?.profile?.name||c?.email?.split("@")[0]||null),i({title:"PDF gerado!",description:`Agenda exportada com sucesso (${a.length} consultas).`}),L(!1)}catch(t){console.error("Erro ao exportar PDF:",t),i({title:"Erro ao exportar",description:"N√£o foi poss√≠vel gerar o PDF. Tente novamente.",variant:"destructive"})}};return e.jsx("div",{className:"min-h-screen bg-background overflow-x-hidden",children:e.jsxs(ot.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-4 md:pt-8 min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 md:mb-8 text-center sm:text-left",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold font-heading uppercase tracking-wide text-primary break-words",children:"Agenda de Consultas"}),e.jsx("p",{className:"text-neutral-600 mt-1 text-sm md:text-base",children:"Visualize e gerencie todos os seus agendamentos."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-center sm:justify-end",children:[e.jsxs(h,{variant:"outline",onClick:()=>L(!0),className:"border-primary text-primary hover:bg-primary hover:text-white",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"})," Exportar PDF"]}),e.jsxs(h,{onClick:()=>{E(null),C(!0)},className:"bg-primary hover:bg-primary/90",children:[e.jsx(kt,{className:"w-4 h-4 mr-2"})," Novo Agendamento"]})]})]}),e.jsx("div",{className:"lg:hidden mb-6",children:e.jsx(se,{className:"bg-card shadow-card-dark rounded-xl overflow-hidden",children:e.jsxs(ne,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(h,{variant:"outline",size:"icon",onClick:Ke,className:"h-10 w-10 flex-shrink-0",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:r?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-primary",children:d(r,"dd 'de' MMMM",{locale:v})}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:d(r,"EEEE",{locale:v})})]}):e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Todos os agendamentos"})}),e.jsx(h,{variant:"outline",size:"icon",onClick:Xe,className:"h-10 w-10 flex-shrink-0",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(h,{variant:r&&S(r)?"default":"outline",size:"sm",onClick:Ge,className:"flex-1",children:"Hoje"}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>Y(!0),className:"flex-1",children:[e.jsx(Et,{className:"w-4 h-4 mr-1.5"}),"Calend√°rio"]}),r&&e.jsx(h,{variant:"outline",size:"sm",onClick:Qe,className:"flex-1",children:"Ver Todos"})]})]})})}),e.jsx(fe,{open:ie,onOpenChange:Y,children:e.jsxs(je,{className:"max-w-sm",children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Selecionar Data"}),e.jsx(Se,{children:"Escolha uma data para ver os agendamentos"})]}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ke,{mode:"single",selected:r,onSelect:Ze,className:"rounded-md border",locale:v,modifiers:{today:t=>S(t),highLoad:t=>(I[d(t,"yyyy-MM-dd")]||0)>=5&&!S(t),mediumLoad:t=>{const a=I[d(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!S(t)},lowLoad:t=>{const a=I[d(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!S(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"space-y-2 pb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground px-2",children:"Legenda:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs px-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"5+"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-7 order-1 min-w-0",children:e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl overflow-hidden",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"font-heading text-base lg:text-lg font-semibold text-primary",children:"Agendamentos"}),e.jsxs(Me,{className:"text-xs lg:text-sm",children:[r&&`Agendamentos de ${d(r,"dd/MM/yyyy")}`,!r&&y==="all"&&"Todos os pr√≥ximos agendamentos",!r&&y==="today"&&"Agendamentos de hoje",!r&&y==="week"&&"Agendamentos desta semana",!r&&y==="month"&&"Agendamentos deste m√™s"]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col sm:flex-row gap-3",children:[e.jsxs(B,{value:y,onValueChange:D,disabled:!!r,children:[e.jsxs(U,{className:"w-full sm:w-[180px]",children:[e.jsx(At,{className:"w-4 h-4 mr-2"}),e.jsx(J,{})]}),e.jsxs(K,{children:[e.jsx(M,{value:"all",children:"Todos"}),e.jsx(M,{value:"today",children:"Hoje"}),e.jsx(M,{value:"week",children:"Esta Semana"}),e.jsx(M,{value:"month",children:"Este M√™s"})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(R,{placeholder:"Buscar paciente...",value:b,onChange:t=>s(t.target.value),className:"pl-9"})]}),(b||r)&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{s(""),j(null)},className:"w-full sm:w-auto",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]}),e.jsxs("div",{className:"lg:hidden relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(R,{placeholder:"Buscar paciente...",value:b,onChange:t=>s(t.target.value),className:"pl-9"})]})]})}),e.jsx(ne,{className:"p-3 lg:p-6",children:T?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"Carregando agendamentos..."})}):Object.keys(_e).length>0?e.jsx("div",{className:"space-y-4 lg:space-y-6",children:Object.entries(_e).map(([t,a])=>e.jsxs("div",{className:"space-y-2 lg:space-y-3",children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 pb-2 border-b",children:[e.jsx(Te,{className:"w-4 h-4 lg:w-5 lg:h-5 text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-sm lg:text-base text-foreground capitalize truncate",children:Je(t)}),e.jsx(Ae,{variant:"secondary",className:`ml-auto text-xs whitespace-nowrap border-0 ${a.length>=5?"bg-secondary/80 text-white":a.length>=3?"bg-yellow-400/70 text-yellow-900":"bg-primary/30 text-primary"}`,children:a.length})]}),e.jsx("div",{className:"space-y-2 lg:space-y-3",children:a.map(n=>{const m=Re(n.status||"scheduled"),x=Be(n.appointment_type||"first_appointment"),f=Ue(n.appointment_time,n.duration);return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-4 p-2.5 lg:p-4 bg-muted/30 hover:bg-muted/50 rounded-lg border border-border/50 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-primary/10 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg min-w-[55px] lg:min-w-[70px] flex-shrink-0",children:[e.jsx(Tt,{className:"w-3 h-3 lg:w-4 lg:h-4 mb-0.5 lg:mb-1 text-primary"}),e.jsx("span",{className:"text-xs lg:text-sm font-bold text-primary",children:d(new Date(n.appointment_time),"HH:mm")}),e.jsx("span",{className:"text-[10px] lg:text-xs text-muted-foreground",children:f})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 mb-0.5",children:[e.jsx(dt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-sm lg:text-base text-foreground truncate",children:n.patient?.name||"Paciente n√£o identificado"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(Ae,{className:`text-xs ${m.color} border-0`,children:m.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.label}),n.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1 hidden lg:block",children:["‚Ä¢ ",n.notes]})]})]}),e.jsxs("div",{className:"flex gap-1 lg:gap-2 flex-shrink-0",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>w(`/nutritionist/patients/${n.patient_id}/hub`),className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-blue-50 hover:text-blue-600",title:"Ver detalhes do paciente",children:e.jsx(Ft,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>{E(n),C(!0)},className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-primary/10 hover:text-primary",title:"Editar agendamento",children:e.jsx(Pt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 lg:h-9 lg:w-9 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>Ve(n),title:"Excluir agendamento",children:e.jsx(ct,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})})]})]},n.id)})})]},t))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 lg:py-12 text-center",children:[e.jsx(Te,{className:"w-12 h-12 lg:w-16 lg:h-16 text-muted-foreground/50 mb-3 lg:mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium text-sm lg:text-base mb-1 lg:mb-2",children:"Nenhum agendamento encontrado"}),e.jsxs("p",{className:"text-xs lg:text-sm text-muted-foreground",children:[b&&"Nenhum agendamento encontrado para esta busca",!b&&r&&"N√£o h√° consultas agendadas para este dia",!b&&!r&&y==="all"&&"Adicione um novo agendamento para come√ßar",!b&&!r&&y==="today"&&"N√£o h√° consultas agendadas para hoje",!b&&!r&&y==="week"&&"N√£o h√° consultas agendadas para esta semana",!b&&!r&&y==="month"&&"N√£o h√° consultas agendadas para este m√™s"]})]})})]})}),e.jsxs("div",{className:"hidden lg:block lg:col-span-3 order-2 space-y-6",children:[e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsxs(ue,{className:"pb-3",children:[e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Calend√°rio"}),e.jsx(Me,{className:"text-xs",children:"Clique em um dia para filtrar ‚Ä¢ Clique novamente para limpar"})]}),e.jsxs(ne,{className:"flex flex-col items-center p-0 pb-3",children:[e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(ke,{mode:"single",selected:r,onSelect:Ye,className:"w-fit",locale:v,modifiers:{today:t=>S(t),highLoad:t=>(I[d(t,"yyyy-MM-dd")]||0)>=5&&!S(t),mediumLoad:t=>{const a=I[d(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!S(t)},lowLoad:t=>{const a=I[d(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!S(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"w-full px-4 mt-3 border-t pt-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Legenda:"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"5+"})]})]})]})]})]}),e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(ue,{className:"pb-3",children:e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Resumo"})}),e.jsx(ne,{className:"space-y-3",children:(()=>{const t=g.filter(m=>S(new Date(m.appointment_time))).length,a=g.filter(m=>Oe(new Date(m.appointment_time),{locale:v})).length,n=g.filter(m=>ze(new Date(m.appointment_time))).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hoje"}),e.jsx("span",{className:de(t),children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Esta Semana"}),e.jsx("span",{className:de(a),children:a})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Este M√™s"}),e.jsx("span",{className:de(n),children:n})]})]})})()})]})]})]}),e.jsx(fe,{open:re,onOpenChange:L,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Exportar Agenda em PDF"}),e.jsx(Se,{children:"Selecione o per√≠odo que deseja exportar"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"period-type",children:"Per√≠odo"}),e.jsxs(B,{value:Z,onValueChange:Ie,children:[e.jsx(U,{id:"period-type",children:e.jsx(J,{})}),e.jsxs(K,{children:[e.jsx(M,{value:"week",children:"Semana"}),e.jsx(M,{value:"month",children:"M√™s"})]})]})]}),Z==="week"&&e.jsxs("div",{children:[e.jsx(N,{children:"Selecionar Semana"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>oe(It($)),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 text-center text-sm font-medium",children:[d(W($,{locale:v}),"dd/MM")," a"," ",d(Ee($,{locale:v}),"dd/MM/yyyy")]}),e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>oe($e($,1)),children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>oe(W(new Date,{locale:v})),className:"w-full mt-2 text-xs",children:"Semana Atual"})]}),Z==="month"&&e.jsxs("div",{children:[e.jsx(N,{children:"Selecionar M√™s"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>le(Ot(q,1)),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-center text-sm font-medium capitalize",children:d(q,"MMMM 'de' yyyy",{locale:v})}),e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>le(Lt(q,1)),children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>le(new Date),className:"w-full mt-2 text-xs",children:"M√™s Atual"})]})]}),e.jsxs(Le,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>L(!1),children:"Cancelar"}),e.jsxs(h,{type:"button",onClick:et,className:"bg-primary",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Exportar"]})]})]})}),e.jsx(Ht,{open:G,onOpenChange:C,appointment:O,patients:k,services:o,nutritionistId:c?.id,preSelectedDate:r,onSave:He}),e.jsx(mt,{open:l,onOpenChange:Q,children:e.jsxs(pt,{children:[e.jsxs(ut,{children:[e.jsx(xt,{children:"Confirmar Exclus√£o"}),e.jsxs(ht,{children:["Tem certeza que deseja excluir o agendamento de"," ",e.jsx("strong",{children:P?.patient?.name})," para"," ",e.jsx("strong",{children:P&&d(new Date(P.appointment_time),"dd/MM/yyyy '√†s' HH:mm")}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta a√ß√£o n√£o pode ser desfeita."]})]}),e.jsxs(gt,{children:[e.jsx(ft,{children:"Cancelar"}),e.jsx(jt,{onClick:We,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})})}export{Na as default};
