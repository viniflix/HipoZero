import{q as $e,r as t,j as e,J as ge,K as je,M as ve,N as Ne,ad as ye,s as ne,B as _,Q as Ge,O as Pe,X as Ie,V as Ts,C as ee,c as me,d as xe,e as se,T as Ke,b as Ye,a as ps,L as Be,A as fs,h as gs,i as js,k as vs,l as Ns,n as ys,o as bs,p as ws,$ as Ae,a5 as Es,u as zs,D as Is,x as Ds,y as Rs,z as Me,an as ss}from"./index-DL6VMzkS.js";import{I as be}from"./input-CMIeflfg.js";import{B as ue}from"./badge-CMQ26CgR.js";import{A as Te,a as Ee}from"./alert-WBazYc63.js";import{T as Ls,D as as}from"./date-input-zI4YYSYu.js";import{L as J}from"./label-c61kF7fH.js";import{T as Xe}from"./textarea-D_72FZEz.js";import{C as Ue}from"./checkbox-BDwF_34G.js";import{S as Cs,a as _s,b as Ss,c as ks,d as Ve}from"./select-BdvFUaSV.js";import{S as Os,a as qe}from"./SmartFoodForm-DtAv55gk.js";import{P as we}from"./plus-D17bPVCi.js";import{S as Ze}from"./search-DSoGe5N4.js";import{l as Je}from"./query-helpers-mbysFH2_.js";import{f as Fs}from"./measureTranslations-AG6EuUvS.js";import{P as ze}from"./pen-square-BTn1AN_C.js";import{R as qs}from"./ReferenceValuesModal-DnQIoq6i.js";import{F as ts}from"./flame-C4A5vNmC.js";import{T as Ms}from"./target-DxVIlGM1.js";import{B as We,R as rs}from"./refresh-cw-KceLOa3W.js";import{T as ls}from"./trending-down-BFB1Ewdl.js";import{T as os}from"./trending-up-D1f-Js4G.js";import{M as $s}from"./minus-CrcBRv1E.js";import{getReferenceValues as Ps,getTemplates as Bs,getMealPlanById as Re,applyTemplateToPatient as Gs,getMealPlans as Us,getActiveMealPlan as Vs,updateFullMealPlan as Ws,createMealPlan as Hs,addMealToPlan as Qs,addFoodToMeal as Ks,archiveMealPlan as Ys,setActiveMealPlan as Xs,deleteMealPlan as Zs,copyMealPlanToPatient as Js,savePlanAsTemplate as ea}from"./meal-plan-queries-DYlpSijV.js";import{C as sa}from"./calendar-jIa_pVTS.js";import{S as aa}from"./save-CMbYHicL.js";import{g as ta}from"./anamnesis-queries-aQPvoJcl.js";import{g as ra}from"./date-C2sroe8F.js";import{F as Le}from"./file-text-C4_WSc72.js";import{U as He}from"./utensils-Dewe3o1J.js";import{R as la}from"./ruler-D1AldI3E.js";import{e as oa}from"./pdfUtils-DW8H_cAf.js";import{E as na}from"./jspdf.es.min-DtjUTZMk.js";import{a as ia}from"./jspdf.plugin.autotable-C3NxY6Hi.js";import{t as ca}from"./mealTranslations-B1KHhmEq.js";import{P as da}from"./progress-DU5vUya8.js";import{P as ma,a as xa,b as ua}from"./popover-D1PQqJd4.js";import{A as Oe}from"./alert-circle-C4M18OPV.js";import{C as ns}from"./calculator-Bj49M2n3.js";import{I as ha}from"./info-op9RHOfw.js";import{C as is}from"./check-circle-2-gVVXIxZ5.js";import{d as pa,h as cs}from"./anthropometry-queries-CkztJiX5.js";import{A as ds}from"./arrow-left-Co1jqMwu.js";import{M as fa}from"./more-vertical-C9pHiQH7.js";import{D as ms}from"./download-BjhT0Wxe.js";import"./calendar-BOiwl0x6.js";import"./endOfMonth-fINJXo8H.js";import"./addMonths-Dpdm5UWc.js";import"./isSameDay-CfSWIrxC.js";import"./chevron-left-HK0xeE4r.js";import"./pt-BR-faZp8-Xc.js";import"./parseISO-DyXfBXdu.js";import"./index-BCjh5bjs.js";import"./extends-CF3RwP-h.js";import"./tabs-DCPXMA94.js";import"./foodService-BU-lt8MH.js";import"./slider-BlQMCEyH.js";import"./nutrition-calculations-DjYFS08l.js";import"./html2canvas.esm-B0tyYwQk.js";import"./patient-queries-DGcE69Ge.js";const ga=$e("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Qe=$e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),xs=$e("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),us=$e("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function ja({open:s,onOpenChange:c,initialName:r="",onFoodCreated:u}){const a=t.useRef(null),x=N=>{u&&u(N),d()},d=()=>{c(!1)};return e.jsx(ge,{open:s,onOpenChange:d,children:e.jsxs(je,{className:"max-w-4xl max-h-[95vh] overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),"Cadastrar Alimento Personalizado"]}),e.jsx(ye,{children:"Preencha o formul√°rio passo a passo para criar um alimento customizado. Voc√™ pode buscar produtos no OpenFoodFacts ou preencher manualmente."})]}),e.jsx(Os,{ref:a,mode:"full",initialName:r,onSuccess:x})]})})}const va=({isOpen:s,onClose:c,onSelect:r})=>{const[u,a]=t.useState(""),[x,d]=t.useState([]),[N,v]=t.useState(!1),[k,n]=t.useState(null),[S,p]=t.useState(null),[P,w]=t.useState(!1),M=[{value:null,label:"Todos"},{value:"TACO",label:"TACO"},{value:"IBGE",label:"IBGE"},{value:"USDA",label:"USDA"},{value:"Tucunduva",label:"Tucunduva"},{value:"TBCA",label:"TBCA"},{value:"custom",label:"Personalizados"}];t.useEffect(()=>{s&&A()},[s,u,S]);const A=async()=>{if(u.length<2){d([]);return}v(!0);try{let o=ne.from("foods").select("id, name, group, description, source, calories, protein, carbs, fat, fiber, sodium").eq("is_active",!0).ilike("name",`%${u}%`).order("name",{ascending:!0}).limit(50);S&&(o=o.eq("source",S));const{data:C,error:F}=await o;if(F)throw F;d(C||[])}catch(o){console.error("Erro ao buscar alimentos:",o),d([])}finally{v(!1)}},E=()=>{k&&(r(k),D())},D=()=>{a(""),d([]),n(null),p(null),c()},f=async o=>{w(!1),d([o,...x]),n(o),u&&await A()};return e.jsxs(ge,{open:s,onOpenChange:D,children:[e.jsxs(je,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Buscar Alimento"}),e.jsx(ye,{children:"Procure alimentos por nome nas bases de dados nutricionais"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"search",children:"Nome do Alimento"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{id:"search",placeholder:"Digite pelo menos 2 caracteres...",value:u,onChange:o=>a(o.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:M.map(o=>e.jsx(ue,{variant:S===o.value?"default":"outline",className:"cursor-pointer",onClick:()=>p(o.value),children:o.label},o.value||"all"))}),e.jsxs(qe,{className:"h-[400px] border rounded-md p-4",children:[N&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Buscando..."}),!N&&u.length<2&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Digite pelo menos 2 caracteres para buscar"}),!N&&u.length>=2&&x.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhum alimento encontrado"}),e.jsxs(_,{variant:"outline",onClick:()=>w(!0),className:"mx-auto",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Cadastrar '",u,"' agora"]})]}),!N&&x.length>0&&e.jsx("div",{className:"space-y-2",children:x.map(o=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${k?.id===o.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>n(o),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:o.name}),k?.id===o.id&&e.jsx(Ge,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(ue,{variant:"outline",className:"text-xs",children:o.source||"N/A"}),o.group&&e.jsx("span",{className:"text-xs text-muted-foreground",children:o.group})]}),o.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:o.description})]}),e.jsxs("div",{className:"ml-4 text-right text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[o.calories," kcal"]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["P: ",o.protein,"g | C: ",o.carbs,"g | G: ",o.fat,"g"]})]})]})},o.id))})]})]}),e.jsxs(Pe,{children:[e.jsxs(_,{variant:"outline",onClick:D,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:E,disabled:!k,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Selecionar"]})]})]}),e.jsx(ja,{open:P,onOpenChange:w,initialName:u,onFoodCreated:f})]})},Na=async()=>{try{const{data:s,error:c}=await ne.from("household_measures").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(c)throw c;return{data:s||[],error:null}}catch(s){return Je("Erro ao buscar medidas caseiras",s),{data:null,error:s}}},ya=async s=>{try{const{data:c,error:r}=await ne.from("food_household_measures").select(`
        id,
        food_id,
        measure_id,
        quantity,
        grams,
        created_at,
        updated_at,
        measure:household_measures(
          id,
          name,
          code,
          category,
          description,
          ml_equivalent,
          grams_equivalent,
          order_index
        )
      `).eq("food_id",s).order("measure(order_index)",{ascending:!0});if(r)throw r;return{data:c||[],error:null}}catch(c){return Je("Erro ao buscar medidas do alimento",c),{data:null,error:c}}},ba=s=>{const[c,r]=t.useState([]),[u,a]=t.useState(!1),[x,d]=t.useState(null),N=t.useCallback(async()=>{if(!s){r([]);return}a(!0),d(null);try{const v=await ya(s);if(v.error)throw v.error;r(v.data||[])}catch(v){console.error("Erro ao carregar medidas:",v),d(v),r([])}finally{a(!1)}},[s]);return t.useEffect(()=>{N()},[N]),{data:c,isLoading:u,error:x,refetch:N}},wa=(s={})=>{const[c,r]=t.useState([]),[u,a]=t.useState(!0),[x,d]=t.useState(null),N=t.useCallback(async()=>{a(!0),d(null);try{const v=await Na();if(v.error)throw v.error;r(v.data||[])}catch(v){console.error("Erro ao carregar medidas caseiras:",v),d(v),r([])}finally{a(!1)}},[]);return t.useEffect(()=>{N()},[N]),{data:c,isLoading:u,error:x,refetch:N}};function Ca({food:s,value:c={quantity:100,measureId:null},onChange:r,showNutrition:u=!0,className:a="",onNutritionChange:x=null}){const{data:d=[],isLoading:N}=wa(),{data:v=[],isLoading:k}=ba(s?.id),n=N||k,S=t.useMemo(()=>d.map(f=>({...f,hasSpecificConversion:v.some(o=>o.measure_id===f.id)})),[d,v]),p=t.useMemo(()=>{if(!c.measureId||c.measureId==="grams"||v.find(C=>C.measure_id===c.measureId))return!1;const o=d.find(C=>C.id===c.measureId);return o&&o.grams_equivalent?!1:!!o},[c.measureId,v,d]),P=t.useMemo(()=>{if(!s||!c.quantity)return 0;if(c.measureId===null||c.measureId==="grams")return c.quantity;const f=v.find(C=>C.measure_id===c.measureId);if(f)return f.grams*c.quantity/f.quantity;const o=d.find(C=>C.id===c.measureId);return o&&o.grams_equivalent?o.grams_equivalent*c.quantity:o?(console.warn(`Usando portion_size como fallback para medida "${o.name}"`),(s.portion_size||100)*c.quantity):(console.error(`Medida ${c.measureId} n√£o encontrada`),0)},[s,c,v,d]),w=t.useMemo(()=>{if(!s||P===0)return{grams:0,calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0};const f=P/100,o=(s.protein||0)*f,C=(s.carbs||0)*f,F=(s.fat||0)*f,H=o*4+C*4+F*9;return{grams:P,calories:parseFloat(H.toFixed(2)),protein:parseFloat(o.toFixed(2)),carbs:parseFloat(C.toFixed(2)),fat:parseFloat(F.toFixed(2)),fiber:s.fiber?parseFloat((s.fiber*f).toFixed(2)):0,sodium:s.sodium?parseFloat((s.sodium*f).toFixed(2)):0}},[s,P]);t.useEffect(()=>{x&&x(w)},[w,x]);const M=f=>{r({...c,quantity:parseFloat(f)||0})},A=f=>{r({...c,measureId:f==="grams"?null:parseInt(f)})},E=t.useMemo(()=>S.reduce((f,o)=>{const C=o.category||"other";return f[C]||(f[C]=[]),f[C].push(o),f},{}),[S]),D={volume:"Medidas de Volume",weight:"Medidas de Peso",unit:"Unidades",other:"Outras"};return e.jsxs("div",{className:`space-y-2 ${a}`,children:[e.jsx(J,{children:"Por√ß√£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{type:"number",value:c.quantity,onChange:f=>M(f.target.value),min:0,step:.5,className:"w-24",placeholder:"0",disabled:!s}),e.jsxs(Cs,{value:c.measureId?.toString()??"grams",onValueChange:A,disabled:!s||n,children:[e.jsx(_s,{className:"w-40",children:e.jsx(Ss,{placeholder:n?"Carregando...":"Selecione"})}),e.jsxs(ks,{className:"max-h-[300px]",children:[e.jsx(Ve,{value:"grams",children:"g"}),e.jsx("div",{className:"overflow-y-auto max-h-[280px]",children:Object.entries(E).map(([f,o])=>e.jsxs(Ts.Fragment,{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground sticky top-0 bg-popover",children:D[f]||f}),o.map(C=>e.jsxs(Ve,{value:C.id.toString(),className:"pl-6",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:C.name}),C.hasSpecificConversion&&e.jsx("span",{className:"ml-2 text-xs text-primary",children:"‚òÖ"})]}),C.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:C.description})]},C.id))]},f))})]})]}),u&&s&&P>0&&e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["‚âà ",w.grams.toFixed(0),"g | ",Math.round(w.calories)," kcal"]})]}),s&&!n&&v.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"‚òÖ = Convers√£o espec√≠fica para este alimento"}),p&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-950/30 p-2 rounded border border-amber-200 dark:border-amber-800",children:["‚ö†Ô∏è Estimativa aproximada (",s.portion_size||100,"g por unidade). Para maior precis√£o, cadastre a convers√£o espec√≠fica."]})]})}const _a=({isOpen:s,onClose:c,onAdd:r,mealName:u,initialData:a=null})=>{const[x,d]=t.useState(null),[N,v]=t.useState({quantity:100,measureId:null}),[k,n]=t.useState(""),[S,p]=t.useState(null),[P,w]=t.useState(!1),[M,A]=t.useState({});t.useEffect(()=>{a&&(d(a.food),v({quantity:a.quantity||100,measureId:a.unit==="gram"?null:a.unit}),n(a.notes||""),p({calories:a.calories||0,protein:a.protein||0,carbs:a.carbs||0,fat:a.fat||0}))},[a]);const E=F=>{d(F),w(!1),v({quantity:100,measureId:null}),p(null)},D=F=>{p(F)},f=()=>{const F={};return x||(F.food="Selecione um alimento"),(!N.quantity||N.quantity<=0)&&(F.portion="Quantidade deve ser maior que zero"),A(F),Object.keys(F).length===0},o=()=>{if(!f())return;const F={food_id:x.id,food:x,quantity:N.quantity,unit:N.measureId||"gram",calories:S?.calories||0,protein:S?.protein||0,carbs:S?.carbs||0,fat:S?.fat||0,notes:k.trim()||null};r(F),C()},C=()=>{d(null),v({quantity:100,measureId:null}),n(""),p(null),A({}),c()};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:s,onOpenChange:C,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:a?"Editar Alimento":"Adicionar Alimento"}),e.jsx(ye,{children:a?`Editar alimento: ${a.food?.name||""}`:u?`Adicionar alimento √† refei√ß√£o: ${u}`:"Adicionar novo alimento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{children:["Alimento ",e.jsx("span",{className:"text-destructive",children:"*"})]}),x?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:x.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.group," ‚Ä¢ ",x.source]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Base 100g: ",x.calories," kcal | P: ",x.protein,"g | C: ",x.carbs,"g | G: ",x.fat,"g"]})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>w(!0),children:"Trocar"})]}):e.jsxs(_,{variant:"outline",className:"w-full",onClick:()=>w(!0),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Buscar Alimento"]}),M.food&&e.jsx("p",{className:"text-xs text-destructive",children:M.food})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ca,{food:x,value:N,onChange:v,showNutrition:!1,onNutritionChange:D}),M.portion&&e.jsx("p",{className:"text-xs text-destructive",children:M.portion})]}),S&&e.jsx(Te,{className:"bg-primary/5",children:e.jsxs(Ee,{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Valores Nutricionais:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:Math.round(S.calories)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:S.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:S.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:S.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx(Xe,{id:"notes",rows:2,placeholder:"Ex: sem sal, sem a√ß√∫car, etc.",value:k,onChange:F=>n(F.target.value)})]})]}),e.jsxs(Pe,{children:[e.jsxs(_,{variant:"outline",onClick:C,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:o,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),a?"Atualizar":"Adicionar"]})]})]})}),e.jsx(va,{isOpen:P,onClose:()=>w(!1),onSelect:E})]})},Sa=({isOpen:s,onClose:c,onSave:r,initialData:u=null})=>{const[a,x]=t.useState({name:"",meal_type:"",meal_time:"",notes:""}),[d,N]=t.useState([]),[v,k]=t.useState(!1),[n,S]=t.useState(null),[p,P]=t.useState({}),w=[{value:"breakfast",label:"Caf√© da Manh√£"},{value:"morning_snack",label:"Lanche da Manh√£"},{value:"lunch",label:"Almo√ßo"},{value:"afternoon_snack",label:"Lanche da Tarde"},{value:"dinner",label:"Jantar"},{value:"supper",label:"Ceia"},{value:"pre_workout",label:"Pr√©-Treino"},{value:"post_workout",label:"P√≥s-Treino"},{value:"other",label:"Outro"}];t.useEffect(()=>{u&&(x({name:u.name||"",meal_type:u.meal_type||"",meal_time:u.meal_time||"",notes:u.notes||""}),N(u.foods||[]))},[u]);const M=(g,R)=>{x($=>{const U={...$,[g]:R};return g==="meal_type"&&R!=="other"&&(U.name=""),U}),p[g]&&P($=>({...$,[g]:null}))},A=g=>{N(R=>[...R,{...g,tempId:Date.now()}])},E=g=>{S(g),k(!0)},D=g=>{N(R=>R.map($=>$.tempId===n.tempId?{...g,tempId:$.tempId}:$)),S(null)},f=g=>{N(R=>R.filter($=>$.tempId!==g))},o=()=>{k(!1),S(null)},C=()=>d.reduce((g,R)=>({calories:g.calories+(R.calories||0),protein:g.protein+(R.protein||0),carbs:g.carbs+(R.carbs||0),fat:g.fat+(R.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),F=()=>{const g={};return a.meal_type||(g.meal_type="Tipo de refei√ß√£o √© obrigat√≥rio"),a.meal_type==="other"&&!a.name.trim()&&(g.name='Nome da refei√ß√£o √© obrigat√≥rio quando tipo √© "Outro"'),d.length===0&&(g.foods="Adicione pelo menos um alimento"),P(g),Object.keys(g).length===0},H=()=>{if(!F())return;const g=C(),$={name:a.meal_type==="other"?a.name:w.find(U=>U.value===a.meal_type)?.label||"",meal_type:a.meal_type,meal_time:a.meal_time,notes:a.notes,foods:d,...g};r($),Y()},Y=()=>{x({name:"",meal_type:"",meal_time:"",notes:""}),N([]),P({}),c()},T=C();return e.jsxs(e.Fragment,{children:[e.jsx(ge,{open:s,onOpenChange:Y,children:e.jsxs(je,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:u?"Editar Refei√ß√£o":"Nova Refei√ß√£o"}),e.jsx(ye,{children:"Configure a refei√ß√£o e adicione os alimentos"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsx(me,{children:e.jsx(xe,{className:"text-lg",children:"Informa√ß√µes da Refei√ß√£o"})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"meal_type",children:["Tipo de Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(Cs,{value:a.meal_type,onValueChange:g=>M("meal_type",g),children:[e.jsx(_s,{id:"meal_type",className:p.meal_type?"border-destructive":"",children:e.jsx(Ss,{placeholder:"Selecione o tipo"})}),e.jsx(ks,{children:w.map(g=>e.jsx(Ve,{value:g.value,children:g.label},g.value))})]}),p.meal_type&&e.jsx("p",{className:"text-xs text-destructive",children:p.meal_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"meal_time",children:"Hor√°rio (opcional)"}),e.jsx(Ls,{id:"meal_time",value:a.meal_time,onChange:g=>M("meal_time",g)})]})]}),a.meal_type==="other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"name",children:["Nome da Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(be,{id:"name",placeholder:"Ex: Lanche Noturno, Suplementa√ß√£o",value:a.name,onChange:g=>M("name",g.target.value),className:p.name?"border-destructive":""}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx(Xe,{id:"notes",rows:2,placeholder:"Observa√ß√µes sobre a refei√ß√£o...",value:a.notes,onChange:g=>M("notes",g.target.value)})]})]})]}),e.jsxs(ee,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{className:"text-lg",children:"Alimentos"}),e.jsxs(_,{size:"sm",onClick:()=>k(!0),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Adicionar Alimento"]})]})}),e.jsx(se,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhum alimento adicionado ainda",p.foods&&e.jsx("p",{className:"text-destructive mt-2",children:p.foods})]}):e.jsxs("div",{className:"space-y-2",children:[d.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:g.food.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Fs(g.quantity,g.unit,g.measure)," ‚Ä¢"," ",g.calories," kcal ‚Ä¢ P: ",g.protein,"g ‚Ä¢ C: ",g.carbs,"g ‚Ä¢ G: ",g.fat,"g"]}),g.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:g.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>E(g),title:"Editar alimento",children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>f(g.tempId),title:"Remover alimento",children:e.jsx(Ke,{className:"h-4 w-4 text-destructive"})})]})]},g.tempId)),e.jsxs("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Totais da Refei√ß√£o:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:T.calories.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:T.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:T.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:T.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})]})})]})]}),e.jsxs(Pe,{children:[e.jsxs(_,{variant:"outline",onClick:Y,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:H,children:[u?"Atualizar":"Adicionar"," Refei√ß√£o"]})]})]})}),e.jsx(_a,{isOpen:v,onClose:o,onAdd:n?D:A,initialData:n,mealName:a.meal_type==="other"?a.name:w.find(g=>g.value===a.meal_type)?.label})]})},As=({protein:s,carbs:c,fat:r,calories:u,patientId:a,planId:x,referenceValues:d,onReferenceUpdate:N,readOnly:v=!1})=>{const k=Ye(),[n,S]=t.useState(!1),p={protein:"#8B3BF2",carbs:"#3B6FF2",fat:"#F28B3B"},P=s*4,w=c*4,M=r*9,A=P+w+M,E=A>0?P/A*100:0,D=A>0?w/A*100:0,f=A>0?M/A*100:0,o=d?.weight_kg?parseFloat(d.weight_kg):null,C=o?s/o:null,F=o?c/o:null,H=o?r/o:null,T=(()=>{if(!d)return null;const h=parseFloat(d.weight_kg),y=parseFloat(d.total_energy_kcal);if(!h||!y)return null;let I,L,G;return d.macro_mode==="percentage"?(I=y*d.protein_percentage/4,L=y*d.carbs_percentage/4,G=y*d.fat_percentage/9):(I=h*d.protein_g_per_kg,L=h*d.carbs_g_per_kg,G=h*d.fat_g_per_kg),{calories:y,protein:I,carbs:L,fat:G,proteinPerKg:I/h,carbsPerKg:L/h,fatPerKg:G/h}})(),g=(h,y)=>{if(!y||y===0)return null;const I=h/y*100,L=h-y,G=I-100;let X="adequate";return I<95||I>105?X="inadequate":I<100?X="below":I>100&&(X="above"),{percentage:I,diff:L,diffPerc:G,status:X}},R=T?g(u,T.calories):null,$=T?g(s,T.protein):null,U=T?g(c,T.carbs):null,he=T?g(r,T.fat):null,te=({adequacy:h,compact:y=!1})=>{if(!h)return null;const L=(G=>{switch(G){case"adequate":return{color:"bg-green-100 text-green-700 border-green-300",icon:e.jsx($s,{className:"w-3 h-3"}),label:"OK"};case"below":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(ls,{className:"w-3 h-3"}),label:h.diffPerc.toFixed(0)};case"above":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(os,{className:"w-3 h-3"}),label:`+${h.diffPerc.toFixed(0)}`};case"inadequate":return{color:h.percentage<95?"bg-red-100 text-red-700 border-red-300":"bg-orange-100 text-orange-700 border-orange-300",icon:h.percentage<95?e.jsx(ls,{className:"w-3 h-3"}):e.jsx(os,{className:"w-3 h-3"}),label:h.percentage<95?h.diffPerc.toFixed(0):`+${h.diffPerc.toFixed(0)}`};default:return null}})(h.status);return L?y?e.jsxs("div",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-md border text-xs font-semibold ${L.color}`,children:[L.icon,e.jsxs("span",{children:[L.label,"%"]})]}):e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md border text-xs font-semibold ${L.color}`,children:[L.icon,e.jsxs("span",{children:[h.percentage.toFixed(0),"%"]})]}):null},ie=()=>{const G=(q,O)=>{const ce=X(75,75,60,O),pe=X(75,75,60,q),fe=O-q<=180?"0":"1";return["M",75,75,"L",ce.x,ce.y,"A",60,60,0,fe,0,pe.x,pe.y,"Z"].join(" ")},X=(q,O,ce,pe)=>{const fe=(pe-90)*Math.PI/180;return{x:q+ce*Math.cos(fe),y:O+ce*Math.sin(fe)}};let ae=0;const re=E/100*360,oe=D/100*360;return e.jsxs("svg",{width:150,height:150,viewBox:"0 0 150 150",className:"mx-auto",children:[E>0&&e.jsx("path",{d:G(ae,ae+re),fill:p.protein,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),D>0&&e.jsx("path",{d:G(ae+re,ae+re+oe),fill:p.carbs,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),f>0&&e.jsx("path",{d:G(ae+re+oe,360),fill:p.fat,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),e.jsx("circle",{cx:75,cy:75,r:38,fill:"#fefae0"}),e.jsx("text",{x:75,y:72,textAnchor:"middle",className:"text-xl font-bold",fill:"#000",children:u.toFixed(0)}),e.jsx("text",{x:75,y:87,textAnchor:"middle",className:"text-[10px]",fill:"#666",children:"kcal"})]})},m=({label:h,color:y,current:I,target:L,currentPerKg:G,targetPerKg:X,percentage:ae,adequacy:re,unit:oe="g",isEnergy:q=!1})=>e.jsxs("div",{className:"p-2 rounded-lg border transition-colors",style:y?{backgroundColor:`${y}0D`,borderColor:`${y}33`}:{backgroundColor:"rgb(250 250 249 / 0.3)",borderColor:"rgb(228 228 231)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[y&&!q&&e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:y}}),q&&e.jsx(ts,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${y&&!q?"":"text-muted-foreground"}`,style:y&&!q?{color:y}:void 0,children:h})]}),re&&e.jsx(te,{adequacy:re,compact:!0})]}),e.jsxs("div",{className:"flex items-baseline justify-between gap-2 flex-wrap min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-1 flex-wrap min-w-0",children:[e.jsx("span",{className:`text-lg font-bold ${y&&!q?"":"text-foreground"}`,style:y&&!q?{color:y}:void 0,children:I.toFixed(q?0:1)}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:oe}),G&&!q&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["(",G.toFixed(1)," g/kg)"]}),ae!==void 0&&!q&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["‚Ä¢ ",ae.toFixed(0),"%"]})]}),L&&e.jsxs("div",{className:"flex items-baseline gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"text-muted-foreground font-medium whitespace-nowrap",children:"Meta:"}),e.jsxs("span",{className:"font-bold text-foreground whitespace-nowrap",children:[L.toFixed(q?0:1),oe]}),X&&!q&&e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["(",X.toFixed(1)," g/kg)"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{className:"h-full bg-gradient-to-br from-[#fefae0]/30 to-[#f9ebc7]/30 border-[#a9b388]",children:[e.jsx(me,{className:"pb-2",children:e.jsxs(xe,{className:"text-base flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-[#c4661f]"}),"Distribui√ß√£o de Macronutrientes"]})}),e.jsxs(se,{className:"space-y-2",children:[e.jsx(ie,{}),e.jsxs("div",{className:"space-y-1",children:[T&&e.jsx(m,{label:"Energia",current:u,target:T.calories,adequacy:R,unit:"kcal",isEnergy:!0}),e.jsx(m,{label:"Prote√≠nas",color:p.protein,current:s,target:T?.protein,currentPerKg:C,targetPerKg:T?.proteinPerKg,percentage:E,adequacy:$}),e.jsx(m,{label:"Carboidratos",color:p.carbs,current:c,target:T?.carbs,currentPerKg:F,targetPerKg:T?.carbsPerKg,percentage:D,adequacy:U}),e.jsx(m,{label:"Gorduras",color:p.fat,current:r,target:T?.fat,currentPerKg:H,targetPerKg:T?.fatPerKg,percentage:f,adequacy:he})]}),T&&e.jsx("div",{className:"flex items-center justify-center pt-1 border-t",children:[R,$,U,he].every(h=>h?.status==="adequate")?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-green-700 bg-green-50 px-3 py-1.5 rounded-full border border-green-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Plano adequado"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-yellow-700 bg-yellow-50 px-3 py-1.5 rounded-full border border-yellow-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Ajustes sugeridos"})]})}),!v&&e.jsxs("div",{className:"pt-1.5 border-t space-y-1",children:[e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>S(!0),className:"w-full gap-2",children:[e.jsx(Ms,{className:"w-4 h-4"}),T?"Editar Valores de Refer√™ncia":"Configurar Valores de Refer√™ncia"]}),x&&e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>k(`/nutritionist/patients/${a}/meal-plan/${x}/summary`),className:"w-full gap-2",children:[e.jsx(We,{className:"w-4 h-4"}),"Ver Resumo Nutricional Completo"]}),!T&&e.jsx("div",{className:"text-[10px] text-muted-foreground bg-[#fefae0] p-2 rounded-lg border border-[#a9b388]/30 text-center",children:"üí° Configure os valores de refer√™ncia para ver an√°lise de adequa√ß√£o e g/kg"})]})]})]}),x&&e.jsx(qs,{isOpen:n,onClose:()=>{S(!1),N&&N()},planId:x})]})},ka=({patientId:s,nutritionistId:c,initialData:r=null,onSubmit:u,onCancel:a,loading:x=!1})=>{const[d,N]=t.useState({name:"",description:"",start_date:new Date().toISOString().split("T")[0],end_date:"",active_days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]}),[v,k]=t.useState([]),[n,S]=t.useState(!1),[p,P]=t.useState(null),[w,M]=t.useState({}),[A,E]=t.useState(null),D=[{value:"monday",label:"Segunda"},{value:"tuesday",label:"Ter√ßa"},{value:"wednesday",label:"Quarta"},{value:"thursday",label:"Quinta"},{value:"friday",label:"Sexta"},{value:"saturday",label:"S√°bado"},{value:"sunday",label:"Domingo"}],f=t.useCallback(async()=>{if(r?.id){const{data:m}=await Ps(r.id);E(m)}},[r?.id]);t.useEffect(()=>{if(r){N({name:r.name||"",description:r.description||"",start_date:r.start_date||new Date().toISOString().split("T")[0],end_date:r.end_date||"",active_days:r.active_days||[]});const m=(r.meals||[]).map((h,y)=>({...h,tempId:h.tempId||Date.now()+y,foods:(h.foods||[]).map((I,L)=>({...I,tempId:I.tempId||Date.now()+y+L+1e3}))}));k(m),f()}},[r,f]);const o=(m,h)=>{N(y=>({...y,[m]:h})),w[m]&&M(y=>({...y,[m]:null}))},C=m=>{N(h=>({...h,active_days:h.active_days.includes(m)?h.active_days.filter(y=>y!==m):[...h.active_days,m]}))},F=()=>{N(m=>({...m,active_days:m.active_days.length===7?[]:D.map(h=>h.value)}))},H=()=>{const m=["monday","tuesday","wednesday","thursday","friday"];N(h=>({...h,active_days:m}))},Y=()=>{const m=["saturday","sunday"];N(h=>({...h,active_days:m}))},T=m=>{k(h=>[...h,{...m,tempId:Date.now(),order_index:h.length}])},g=m=>{P(m),S(!0)},R=m=>{k(h=>h.map(y=>y.tempId===p.tempId?{...m,tempId:y.tempId}:y)),P(null)},$=m=>{k(h=>h.filter(y=>y.tempId!==m))},U=()=>v.reduce((m,h)=>({calories:m.calories+(h.calories||0),protein:m.protein+(h.protein||0),carbs:m.carbs+(h.carbs||0),fat:m.fat+(h.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),he=()=>{const m={};return d.name.trim()||(m.name="Nome do plano √© obrigat√≥rio"),d.active_days.length===0&&(m.active_days="Selecione pelo menos um dia da semana"),d.start_date||(m.start_date="Data de in√≠cio √© obrigat√≥ria"),d.end_date&&d.end_date<d.start_date&&(m.end_date="Data final deve ser posterior √† data inicial"),v.length===0&&(m.meals="Adicione pelo menos uma refei√ß√£o"),M(m),Object.keys(m).length===0},te=m=>{if(m.preventDefault(),!he())return;const h=U(),y={patient_id:s,nutritionist_id:c,...d,...h,meals:v};u(y,r?.id)},ie=U();return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsx(me,{children:e.jsx(xe,{className:"text-lg",children:"Informa√ß√µes do Plano"})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"name",children:["Nome do Plano ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(be,{id:"name",placeholder:"Ex: Dieta Hipertrofia",value:d.name,onChange:m=>o("name",m.target.value),className:w.name?"border-destructive":"",disabled:x}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"description",children:"Descri√ß√£o (opcional)"}),e.jsx(Xe,{id:"description",rows:3,placeholder:"Descreva os objetivos e caracter√≠sticas do plano alimentar...",value:d.description,onChange:m=>o("description",m.target.value),disabled:x})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"start_date",children:["Data de In√≠cio ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(as,{id:"start_date",value:d.start_date,onChange:m=>o("start_date",m),className:w.start_date?"border-destructive":"",disabled:x}),w.start_date&&e.jsx("p",{className:"text-xs text-destructive",children:w.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"end_date",children:"Data de T√©rmino (opcional)"}),e.jsx(as,{id:"end_date",value:d.end_date,onChange:m=>o("end_date",m),className:w.end_date?"border-destructive":"",disabled:x}),w.end_date&&e.jsx("p",{className:"text-xs text-destructive",children:w.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs(J,{children:["Dias Ativos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:H,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Dias √∫teis"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:Y,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Fins de semana"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:F,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:d.active_days.length===7?"Limpar":"Todos"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:D.map(m=>e.jsxs("label",{className:`
                                            flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-1 sm:px-3 py-2 border rounded-lg cursor-pointer transition-colors text-xs sm:text-sm
                                            ${d.active_days.includes(m.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"}
                                        `,children:[e.jsx(Ue,{checked:d.active_days.includes(m.value),onCheckedChange:()=>C(m.value),disabled:x,className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-[10px] sm:text-sm leading-tight text-center",children:m.label})]},m.value))}),w.active_days&&e.jsx("p",{className:"text-xs text-destructive",children:w.active_days})]})]})]}),v.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:e.jsxs(ee,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{P(null),S(!0)},disabled:x,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(se,{children:e.jsx("div",{className:"space-y-3",children:v.map((m,h)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",h+1]}),e.jsx("h4",{className:"font-semibold",children:m.name}),m.meal_time&&e.jsxs(ue,{variant:"outline",children:[e.jsx(sa,{className:"h-3 w-3 mr-1"}),m.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[m.foods?.length||0," alimento(s) ‚Ä¢"," ",m.calories?.toFixed(0)||0," kcal ‚Ä¢ P: ",m.protein?.toFixed(1)||0,"g ‚Ä¢ C: ",m.carbs?.toFixed(1)||0,"g ‚Ä¢ G: ",m.fat?.toFixed(1)||0,"g"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(m),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>$(m.tempId),children:e.jsx(Ke,{className:"h-4 w-4 text-destructive"})})]})]})},m.tempId))})})]})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(As,{protein:ie.protein,carbs:ie.carbs,fat:ie.fat,calories:ie.calories,patientId:s,planId:r?.id,referenceValues:A,onReferenceUpdate:f})})]}),v.length===0&&e.jsxs(ee,{children:[e.jsx(me,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(xe,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{P(null),S(!0)},disabled:x,children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhuma refei√ß√£o adicionada ainda",w.meals&&e.jsx("p",{className:"text-destructive mt-2",children:w.meals})]})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(_,{type:"button",variant:"outline",onClick:a,disabled:x,children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{type:"submit",disabled:x,children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),x?"Salvando...":r?"Atualizar Plano":"Criar Plano"]})]})]}),e.jsx(Sa,{isOpen:n,onClose:()=>{S(!1),P(null)},onSave:p?R:T,initialData:p})]})},Fa=({isOpen:s,onClose:c,planId:r,planName:u,onCopy:a})=>{const[x,d]=t.useState([]),[N,v]=t.useState([]),[k,n]=t.useState(""),[S,p]=t.useState(null),[P,w]=t.useState(!1),[M,A]=t.useState(!1);t.useEffect(()=>{s&&E()},[s]),t.useEffect(()=>{if(k){const o=x.filter(C=>C.name?.toLowerCase().includes(k.toLowerCase())||C.email?.toLowerCase().includes(k.toLowerCase()));v(o)}else v(x)},[k,x]);const E=async()=>{w(!0);try{const{data:{user:o}}=await ne.auth.getUser();if(!o)return;const{data:C,error:F}=await ne.from("user_profiles").select("id, name, email").eq("user_type","patient").eq("nutritionist_id",o.id).order("name",{ascending:!0});if(F)throw F;d(C||[]),v(C||[])}catch(o){console.error("Erro ao carregar pacientes:",o)}finally{w(!1)}},D=async()=>{if(S){A(!0);try{await a(S.id),f()}catch(o){console.error("Erro ao copiar modelo:",o)}finally{A(!1)}}},f=()=>{n(""),p(null),c()};return e.jsx(ge,{open:s,onOpenChange:f,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Copiar Modelo de Dieta"}),e.jsxs(ye,{children:["Selecione o paciente para aplicar o plano: ",e.jsx("strong",{children:u})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"search",children:"Buscar Paciente"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{id:"search",placeholder:"Digite o nome ou email do paciente...",value:k,onChange:o=>n(o.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsxs(qe,{className:"h-[400px] border rounded-md p-4",children:[P&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando pacientes..."}),!P&&N.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:k?"Nenhum paciente encontrado":"Voc√™ n√£o tem pacientes cadastrados"}),!P&&N.length>0&&e.jsx("div",{className:"space-y-2",children:N.map(o=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${S?.id===o.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>p(o),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:o.name}),S?.id===o.id&&e.jsx(Ge,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.email})]})})},o.id))})]})]}),e.jsxs(Pe,{children:[e.jsxs(_,{variant:"outline",onClick:f,disabled:M,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:D,disabled:!S||M,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),M?"Copiando...":"Copiar Modelo"]})]})]})})};function Ma(s,c){if(!s||!c||c.length===0)return null;const r=s.toLowerCase();for(const u of c)if(u&&r.includes(u.toLowerCase()))return u;return null}function Pa({open:s,onOpenChange:c,patientId:r,nutritionistId:u,onTemplateApplied:a}){const{toast:x}=ps(),[d,N]=t.useState([]),[v,k]=t.useState([]),[n,S]=t.useState(null),[p,P]=t.useState(null),[w,M]=t.useState(""),[A,E]=t.useState(null),[D,f]=t.useState(!1),[o,C]=t.useState(!1),[F,H]=t.useState(null),[Y,T]=t.useState(!1),[g,R]=t.useState(1),[$,U]=t.useState(!1),[he,te]=t.useState([]),[ie,m]=t.useState(null),[h,y]=t.useState(new Set);t.useEffect(()=>{s&&u&&L(),s&&r&&X()},[s,u,r]),t.useEffect(()=>{let i=d;w&&(i=i.filter(b=>b.name.toLowerCase().includes(w.toLowerCase())||b.description&&b.description.toLowerCase().includes(w.toLowerCase()))),A&&(i=i.filter(b=>b.template_tags?(Array.isArray(b.template_tags)?b.template_tags:[b.template_tags]).some(z=>z.toLowerCase()===A.toLowerCase()):!1)),k(i)},[d,w,A]);const I=(i,b=null)=>!i||!i.meals?{calories:0,protein:0,carbs:0,fat:0}:(b&&b.size>0?i.meals.filter(z=>b.has(z.id)):i.meals).reduce((z,Q)=>({calories:z.calories+(parseFloat(Q.total_calories)||0),protein:z.protein+(parseFloat(Q.total_protein)||0),carbs:z.carbs+(parseFloat(Q.total_carbs)||0),fat:z.fat+(parseFloat(Q.total_fat)||0)}),{calories:0,protein:0,carbs:0,fat:0});t.useEffect(()=>{n&&G(n.id)},[n]),t.useEffect(()=>{if(p&&F&&Y&&h.size>0){const i=I(p,h).calories;if(i>0){const b=F/i;R(b)}}else R(1)},[p,F,Y,h]);const L=async()=>{f(!0);try{const{data:i,error:b}=await Bs(u);if(b)throw b;N(i||[]),k(i||[])}catch(i){console.error("Erro ao carregar templates:",i),x({title:"Erro",description:"N√£o foi poss√≠vel carregar os templates.",variant:"destructive"})}finally{f(!1)}},G=async i=>{try{const{data:b,error:V}=await Re(i);if(V)throw V;if(P(b),T(!1),b?.meals){const z=new Set(b.meals.map(Q=>Q.id));y(z)}else y(new Set)}catch(b){console.error("Erro ao carregar detalhes do template:",b),P(null),y(new Set)}},X=async()=>{if(r)try{const{data:i}=await ne.from("patient_goals").select("daily_calorie_goal").eq("patient_id",r).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(i?.daily_calorie_goal){H(parseFloat(i.daily_calorie_goal));return}const b=ra(),{data:V}=await ne.from("prescriptions").select("calories").eq("patient_id",r).lte("start_date",b).or(`end_date.is.null,end_date.gte.${b}`).order("start_date",{ascending:!1}).limit(1).maybeSingle();if(V?.calories){H(parseFloat(V.calories));return}const{data:z}=await ne.from("energy_expenditure_calculations").select("get_with_activities, get").eq("patient_id",r).order("created_at",{ascending:!1}).limit(1).maybeSingle(),Q=z?.get_with_activities??z?.get??null;if(Q){H(parseFloat(Q));return}H(null)}catch(i){console.error("Erro ao buscar meta cal√≥rica do paciente:",i),H(null)}},ae=async()=>{if(!p||!r)return[];try{const{data:i,error:b}=await ta(r,!0);if(b||!i||!i.content)return[];const V=i.content,Q=(V.historico_clinico?.alergias||[]).filter(W=>W&&W.alimento).map(W=>W.alimento.trim()).filter(W=>W.length>0),Se=(V.habitos_alimentares?.alimentos_nao_gosta||"").split(/[,;]/).map(W=>W.trim()).filter(W=>W.length>0),De=[...Q,...Se];if(De.length===0)return[];const Ce=[];if(p.meals){for(const W of p.meals)if(h.has(W.id)&&W.foods)for(const Fe of W.foods){const l=Fe.food?.name||Fe.foods?.name||Fe.name||"";l&&Ce.push(l)}}const ke=[];for(const W of Ce)Ma(W,De)&&(ke.includes(W)||ke.push(W));return ke}catch(i){return console.error("Erro ao verificar conflitos de alimentos:",i),[]}},re=async(i=!1)=>{if(!(!n||!r)){if(h.size===0){x({title:"Nenhuma Refei√ß√£o Selecionada",description:"Selecione pelo menos uma refei√ß√£o para importar.",variant:"destructive"});return}if(!i){const b=await ae();if(b.length>0){te(b),U(!0),m({templateId:n.id,patientId:r,scaleFactor:Y?g:1,selectedMealIds:Array.from(h)});return}}C(!0);try{const b=ie||{templateId:n.id,patientId:r,scaleFactor:Y?g:1,selectedMealIds:Array.from(h)},{data:V,error:z}=await Gs(b.templateId,b.patientId,null,b.scaleFactor,b.selectedMealIds);if(z)throw z;const Q=b.scaleFactor!==1?` (quantidades ajustadas para ${Math.round(F)} kcal)`:"",_e=b.selectedMealIds?.length||h.size,Se=_e<(p?.meals?.length||0)?` (${_e} de ${p?.meals?.length||0} refei√ß√µes importadas)`:"";x({title:"Template Aplicado",description:`O template "${n.name}" foi aplicado ao paciente com sucesso.${Q}${Se}`}),a&&a(V),m(null),te([]),U(!1),c(!1)}catch(b){console.error("Erro ao aplicar template:",b),x({title:"Erro",description:"N√£o foi poss√≠vel aplicar o template.",variant:"destructive"})}finally{C(!1)}}},oe=()=>{U(!1),re(!0)},q=Array.from(new Set(d.filter(i=>i.template_tags).flatMap(i=>Array.isArray(i.template_tags)?i.template_tags:[i.template_tags]))),O=p?I(p,h):null,ce=O&&F&&O.calories>0,pe=ce?Math.abs((O.calories-F)/O.calories)*100:0,fe=ce&&pe>10;return e.jsxs(ge,{open:s,onOpenChange:c,children:[e.jsxs(je,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(ve,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),"Meus Modelos de Dieta"]}),e.jsx(ye,{children:"Selecione um template para aplicar ao paciente"})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 flex flex-col border-r pr-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"Buscar templates...",value:w,onChange:i=>M(i.target.value),className:"pl-8"})]})}),q.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Filtrar por Tag:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{variant:A===null?"default":"outline",size:"sm",onClick:()=>E(null),children:"Todos"}),q.map(i=>e.jsx(_,{variant:A===i?"default":"outline",size:"sm",onClick:()=>E(i),children:i},i))]})]}),e.jsx(qe,{className:"flex-1",children:D?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Be,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):v.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Le,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum template encontrado"})]}):e.jsx("div",{className:"space-y-2",children:v.map(i=>e.jsx(ee,{className:`cursor-pointer transition-colors ${n?.id===i.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>S(i),children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:i.name}),i.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:i.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(He,{className:"w-3 h-3"}),e.jsx("span",{children:i.daily_calories?`${Math.round(i.daily_calories)} kcal`:"N/A"})]}),i.template_tags&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(Array.isArray(i.template_tags)?i.template_tags:[i.template_tags]).map((b,V)=>e.jsxs(ue,{variant:"secondary",className:"text-xs",children:[e.jsx(us,{className:"w-2 h-2 mr-1"}),b]},V))})]})})},i.id))})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:n?e.jsxs(e.Fragment,{children:[p?e.jsx(qe,{className:"flex-1",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(ee,{children:[e.jsxs(me,{children:[e.jsx(xe,{children:p.name}),p.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:p.description})]}),e.jsxs(se,{children:[O&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(O.calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prote√≠nas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(O.protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(O.carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(O.fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsxs("span",{children:[p.meals?.length||0," refei√ß√µes"]})]}),p.template_tags&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(us,{className:"w-4 h-4 text-muted-foreground"}),(Array.isArray(p.template_tags)?p.template_tags:[p.template_tags]).map((i,b)=>e.jsx(ue,{variant:"secondary",children:i},b))]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Selecione as Refei√ß√µes para Importar:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>{if(p?.meals){const i=new Set(p.meals.map(b=>b.id));y(i)}},className:"text-xs h-7",children:"Selecionar Todas"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>y(new Set),className:"text-xs h-7",children:"Desmarcar Todas"})]})]}),e.jsx("div",{className:"space-y-2",children:p.meals?.map((i,b)=>{const V=h.has(i.id);return e.jsx(ee,{className:`cursor-pointer transition-colors ${V?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>{const z=new Set(h);V?z.delete(i.id):z.add(i.id),y(z)},children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ue,{checked:V,onCheckedChange:z=>{const Q=new Set(h);z?Q.add(i.id):Q.delete(i.id),y(Q)},onClick:z=>z.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.meal_type})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[Math.round(i.total_calories||0)," kcal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",Math.round(i.total_protein||0),"g | C: ",Math.round(i.total_carbs||0),"g | G: ",Math.round(i.total_fat||0),"g"]})]})]}),i.foods&&i.foods.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.foods.length," alimento(s)"]})})]})]})})},i.id||b)})}),p.meals&&p.meals.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[h.size," de ",p.meals.length," refei√ß√µes selecionadas"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Be,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),fe&&e.jsxs(Te,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(la,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ee,{children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ue,{id:"auto-scale",checked:Y,onCheckedChange:i=>T(i===!0)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(J,{htmlFor:"auto-scale",className:"text-sm font-medium cursor-pointer",children:["Ajustar quantidades automaticamente para atingir ",Math.round(F)," kcal?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["O template tem ",Math.round(O.calories)," kcal.",Y&&e.jsxs("span",{className:"block mt-1",children:["As por√ß√µes ser√£o ajustadas por um fator de ",g.toFixed(2),"x (aproximadamente ",Math.round(O.calories*g)," kcal ap√≥s ajuste)."]})]})]})]})})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsx(_,{onClick:re,disabled:o||!r,className:"w-full sm:w-auto",children:o?e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2 animate-spin"}),"Aplicando..."]}):e.jsx(e.Fragment,{children:"Aplicar este Modelo"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Le,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecione um template para visualizar os detalhes"})]})})})]})]}),e.jsx(fs,{open:$,onOpenChange:U,children:e.jsxs(gs,{children:[e.jsxs(js,{children:[e.jsx(vs,{className:"flex items-center gap-2",children:"‚ö†Ô∏è Alerta de Restri√ß√£o Alimentar"}),e.jsxs(Ns,{className:"space-y-3",children:[e.jsx("p",{children:"Este modelo cont√©m alimentos que o paciente marcou como alergia ou avers√£o:"}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:he.map((i,b)=>e.jsx("li",{className:"font-semibold text-destructive",children:i},b))})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Deseja continuar mesmo assim? Esta a√ß√£o pode causar rea√ß√µes adversas no paciente."})]})]}),e.jsxs(ys,{children:[e.jsx(bs,{onClick:()=>{U(!1),te([]),m(null)},children:"Cancelar Importa√ß√£o"}),e.jsx(ws,{onClick:oe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Ignorar e Aplicar"})]})]})})]})}const Aa=async(s,c="Paciente")=>{if(!s||!s.meals||s.meals.length===0)throw new Error("Plano alimentar inv√°lido ou sem refei√ß√µes");const r=Ta(s.meals),u=Ea(r),a=new na("p","mm","a4"),x=a.internal.pageSize.width,d=a.internal.pageSize.height,N=[70,125,70],v=[68,64,60],k=[120,113,108];let n=20;a.setFont("helvetica");try{const E=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(D=>{const f=new Image;f.onload=()=>{const o=x*.15,C=f.height/f.width*o,F=new FileReader;F.onloadend=()=>{const H=F.result;a.addImage(H,"PNG",14,10,o,C),D()},F.readAsDataURL(E)},f.src=URL.createObjectURL(E)})}catch(M){console.error("Erro ao carregar logo:",M)}a.setFontSize(20),a.setTextColor(...N),a.setFont("helvetica","bold"),a.text("Lista de Compras",x/2,n,{align:"center"}),n+=8,a.setFontSize(12),a.setTextColor(...v),a.setFont("helvetica","normal"),a.text(`Paciente: ${c}`,14,n),n+=6;const S=new Date().toLocaleDateString("pt-BR");a.setFontSize(10),a.setTextColor(...k),a.text(`Gerado em: ${S}`,14,n),n+=10,a.setDrawColor(...N),a.setLineWidth(.5),a.line(14,n,x-14,n),n+=8;const p=Object.keys(u).sort();for(let M=0;M<p.length;M++){const A=p[M],E=u[A];n>d-60&&(a.addPage(),n=20),a.setFontSize(14),a.setTextColor(...N),a.setFont("helvetica","bold"),a.text(A,14,n),n+=6;const D=E.map(f=>["",f.name,f.totalQuantity]);ia(a,{startY:n,head:[["","Item","Quantidade Total"]],body:D,theme:"grid",headStyles:{fillColor:N,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{textColor:v,fontSize:10},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:"auto",halign:"left"},2:{cellWidth:50,halign:"right"}},margin:{left:14,right:14},styles:{lineColor:[200,200,200],lineWidth:.1},didParseCell:function(f){if(f.column.index===0&&f.row.index>=0){const o=f.cell.x+2,C=f.cell.y+2,F=4;a.setDrawColor(150,150,150),a.setLineWidth(.3),a.rect(o,C,F,F)}}}),n=a.lastAutoTable.finalY+8,M<p.length-1&&(n+=5)}const P=d-15;a.setFontSize(8),a.setTextColor(...k),a.setFont("helvetica","italic"),a.text("Gerado por HipoZero",x/2,P,{align:"center"});const w=`lista_compras_${c.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;a.save(w)};function Ta(s){const c=new Map;for(const r of s)if(!(!r.foods||r.foods.length===0))for(const u of r.foods){const a=u.foods?.name||u.food?.name||u.name||"Alimento n√£o identificado",x=parseFloat(u.quantity)||0,d=u.unit||"g",N=u.foods?.group||u.food?.group||"Outros",v=`${a.toLowerCase()}_${d}`;if(c.has(v)){const k=c.get(v);k.totalQuantity=hs(k.totalQuantityValue+x,d),k.totalQuantityValue+=x}else c.set(v,{name:a,unit:d,category:N,totalQuantity:hs(x,d),totalQuantityValue:x})}return Array.from(c.values())}function Ea(s){const c={},r={"Cereais e derivados":"Cereais e Derivados","Verduras, hortali√ßas e derivados":"Verduras e Hortali√ßas","Frutas e sucos":"Frutas","Carnes e derivados":"Carnes","Leite e derivados":"Latic√≠nios","√ìleos e gorduras":"√ìleos e Gorduras","Pescados e frutos do mar":"Peixes e Frutos do Mar",Leguminosas:"Leguminosas","Nozes e sementes":"Nozes e Sementes",Bebidas:"Bebidas",Outros:"Outros"};for(const u of s){const a=r[u.category]||u.category||"Outros";c[a]||(c[a]=[]),c[a].push(u)}for(const u in c)c[u].sort((a,x)=>a.name.localeCompare(x.name,"pt-BR"));return c}function hs(s,c){const r=Math.round(s*100)/100;return r%1===0?`${r} ${c}`:`${r.toFixed(2)} ${c}`}const za=async s=>ne.from("energy_expenditure_calculations").select("*").eq("patient_id",s).order("created_at",{ascending:!1}).limit(1).maybeSingle(),Ia=async s=>{try{const{data:c,error:r}=await za(s);if(r)throw r;return{data:c,error:null}}catch(c){return Je("Erro ao buscar c√°lculo de energia",c),{data:null,error:c}}};function Da({targetCalories:s,currentCalories:c=0,patientId:r,energyCalculation:u=null}){const a=Ye();if(!s||s<=0)return e.jsx(ee,{className:"border-yellow-500/50 bg-yellow-50/50 dark:bg-yellow-950/20",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Gasto Energ√©tico n√£o definido"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Defina o gasto energ√©tico para monitorar a meta do plano"})]})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>a(`/nutritionist/patients/${r}/energy-expenditure`),className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Definir Gasto Energ√©tico"]})]})})});const x=c-s,d=Math.abs(x),N=s>0?Math.min(100,c/s*100):0;let v="text-green-600",k="bg-green-100 dark:bg-green-900/30",n="border-green-500/50",S=is,p="Alinhado";d<=50?(v="text-green-600",k="bg-green-100 dark:bg-green-900/30",n="border-green-500/50",S=is,p="Alinhado"):d<=200?(v="text-yellow-600",k="bg-yellow-100 dark:bg-yellow-900/30",n="border-yellow-500/50",S=Oe,p="Pr√≥ximo"):(v="text-red-600",k="bg-red-100 dark:bg-red-900/30",n="border-red-500/50",S=Oe,p="Desalinhado");const P=S,M=u?{protocol:{"harris-benedict":"Harris-Benedict (1984)","mifflin-st-jeor":"Mifflin-St Jeor","fao-who":"FAO/WHO",cunningham:"Cunningham (Atletas)",tinsley:"Tinsley (Bodybuilding)"}[u.protocol]||u.protocol,tmb:u.tmb,activityLevel:u.activity_level,get:u.get,goalCalories:u.get_with_activities||u.get}:null;return e.jsx(ee,{className:Ae("sticky top-4 z-10",n,k),children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Prescrito:"}),e.jsxs("span",{className:"text-sm font-bold text-foreground",children:[Math.round(c)," kcal"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Meta Calculada (GET):"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-sm font-bold text-primary",children:[Math.round(s)," kcal"]}),M&&e.jsxs(ma,{children:[e.jsx(xa,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ha,{className:"w-3.5 h-3.5"})})}),e.jsx(ua,{className:"w-80 p-0",side:"bottom",align:"end",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"font-semibold text-sm",children:"C√°lculo de Energia"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Protocolo:"}),e.jsx("span",{className:"font-medium",children:M.protocol})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TMB:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(M.tmb)," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"N√≠vel de Atividade:"}),e.jsxs("span",{className:"font-medium",children:["x",M.activityLevel]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"GET Base:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(M.get)," kcal"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Meta Final:"}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(M.goalCalories)," kcal"]})]})})]})]})})]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(da,{value:N,className:Ae("h-2",d<=50?"bg-green-500":d<=200?"bg-yellow-500":"bg-red-500")}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso em rela√ß√£o √† meta"}),e.jsxs("span",{className:Ae("font-semibold",v),children:[N.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ue,{variant:"outline",className:Ae("gap-1.5",v,n),children:[e.jsx(P,{className:"w-3 h-3"}),p]}),e.jsxs("span",{className:Ae("text-sm font-semibold",x>0?"text-red-600":x<0?"text-blue-600":"text-green-600"),children:[x>0?"+":"",Math.round(x)," kcal"]})]})]})})})}const Bt=()=>{const{patientId:s}=Es(),c=Ye(),{toast:r}=ps(),{user:u}=zs(),[a,x]=t.useState(!0),[d,N]=t.useState(!1),[v,k]=t.useState([]),[n,S]=t.useState(null),[p,P]=t.useState(""),[w,M]=t.useState(null),[A,E]=t.useState(!1),[D,f]=t.useState(null),[o,C]=t.useState(null),[F,H]=t.useState(!1),[Y,T]=t.useState(null),[g,R]=t.useState(!1),[$,U]=t.useState(null),[he,te]=t.useState(!1),[ie,m]=t.useState(!1),[h,y]=t.useState(!1),[I,L]=t.useState(""),[G,X]=t.useState(""),[ae,re]=t.useState(null),[oe,q]=t.useState(null);t.useEffect(()=>{(async()=>{const{data:{user:j}}=await ne.auth.getUser();j&&C(j.id)})()},[]),t.useEffect(()=>{(async()=>{if(s)try{const{data:j,error:B}=await ne.from("user_profiles").select("name").eq("id",s).single();!B&&j&&P(j.name)}catch(j){console.error("Erro ao carregar nome do paciente:",j)}})()},[s]);const O=t.useCallback(async()=>{if(s){x(!0);try{const[l,j]=await Promise.all([Us(s),Vs(s)]);if(l.error)throw l.error;k(l.data||[]),S(j.data)}catch(l){console.error("Erro ao carregar planos:",l),r({title:"Erro",description:"N√£o foi poss√≠vel carregar os planos alimentares",variant:"destructive"})}finally{x(!1)}}},[s,r]);t.useEffect(()=>{O()},[O]),t.useEffect(()=>{(async()=>{if(n?.id){const{data:j}=await Ps(n.id);M(j)}else M(null)})()},[n?.id]),t.useEffect(()=>{(async()=>{if(s)try{const{data:j,error:B}=await Ia(s);if(B)throw B;re(j)}catch(j){console.error("Erro ao carregar c√°lculo de energia:",j)}})()},[s]),t.useEffect(()=>{(async()=>{if(!s)return;const{data:j}=await pa(s);q(j||null)})()},[s]);const ce=l=>{if(!l)return null;const j=new Date(l);if(Number.isNaN(j.getTime()))return null;const B=Date.now()-j.getTime();if(B<0)return`atualizado em ${j.toLocaleString("pt-BR")}`;const K=Math.floor(B/6e4);if(K<1)return"atualizado agora";if(K<60)return`atualizado h√° ${K} min`;const le=Math.floor(K/60);if(le<24)return`atualizado h√° ${le}h`;const Z=Math.floor(le/24);return Z<=7?`atualizado h√° ${Z} dia${Z>1?"s":""}`:`atualizado em ${j.toLocaleDateString("pt-BR")} √†s ${j.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`},pe=async()=>{const{error:l}=await cs(s,{mealPlan:!0});if(l){r({title:"N√£o foi poss√≠vel marcar como revisado",description:"Tente novamente em instantes.",variant:"destructive"});return}q(j=>({...j||{},needs_meal_plan_review:!1})),r({title:"Pend√™ncia removida",description:"O m√≥dulo de plano alimentar foi marcado como revisado.",variant:"success"})},fe=async(l,j=null)=>{N(!0);try{if(j){const K=await Ws(j,l);if(K.error)throw K.error}else{const K=await Hs({patient_id:l.patient_id,nutritionist_id:l.nutritionist_id,name:l.name,description:l.description,active_days:l.active_days,start_date:l.start_date,end_date:l.end_date||null});if(K.error)throw K.error;for(const le of l.meals){const Z=await Qs({meal_plan_id:K.data.id,name:le.name,meal_type:le.meal_type,meal_time:le.meal_time,notes:le.notes,order_index:le.order_index});if(Z.error)throw Z.error;for(const de of le.foods||[]){const es=await Ks({meal_plan_meal_id:Z.data.id,food_id:de.food_id,quantity:de.quantity,unit:de.unit,calories:de.calories,protein:de.protein,carbs:de.carbs,fat:de.fat,notes:de.notes,order_index:de.order_index||0});if(es?.error)throw es.error}}}r({title:"Sucesso",description:j?"Plano atualizado com sucesso":"Plano criado com sucesso",variant:"success"});const{error:B}=await cs(s,{mealPlan:!0});B?console.warn("N√£o foi poss√≠vel limpar flag de revis√£o do plano automaticamente:",B):q(K=>({...K||{},needs_meal_plan_review:!1})),E(!1),f(null),await O()}catch(B){console.error("Erro ao salvar plano:",B),r({title:"Erro",description:"N√£o foi poss√≠vel salvar o plano alimentar",variant:"destructive"})}finally{N(!1)}},i=async l=>{try{const j=await Re(l);if(j.error)throw j.error;f(j.data),E(!0)}catch(j){console.error("Erro ao carregar plano para edi√ß√£o:",j),r({title:"Erro",description:"N√£o foi poss√≠vel carregar o plano para edi√ß√£o",variant:"destructive"})}},b=async l=>{try{const j=await Ys(l);if(j.error)throw j.error;r({title:"Sucesso",description:"Plano arquivado com sucesso",variant:"success"}),await O()}catch(j){console.error("Erro ao arquivar plano:",j),r({title:"Erro",description:"N√£o foi poss√≠vel arquivar o plano",variant:"destructive"})}},V=async l=>{try{const j=await Xs(l);if(j.error)throw j.error;r({title:"Sucesso",description:"Plano ativado com sucesso",variant:"success"}),await O()}catch(j){console.error("Erro ao ativar plano:",j),r({title:"Erro",description:"N√£o foi poss√≠vel ativar o plano",variant:"destructive"})}},z=l=>{const j=v.find(B=>B.id===l)||n;j&&(U(j),R(!0))},Q=async l=>{try{const j=await Js($.id,l);if(j.error)throw j.error;r({title:"Sucesso",description:"Plano copiado para o paciente com sucesso",variant:"success"}),R(!1),U(null)}catch(j){console.error("Erro ao copiar modelo:",j),r({title:"Erro",description:"N√£o foi poss√≠vel copiar o modelo para o paciente",variant:"destructive"})}},_e=async()=>{if(!n){r({title:"Erro",description:"Nenhum plano ativo encontrado.",variant:"destructive"});return}try{const l=await Re(n.id);if(l.error)throw l.error;const j=l.data;await Aa(j,p),r({title:"Lista de Compras gerada!",description:"O PDF foi baixado com sucesso."})}catch(l){console.error("Erro ao gerar lista de compras:",l),r({title:"Erro",description:"N√£o foi poss√≠vel gerar a lista de compras. Tente novamente.",variant:"destructive"})}},Se=async l=>{if(n)try{te(!1);const j=await Re(n.id);if(j.error)throw j.error;const B=j.data;await oa(B,p,u?.profile?.name,l,ca,Fs),r({title:"PDF gerado!",description:"Plano alimentar exportado com sucesso.",variant:"success"})}catch(j){console.error("Erro ao exportar PDF:",j),r({title:"Erro",description:"N√£o foi poss√≠vel exportar o plano alimentar",variant:"destructive"})}},De=async()=>{if(Y)try{const l=await Zs(Y);if(l.error)throw l.error;r({title:"Sucesso",description:"Plano deletado com sucesso",variant:"success"}),T(null),H(!1),await O()}catch(l){console.error("Erro ao deletar plano:",l),r({title:"Erro",description:"N√£o foi poss√≠vel deletar o plano",variant:"destructive"})}},Ce=l=>l?new Date(l).toLocaleDateString("pt-BR"):null,ke=l=>{if(!l||l.length===0)return"Nenhum dia";if(l.length===7)return"Todos os dias";const j=["monday","tuesday","wednesday","thursday","friday"],B=["saturday","sunday"],K=j.every(Z=>l.includes(Z))&&!B.some(Z=>l.includes(Z)),le=B.every(Z=>l.includes(Z))&&!j.some(Z=>l.includes(Z));return K?"Dias √∫teis":le?"Fins de semana":`${l.length} dias`},W=async()=>{if(!(!n||!I.trim())){N(!0);try{const l=G?G.split(",").map(K=>K.trim()).filter(K=>K.length>0):[],{data:j,error:B}=await ea(n.id,I.trim(),l);if(B)throw B;r({title:"Template Salvo",description:`O plano foi salvo como template "${I}" com sucesso.`,variant:"success"}),y(!1),L(""),X("")}catch(l){console.error("Erro ao salvar template:",l),r({title:"Erro",description:"N√£o foi poss√≠vel salvar o template.",variant:"destructive"})}finally{N(!1)}}},Fe=async l=>{await O(),l&&S(l)};return a?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Carregando..."})}):A?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(_,{variant:"ghost",onClick:()=>{E(!1),f(null)},children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"Voltar"]})}),e.jsx(ka,{patientId:s,nutritionistId:o,initialData:D,onSubmit:fe,onCancel:()=>{E(!1),f(null)},loading:d})]}):e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>c(`/nutritionist/patients/${s}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:O,className:"flex-shrink-0",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(He,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"truncate",children:"Planos Alimentares"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gerencie os planos alimentares do paciente"})]}),e.jsxs(_,{size:"sm",onClick:()=>E(!0),className:"w-full sm:w-auto",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Novo Plano"]})]})]}),oe?.needs_meal_plan_review&&e.jsxs(Te,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(Oe,{className:"h-4 w-4 text-amber-700"}),e.jsx(Ee,{className:"text-amber-800",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{children:"A antropometria foi atualizada recentemente. Revise o plano alimentar e salve para sincronizar."}),oe?.anthropometry_updated_at&&e.jsx("p",{className:"mt-1 text-xs text-amber-700/90",children:ce(oe.anthropometry_updated_at)})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(_,{size:"sm",variant:"outline",className:"border-amber-300 bg-white text-amber-800 hover:bg-amber-100",onClick:()=>{n?.id?i(n.id):E(!0)},children:"Revisar agora"}),e.jsx(_,{size:"sm",variant:"ghost",className:"text-amber-900 hover:bg-amber-100",onClick:pe,children:"Marcar como revisado"})]})]})})]}),e.jsx(Da,{targetCalories:ae?.get_with_activities||ae?.get||null,currentCalories:n?.daily_calories||0,patientId:s,energyCalculation:ae}),n&&e.jsxs(ee,{className:"mb-6 border-primary shadow-sm",children:[e.jsx(me,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(xe,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx("span",{className:"break-words",children:n.name}),e.jsx(ue,{className:"bg-primary",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>i(n.id),className:"hidden sm:flex",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(_,{size:"sm",onClick:()=>c(`/nutritionist/patients/${s}/meal-plan/${n.id}/summary`),className:"hidden sm:flex",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Resumo Nutricional"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:_e,className:"hidden sm:flex",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Lista de Compras"]}),e.jsxs(Is,{children:[e.jsx(Ds,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:e.jsx(fa,{className:"h-4 w-4"})})}),e.jsxs(Rs,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsxs(Me,{onClick:()=>i(n.id),children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Editar Plano"]}),e.jsxs(Me,{onClick:()=>c(`/nutritionist/patients/${s}/meal-plan/${n.id}/summary`),children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Ver Resumo Nutricional"]}),e.jsx(ss,{})]}),e.jsxs(Me,{onClick:()=>te(!0),children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),e.jsxs(Me,{onClick:_e,children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Gerar Lista de Compras"]}),e.jsxs(Me,{onClick:()=>z(n.id),children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Copiar como Modelo"]}),e.jsx(ss,{}),e.jsxs(Me,{onClick:()=>b(n.id),className:"text-destructive focus:text-destructive",children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Arquivar Plano"]})]})]})]})]})})}),e.jsxs(se,{children:[n.description&&e.jsx("p",{className:"text-muted-foreground mb-4",children:n.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"In√≠cio"}),e.jsx("div",{className:"font-semibold",children:Ce(n.start_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"T√©rmino"}),e.jsx("div",{className:"font-semibold",children:n.end_date?Ce(n.end_date):"Indeterminado"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dias Ativos"}),e.jsx("div",{className:"font-semibold",children:ke(n.active_days)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Refei√ß√µes"}),e.jsx("div",{className:"font-semibold",children:n.meals?.length||0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:n.meals&&n.meals.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold mb-3",children:"Refei√ß√µes:"}),n.meals.map((l,j)=>e.jsx("div",{className:"p-3 border rounded-lg bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[j+1,". ",l.name,l.meal_time&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["√†s ",l.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.foods?.length||0," alimento(s) ‚Ä¢"," ",l.total_calories?.toFixed(0)||0," kcal"]})]})})},l.id))]}):e.jsx(Te,{children:e.jsx(Ee,{children:"Nenhuma refei√ß√£o adicionada ainda."})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(As,{protein:n.daily_protein||0,carbs:n.daily_carbs||0,fat:n.daily_fat||0,calories:n.daily_calories||0,patientId:s,planId:null,referenceValues:w,onReferenceUpdate:null,readOnly:!0})})]})]})]}),e.jsxs(ee,{children:[e.jsx(me,{children:e.jsx(xe,{children:"Todos os Planos"})}),e.jsx(se,{children:v.length===0?e.jsx(Te,{children:e.jsx(Ee,{children:'Nenhum plano alimentar criado ainda. Clique em "Novo Plano" para come√ßar.'})}):e.jsx("div",{className:"space-y-3",children:v.map(l=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:l.name}),l.is_active&&e.jsx(ue,{variant:"outline",children:"Ativo"}),!l.is_active&&e.jsx(ue,{variant:"secondary",children:"Arquivado"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[Ce(l.start_date),l.end_date&&` at√© ${Ce(l.end_date)}`," ","‚Ä¢ ",ke(l.active_days)," ","‚Ä¢ ",l.daily_calories?.toFixed(0)||0," kcal/dia"]})]}),e.jsxs("div",{className:"flex gap-2",children:[!l.is_active&&e.jsx(_,{variant:"default",size:"sm",onClick:()=>V(l.id),title:"Ativar este plano",children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>i(l.id),title:"Editar plano",children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>z(l.id),title:"Copiar modelo",children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>{T(l.id),H(!0)},title:"Deletar plano",children:e.jsx(Ke,{className:"h-4 w-4 text-destructive"})})]})]})},l.id))})})]}),e.jsx(fs,{open:F,onOpenChange:H,children:e.jsxs(gs,{children:[e.jsxs(js,{children:[e.jsx(vs,{children:"Confirmar Exclus√£o"}),e.jsx(Ns,{children:"Tem certeza que deseja deletar este plano alimentar? Esta a√ß√£o n√£o pode ser desfeita."})]}),e.jsxs(ys,{children:[e.jsx(bs,{onClick:()=>T(null),children:"Cancelar"}),e.jsx(ws,{onClick:De,className:"bg-destructive",children:"Deletar"})]})]})}),e.jsx(Fa,{isOpen:g,onClose:()=>{R(!1),U(null)},planId:$?.id,planName:$?.name,onCopy:Q}),e.jsx(ge,{open:h,onOpenChange:y,children:e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Salvar Plano como Modelo"}),e.jsx(ye,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(be,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:I,onChange:l=>L(l.target.value),disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por v√≠rgula)"}),e.jsx(be,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:G,onChange:l=>X(l.target.value),disabled:d}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(Pe,{children:[e.jsx(_,{variant:"outline",onClick:()=>{y(!1),L(""),X("")},disabled:d,children:"Cancelar"}),e.jsx(_,{onClick:W,disabled:d||!I.trim(),children:d?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(Pa,{open:ie,onOpenChange:m,patientId:s,nutritionistId:o,onTemplateApplied:Fe}),e.jsx(ge,{open:he,onOpenChange:te,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Exportar Plano Alimentar"}),e.jsx(ye,{children:"Escolha o formato de exporta√ß√£o para PDF"})]}),e.jsxs("div",{className:"grid gap-3 py-4",children:[e.jsx(ee,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>Se(!1),children:e.jsxs(se,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(Le,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Simples"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macronutrientes b√°sicos (calorias, prote√≠nas, carboidratos e gorduras)"})]})]})}),e.jsx(ee,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>Se(!0),children:e.jsxs(se,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-secondary/10 text-secondary",children:e.jsx(ms,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Completo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macros + micronutrientes (fibras, vitaminas, minerais)"})]})]})})]}),e.jsx(Pe,{className:"sm:justify-start",children:e.jsx(_,{variant:"ghost",onClick:()=>te(!1),className:"w-full sm:w-auto",children:"Cancelar"})})]})})]})};export{Bt as default};
