import{u as xe,a as ue,r as a,O as d,s as c,j as e,S as U,m as b,C as u,c as p,d as g,w as y,e as j,ai as pe,aM as ge,B as v,aj as je,ak as fe,al as ye,au as ve,an as w}from"./index-yDciBRsX.js";import{T as Ne,a as be,b as D,c as _}from"./tabs-B3rgPvAC.js";import{I as n}from"./input-C3FhjpPV.js";import{L as m}from"./label-BhMYCUX6.js";import{W as we}from"./WeightChart-8SS1yQG8.js";import{D as K}from"./droplet-BXsE1kkz.js";import{R as $}from"./ruler-Rnm-z8yn.js";import{C as B}from"./camera-HVj4VQ27.js";import{R as X,T as Y}from"./generateCategoricalChart-DbqSdPzj.js";import{a as V,L as J}from"./LineChart-Cqk1c1TN.js";import{C as Q}from"./CartesianGrid-BFHiJKJE.js";import{X as Z,Y as ee}from"./YAxis-cVSt119f.js";import{P as De}from"./plus-CrGgCcIt.js";import"./minus-DdD-Giqk.js";import"./trending-down-CBbNlvR8.js";function He(){const{user:l}=xe(),{toast:i}=ue(),[r,se]=a.useState("peso"),[C,te]=a.useState([]),[P,R]=a.useState([]),[N,ae]=a.useState([]),[E,k]=a.useState([]),[re,T]=a.useState(!0),[ie,f]=a.useState(!1),[oe,de]=a.useState(null),[F,q]=a.useState(""),[M,G]=a.useState(""),[S,L]=a.useState(""),[A,W]=a.useState(""),[o,h]=a.useState(d(new Date,"yyyy-MM-dd")),x=a.useCallback(async()=>{if(!l)return;T(!0);const{data:s}=await c.from("growth_records").select("*").eq("patient_id",l.id).order("record_date",{ascending:!0});te(s||[]),de(null);try{const{data:t}=await c.from("glycemia_records").select("*").eq("patient_id",l.id).order("record_date",{ascending:!0});R(t||[])}catch{R([])}try{const{data:t}=await c.from("progress_photos").select("*").eq("patient_id",l.id).order("photo_date",{ascending:!1});k(t||[])}catch{k([])}ae(s||[]),T(!1)},[l]);a.useEffect(()=>{x()},[x]);const le=async s=>{if(s.preventDefault(),!F||!o){i({title:"Erro",description:"Preencha todos os campos.",variant:"destructive"});return}const{error:t}=await c.from("growth_records").insert({patient_id:l.id,record_date:o,weight:parseFloat(F)});t?i({title:"Erro",description:"Não foi possível adicionar o registro.",variant:"destructive"}):(i({title:"Sucesso",description:"Registro de peso adicionado com sucesso!"}),f(!1),q(""),h(d(new Date,"yyyy-MM-dd")),x())},ce=async s=>{if(s.preventDefault(),!M||!o){i({title:"Erro",description:"Preencha todos os campos obrigatórios.",variant:"destructive"});return}const{error:t}=await c.from("growth_records").insert({patient_id:l.id,record_date:o,height:parseFloat(M),head_circumference:S?parseFloat(S):null});t?i({title:"Erro",description:"Não foi possível adicionar o registro.",variant:"destructive"}):(i({title:"Sucesso",description:"Registro de medidas adicionado com sucesso!"}),f(!1),G(""),L(""),h(d(new Date,"yyyy-MM-dd")),x())},ne=async s=>{if(s.preventDefault(),!A||!o){i({title:"Erro",description:"Preencha todos os campos.",variant:"destructive"});return}try{const{error:t}=await c.from("glycemia_records").insert({patient_id:l.id,record_date:o,glycemia_value:parseFloat(A)});if(t)throw t;i({title:"Sucesso",description:"Registro de glicemia adicionado com sucesso!"}),f(!1),W(""),h(d(new Date,"yyyy-MM-dd")),x()}catch{i({title:"Erro",description:"Não foi possível adicionar o registro. A tabela pode não estar disponível ainda.",variant:"destructive"})}},me=async s=>{if(!s||!o){i({title:"Erro",description:"Selecione uma foto e uma data.",variant:"destructive"});return}try{const t=s.name.split(".").pop(),z=`${l.id}/${Date.now()}.${t}`,{error:I}=await c.storage.from("progress-photos").upload(z,s);if(I)throw I;const{data:{publicUrl:he}}=c.storage.from("progress-photos").getPublicUrl(z),{error:O}=await c.from("progress_photos").insert({patient_id:l.id,photo_date:o,photo_url:he});if(O)throw O;i({title:"Sucesso",description:"Foto de progresso adicionada com sucesso!"}),f(!1),h(d(new Date,"yyyy-MM-dd")),x()}catch{i({title:"Erro",description:"Não foi possível adicionar a foto. A funcionalidade pode não estar disponível ainda.",variant:"destructive"})}},H=P.map(s=>({date:d(new Date(s.record_date),"dd/MM/yy"),value:parseFloat(s.glycemia_value)}));return e.jsxs("div",{className:"flex flex-col min-h-screen bg-background",children:[e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Meu Progresso"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Acompanhe sua evolução"})]}),e.jsxs(Ne,{value:r,onValueChange:se,className:"w-full",children:[e.jsxs(be,{className:"grid w-full grid-cols-4 mb-4",children:[e.jsxs(D,{value:"peso",className:"text-xs",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Peso"]}),e.jsxs(D,{value:"glicemia",className:"text-xs",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Glicemia"]}),e.jsxs(D,{value:"medidas",className:"text-xs",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Medidas"]}),e.jsxs(D,{value:"fotos",className:"text-xs",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Fotos"]})]}),e.jsx(_,{value:"peso",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:C.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(u,{className:"shadow-sm",children:[e.jsxs(p,{children:[e.jsx(g,{children:"Evolução de Peso"}),e.jsx(y,{children:"Acompanhe sua evolução ao longo do tempo"})]}),e.jsx(j,{children:e.jsx(we,{data:C,goalWeight:oe})})]}),e.jsxs(u,{className:"shadow-sm",children:[e.jsx(p,{children:e.jsx(g,{className:"text-lg",children:"Registros Recentes"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-2",children:C.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),s.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.notes})]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[parseFloat(s.weight).toFixed(1)," kg"]})]},t))})})]})]}):e.jsxs(u,{className:"shadow-sm",children:[e.jsxs(p,{children:[e.jsx(g,{children:"Evolução de Peso"}),e.jsx(y,{children:"Nenhum registro encontrado"})]}),e.jsx(j,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione seu primeiro registro de peso usando o botão +"})]})})]})})}),e.jsx(_,{value:"glicemia",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(u,{className:"shadow-sm",children:[e.jsxs(p,{children:[e.jsx(g,{children:"Evolução da Glicemia"}),e.jsx(y,{children:"Acompanhamento da glicemia ao longo do tempo"})]}),e.jsx(j,{children:H.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx(X,{width:"100%",height:300,children:e.jsxs(V,{data:H,children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"date",tick:{fontSize:12}}),e.jsx(ee,{tick:{fontSize:12}}),e.jsx(Y,{}),e.jsx(J,{type:"monotone",dataKey:"value",name:"Glicemia (mg/dL)",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:4}})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Registros Recentes"}),e.jsx("div",{className:"space-y-2",children:P.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:[parseFloat(s.glycemia_value).toFixed(0)," mg/dL"]})]},t))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum registro de glicemia encontrado"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar seu primeiro registro"})]})})]})})}),e.jsx(_,{value:"medidas",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(u,{className:"shadow-sm",children:[e.jsxs(p,{children:[e.jsx(g,{children:"Medidas Corporais"}),e.jsx(y,{children:"Histórico de medidas antropométricas"})]}),e.jsx(j,{children:N.length>0?e.jsxs("div",{className:"space-y-4",children:[N.filter(s=>s.height).length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Evolução da Altura"}),e.jsx(X,{width:"100%",height:250,children:e.jsxs(V,{data:N.filter(s=>s.height).map(s=>({date:d(new Date(s.record_date),"dd/MM/yy"),height:parseFloat(s.height)})),children:[e.jsx(Q,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"date",tick:{fontSize:12}}),e.jsx(ee,{tick:{fontSize:12}}),e.jsx(Y,{}),e.jsx(J,{type:"monotone",dataKey:"height",name:"Altura (cm)",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Histórico Completo"}),N.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).map((s,t)=>e.jsx("div",{className:"flex justify-between items-center p-4 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1",children:[s.weight&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Peso:"})," ",parseFloat(s.weight).toFixed(1)," kg"]}),s.height&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Altura:"})," ",parseFloat(s.height).toFixed(1)," cm"]}),s.head_circumference&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"PC:"})," ",parseFloat(s.head_circumference).toFixed(1)," cm"]}),s.weight&&s.height&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"IMC:"})," ",(parseFloat(s.weight)/Math.pow(parseFloat(s.height)/100,2)).toFixed(1)]})]})]})},t))]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma medida registrada"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar seu primeiro registro"})]})})]})})}),e.jsx(_,{value:"fotos",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(u,{className:"shadow-sm",children:[e.jsxs(p,{children:[e.jsx(g,{children:"Fotos de Progresso"}),e.jsx(y,{children:"Registros visuais da evolução"})]}),e.jsx(j,{children:E.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:E.map((s,t)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted border border-border hover:shadow-md transition-shadow group",children:[e.jsx("img",{src:s.photo_url,alt:`Progresso ${d(new Date(s.photo_date),"dd/MM/yyyy")}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-3",children:e.jsx("p",{className:"text-xs text-white font-medium",children:d(new Date(s.photo_date),"dd/MM/yyyy")})})]},t))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma foto de progresso"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar sua primeira foto"})]})})]})})})]})]}),e.jsxs(pe,{open:ie,onOpenChange:f,children:[e.jsx(ge,{asChild:!0,children:e.jsx(v,{size:"lg",className:"fixed bottom-20 right-4 h-14 w-14 rounded-full shadow-lg z-40 bg-primary hover:bg-primary/90 text-white md:bottom-24",children:e.jsx(De,{className:"h-6 w-6 text-white"})})}),e.jsxs(je,{children:[e.jsxs(fe,{children:[e.jsxs(ye,{children:[r==="peso"&&"Registrar Peso",r==="glicemia"&&"Registrar Glicemia",r==="medidas"&&"Registrar Medidas",r==="fotos"&&"Adicionar Foto de Progresso"]}),e.jsxs(ve,{children:[r==="peso"&&"Adicione um novo registro de peso",r==="glicemia"&&"Adicione um novo registro de glicemia",r==="medidas"&&"Adicione um novo registro de medidas corporais",r==="fotos"&&"Adicione uma nova foto de progresso"]})]}),r==="peso"&&e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"date",children:"Data"}),e.jsx(n,{id:"date",type:"date",value:o,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(n,{id:"weight",type:"number",step:"0.1",value:F,onChange:s=>q(s.target.value),placeholder:"Ex: 75.5",required:!0})]}),e.jsx(w,{children:e.jsx(v,{type:"submit",children:"Adicionar"})})]}),r==="glicemia"&&e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"date",children:"Data"}),e.jsx(n,{id:"date",type:"date",value:o,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"glycemia",children:"Glicemia (mg/dL)"}),e.jsx(n,{id:"glycemia",type:"number",step:"1",value:A,onChange:s=>W(s.target.value),placeholder:"Ex: 95",required:!0})]}),e.jsx(w,{children:e.jsx(v,{type:"submit",children:"Adicionar"})})]}),r==="medidas"&&e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"date",children:"Data"}),e.jsx(n,{id:"date",type:"date",value:o,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"height",children:"Altura (cm)"}),e.jsx(n,{id:"height",type:"number",step:"0.1",value:M,onChange:s=>G(s.target.value),placeholder:"Ex: 170",required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"headCircumference",children:"Perímetro Cefálico (cm) - Opcional"}),e.jsx(n,{id:"headCircumference",type:"number",step:"0.1",value:S,onChange:s=>L(s.target.value),placeholder:"Ex: 55"})]}),e.jsx(w,{children:e.jsx(v,{type:"submit",children:"Adicionar"})})]}),r==="fotos"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault();const t=document.getElementById("photoFile");t?.files?.[0]&&me(t.files[0])},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"date",children:"Data"}),e.jsx(n,{id:"date",type:"date",value:o,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"photoFile",children:"Foto"}),e.jsx(n,{id:"photoFile",type:"file",accept:"image/*",required:!0})]}),e.jsx(w,{children:e.jsx(v,{type:"submit",children:"Adicionar"})})]})]})]}),re&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]})}export{He as default};
