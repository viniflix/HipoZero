import{u as M,a as $,r as o,j as e,L,B as d,s as m,b as I,m as y,C,c as E,d as k,w as D,e as A,U as B,v as G,O as H,H as W,M as f,aq as V,bk as J,A as Q,f as K,F as X,h as Y,i as Z,k as ee,l as se,n as ae,o as te,p as re,bl as ie}from"./index-DGgtqe62.js";import{I as le}from"./input-C1Ic9mBe.js";import{L as oe}from"./label-ByZ_-J2k.js";import{A as ne,a as ce,b as de}from"./avatar-CWQakZKd.js";import{C as S}from"./camera-BFNHrEG1.js";import{M as me}from"./mail-BtERDdVL.js";import{P as xe,M as ue}from"./phone-CRMfP5xZ.js";import{R as pe}from"./ruler-CC1sg4dL.js";import{W as fe}from"./weight-B2-nSwx7.js";import{P as he}from"./pen-square-UGEIzMfA.js";import{C as je}from"./clipboard-list-DBXMmtvm.js";import{B as Ne}from"./book-open-CBEoZV3f.js";import{D as ge}from"./download-DMbtZ0RA.js";function ve({size:s="large",showChangeButton:h=!0}){const{user:i,updateUserProfile:r}=M(),{toast:u}=$(),[x,N]=o.useState(!1),[g,n]=o.useState(null),c=o.useRef(null),b={small:"w-12 h-12",medium:"w-20 h-20",large:"w-32 h-32"},j=()=>{c.current?.click()},v=async p=>{try{const a=p.target.files?.[0];if(!a)return;if(!a.type.startsWith("image/")){u({title:"Erro",description:"Por favor, selecione uma imagem válida.",variant:"destructive"});return}if(a.size>5*1024*1024){u({title:"Erro",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}N(!0);const t=URL.createObjectURL(a);n(t);const{data:l}=await m.storage.from("avatars").list(i.id);if(l&&l.length>0){const O=l.map(T=>`${i.id}/${T.name}`);await m.storage.from("avatars").remove(O)}const z=a.name.split(".").pop(),_=`${Date.now()}_${Math.random().toString(36).substring(7)}.${z}`,P=`${i.id}/${_}`,{error:U}=await m.storage.from("avatars").upload(P,a,{upsert:!0});if(U)throw n(null),URL.revokeObjectURL(t),U;const{data:{publicUrl:q}}=m.storage.from("avatars").getPublicUrl(P),{data:F,error:R}=await m.from("user_profiles").update({avatar_url:q}).eq("id",i.id).select().single();if(R)throw n(null),URL.revokeObjectURL(t),R;r&&r(F),URL.revokeObjectURL(t),n(null),u({title:"Sucesso!",description:"Foto de perfil atualizada com sucesso."})}catch(a){console.error("Erro ao fazer upload:",a),u({title:"Erro",description:a.message||"Não foi possível atualizar a foto de perfil.",variant:"destructive"})}finally{N(!1),c.current&&(c.current.value="")}},w=()=>{const p=i?.profile?.name||"U",a=p.split(" ");return a.length>=2?`${a[0][0]}${a[a.length-1][0]}`.toUpperCase():p[0].toUpperCase()};return e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ne,{className:b[s],children:[e.jsx(ce,{src:g||i?.profile?.avatar_url,alt:i?.profile?.name}),e.jsx(de,{className:"bg-primary/10 text-primary text-2xl font-semibold",children:x?e.jsx(L,{className:"w-8 h-8 animate-spin"}):w()})]}),h&&e.jsx("button",{onClick:j,disabled:x,className:"absolute bottom-0 right-0 p-2 bg-primary text-white rounded-full shadow-lg hover:bg-primary/90 transition-colors disabled:opacity-50",children:e.jsx(S,{className:"w-4 h-4"})})]}),h&&e.jsx(d,{variant:"outline",size:"sm",onClick:j,disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Alterar Foto"]})}),e.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:v,className:"hidden"})]})}function Me(){const{user:s,signOut:h}=M(),i=I(),{toast:r}=$(),[u,x]=o.useState([]),[N,g]=o.useState(!0),[n,c]=o.useState(""),[b,j]=o.useState(!1),v=o.useCallback(async()=>{if(!s)return;g(!0);const{data:t,error:l}=await m.from("user_achievements").select("*, achievements(name, description, icon_name)").eq("user_id",s.id);l?(console.error("Erro ao carregar conquistas:",l),x([])):x(t||[]),g(!1)},[s]);o.useEffect(()=>{v()},[v]);const w=async()=>{try{console.log("Exporting user data...",{userId:s?.id}),r({title:"Exportando dados...",description:"Preparando seu arquivo de dados pessoais."}),setTimeout(()=>{r({title:"Solicitação recebida!",description:"Seus dados foram solicitados. Você receberá um email em breve com o arquivo completo."})},1500)}catch(t){console.error("Erro ao exportar dados:",t),r({title:"Erro",description:"Não foi possível exportar seus dados.",variant:"destructive"})}},p=async()=>{if(n!==s?.email){r({title:"Email incorreto",description:"Por favor, digite seu email corretamente para confirmar a exclusão.",variant:"destructive"});return}try{r({title:"Excluindo conta...",description:"Processando sua solicitação. Esta ação é irreversível."});const{error:t}=await m.rpc("delete_user_account",{user_id:s.id});if(t){console.error("Erro ao excluir conta:",t);const{error:l}=await m.from("user_profiles").update({is_active:!1,deleted_at:new Date().toISOString()}).eq("id",s.id);if(l)throw l}await h(),r({title:"Conta excluída",description:"Sua conta e todos os dados foram permanentemente removidos."})}catch(t){console.error("Erro ao excluir conta:",t),r({title:"Erro",description:"Não foi possível excluir sua conta. Tente novamente ou entre em contato com o suporte.",variant:"destructive"})}finally{j(!1),c("")}},a=async()=>{try{await h(),r({title:"Logout realizado",description:"Até logo!"})}catch{r({title:"Erro",description:"Não foi possível fazer logout.",variant:"destructive"})}};return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsx("div",{className:"flex flex-col min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Perfil"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie sua conta e preferências"})]}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(C,{children:[e.jsxs(E,{className:"pb-3",children:[e.jsx(k,{className:"text-lg",children:"Meus Dados"}),e.jsx(D,{children:"Informações da sua conta"})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ve,{size:"large",showChangeButton:!0})}),e.jsx("hr",{className:"border-t"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Nome completo"}),e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s?.profile?.name||"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s?.email||"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(xe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Telefone"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s?.profile?.phone||"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Data de Nascimento"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s?.profile?.birth_date?H(new Date(s.profile.birth_date),"dd 'de' MMMM 'de' yyyy",{locale:W}):"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Altura"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s?.profile?.height?`${s.profile.height} cm`:"Não informado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Peso"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s?.profile?.weight?`${s.profile.weight} kg`:"Não informado"})]})]})]}),(s?.profile?.address?.zipcode||s?.profile?.address?.city)&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"border-t"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-foreground mb-3",children:"Endereço"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-primary"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:[s?.profile?.address?.street&&s?.profile?.address?.number?`${s.profile.address.street}, ${s.profile.address.number}`:s?.profile?.address?.street||"",s?.profile?.address?.complement||"",s?.profile?.address?.neighborhood||"",s?.profile?.address?.city&&s?.profile?.address?.state?`${s.profile.address.city} - ${s.profile.address.state}`:s?.profile?.address?.city||s?.profile?.address?.state||"",s?.profile?.address?.zipcode?`CEP: ${s.profile.address.zipcode}`:""].filter(Boolean).join(", ")||"Endereço não informado"})})]})]})]}),e.jsx("hr",{className:"border-t"}),e.jsxs(d,{variant:"outline",className:"w-full justify-between",onClick:()=>i("/patient/editar-perfil"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Editar Informações"]}),e.jsx(f,{className:"w-4 h-4"})]})]})]})}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(C,{children:[e.jsxs(E,{className:"pb-3",children:[e.jsx(k,{className:"text-lg",children:"Minha Jornada"}),e.jsx(D,{children:"Recursos e acompanhamento"})]}),e.jsxs(A,{className:"space-y-2",children:[e.jsxs(d,{variant:"ghost",className:"w-full justify-between h-auto py-3",onClick:()=>i("/patient/conquistas"),children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:"Minhas Conquistas"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.length," conquista(s) desbloqueada(s)"]})]})]}),e.jsx(f,{className:"w-4 h-4"})]}),e.jsx("hr",{className:"border-t"}),e.jsxs(d,{variant:"ghost",className:"w-full justify-between h-auto py-3",onClick:()=>{try{i("/patient/questionnaires")}catch{r({title:"Em breve",description:"Esta funcionalidade estará disponível em breve."})}},children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:"Meus Questionários"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Visualize e atualize suas respostas"})]})]}),e.jsx(f,{className:"w-4 h-4"})]}),e.jsx("hr",{className:"border-t"}),e.jsxs(d,{variant:"ghost",className:"w-full justify-between h-auto py-3",onClick:()=>{r({title:"Em breve",description:"Receitas do Nutri estará disponível em breve."})},children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:"Receitas do Nutri"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receitas personalizadas do seu nutricionista"})]})]}),e.jsx(f,{className:"w-4 h-4"})]})]})]})}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(C,{children:[e.jsxs(E,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-primary"}),e.jsx(k,{className:"text-lg",children:"Privacidade"})]}),e.jsx(D,{children:"Gerencie seus dados pessoais"})]}),e.jsxs(A,{className:"space-y-2",children:[e.jsxs(d,{variant:"ghost",className:"w-full justify-between h-auto py-3",onClick:w,children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:"Exportar Meus Dados"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Baixe uma cópia dos seus dados (LGPD)"})]})]}),e.jsx(f,{className:"w-4 h-4"})]}),e.jsx("hr",{className:"border-t"}),e.jsxs(Q,{open:b,onOpenChange:j,children:[e.jsx(K,{asChild:!0,children:e.jsxs(d,{variant:"ghost",className:"w-full justify-between h-auto py-3 text-destructive hover:text-destructive",children:[e.jsxs("span",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium",children:"Excluir Minha Conta"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Remover permanentemente seus dados"})]})]}),e.jsx(f,{className:"w-4 h-4"})]})}),e.jsxs(Y,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(ee,{className:"text-destructive",children:"Excluir Conta Permanentemente"}),e.jsxs(se,{className:"space-y-3",children:[e.jsxs("p",{children:["Esta ação é ",e.jsx("strong",{children:"irreversível"}),". Seus dados de saúde e histórico serão apagados permanentemente."]}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Para confirmar, digite seu email:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{htmlFor:"delete-email",className:"text-xs text-muted-foreground",children:"Email de confirmação"}),e.jsx(le,{id:"delete-email",type:"email",placeholder:s?.email||"seu@email.com",value:n,onChange:t=>c(t.target.value),className:"w-full"})]})]})]}),e.jsxs(ae,{children:[e.jsx(te,{onClick:()=>c(""),children:"Cancelar"}),e.jsx(re,{onClick:p,disabled:n!==s?.email,className:"bg-destructive hover:bg-destructive/90 disabled:opacity-50 disabled:cursor-not-allowed",children:"Excluir Conta"})]})]})]})]})]})}),e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(d,{variant:"outline",className:"w-full text-destructive hover:text-destructive border-destructive/30",onClick:a,children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Sair da Conta"]})})]})})}export{Me as default};
