import{q as Ie,r as t,j as e,V as de,W as me,Y as xe,Z as ue,aw as he,s as oe,B as _,a0 as qe,_ as be,X as Me,ak as Cs,C as ee,c as pe,d as fe,e as se,F as Ue,b as Ve,T as os,at as Qe,v as _s,a as is,I as Pe,L as De,E as Le,A as cs,h as ds,i as ms,k as xs,l as us,n as hs,o as ps,p as fs,ap as ke,au as Ss,u as ks,D as Fs,x as Ms,y as Ps,z as _e,aH as Ke}from"./index-Cl9S2_vK.js";import{I as te}from"./input-J8T_OYAP.js";import{B as ge}from"./badge-DPJEOXlY.js";import{A as Te,a as Ee}from"./alert-Cz0d9f0N.js";import{L as J}from"./label-B6xwKmAy.js";import{T as We}from"./textarea-Ck-wLz_m.js";import{C as Re}from"./checkbox-Bd5XEerF.js";import{S as gs,a as js,b as vs,c as Ns,d as $e}from"./select-DVIkm2mv.js";import{S as As,a as ze}from"./SmartFoodForm-n883FRrg.js";import{P as ye}from"./plus-2SV3Jemc.js";import{S as He}from"./search-DBl0ILHl.js";import{f as ys}from"./measureTranslations-AG6EuUvS.js";import{P as Fe}from"./pen-square-BteyrFgO.js";import{R as Ts}from"./ReferenceValuesModal-qxdxBVUk.js";import{F as Ye}from"./flame-88bmHynt.js";import{B as Be,R as Xe}from"./refresh-cw-449M6kAo.js";import{T as Ze}from"./trending-down-RN1wbuZQ.js";import{M as Es}from"./minus-YsdgalHT.js";import{getReferenceValues as bs,getTemplates as zs,getMealPlanById as Ae,applyTemplateToPatient as Is,getMealPlans as Ds,getActiveMealPlan as Os,updateFullMealPlan as qs,createMealPlan as Ls,addMealToPlan as Rs,addFoodToMeal as $s,archiveMealPlan as Bs,setActiveMealPlan as Gs,deleteMealPlan as Us,copyMealPlanToPatient as Vs,savePlanAsTemplate as Ws}from"./meal-plan-queries-CpEkmQ-d.js";import{S as Hs}from"./save-Dd24c85S.js";import{g as Qs}from"./anamnesis-queries-C1nreQvl.js";import{R as Ks}from"./ruler-CwIAZpVo.js";import{e as Ys}from"./pdfUtils-EBXEsIXu.js";import{E as Xs,a as Zs}from"./jspdf.plugin.autotable-DR81t-kr.js";import{t as Js}from"./mealTranslations-B1KHhmEq.js";import{P as ea}from"./progress-Hy44xw5P.js";import{P as sa,a as aa,b as ta}from"./popover-D5rOhnJc.js";import{A as Oe}from"./alert-circle--FqPo4fT.js";import{C as Je}from"./calculator-BdlGdxnE.js";import{I as ra}from"./info-D4I_a0zH.js";import{C as es}from"./check-circle-2-Cpln7o88.js";import{A as ss}from"./arrow-left-CUOJhKUw.js";import{M as la}from"./more-vertical-DRvk16uC.js";import{D as as}from"./download-Ea_rXT4W.js";import"./index-cNXYI7Zo.js";import"./extends-CF3RwP-h.js";import"./tabs-C2iurRVm.js";import"./foodService-BXRXQ4Oc.js";import"./chevron-left-B_3ySMk6.js";import"./slider-DvRPGwdZ.js";import"./html2canvas.esm-B0tyYwQk.js";const na=Ie("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Ge=Ie("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ts=Ie("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),rs=Ie("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function oa({open:a,onOpenChange:c,initialName:l="",onFoodCreated:h}){const s=t.useRef(null),x=N=>{h&&h(N),o()},o=()=>{c(!1)};return e.jsx(de,{open:a,onOpenChange:o,children:e.jsxs(me,{className:"max-w-4xl max-h-[95vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Cadastrar Alimento Personalizado"]}),e.jsx(he,{children:"Preencha o formul√°rio passo a passo para criar um alimento customizado. Voc√™ pode buscar produtos no OpenFoodFacts ou preencher manualmente."})]}),e.jsx(As,{ref:s,mode:"full",initialName:l,onSuccess:x})]})})}const ia=({isOpen:a,onClose:c,onSelect:l})=>{const[h,s]=t.useState(""),[x,o]=t.useState([]),[N,j]=t.useState(!1),[k,i]=t.useState(null),[S,p]=t.useState(null),[A,w]=t.useState(!1),M=[{value:null,label:"Todos"},{value:"TACO",label:"TACO"},{value:"IBGE",label:"IBGE"},{value:"USDA",label:"USDA"},{value:"Tucunduva",label:"Tucunduva"},{value:"TBCA",label:"TBCA"},{value:"custom",label:"Personalizados"}];t.useEffect(()=>{a&&T()},[a,h,S]);const T=async()=>{if(h.length<2){o([]);return}j(!0);try{let r=oe.from("foods").select("id, name, group, description, source, calories, protein, carbs, fat, fiber, sodium").eq("is_active",!0).ilike("name",`%${h}%`).order("name",{ascending:!0}).limit(50);S&&(r=r.eq("source",S));const{data:C,error:F}=await r;if(F)throw F;o(C||[])}catch(r){console.error("Erro ao buscar alimentos:",r),o([])}finally{j(!1)}},z=()=>{k&&(l(k),q())},q=()=>{s(""),o([]),i(null),p(null),c()},f=async r=>{w(!1),o([r,...x]),i(r),h&&await T()};return e.jsxs(de,{open:a,onOpenChange:q,children:[e.jsxs(me,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Buscar Alimento"}),e.jsx(he,{children:"Procure alimentos por nome nas bases de dados nutricionais"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"search",children:"Nome do Alimento"}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{id:"search",placeholder:"Digite pelo menos 2 caracteres...",value:h,onChange:r=>s(r.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:M.map(r=>e.jsx(ge,{variant:S===r.value?"default":"outline",className:"cursor-pointer",onClick:()=>p(r.value),children:r.label},r.value||"all"))}),e.jsxs(ze,{className:"h-[400px] border rounded-md p-4",children:[N&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Buscando..."}),!N&&h.length<2&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Digite pelo menos 2 caracteres para buscar"}),!N&&h.length>=2&&x.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhum alimento encontrado"}),e.jsxs(_,{variant:"outline",onClick:()=>w(!0),className:"mx-auto",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Cadastrar '",h,"' agora"]})]}),!N&&x.length>0&&e.jsx("div",{className:"space-y-2",children:x.map(r=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${k?.id===r.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>i(r),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:r.name}),k?.id===r.id&&e.jsx(qe,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(ge,{variant:"outline",className:"text-xs",children:r.source||"N/A"}),r.group&&e.jsx("span",{className:"text-xs text-muted-foreground",children:r.group})]}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:r.description})]}),e.jsxs("div",{className:"ml-4 text-right text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[r.calories," kcal"]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["P: ",r.protein,"g | C: ",r.carbs,"g | G: ",r.fat,"g"]})]})]})},r.id))})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:q,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:z,disabled:!k,children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Selecionar"]})]})]}),e.jsx(oa,{open:A,onOpenChange:w,initialName:h,onFoodCreated:f})]})},ca=async()=>{try{const{data:a,error:c}=await oe.from("household_measures").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(c)throw c;return{data:a||[],error:null}}catch(a){return console.error("Erro ao buscar medidas caseiras:",a),{data:null,error:a}}},da=async a=>{try{const{data:c,error:l}=await oe.from("food_household_measures").select(`
        id,
        food_id,
        measure_id,
        quantity,
        grams,
        created_at,
        updated_at,
        measure:household_measures(
          id,
          name,
          code,
          category,
          description,
          ml_equivalent,
          grams_equivalent,
          order_index
        )
      `).eq("food_id",a).order("measure(order_index)",{ascending:!0});if(l)throw l;return{data:c||[],error:null}}catch(c){return console.error("Erro ao buscar medidas do alimento:",c),{data:null,error:c}}},ma=a=>{const[c,l]=t.useState([]),[h,s]=t.useState(!1),[x,o]=t.useState(null),N=t.useCallback(async()=>{if(!a){l([]);return}s(!0),o(null);try{const j=await da(a);if(j.error)throw j.error;l(j.data||[])}catch(j){console.error("Erro ao carregar medidas:",j),o(j),l([])}finally{s(!1)}},[a]);return t.useEffect(()=>{N()},[N]),{data:c,isLoading:h,error:x,refetch:N}},xa=(a={})=>{const[c,l]=t.useState([]),[h,s]=t.useState(!0),[x,o]=t.useState(null),N=t.useCallback(async()=>{s(!0),o(null);try{const j=await ca();if(j.error)throw j.error;l(j.data||[])}catch(j){console.error("Erro ao carregar medidas caseiras:",j),o(j),l([])}finally{s(!1)}},[]);return t.useEffect(()=>{N()},[N]),{data:c,isLoading:h,error:x,refetch:N}};function ua({food:a,value:c={quantity:100,measureId:null},onChange:l,showNutrition:h=!0,className:s="",onNutritionChange:x=null}){const{data:o=[],isLoading:N}=xa(),{data:j=[],isLoading:k}=ma(a?.id),i=N||k,S=t.useMemo(()=>o.map(f=>({...f,hasSpecificConversion:j.some(r=>r.measure_id===f.id)})),[o,j]),p=t.useMemo(()=>{if(!c.measureId||c.measureId==="grams"||j.find(C=>C.measure_id===c.measureId))return!1;const r=o.find(C=>C.id===c.measureId);return r&&r.grams_equivalent?!1:!!r},[c.measureId,j,o]),A=t.useMemo(()=>{if(!a||!c.quantity)return 0;if(c.measureId===null||c.measureId==="grams")return c.quantity;const f=j.find(C=>C.measure_id===c.measureId);if(f)return f.grams*c.quantity/f.quantity;const r=o.find(C=>C.id===c.measureId);return r&&r.grams_equivalent?r.grams_equivalent*c.quantity:r?(console.warn(`Usando portion_size como fallback para medida "${r.name}"`),(a.portion_size||100)*c.quantity):(console.error(`Medida ${c.measureId} n√£o encontrada`),0)},[a,c,j,o]),w=t.useMemo(()=>{if(!a||A===0)return{grams:0,calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0};const f=A/100,r=(a.protein||0)*f,C=(a.carbs||0)*f,F=(a.fat||0)*f,W=r*4+C*4+F*9;return{grams:A,calories:parseFloat(W.toFixed(2)),protein:parseFloat(r.toFixed(2)),carbs:parseFloat(C.toFixed(2)),fat:parseFloat(F.toFixed(2)),fiber:a.fiber?parseFloat((a.fiber*f).toFixed(2)):0,sodium:a.sodium?parseFloat((a.sodium*f).toFixed(2)):0}},[a,A]);t.useEffect(()=>{x&&x(w)},[w,x]);const M=f=>{l({...c,quantity:parseFloat(f)||0})},T=f=>{l({...c,measureId:f==="grams"?null:parseInt(f)})},z=t.useMemo(()=>S.reduce((f,r)=>{const C=r.category||"other";return f[C]||(f[C]=[]),f[C].push(r),f},{}),[S]),q={volume:"Medidas de Volume",weight:"Medidas de Peso",unit:"Unidades",other:"Outras"};return e.jsxs("div",{className:`space-y-2 ${s}`,children:[e.jsx(J,{children:"Por√ß√£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{type:"number",value:c.quantity,onChange:f=>M(f.target.value),min:0,step:.5,className:"w-24",placeholder:"0",disabled:!a}),e.jsxs(gs,{value:c.measureId?.toString()??"grams",onValueChange:T,disabled:!a||i,children:[e.jsx(js,{className:"w-40",children:e.jsx(vs,{placeholder:i?"Carregando...":"Selecione"})}),e.jsxs(Ns,{className:"max-h-[300px]",children:[e.jsx($e,{value:"grams",children:"g"}),e.jsx("div",{className:"overflow-y-auto max-h-[280px]",children:Object.entries(z).map(([f,r])=>e.jsxs(Cs.Fragment,{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground sticky top-0 bg-popover",children:q[f]||f}),r.map(C=>e.jsxs($e,{value:C.id.toString(),className:"pl-6",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:C.name}),C.hasSpecificConversion&&e.jsx("span",{className:"ml-2 text-xs text-primary",children:"‚òÖ"})]}),C.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:C.description})]},C.id))]},f))})]})]}),h&&a&&A>0&&e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["‚âà ",w.grams.toFixed(0),"g | ",Math.round(w.calories)," kcal"]})]}),a&&!i&&j.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"‚òÖ = Convers√£o espec√≠fica para este alimento"}),p&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-950/30 p-2 rounded border border-amber-200 dark:border-amber-800",children:["‚ö†Ô∏è Estimativa aproximada (",a.portion_size||100,"g por unidade). Para maior precis√£o, cadastre a convers√£o espec√≠fica."]})]})}const ha=({isOpen:a,onClose:c,onAdd:l,mealName:h,initialData:s=null})=>{const[x,o]=t.useState(null),[N,j]=t.useState({quantity:100,measureId:null}),[k,i]=t.useState(""),[S,p]=t.useState(null),[A,w]=t.useState(!1),[M,T]=t.useState({});t.useEffect(()=>{s&&(o(s.food),j({quantity:s.quantity||100,measureId:s.unit==="gram"?null:s.unit}),i(s.notes||""),p({calories:s.calories||0,protein:s.protein||0,carbs:s.carbs||0,fat:s.fat||0}))},[s]);const z=F=>{o(F),w(!1),j({quantity:100,measureId:null}),p(null)},q=F=>{p(F)},f=()=>{const F={};return x||(F.food="Selecione um alimento"),(!N.quantity||N.quantity<=0)&&(F.portion="Quantidade deve ser maior que zero"),T(F),Object.keys(F).length===0},r=()=>{if(!f())return;const F={food_id:x.id,food:x,quantity:N.quantity,unit:N.measureId||"gram",calories:S?.calories||0,protein:S?.protein||0,carbs:S?.carbs||0,fat:S?.fat||0,notes:k.trim()||null};l(F),C()},C=()=>{o(null),j({quantity:100,measureId:null}),i(""),p(null),T({}),c()};return e.jsxs(e.Fragment,{children:[e.jsx(de,{open:a,onOpenChange:C,children:e.jsxs(me,{className:"max-w-2xl",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:s?"Editar Alimento":"Adicionar Alimento"}),e.jsx(he,{children:s?`Editar alimento: ${s.food?.name||""}`:h?`Adicionar alimento √† refei√ß√£o: ${h}`:"Adicionar novo alimento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{children:["Alimento ",e.jsx("span",{className:"text-destructive",children:"*"})]}),x?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:x.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[x.group," ‚Ä¢ ",x.source]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Base 100g: ",x.calories," kcal | P: ",x.protein,"g | C: ",x.carbs,"g | G: ",x.fat,"g"]})]}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>w(!0),children:"Trocar"})]}):e.jsxs(_,{variant:"outline",className:"w-full",onClick:()=>w(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Buscar Alimento"]}),M.food&&e.jsx("p",{className:"text-xs text-destructive",children:M.food})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ua,{food:x,value:N,onChange:j,showNutrition:!1,onNutritionChange:q}),M.portion&&e.jsx("p",{className:"text-xs text-destructive",children:M.portion})]}),S&&e.jsx(Te,{className:"bg-primary/5",children:e.jsxs(Ee,{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Valores Nutricionais:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:Math.round(S.calories)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:S.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:S.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:S.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx(We,{id:"notes",rows:2,placeholder:"Ex: sem sal, sem a√ß√∫car, etc.",value:k,onChange:F=>i(F.target.value)})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:C,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:r,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),s?"Atualizar":"Adicionar"]})]})]})}),e.jsx(ia,{isOpen:A,onClose:()=>w(!1),onSelect:z})]})},pa=({isOpen:a,onClose:c,onSave:l,initialData:h=null})=>{const[s,x]=t.useState({name:"",meal_type:"",meal_time:"",notes:""}),[o,N]=t.useState([]),[j,k]=t.useState(!1),[i,S]=t.useState(null),[p,A]=t.useState({}),w=[{value:"breakfast",label:"Caf√© da Manh√£"},{value:"morning_snack",label:"Lanche da Manh√£"},{value:"lunch",label:"Almo√ßo"},{value:"afternoon_snack",label:"Lanche da Tarde"},{value:"dinner",label:"Jantar"},{value:"supper",label:"Ceia"},{value:"pre_workout",label:"Pr√©-Treino"},{value:"post_workout",label:"P√≥s-Treino"},{value:"other",label:"Outro"}];t.useEffect(()=>{h&&(x({name:h.name||"",meal_type:h.meal_type||"",meal_time:h.meal_time||"",notes:h.notes||""}),N(h.foods||[]))},[h]);const M=(g,L)=>{x(R=>{const U={...R,[g]:L};return g==="meal_type"&&L!=="other"&&(U.name=""),U}),p[g]&&A(R=>({...R,[g]:null}))},T=g=>{N(L=>[...L,{...g,tempId:Date.now()}])},z=g=>{S(g),k(!0)},q=g=>{N(L=>L.map(R=>R.tempId===i.tempId?{...g,tempId:R.tempId}:R)),S(null)},f=g=>{N(L=>L.filter(R=>R.tempId!==g))},r=()=>{k(!1),S(null)},C=()=>o.reduce((g,L)=>({calories:g.calories+(L.calories||0),protein:g.protein+(L.protein||0),carbs:g.carbs+(L.carbs||0),fat:g.fat+(L.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),F=()=>{const g={};return s.meal_type||(g.meal_type="Tipo de refei√ß√£o √© obrigat√≥rio"),s.meal_type==="other"&&!s.name.trim()&&(g.name='Nome da refei√ß√£o √© obrigat√≥rio quando tipo √© "Outro"'),o.length===0&&(g.foods="Adicione pelo menos um alimento"),A(g),Object.keys(g).length===0},W=()=>{if(!F())return;const g=C(),R={name:s.meal_type==="other"?s.name:w.find(U=>U.value===s.meal_type)?.label||"",meal_type:s.meal_type,meal_time:s.meal_time,notes:s.notes,foods:o,...g};l(R),X()},X=()=>{x({name:"",meal_type:"",meal_time:"",notes:""}),N([]),A({}),c()},E=C();return e.jsxs(e.Fragment,{children:[e.jsx(de,{open:a,onOpenChange:X,children:e.jsxs(me,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:h?"Editar Refei√ß√£o":"Nova Refei√ß√£o"}),e.jsx(he,{children:"Configure a refei√ß√£o e adicione os alimentos"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsx(fe,{className:"text-lg",children:"Informa√ß√µes da Refei√ß√£o"})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"meal_type",children:["Tipo de Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(gs,{value:s.meal_type,onValueChange:g=>M("meal_type",g),children:[e.jsx(js,{id:"meal_type",className:p.meal_type?"border-destructive":"",children:e.jsx(vs,{placeholder:"Selecione o tipo"})}),e.jsx(Ns,{children:w.map(g=>e.jsx($e,{value:g.value,children:g.label},g.value))})]}),p.meal_type&&e.jsx("p",{className:"text-xs text-destructive",children:p.meal_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"meal_time",children:"Hor√°rio (opcional)"}),e.jsx(te,{id:"meal_time",type:"time",value:s.meal_time,onChange:g=>M("meal_time",g.target.value)})]})]}),s.meal_type==="other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"name",children:["Nome da Refei√ß√£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"name",placeholder:"Ex: Lanche Noturno, Suplementa√ß√£o",value:s.name,onChange:g=>M("name",g.target.value),className:p.name?"border-destructive":""}),p.name&&e.jsx("p",{className:"text-xs text-destructive",children:p.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"notes",children:"Observa√ß√µes (opcional)"}),e.jsx(We,{id:"notes",rows:2,placeholder:"Observa√ß√µes sobre a refei√ß√£o...",value:s.notes,onChange:g=>M("notes",g.target.value)})]})]})]}),e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-lg",children:"Alimentos"}),e.jsxs(_,{size:"sm",onClick:()=>k(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Alimento"]})]})}),e.jsx(se,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhum alimento adicionado ainda",p.foods&&e.jsx("p",{className:"text-destructive mt-2",children:p.foods})]}):e.jsxs("div",{className:"space-y-2",children:[o.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:g.food.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[ys(g.quantity,g.unit,g.measure)," ‚Ä¢"," ",g.calories," kcal ‚Ä¢ P: ",g.protein,"g ‚Ä¢ C: ",g.carbs,"g ‚Ä¢ G: ",g.fat,"g"]}),g.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:g.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>z(g),title:"Editar alimento",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>f(g.tempId),title:"Remover alimento",children:e.jsx(Ue,{className:"h-4 w-4 text-destructive"})})]})]},g.tempId)),e.jsxs("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Totais da Refei√ß√£o:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:E.calories.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Prote√≠nas"}),e.jsx("div",{className:"font-bold text-lg",children:E.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:E.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:E.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})]})})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:X,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:W,children:[h?"Atualizar":"Adicionar"," Refei√ß√£o"]})]})]})}),e.jsx(ha,{isOpen:j,onClose:r,onAdd:i?q:T,initialData:i,mealName:s.meal_type==="other"?s.name:w.find(g=>g.value===s.meal_type)?.label})]})},ws=({protein:a,carbs:c,fat:l,calories:h,patientId:s,planId:x,referenceValues:o,onReferenceUpdate:N,readOnly:j=!1})=>{const k=Ve(),[i,S]=t.useState(!1),p={protein:"#8B3BF2",carbs:"#3B6FF2",fat:"#F28B3B"},A=a*4,w=c*4,M=l*9,T=A+w+M,z=T>0?A/T*100:0,q=T>0?w/T*100:0,f=T>0?M/T*100:0,r=o?.weight_kg?parseFloat(o.weight_kg):null,C=r?a/r:null,F=r?c/r:null,W=r?l/r:null,E=(()=>{if(!o)return null;const u=parseFloat(o.weight_kg),y=parseFloat(o.total_energy_kcal);if(!u||!y)return null;let I,D,$;return o.macro_mode==="percentage"?(I=y*o.protein_percentage/4,D=y*o.carbs_percentage/4,$=y*o.fat_percentage/9):(I=u*o.protein_g_per_kg,D=u*o.carbs_g_per_kg,$=u*o.fat_g_per_kg),{calories:y,protein:I,carbs:D,fat:$,proteinPerKg:I/u,carbsPerKg:D/u,fatPerKg:$/u}})(),g=(u,y)=>{if(!y||y===0)return null;const I=u/y*100,D=u-y,$=I-100;let Q="adequate";return I<95||I>105?Q="inadequate":I<100?Q="below":I>100&&(Q="above"),{percentage:I,diff:D,diffPerc:$,status:Q}},L=E?g(h,E.calories):null,R=E?g(a,E.protein):null,U=E?g(c,E.carbs):null,je=E?g(l,E.fat):null,re=({adequacy:u,compact:y=!1})=>{if(!u)return null;const D=($=>{switch($){case"adequate":return{color:"bg-green-100 text-green-700 border-green-300",icon:e.jsx(Es,{className:"w-3 h-3"}),label:"OK"};case"below":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(Ze,{className:"w-3 h-3"}),label:u.diffPerc.toFixed(0)};case"above":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(Qe,{className:"w-3 h-3"}),label:`+${u.diffPerc.toFixed(0)}`};case"inadequate":return{color:u.percentage<95?"bg-red-100 text-red-700 border-red-300":"bg-orange-100 text-orange-700 border-orange-300",icon:u.percentage<95?e.jsx(Ze,{className:"w-3 h-3"}):e.jsx(Qe,{className:"w-3 h-3"}),label:u.percentage<95?u.diffPerc.toFixed(0):`+${u.diffPerc.toFixed(0)}`};default:return null}})(u.status);return D?y?e.jsxs("div",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-md border text-xs font-semibold ${D.color}`,children:[D.icon,e.jsxs("span",{children:[D.label,"%"]})]}):e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md border text-xs font-semibold ${D.color}`,children:[D.icon,e.jsxs("span",{children:[u.percentage.toFixed(0),"%"]})]}):null},ne=()=>{const $=(B,V)=>{const ie=Q(75,75,60,V),ve=Q(75,75,60,B),ce=V-B<=180?"0":"1";return["M",75,75,"L",ie.x,ie.y,"A",60,60,0,ce,0,ve.x,ve.y,"Z"].join(" ")},Q=(B,V,ie,ve)=>{const ce=(ve-90)*Math.PI/180;return{x:B+ie*Math.cos(ce),y:V+ie*Math.sin(ce)}};let ae=0;const le=z/100*360,Z=q/100*360;return e.jsxs("svg",{width:150,height:150,viewBox:"0 0 150 150",className:"mx-auto",children:[z>0&&e.jsx("path",{d:$(ae,ae+le),fill:p.protein,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),q>0&&e.jsx("path",{d:$(ae+le,ae+le+Z),fill:p.carbs,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),f>0&&e.jsx("path",{d:$(ae+le+Z,360),fill:p.fat,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),e.jsx("circle",{cx:75,cy:75,r:38,fill:"#fefae0"}),e.jsx("text",{x:75,y:72,textAnchor:"middle",className:"text-xl font-bold",fill:"#000",children:h.toFixed(0)}),e.jsx("text",{x:75,y:87,textAnchor:"middle",className:"text-[10px]",fill:"#666",children:"kcal"})]})},m=({label:u,color:y,current:I,target:D,currentPerKg:$,targetPerKg:Q,percentage:ae,adequacy:le,unit:Z="g",isEnergy:B=!1})=>e.jsxs("div",{className:"p-2 rounded-lg border transition-colors",style:y?{backgroundColor:`${y}0D`,borderColor:`${y}33`}:{backgroundColor:"rgb(250 250 249 / 0.3)",borderColor:"rgb(228 228 231)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[y&&!B&&e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:y}}),B&&e.jsx(Ye,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${y&&!B?"":"text-muted-foreground"}`,style:y&&!B?{color:y}:void 0,children:u})]}),le&&e.jsx(re,{adequacy:le,compact:!0})]}),e.jsxs("div",{className:"flex items-baseline justify-between gap-2 flex-wrap min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-1 flex-wrap min-w-0",children:[e.jsx("span",{className:`text-lg font-bold ${y&&!B?"":"text-foreground"}`,style:y&&!B?{color:y}:void 0,children:I.toFixed(B?0:1)}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:Z}),$&&!B&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["(",$.toFixed(1)," g/kg)"]}),ae!==void 0&&!B&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["‚Ä¢ ",ae.toFixed(0),"%"]})]}),D&&e.jsxs("div",{className:"flex items-baseline gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"text-muted-foreground font-medium whitespace-nowrap",children:"Meta:"}),e.jsxs("span",{className:"font-bold text-foreground whitespace-nowrap",children:[D.toFixed(B?0:1),Z]}),Q&&!B&&e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["(",Q.toFixed(1)," g/kg)"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{className:"h-full bg-gradient-to-br from-[#fefae0]/30 to-[#f9ebc7]/30 border-[#a9b388]",children:[e.jsx(pe,{className:"pb-2",children:e.jsxs(fe,{className:"text-base flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-[#c4661f]"}),"Distribui√ß√£o de Macronutrientes"]})}),e.jsxs(se,{className:"space-y-2",children:[e.jsx(ne,{}),e.jsxs("div",{className:"space-y-1",children:[E&&e.jsx(m,{label:"Energia",current:h,target:E.calories,adequacy:L,unit:"kcal",isEnergy:!0}),e.jsx(m,{label:"Prote√≠nas",color:p.protein,current:a,target:E?.protein,currentPerKg:C,targetPerKg:E?.proteinPerKg,percentage:z,adequacy:R}),e.jsx(m,{label:"Carboidratos",color:p.carbs,current:c,target:E?.carbs,currentPerKg:F,targetPerKg:E?.carbsPerKg,percentage:q,adequacy:U}),e.jsx(m,{label:"Gorduras",color:p.fat,current:l,target:E?.fat,currentPerKg:W,targetPerKg:E?.fatPerKg,percentage:f,adequacy:je})]}),E&&e.jsx("div",{className:"flex items-center justify-center pt-1 border-t",children:[L,R,U,je].every(u=>u?.status==="adequate")?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-green-700 bg-green-50 px-3 py-1.5 rounded-full border border-green-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Plano adequado"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-yellow-700 bg-yellow-50 px-3 py-1.5 rounded-full border border-yellow-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Ajustes sugeridos"})]})}),!j&&e.jsxs("div",{className:"pt-1.5 border-t space-y-1",children:[e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>S(!0),className:"w-full gap-2",children:[e.jsx(os,{className:"w-4 h-4"}),E?"Editar Valores de Refer√™ncia":"Configurar Valores de Refer√™ncia"]}),x&&e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>k(`/nutritionist/patients/${s}/meal-plan/${x}/summary`),className:"w-full gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Ver Resumo Nutricional Completo"]}),!E&&e.jsx("div",{className:"text-[10px] text-muted-foreground bg-[#fefae0] p-2 rounded-lg border border-[#a9b388]/30 text-center",children:"üí° Configure os valores de refer√™ncia para ver an√°lise de adequa√ß√£o e g/kg"})]})]})]}),x&&e.jsx(Ts,{isOpen:i,onClose:()=>{S(!1),N&&N()},planId:x})]})},fa=({patientId:a,nutritionistId:c,initialData:l=null,onSubmit:h,onCancel:s,loading:x=!1})=>{const[o,N]=t.useState({name:"",description:"",start_date:new Date().toISOString().split("T")[0],end_date:"",active_days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]}),[j,k]=t.useState([]),[i,S]=t.useState(!1),[p,A]=t.useState(null),[w,M]=t.useState({}),[T,z]=t.useState(null),q=[{value:"monday",label:"Segunda"},{value:"tuesday",label:"Ter√ßa"},{value:"wednesday",label:"Quarta"},{value:"thursday",label:"Quinta"},{value:"friday",label:"Sexta"},{value:"saturday",label:"S√°bado"},{value:"sunday",label:"Domingo"}],f=t.useCallback(async()=>{if(l?.id){const{data:m}=await bs(l.id);z(m)}},[l?.id]);t.useEffect(()=>{if(l){N({name:l.name||"",description:l.description||"",start_date:l.start_date||new Date().toISOString().split("T")[0],end_date:l.end_date||"",active_days:l.active_days||[]});const m=(l.meals||[]).map((u,y)=>({...u,tempId:u.tempId||Date.now()+y,foods:(u.foods||[]).map((I,D)=>({...I,tempId:I.tempId||Date.now()+y+D+1e3}))}));k(m),f()}},[l,f]);const r=(m,u)=>{N(y=>({...y,[m]:u})),w[m]&&M(y=>({...y,[m]:null}))},C=m=>{N(u=>({...u,active_days:u.active_days.includes(m)?u.active_days.filter(y=>y!==m):[...u.active_days,m]}))},F=()=>{N(m=>({...m,active_days:m.active_days.length===7?[]:q.map(u=>u.value)}))},W=()=>{const m=["monday","tuesday","wednesday","thursday","friday"];N(u=>({...u,active_days:m}))},X=()=>{const m=["saturday","sunday"];N(u=>({...u,active_days:m}))},E=m=>{k(u=>[...u,{...m,tempId:Date.now(),order_index:u.length}])},g=m=>{A(m),S(!0)},L=m=>{k(u=>u.map(y=>y.tempId===p.tempId?{...m,tempId:y.tempId}:y)),A(null)},R=m=>{k(u=>u.filter(y=>y.tempId!==m))},U=()=>j.reduce((m,u)=>({calories:m.calories+(u.calories||0),protein:m.protein+(u.protein||0),carbs:m.carbs+(u.carbs||0),fat:m.fat+(u.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),je=()=>{const m={};return o.name.trim()||(m.name="Nome do plano √© obrigat√≥rio"),o.active_days.length===0&&(m.active_days="Selecione pelo menos um dia da semana"),o.start_date||(m.start_date="Data de in√≠cio √© obrigat√≥ria"),o.end_date&&o.end_date<o.start_date&&(m.end_date="Data final deve ser posterior √† data inicial"),j.length===0&&(m.meals="Adicione pelo menos uma refei√ß√£o"),M(m),Object.keys(m).length===0},re=m=>{if(m.preventDefault(),!je())return;const u=U(),y={patient_id:a,nutritionist_id:c,...o,...u,meals:j};h(y,l?.id)},ne=U();return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsx(fe,{className:"text-lg",children:"Informa√ß√µes do Plano"})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"name",children:["Nome do Plano ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"name",placeholder:"Ex: Dieta Hipertrofia",value:o.name,onChange:m=>r("name",m.target.value),className:w.name?"border-destructive":"",disabled:x}),w.name&&e.jsx("p",{className:"text-xs text-destructive",children:w.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"description",children:"Descri√ß√£o (opcional)"}),e.jsx(We,{id:"description",rows:3,placeholder:"Descreva os objetivos e caracter√≠sticas do plano alimentar...",value:o.description,onChange:m=>r("description",m.target.value),disabled:x})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"start_date",children:["Data de In√≠cio ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"start_date",type:"date",value:o.start_date,onChange:m=>r("start_date",m.target.value),className:w.start_date?"border-destructive":"",disabled:x}),w.start_date&&e.jsx("p",{className:"text-xs text-destructive",children:w.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"end_date",children:"Data de T√©rmino (opcional)"}),e.jsx(te,{id:"end_date",type:"date",value:o.end_date,onChange:m=>r("end_date",m.target.value),className:w.end_date?"border-destructive":"",disabled:x}),w.end_date&&e.jsx("p",{className:"text-xs text-destructive",children:w.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs(J,{children:["Dias Ativos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:W,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Dias √∫teis"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:X,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Fins de semana"}),e.jsx(_,{type:"button",variant:"outline",size:"sm",onClick:F,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:o.active_days.length===7?"Limpar":"Todos"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:q.map(m=>e.jsxs("label",{className:`
                                            flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-1 sm:px-3 py-2 border rounded-lg cursor-pointer transition-colors text-xs sm:text-sm
                                            ${o.active_days.includes(m.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"}
                                        `,children:[e.jsx(Re,{checked:o.active_days.includes(m.value),onCheckedChange:()=>C(m.value),disabled:x,className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-[10px] sm:text-sm leading-tight text-center",children:m.label})]},m.value))}),w.active_days&&e.jsx("p",{className:"text-xs text-destructive",children:w.active_days})]})]})]}),j.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{A(null),S(!0)},disabled:x,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(se,{children:e.jsx("div",{className:"space-y-3",children:j.map((m,u)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",u+1]}),e.jsx("h4",{className:"font-semibold",children:m.name}),m.meal_time&&e.jsxs(ge,{variant:"outline",children:[e.jsx(_s,{className:"h-3 w-3 mr-1"}),m.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[m.foods?.length||0," alimento(s) ‚Ä¢"," ",m.calories?.toFixed(0)||0," kcal ‚Ä¢ P: ",m.protein?.toFixed(1)||0,"g ‚Ä¢ C: ",m.carbs?.toFixed(1)||0,"g ‚Ä¢ G: ",m.fat?.toFixed(1)||0,"g"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(m),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(m.tempId),children:e.jsx(Ue,{className:"h-4 w-4 text-destructive"})})]})]})},m.tempId))})})]})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(ws,{protein:ne.protein,carbs:ne.carbs,fat:ne.fat,calories:ne.calories,patientId:a,planId:l?.id,referenceValues:T,onReferenceUpdate:f})})]}),j.length===0&&e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-lg",children:"Refei√ß√µes"}),e.jsxs(_,{type:"button",size:"sm",onClick:()=>{A(null),S(!0)},disabled:x,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Adicionar Refei√ß√£o"]})]})}),e.jsx(se,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhuma refei√ß√£o adicionada ainda",w.meals&&e.jsx("p",{className:"text-destructive mt-2",children:w.meals})]})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(_,{type:"button",variant:"outline",onClick:s,disabled:x,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{type:"submit",disabled:x,children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),x?"Salvando...":l?"Atualizar Plano":"Criar Plano"]})]})]}),e.jsx(pa,{isOpen:i,onClose:()=>{S(!1),A(null)},onSave:p?L:E,initialData:p})]})},ga=({isOpen:a,onClose:c,planId:l,planName:h,onCopy:s})=>{const[x,o]=t.useState([]),[N,j]=t.useState([]),[k,i]=t.useState(""),[S,p]=t.useState(null),[A,w]=t.useState(!1),[M,T]=t.useState(!1);t.useEffect(()=>{a&&z()},[a]),t.useEffect(()=>{if(k){const r=x.filter(C=>C.name?.toLowerCase().includes(k.toLowerCase())||C.email?.toLowerCase().includes(k.toLowerCase()));j(r)}else j(x)},[k,x]);const z=async()=>{w(!0);try{const{data:{user:r}}=await oe.auth.getUser();if(!r)return;const{data:C,error:F}=await oe.from("user_profiles").select("id, name, email").eq("user_type","patient").eq("nutritionist_id",r.id).order("name",{ascending:!0});if(F)throw F;o(C||[]),j(C||[])}catch(r){console.error("Erro ao carregar pacientes:",r)}finally{w(!1)}},q=async()=>{if(S){T(!0);try{await s(S.id),f()}catch(r){console.error("Erro ao copiar modelo:",r)}finally{T(!1)}}},f=()=>{i(""),p(null),c()};return e.jsx(de,{open:a,onOpenChange:f,children:e.jsxs(me,{className:"max-w-2xl",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Copiar Modelo de Dieta"}),e.jsxs(he,{children:["Selecione o paciente para aplicar o plano: ",e.jsx("strong",{children:h})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"search",children:"Buscar Paciente"}),e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(te,{id:"search",placeholder:"Digite o nome ou email do paciente...",value:k,onChange:r=>i(r.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsxs(ze,{className:"h-[400px] border rounded-md p-4",children:[A&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando pacientes..."}),!A&&N.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:k?"Nenhum paciente encontrado":"Voc√™ n√£o tem pacientes cadastrados"}),!A&&N.length>0&&e.jsx("div",{className:"space-y-2",children:N.map(r=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${S?.id===r.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>p(r),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:r.name}),S?.id===r.id&&e.jsx(qe,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]})})},r.id))})]})]}),e.jsxs(be,{children:[e.jsxs(_,{variant:"outline",onClick:f,disabled:M,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(_,{onClick:q,disabled:!S||M,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),M?"Copiando...":"Copiar Modelo"]})]})]})})};function ja(a,c){if(!a||!c||c.length===0)return null;const l=a.toLowerCase();for(const h of c)if(h&&l.includes(h.toLowerCase()))return h;return null}function ls({open:a,onOpenChange:c,patientId:l,nutritionistId:h,onTemplateApplied:s}){const{toast:x}=is(),[o,N]=t.useState([]),[j,k]=t.useState([]),[i,S]=t.useState(null),[p,A]=t.useState(null),[w,M]=t.useState(""),[T,z]=t.useState(null),[q,f]=t.useState(!1),[r,C]=t.useState(!1),[F,W]=t.useState(null),[X,E]=t.useState(!1),[g,L]=t.useState(1),[R,U]=t.useState(!1),[je,re]=t.useState([]),[ne,m]=t.useState(null),[u,y]=t.useState(new Set);t.useEffect(()=>{a&&h&&D(),a&&l&&Q()},[a,h,l]),t.useEffect(()=>{let d=o;w&&(d=d.filter(b=>b.name.toLowerCase().includes(w.toLowerCase())||b.description&&b.description.toLowerCase().includes(w.toLowerCase()))),T&&(d=d.filter(b=>b.template_tags?(Array.isArray(b.template_tags)?b.template_tags:[b.template_tags]).some(O=>O.toLowerCase()===T.toLowerCase()):!1)),k(d)},[o,w,T]);const I=(d,b=null)=>!d||!d.meals?{calories:0,protein:0,carbs:0,fat:0}:(b&&b.size>0?d.meals.filter(O=>b.has(O.id)):d.meals).reduce((O,H)=>({calories:O.calories+(parseFloat(H.total_calories)||0),protein:O.protein+(parseFloat(H.total_protein)||0),carbs:O.carbs+(parseFloat(H.total_carbs)||0),fat:O.fat+(parseFloat(H.total_fat)||0)}),{calories:0,protein:0,carbs:0,fat:0});t.useEffect(()=>{i&&$(i.id)},[i]),t.useEffect(()=>{if(p&&F&&X&&u.size>0){const d=I(p,u).calories;if(d>0){const b=F/d;L(b)}}else L(1)},[p,F,X,u]);const D=async()=>{f(!0);try{const{data:d,error:b}=await zs(h);if(b)throw b;N(d||[]),k(d||[])}catch(d){console.error("Erro ao carregar templates:",d),x({title:"Erro",description:"N√£o foi poss√≠vel carregar os templates.",variant:"destructive"})}finally{f(!1)}},$=async d=>{try{const{data:b,error:G}=await Ae(d);if(G)throw G;if(A(b),E(!1),b?.meals){const O=new Set(b.meals.map(H=>H.id));y(O)}else y(new Set)}catch(b){console.error("Erro ao carregar detalhes do template:",b),A(null),y(new Set)}},Q=async()=>{if(l)try{const{data:d}=await oe.from("patient_goals").select("daily_calorie_goal").eq("patient_id",l).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(d?.daily_calorie_goal){W(parseFloat(d.daily_calorie_goal));return}const b=new Date().toISOString().split("T")[0],{data:G}=await oe.from("prescriptions").select("calories").eq("patient_id",l).lte("start_date",b).or(`end_date.is.null,end_date.gte.${b}`).order("start_date",{ascending:!1}).limit(1).maybeSingle();if(G?.calories){W(parseFloat(G.calories));return}const{data:O}=await oe.from("energy_expenditure_calculations").select("total_daily_energy_expenditure").eq("patient_id",l).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(O?.total_daily_energy_expenditure){W(parseFloat(O.total_daily_energy_expenditure));return}W(null)}catch(d){console.error("Erro ao buscar meta cal√≥rica do paciente:",d),W(null)}},ae=async()=>{if(!p||!l)return[];try{const{data:d,error:b}=await Qs(l,!0);if(b||!d||!d.content)return[];const G=d.content,H=(G.historico_clinico?.alergias||[]).filter(P=>P&&P.alimento).map(P=>P.alimento.trim()).filter(P=>P.length>0),Ce=(G.habitos_alimentares?.alimentos_nao_gosta||"").split(/[,;]/).map(P=>P.trim()).filter(P=>P.length>0),Se=[...H,...Ce];if(Se.length===0)return[];const n=[];if(p.meals){for(const P of p.meals)if(u.has(P.id)&&P.foods)for(const K of P.foods){const Ne=K.food?.name||K.foods?.name||K.name||"";Ne&&n.push(Ne)}}const v=[];for(const P of n)ja(P,Se)&&(v.includes(P)||v.push(P));return v}catch(d){return console.error("Erro ao verificar conflitos de alimentos:",d),[]}},le=async(d=!1)=>{if(!(!i||!l)){if(u.size===0){x({title:"Nenhuma Refei√ß√£o Selecionada",description:"Selecione pelo menos uma refei√ß√£o para importar.",variant:"destructive"});return}if(!d){const b=await ae();if(b.length>0){re(b),U(!0),m({templateId:i.id,patientId:l,scaleFactor:X?g:1,selectedMealIds:Array.from(u)});return}}C(!0);try{const b=ne||{templateId:i.id,patientId:l,scaleFactor:X?g:1,selectedMealIds:Array.from(u)},{data:G,error:O}=await Is(b.templateId,b.patientId,null,b.scaleFactor,b.selectedMealIds);if(O)throw O;const H=b.scaleFactor!==1?` (quantidades ajustadas para ${Math.round(F)} kcal)`:"",we=b.selectedMealIds?.length||u.size,Ce=we<(p?.meals?.length||0)?` (${we} de ${p?.meals?.length||0} refei√ß√µes importadas)`:"";x({title:"Template Aplicado",description:`O template "${i.name}" foi aplicado ao paciente com sucesso.${H}${Ce}`}),s&&s(G),m(null),re([]),U(!1),c(!1)}catch(b){console.error("Erro ao aplicar template:",b),x({title:"Erro",description:"N√£o foi poss√≠vel aplicar o template.",variant:"destructive"})}finally{C(!1)}}},Z=()=>{U(!1),le(!0)},B=Array.from(new Set(o.filter(d=>d.template_tags).flatMap(d=>Array.isArray(d.template_tags)?d.template_tags:[d.template_tags]))),V=p?I(p,u):null,ie=V&&F&&V.calories>0,ve=ie?Math.abs((V.calories-F)/V.calories)*100:0,ce=ie&&ve>10;return e.jsxs(de,{open:a,onOpenChange:c,children:[e.jsxs(me,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(xe,{children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Meus Modelos de Dieta"]}),e.jsx(he,{children:"Selecione um template para aplicar ao paciente"})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 flex flex-col border-r pr-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(te,{placeholder:"Buscar templates...",value:w,onChange:d=>M(d.target.value),className:"pl-8"})]})}),B.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Filtrar por Tag:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(_,{variant:T===null?"default":"outline",size:"sm",onClick:()=>z(null),children:"Todos"}),B.map(d=>e.jsx(_,{variant:T===d?"default":"outline",size:"sm",onClick:()=>z(d),children:d},d))]})]}),e.jsx(ze,{className:"flex-1",children:q?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(De,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum template encontrado"})]}):e.jsx("div",{className:"space-y-2",children:j.map(d=>e.jsx(ee,{className:`cursor-pointer transition-colors ${i?.id===d.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>S(d),children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:d.name}),d.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:d.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Le,{className:"w-3 h-3"}),e.jsx("span",{children:d.daily_calories?`${Math.round(d.daily_calories)} kcal`:"N/A"})]}),d.template_tags&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(Array.isArray(d.template_tags)?d.template_tags:[d.template_tags]).map((b,G)=>e.jsxs(ge,{variant:"secondary",className:"text-xs",children:[e.jsx(rs,{className:"w-2 h-2 mr-1"}),b]},G))})]})})},d.id))})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i?e.jsxs(e.Fragment,{children:[p?e.jsx(ze,{className:"flex-1",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(ee,{children:[e.jsxs(pe,{children:[e.jsx(fe,{children:p.name}),p.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:p.description})]}),e.jsxs(se,{children:[V&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(V.calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prote√≠nas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(V.protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(V.carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(V.fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsxs("span",{children:[p.meals?.length||0," refei√ß√µes"]})]}),p.template_tags&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(rs,{className:"w-4 h-4 text-muted-foreground"}),(Array.isArray(p.template_tags)?p.template_tags:[p.template_tags]).map((d,b)=>e.jsx(ge,{variant:"secondary",children:d},b))]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Selecione as Refei√ß√µes para Importar:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>{if(p?.meals){const d=new Set(p.meals.map(b=>b.id));y(d)}},className:"text-xs h-7",children:"Selecionar Todas"}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>y(new Set),className:"text-xs h-7",children:"Desmarcar Todas"})]})]}),e.jsx("div",{className:"space-y-2",children:p.meals?.map((d,b)=>{const G=u.has(d.id);return e.jsx(ee,{className:`cursor-pointer transition-colors ${G?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>{const O=new Set(u);G?O.delete(d.id):O.add(d.id),y(O)},children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Re,{checked:G,onCheckedChange:O=>{const H=new Set(u);O?H.add(d.id):H.delete(d.id),y(H)},onClick:O=>O.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:d.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.meal_type})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[Math.round(d.total_calories||0)," kcal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",Math.round(d.total_protein||0),"g | C: ",Math.round(d.total_carbs||0),"g | G: ",Math.round(d.total_fat||0),"g"]})]})]}),d.foods&&d.foods.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[d.foods.length," alimento(s)"]})})]})]})})},d.id||b)})}),p.meals&&p.meals.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[u.size," de ",p.meals.length," refei√ß√µes selecionadas"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(De,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),ce&&e.jsxs(Te,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(Ks,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ee,{children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Re,{id:"auto-scale",checked:X,onCheckedChange:d=>E(d===!0)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(J,{htmlFor:"auto-scale",className:"text-sm font-medium cursor-pointer",children:["Ajustar quantidades automaticamente para atingir ",Math.round(F)," kcal?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["O template tem ",Math.round(V.calories)," kcal.",X&&e.jsxs("span",{className:"block mt-1",children:["As por√ß√µes ser√£o ajustadas por um fator de ",g.toFixed(2),"x (aproximadamente ",Math.round(V.calories*g)," kcal ap√≥s ajuste)."]})]})]})]})})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsx(_,{onClick:le,disabled:r||!l,className:"w-full sm:w-auto",children:r?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-2 animate-spin"}),"Aplicando..."]}):e.jsx(e.Fragment,{children:"Aplicar este Modelo"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Pe,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecione um template para visualizar os detalhes"})]})})})]})]}),e.jsx(cs,{open:R,onOpenChange:U,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(xs,{className:"flex items-center gap-2",children:"‚ö†Ô∏è Alerta de Restri√ß√£o Alimentar"}),e.jsxs(us,{className:"space-y-3",children:[e.jsx("p",{children:"Este modelo cont√©m alimentos que o paciente marcou como alergia ou avers√£o:"}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:je.map((d,b)=>e.jsx("li",{className:"font-semibold text-destructive",children:d},b))})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Deseja continuar mesmo assim? Esta a√ß√£o pode causar rea√ß√µes adversas no paciente."})]})]}),e.jsxs(hs,{children:[e.jsx(ps,{onClick:()=>{U(!1),re([]),m(null)},children:"Cancelar Importa√ß√£o"}),e.jsx(fs,{onClick:Z,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Ignorar e Aplicar"})]})]})})]})}const va=async(a,c="Paciente")=>{if(!a||!a.meals||a.meals.length===0)throw new Error("Plano alimentar inv√°lido ou sem refei√ß√µes");const l=Na(a.meals),h=ya(l),s=new Xs("p","mm","a4"),x=s.internal.pageSize.width,o=s.internal.pageSize.height,N=[70,125,70],j=[68,64,60],k=[120,113,108];let i=20;s.setFont("helvetica");try{const z=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(q=>{const f=new Image;f.onload=()=>{const r=x*.15,C=f.height/f.width*r,F=new FileReader;F.onloadend=()=>{const W=F.result;s.addImage(W,"PNG",14,10,r,C),q()},F.readAsDataURL(z)},f.src=URL.createObjectURL(z)})}catch(M){console.error("Erro ao carregar logo:",M)}s.setFontSize(20),s.setTextColor(...N),s.setFont("helvetica","bold"),s.text("Lista de Compras",x/2,i,{align:"center"}),i+=8,s.setFontSize(12),s.setTextColor(...j),s.setFont("helvetica","normal"),s.text(`Paciente: ${c}`,14,i),i+=6;const S=new Date().toLocaleDateString("pt-BR");s.setFontSize(10),s.setTextColor(...k),s.text(`Gerado em: ${S}`,14,i),i+=10,s.setDrawColor(...N),s.setLineWidth(.5),s.line(14,i,x-14,i),i+=8;const p=Object.keys(h).sort();for(let M=0;M<p.length;M++){const T=p[M],z=h[T];i>o-60&&(s.addPage(),i=20),s.setFontSize(14),s.setTextColor(...N),s.setFont("helvetica","bold"),s.text(T,14,i),i+=6;const q=z.map(f=>["",f.name,f.totalQuantity]);Zs(s,{startY:i,head:[["","Item","Quantidade Total"]],body:q,theme:"grid",headStyles:{fillColor:N,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{textColor:j,fontSize:10},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:"auto",halign:"left"},2:{cellWidth:50,halign:"right"}},margin:{left:14,right:14},styles:{lineColor:[200,200,200],lineWidth:.1},didParseCell:function(f){if(f.column.index===0&&f.row.index>=0){const r=f.cell.x+2,C=f.cell.y+2,F=4;s.setDrawColor(150,150,150),s.setLineWidth(.3),s.rect(r,C,F,F)}}}),i=s.lastAutoTable.finalY+8,M<p.length-1&&(i+=5)}const A=o-15;s.setFontSize(8),s.setTextColor(...k),s.setFont("helvetica","italic"),s.text("Gerado por HipoZero",x/2,A,{align:"center"});const w=`lista_compras_${c.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;s.save(w)};function Na(a){const c=new Map;for(const l of a)if(!(!l.foods||l.foods.length===0))for(const h of l.foods){const s=h.foods?.name||h.food?.name||h.name||"Alimento n√£o identificado",x=parseFloat(h.quantity)||0,o=h.unit||"g",N=h.foods?.group||h.food?.group||"Outros",j=`${s.toLowerCase()}_${o}`;if(c.has(j)){const k=c.get(j);k.totalQuantity=ns(k.totalQuantityValue+x,o),k.totalQuantityValue+=x}else c.set(j,{name:s,unit:o,category:N,totalQuantity:ns(x,o),totalQuantityValue:x})}return Array.from(c.values())}function ya(a){const c={},l={"Cereais e derivados":"Cereais e Derivados","Verduras, hortali√ßas e derivados":"Verduras e Hortali√ßas","Frutas e sucos":"Frutas","Carnes e derivados":"Carnes","Leite e derivados":"Latic√≠nios","√ìleos e gorduras":"√ìleos e Gorduras","Pescados e frutos do mar":"Peixes e Frutos do Mar",Leguminosas:"Leguminosas","Nozes e sementes":"Nozes e Sementes",Bebidas:"Bebidas",Outros:"Outros"};for(const h of a){const s=l[h.category]||h.category||"Outros";c[s]||(c[s]=[]),c[s].push(h)}for(const h in c)c[h].sort((s,x)=>s.name.localeCompare(x.name,"pt-BR"));return c}function ns(a,c){const l=Math.round(a*100)/100;return l%1===0?`${l} ${c}`:`${l.toFixed(2)} ${c}`}const ba=async a=>{try{const{data:c,error:l}=await oe.from("energy_expenditure_calculations").select("*").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(l)throw l;return{data:c,error:null}}catch(c){return console.error("Erro ao buscar c√°lculo de energia:",c),{data:null,error:c}}};function wa({targetCalories:a,currentCalories:c=0,patientId:l,energyCalculation:h=null}){const s=Ve();if(!a||a<=0)return e.jsx(ee,{className:"border-yellow-500/50 bg-yellow-50/50 dark:bg-yellow-950/20",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Gasto Energ√©tico n√£o definido"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Defina o gasto energ√©tico para monitorar a meta do plano"})]})]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>s(`/nutritionist/patients/${l}/energy-expenditure`),className:"gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Definir Gasto Energ√©tico"]})]})})});const x=c-a,o=Math.abs(x),N=a>0?Math.min(100,c/a*100):0;let j="text-green-600",k="bg-green-100 dark:bg-green-900/30",i="border-green-500/50",S=es,p="Alinhado";o<=50?(j="text-green-600",k="bg-green-100 dark:bg-green-900/30",i="border-green-500/50",S=es,p="Alinhado"):o<=200?(j="text-yellow-600",k="bg-yellow-100 dark:bg-yellow-900/30",i="border-yellow-500/50",S=Oe,p="Pr√≥ximo"):(j="text-red-600",k="bg-red-100 dark:bg-red-900/30",i="border-red-500/50",S=Oe,p="Desalinhado");const A=S,M=h?{protocol:{"harris-benedict":"Harris-Benedict (1984)","mifflin-st-jeor":"Mifflin-St Jeor","fao-who":"FAO/WHO",cunningham:"Cunningham (Atletas)",tinsley:"Tinsley (Bodybuilding)"}[h.protocol]||h.protocol,tmb:h.tmb,activityLevel:h.activity_level,get:h.get,goalCalories:h.get_with_activities||h.get}:null;return e.jsx(ee,{className:ke("sticky top-4 z-10",i,k),children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Prescrito:"}),e.jsxs("span",{className:"text-sm font-bold text-foreground",children:[Math.round(c)," kcal"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Meta Calculada (GET):"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-sm font-bold text-primary",children:[Math.round(a)," kcal"]}),M&&e.jsxs(sa,{children:[e.jsx(aa,{asChild:!0,children:e.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(ra,{className:"w-3.5 h-3.5"})})}),e.jsx(ta,{className:"w-80 p-0",side:"bottom",align:"end",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-primary"}),e.jsx("h4",{className:"font-semibold text-sm",children:"C√°lculo de Energia"})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Protocolo:"}),e.jsx("span",{className:"font-medium",children:M.protocol})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TMB:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(M.tmb)," kcal"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"N√≠vel de Atividade:"}),e.jsxs("span",{className:"font-medium",children:["x",M.activityLevel]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"GET Base:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(M.get)," kcal"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Meta Final:"}),e.jsxs("span",{className:"font-bold text-primary",children:[Math.round(M.goalCalories)," kcal"]})]})})]})]})})]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(ea,{value:N,className:ke("h-2",o<=50?"bg-green-500":o<=200?"bg-yellow-500":"bg-red-500")}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso em rela√ß√£o √† meta"}),e.jsxs("span",{className:ke("font-semibold",j),children:[N.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ge,{variant:"outline",className:ke("gap-1.5",j,i),children:[e.jsx(A,{className:"w-3 h-3"}),p]}),e.jsxs("span",{className:ke("text-sm font-semibold",x>0?"text-red-600":x<0?"text-blue-600":"text-green-600"),children:[x>0?"+":"",Math.round(x)," kcal"]})]})]})})})}const mt=()=>{const{patientId:a}=Ss(),c=Ve(),{toast:l}=is(),{user:h}=ks(),[s,x]=t.useState(!0),[o,N]=t.useState(!1),[j,k]=t.useState([]),[i,S]=t.useState(null),[p,A]=t.useState(""),[w,M]=t.useState(null),[T,z]=t.useState(!1),[q,f]=t.useState(null),[r,C]=t.useState(null),[F,W]=t.useState(!1),[X,E]=t.useState(null),[g,L]=t.useState(!1),[R,U]=t.useState(null),[je,re]=t.useState(!1),[ne,m]=t.useState(!1),[u,y]=t.useState(!1),[I,D]=t.useState(""),[$,Q]=t.useState(""),[ae,le]=t.useState(null);t.useEffect(()=>{(async()=>{const{data:{user:v}}=await oe.auth.getUser();v&&C(v.id)})()},[]),t.useEffect(()=>{(async()=>{if(a)try{const{data:v,error:P}=await oe.from("user_profiles").select("name").eq("id",a).single();!P&&v&&A(v.name)}catch(v){console.error("Erro ao carregar nome do paciente:",v)}})()},[a]);const Z=t.useCallback(async()=>{if(a){x(!0);try{const[n,v]=await Promise.all([Ds(a),Os(a)]);if(n.error)throw n.error;k(n.data||[]),S(v.data)}catch(n){console.error("Erro ao carregar planos:",n),l({title:"Erro",description:"N√£o foi poss√≠vel carregar os planos alimentares",variant:"destructive"})}finally{x(!1)}}},[a,l]);t.useEffect(()=>{Z()},[Z]),t.useEffect(()=>{(async()=>{if(i?.id){const{data:v}=await bs(i.id);M(v)}else M(null)})()},[i?.id]),t.useEffect(()=>{(async()=>{if(a)try{const{data:v,error:P}=await ba(a);if(P)throw P;le(v)}catch(v){console.error("Erro ao carregar c√°lculo de energia:",v)}})()},[a]);const B=async(n,v=null)=>{N(!0);try{if(v){const P=await qs(v,n);if(P.error)throw P.error}else{const P=await Ls({patient_id:n.patient_id,nutritionist_id:n.nutritionist_id,name:n.name,description:n.description,active_days:n.active_days,start_date:n.start_date,end_date:n.end_date||null});if(P.error)throw P.error;for(const K of n.meals){const Ne=await Rs({meal_plan_id:P.data.id,name:K.name,meal_type:K.meal_type,meal_time:K.meal_time,notes:K.notes,order_index:K.order_index});if(Ne.error)throw Ne.error;for(const Y of K.foods||[])await $s({meal_plan_meal_id:Ne.data.id,food_id:Y.food_id,quantity:Y.quantity,unit:Y.unit,calories:Y.calories,protein:Y.protein,carbs:Y.carbs,fat:Y.fat,notes:Y.notes,order_index:Y.order_index||0})}}l({title:"Sucesso",description:v?"Plano atualizado com sucesso":"Plano criado com sucesso",variant:"success"}),z(!1),f(null),await Z()}catch(P){console.error("Erro ao salvar plano:",P),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o plano alimentar",variant:"destructive"})}finally{N(!1)}},V=async n=>{try{const v=await Ae(n);if(v.error)throw v.error;f(v.data),z(!0)}catch(v){console.error("Erro ao carregar plano para edi√ß√£o:",v),l({title:"Erro",description:"N√£o foi poss√≠vel carregar o plano para edi√ß√£o",variant:"destructive"})}},ie=async n=>{try{const v=await Bs(n);if(v.error)throw v.error;l({title:"Sucesso",description:"Plano arquivado com sucesso",variant:"success"}),await Z()}catch(v){console.error("Erro ao arquivar plano:",v),l({title:"Erro",description:"N√£o foi poss√≠vel arquivar o plano",variant:"destructive"})}},ve=async n=>{try{const v=await Gs(n);if(v.error)throw v.error;l({title:"Sucesso",description:"Plano ativado com sucesso",variant:"success"}),await Z()}catch(v){console.error("Erro ao ativar plano:",v),l({title:"Erro",description:"N√£o foi poss√≠vel ativar o plano",variant:"destructive"})}},ce=n=>{const v=j.find(P=>P.id===n)||i;v&&(U(v),L(!0))},d=async n=>{try{const v=await Vs(R.id,n);if(v.error)throw v.error;l({title:"Sucesso",description:"Plano copiado para o paciente com sucesso",variant:"success"}),L(!1),U(null)}catch(v){console.error("Erro ao copiar modelo:",v),l({title:"Erro",description:"N√£o foi poss√≠vel copiar o modelo para o paciente",variant:"destructive"})}},b=async()=>{if(!i){l({title:"Erro",description:"Nenhum plano ativo encontrado.",variant:"destructive"});return}try{const n=await Ae(i.id);if(n.error)throw n.error;const v=n.data;await va(v,p),l({title:"Lista de Compras gerada!",description:"O PDF foi baixado com sucesso."})}catch(n){console.error("Erro ao gerar lista de compras:",n),l({title:"Erro",description:"N√£o foi poss√≠vel gerar a lista de compras. Tente novamente.",variant:"destructive"})}},G=async n=>{if(i)try{re(!1);const v=await Ae(i.id);if(v.error)throw v.error;const P=v.data;await Ys(P,p,h?.profile?.name,n,Js,ys),l({title:"PDF gerado!",description:"Plano alimentar exportado com sucesso.",variant:"success"})}catch(v){console.error("Erro ao exportar PDF:",v),l({title:"Erro",description:"N√£o foi poss√≠vel exportar o plano alimentar",variant:"destructive"})}},O=async()=>{if(X)try{const n=await Us(X);if(n.error)throw n.error;l({title:"Sucesso",description:"Plano deletado com sucesso",variant:"success"}),E(null),W(!1),await Z()}catch(n){console.error("Erro ao deletar plano:",n),l({title:"Erro",description:"N√£o foi poss√≠vel deletar o plano",variant:"destructive"})}},H=n=>n?new Date(n).toLocaleDateString("pt-BR"):null,we=n=>{if(!n||n.length===0)return"Nenhum dia";if(n.length===7)return"Todos os dias";const v=["monday","tuesday","wednesday","thursday","friday"],P=["saturday","sunday"],K=v.every(Y=>n.includes(Y))&&!P.some(Y=>n.includes(Y)),Ne=P.every(Y=>n.includes(Y))&&!v.some(Y=>n.includes(Y));return K?"Dias √∫teis":Ne?"Fins de semana":`${n.length} dias`},Ce=async()=>{if(!(!i||!I.trim())){N(!0);try{const n=$?$.split(",").map(K=>K.trim()).filter(K=>K.length>0):[],{data:v,error:P}=await Ws(i.id,I.trim(),n);if(P)throw P;l({title:"Template Salvo",description:`O plano foi salvo como template "${I}" com sucesso.`,variant:"success"}),y(!1),D(""),Q("")}catch(n){console.error("Erro ao salvar template:",n),l({title:"Erro",description:"N√£o foi poss√≠vel salvar o template.",variant:"destructive"})}finally{N(!1)}}},Se=async n=>{await Z(),n&&S(n)};return s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Carregando..."})}):T?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(_,{variant:"ghost",onClick:()=>{z(!1),f(null)},children:[e.jsx(ss,{className:"mr-2 h-4 w-4"}),"Voltar"]})}),e.jsx(fa,{patientId:a,nutritionistId:r,initialData:q,onSubmit:B,onCancel:()=>{z(!1),f(null)},loading:o})]}):e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{variant:"ghost",size:"sm",onClick:()=>c(`/nutritionist/patients/${a}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(ss,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:Z,className:"flex-shrink-0",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Le,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"truncate",children:"Planos Alimentares"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gerencie os planos alimentares do paciente"})]}),e.jsxs(_,{size:"sm",onClick:()=>z(!0),className:"w-full sm:w-auto",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Novo Plano"]})]})]}),e.jsx(wa,{targetCalories:ae?.get_with_activities||ae?.get||null,currentCalories:i?.daily_calories||0,patientId:a,energyCalculation:ae}),i&&e.jsxs(ee,{className:"mb-6 border-primary shadow-sm",children:[e.jsx(pe,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(fe,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx("span",{className:"break-words",children:i.name}),e.jsx(ge,{className:"bg-primary",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:()=>V(i.id),className:"hidden sm:flex",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(_,{size:"sm",onClick:()=>c(`/nutritionist/patients/${a}/meal-plan/${i.id}/summary`),className:"hidden sm:flex",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Resumo Nutricional"]}),e.jsxs(_,{size:"sm",variant:"outline",onClick:b,className:"hidden sm:flex",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Lista de Compras"]}),e.jsxs(Fs,{children:[e.jsx(Ms,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:e.jsx(la,{className:"h-4 w-4"})})}),e.jsxs(Ps,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsxs(_e,{onClick:()=>V(i.id),children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Editar Plano"]}),e.jsxs(_e,{onClick:()=>c(`/nutritionist/patients/${a}/meal-plan/${i.id}/summary`),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Ver Resumo Nutricional"]}),e.jsx(Ke,{})]}),e.jsxs(_e,{onClick:()=>re(!0),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),e.jsxs(_e,{onClick:b,children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Gerar Lista de Compras"]}),e.jsxs(_e,{onClick:()=>ce(i.id),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Copiar como Modelo"]}),e.jsx(Ke,{}),e.jsxs(_e,{onClick:()=>ie(i.id),className:"text-destructive focus:text-destructive",children:[e.jsx(na,{className:"h-4 w-4 mr-2"}),"Arquivar Plano"]})]})]})]})]})})}),e.jsxs(se,{children:[i.description&&e.jsx("p",{className:"text-muted-foreground mb-4",children:i.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"In√≠cio"}),e.jsx("div",{className:"font-semibold",children:H(i.start_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"T√©rmino"}),e.jsx("div",{className:"font-semibold",children:i.end_date?H(i.end_date):"Indeterminado"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dias Ativos"}),e.jsx("div",{className:"font-semibold",children:we(i.active_days)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Refei√ß√µes"}),e.jsx("div",{className:"font-semibold",children:i.meals?.length||0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:i.meals&&i.meals.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold mb-3",children:"Refei√ß√µes:"}),i.meals.map((n,v)=>e.jsx("div",{className:"p-3 border rounded-lg bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[v+1,". ",n.name,n.meal_time&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["√†s ",n.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.foods?.length||0," alimento(s) ‚Ä¢"," ",n.total_calories?.toFixed(0)||0," kcal"]})]})})},n.id))]}):e.jsx(Te,{children:e.jsx(Ee,{children:"Nenhuma refei√ß√£o adicionada ainda."})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(ws,{protein:i.daily_protein||0,carbs:i.daily_carbs||0,fat:i.daily_fat||0,calories:i.daily_calories||0,patientId:a,planId:null,referenceValues:w,onReferenceUpdate:null,readOnly:!0})})]})]})]}),e.jsxs(ee,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Todos os Planos"})}),e.jsx(se,{children:j.length===0?e.jsx(Te,{children:e.jsx(Ee,{children:'Nenhum plano alimentar criado ainda. Clique em "Novo Plano" para come√ßar.'})}):e.jsx("div",{className:"space-y-3",children:j.map(n=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:n.name}),n.is_active&&e.jsx(ge,{variant:"outline",children:"Ativo"}),!n.is_active&&e.jsx(ge,{variant:"secondary",children:"Arquivado"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[H(n.start_date),n.end_date&&` at√© ${H(n.end_date)}`," ","‚Ä¢ ",we(n.active_days)," ","‚Ä¢ ",n.daily_calories?.toFixed(0)||0," kcal/dia"]})]}),e.jsxs("div",{className:"flex gap-2",children:[!n.is_active&&e.jsx(_,{variant:"default",size:"sm",onClick:()=>ve(n.id),title:"Ativar este plano",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>V(n.id),title:"Editar plano",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>ce(n.id),title:"Copiar modelo",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx(_,{variant:"outline",size:"sm",onClick:()=>{E(n.id),W(!0)},title:"Deletar plano",children:e.jsx(Ue,{className:"h-4 w-4 text-destructive"})})]})]})},n.id))})})]}),e.jsx(cs,{open:F,onOpenChange:W,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(xs,{children:"Confirmar Exclus√£o"}),e.jsx(us,{children:"Tem certeza que deseja deletar este plano alimentar? Esta a√ß√£o n√£o pode ser desfeita."})]}),e.jsxs(hs,{children:[e.jsx(ps,{onClick:()=>E(null),children:"Cancelar"}),e.jsx(fs,{onClick:O,className:"bg-destructive",children:"Deletar"})]})]})}),e.jsx(ga,{isOpen:g,onClose:()=>{L(!1),U(null)},planId:R?.id,planName:R?.name,onCopy:d}),e.jsx(de,{open:u,onOpenChange:y,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Salvar Plano como Modelo"}),e.jsx(he,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:I,onChange:n=>D(n.target.value),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por v√≠rgula)"}),e.jsx(te,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:$,onChange:n=>Q(n.target.value),disabled:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(be,{children:[e.jsx(_,{variant:"outline",onClick:()=>{y(!1),D(""),Q("")},disabled:o,children:"Cancelar"}),e.jsx(_,{onClick:Ce,disabled:o||!I.trim(),children:o?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(ls,{open:ne,onOpenChange:m,patientId:a,nutritionistId:r,onTemplateApplied:Se}),e.jsx(de,{open:je,onOpenChange:re,children:e.jsxs(me,{className:"sm:max-w-md",children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Exportar Plano Alimentar"}),e.jsx(he,{children:"Escolha o formato de exporta√ß√£o para PDF"})]}),e.jsxs("div",{className:"grid gap-3 py-4",children:[e.jsx(ee,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>G(!1),children:e.jsxs(se,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Simples"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macronutrientes b√°sicos (calorias, prote√≠nas, carboidratos e gorduras)"})]})]})}),e.jsx(ee,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>G(!0),children:e.jsxs(se,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-secondary/10 text-secondary",children:e.jsx(as,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Completo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macros + micronutrientes (fibras, vitaminas, minerais)"})]})]})})]}),e.jsx(be,{className:"sm:justify-start",children:e.jsx(_,{variant:"ghost",onClick:()=>re(!1),className:"w-full sm:w-auto",children:"Cancelar"})})]})}),e.jsx(de,{open:u,onOpenChange:y,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(ue,{children:"Salvar Plano como Modelo"}),e.jsx(he,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:I,onChange:n=>D(n.target.value),disabled:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por v√≠rgula)"}),e.jsx(te,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:$,onChange:n=>Q(n.target.value),disabled:o}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(be,{children:[e.jsx(_,{variant:"outline",onClick:()=>{y(!1),D(""),Q("")},disabled:o,children:"Cancelar"}),e.jsx(_,{onClick:Ce,disabled:o||!I.trim(),children:o?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(ls,{open:ne,onOpenChange:m,patientId:a,nutritionistId:r,onTemplateApplied:Se})]})};export{mt as default};
