import{q as Ce,j as e,J as ae,K as te,M as re,N as ie,B as f,ad as le,F as j,C as S,c as Y,d as V,e as T,u as De,b as ke,a as Pe,r as d,s as W,R as Se,m as B,G as Te,E as ze,w as Fe,D as Oe,x as Re,y as Ee,z as ce,T as Ae,az as qe,ay as Le,O as He,A as Ie,h as $e,i as Ge,k as We,l as Be,n as Ue,o as Ye,p as Ve,a3 as Je,au as Qe}from"./index-BvWB-6Y-.js";import{D as Ze}from"./date-input-NufpG6-F.js";import{P as U}from"./progress-Di_AUcQX.js";import{L as X}from"./label-Dds-NHUC.js";import{S as ee}from"./switch-DstVlsQb.js";import{I as se}from"./input-OBodSLFw.js";import{t as A}from"./mealTranslations-B1KHhmEq.js";import{B as Ke}from"./badge-CCK5Bs0D.js";import{f as me}from"./measureTranslations-AG6EuUvS.js";import{E as Xe}from"./jspdf.es.min-B7ZBL3OL.js";import{a as es}from"./jspdf.plugin.autotable-C3NxY6Hi.js";import{F as ss}from"./file-text-CyOxrREb.js";import{D as as}from"./download-CU2JC9ir.js";import{C as ts}from"./calendar-BxLBJTLY.js";import{U as q}from"./utensils-CLVAb11L.js";import{p as E}from"./pt-BR-BMtVLtF7.js";import{u as rs,B as is,W as ls}from"./useNotifications-DioZYdve.js";import{h as ns,u as os}from"./food-diary-queries-Q2rJq5H2.js";import{E as ds}from"./eye-D-rBLbjZ.js";import{C as cs}from"./clock-BDxmKYor.js";import{C as ms}from"./chevron-left-FDyjizdT.js";import{F as xs}from"./flame-DbwLYwhx.js";import{D as hs}from"./droplet-BdKopZMO.js";import{P as xe}from"./plus-BWNKYoo4.js";import{P as ps}from"./pen-square-OCV3PTXs.js";import{p as us}from"./parseISO-DtrTOw4I.js";import{i as fs}from"./isSameDay-CSO39H9U.js";import{i as he}from"./isToday-kGhyZ0TX.js";import{i as gs}from"./isYesterday-9BPB-yUf.js";import{i as js}from"./isTomorrow-BGjt5OZp.js";import"./calendar-rgGv7qqU.js";import"./endOfMonth-Ca9QmV5D.js";import"./addMonths-hOFFPW3g.js";import"./popover-BK70NwGK.js";import"./extends-CF3RwP-h.js";import"./date-C2sroe8F.js";import"./query-helpers-mbysFH2_.js";import"./observability-queries-BxbsnaqH.js";import"./constructNow-BDnuN8eJ.js";const pe=Ce("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);function bs({open:m,onOpenChange:L,mealPlan:x,patientName:b}){if(!x)return null;const P=["breakfast","morning_snack","lunch","afternoon_snack","dinner","supper"],y=[...x.meal_plan_meals||[]].sort((a,g)=>P.indexOf(a.meal_type)-P.indexOf(g.meal_type)),v=y.reduce((a,g)=>{const c=(g.meal_plan_foods||[]).reduce((r,n)=>({calories:r.calories+(n.calories||0),protein:r.protein+(n.protein||0),carbs:r.carbs+(n.carbs||0),fat:r.fat+(n.fat||0)}),{calories:0,protein:0,carbs:0,fat:0});return{calories:a.calories+c.calories,protein:a.protein+c.protein,carbs:a.carbs+c.carbs,fat:a.fat+c.fat}},{calories:0,protein:0,carbs:0,fat:0}),z=async()=>{const a=new Xe,g=a.internal.pageSize.width,w=a.internal.pageSize.height,c=[70,125,70],r=[68,64,60],n=[120,113,108],F=[245,245,244];let i=20;a.setFont("helvetica");try{const N=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(o=>{const C=new Image;C.onload=()=>{const D=g*.2,O=C.height/C.width*D,u=new FileReader;u.onloadend=()=>{const Q=u.result;a.addImage(Q,"PNG",14,10,D,O),o()},u.readAsDataURL(N)},C.src=URL.createObjectURL(N)})}catch(p){console.error("Erro ao carregar logo:",p)}a.setFontSize(20),a.setTextColor(...c),a.setFont("helvetica","bold"),a.text("Plano Alimentar",g/2,20,{align:"center"}),a.setDrawColor(...c),a.setLineWidth(.5),a.line(14,24,g-14,24),i=32,a.setFont("helvetica","normal"),a.setFontSize(10),a.setTextColor(...r),b&&(a.text(`Paciente: ${b}`,14,i),i+=5);const H=j(new Date(x.start_date),"dd 'de' MMMM 'de' yyyy",{locale:E}),J=x.end_date?j(new Date(x.end_date),"dd 'de' MMMM 'de' yyyy",{locale:E}):"Indeterminado";a.text(`Período: ${H} até ${J}`,14,i),i+=5,a.text(`Gerado em: ${j(new Date,"dd/MM/yyyy 'às' HH:mm")}`,14,i),i+=10,a.setFillColor(...F),a.roundedRect(14,i,g-28,20,2,2,"F"),a.setFontSize(9),a.setTextColor(...r),a.setFont("helvetica","bold"),a.text("Meta Diária Total:",18,i+6),a.setFont("helvetica","normal"),a.setTextColor(...n);const I=`${Math.round(v.calories)} kcal  •  Proteínas: ${Math.round(v.protein)}g  •  Carboidratos: ${Math.round(v.carbs)}g  •  Gorduras: ${Math.round(v.fat)}g`;a.text(I,18,i+13),i+=28;for(let p=0;p<y.length;p++){const M=y[p],N=M.meal_plan_foods||[],o=15+(N.length+1)*7+(M.notes?10:0);i+o>w-30&&(a.addPage(),i=20),a.setFontSize(12),a.setTextColor(...c),a.setFont("helvetica","bold");const C=A(M.meal_type),D=M.meal_time||"";if(a.text(`${C}${D?` • ${D}`:""}`,14,i),i+=7,N.length>0){const O=N.map(u=>[u.foods?.name||"Alimento",me(u.quantity||0,u.unit||"",u.measure),Math.round(u.calories||0),Math.round(u.protein||0),Math.round(u.carbs||0),Math.round(u.fat||0)]);es(a,{startY:i,head:[["Alimento","Quantidade","Calorias","Proteína","Carboidrato","Gordura"]],body:O,theme:"striped",headStyles:{fillColor:c,textColor:[255,255,255],fontSize:9,fontStyle:"bold",halign:"center",font:"helvetica"},bodyStyles:{fontSize:8,textColor:r,font:"helvetica"},columnStyles:{0:{halign:"left",cellWidth:"auto"},1:{halign:"center",cellWidth:30},2:{halign:"center",cellWidth:23},3:{halign:"center",cellWidth:23},4:{halign:"center",cellWidth:28},5:{halign:"center",cellWidth:23}},alternateRowStyles:{fillColor:F},margin:{left:14,right:14}}),i=a.lastAutoTable.finalY+3}M.notes&&(a.setFontSize(8),a.setTextColor(...n),a.setFont("helvetica","italic"),a.text(`Obs: ${M.notes}`,14,i),i+=6),p<y.length-1&&(i+=5)}const $=a.internal.getNumberOfPages();for(let p=1;p<=$;p++)a.setPage(p),a.setFontSize(8),a.setTextColor(...n),a.setFont("helvetica","normal"),a.text(`Página ${p} de ${$}`,g-14,w-10,{align:"right"});const h=`plano-alimentar-${b?.replace(/\s+/g,"-").toLowerCase()||"paciente"}-${j(new Date,"dd-MM-yyyy")}.pdf`;a.save(h)};return e.jsx(ae,{open:m,onOpenChange:L,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-6 h-6 text-primary"}),e.jsx(ie,{className:"text-2xl",children:"Meu Plano Alimentar"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:z,className:"gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),"Baixar PDF"]})]}),e.jsxs(le,{className:"flex items-center gap-2 pt-2",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:["Período: ",j(new Date(x.start_date),"dd 'de' MMMM",{locale:E})," até ",x.end_date?j(new Date(x.end_date),"dd 'de' MMMM 'de' yyyy",{locale:E}):"indeterminado"]})]})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(S,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:[e.jsx(Y,{className:"pb-3",children:e.jsx(V,{className:"text-base text-primary",children:"Meta Diária Total"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-white/80 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:Math.round(v.calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calorias"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/80 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(v.protein),"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Proteínas"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/80 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(v.carbs),"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carboidratos"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/80 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:[Math.round(v.fat),"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gorduras"})]})]})})]}),e.jsx("div",{className:"space-y-4",children:y.length>0?y.map((a,g)=>{const w=a.meal_plan_foods||[],c=w.reduce((r,n)=>({calories:r.calories+(n.calories||0),protein:r.protein+(n.protein||0),carbs:r.carbs+(n.carbs||0),fat:r.fat+(n.fat||0)}),{calories:0,protein:0,carbs:0,fat:0});return e.jsxs(S,{className:"border-l-4 border-l-primary",children:[e.jsxs(Y,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-primary"}),e.jsx(V,{className:"text-lg",children:A(a.meal_type)}),a.meal_time&&e.jsx(Ke,{variant:"outline",className:"text-xs",children:a.meal_time})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-sm font-bold text-primary",children:[Math.round(c.calories)," kcal"]})})]}),a.name&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.name})]}),e.jsx(T,{children:w.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-muted/50",children:[e.jsx("th",{className:"text-left p-2 font-semibold",children:"Alimento"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Quantidade"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Calorias"}),e.jsx("th",{className:"text-right p-2 font-semibold hidden md:table-cell",children:"Prot."}),e.jsx("th",{className:"text-right p-2 font-semibold hidden md:table-cell",children:"Carb."}),e.jsx("th",{className:"text-right p-2 font-semibold hidden md:table-cell",children:"Gord."})]})}),e.jsx("tbody",{children:w.map((r,n)=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-muted/30",children:[e.jsx("td",{className:"p-2",children:r.foods?.name||"Alimento"}),e.jsx("td",{className:"p-2 text-right whitespace-nowrap",children:me(r.quantity||0,r.unit||"",r.measure)}),e.jsxs("td",{className:"p-2 text-right font-medium whitespace-nowrap",children:[Math.round(r.calories||0)," kcal"]}),e.jsxs("td",{className:"p-2 text-right text-muted-foreground hidden md:table-cell",children:[Math.round(r.protein||0),"g"]}),e.jsxs("td",{className:"p-2 text-right text-muted-foreground hidden md:table-cell",children:[Math.round(r.carbs||0),"g"]}),e.jsxs("td",{className:"p-2 text-right text-muted-foreground hidden md:table-cell",children:[Math.round(r.fat||0),"g"]})]},n))})]})}),e.jsxs("div",{className:"md:hidden mt-3 p-2 bg-muted/30 rounded text-xs",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Totais desta refeição:"}),e.jsxs("p",{className:"text-muted-foreground",children:["P: ",Math.round(c.protein),"g | C: ",Math.round(c.carbs),"g | G: ",Math.round(c.fat),"g"]})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum alimento cadastrado nesta refeição"})})]},g)}):e.jsx(S,{children:e.jsxs(T,{className:"py-8 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-muted-foreground/50 mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma refeição cadastrada neste plano"})]})})})]})]})})}function ia(){const{user:m}=De(),L=ke(),{toast:x}=Pe(),[b,P]=d.useState(new Date),[y,v]=d.useState([]),[z,a]=d.useState(null),[g,w]=d.useState(!0),[c,r]=d.useState(!1),[n,F]=d.useState(null),[i,H]=d.useState(!1),[J,I]=d.useState(!1),{unreadCount:$}=rs(),[h,p]=d.useState(null),[M,N]=d.useState(!1),[o,C]=d.useState({daily_log_enabled:!0,measurement_enabled:!0,daily_log_time:"20:00",measurement_time:"09:00",channel_in_app:!0,timezone:"America/Sao_Paulo",quiet_hours_start:"",quiet_hours_end:""}),[D,O]=d.useState(!1),u=[{key:"breakfast",label:"Café da Manhã"},{key:"morning_snack",label:"Lanche da Manhã"},{key:"lunch",label:"Almoço"},{key:"afternoon_snack",label:"Lanche da Tarde"},{key:"dinner",label:"Jantar"},{key:"supper",label:"Ceia"}],Q=z?.meal_plan_meals?.map(s=>s.meal_type)||[],ne=d.useCallback(async()=>{if(!m)return;const s=j(new Date,"yyyy-MM-dd"),{data:t}=await W.from("meal_plans").select(`
        *,
        meal_plan_meals (
          *,
          meal_plan_foods (
            *,
            foods (id, name)
          )
        )
      `).eq("patient_id",m.id).eq("is_active",!0).lte("start_date",s).or(`end_date.is.null,end_date.gte.${s}`).maybeSingle();a(t),t&&t.daily_calories>0?p({calories:t.daily_calories||0,protein:t.daily_protein||0,carbs:t.daily_carbs||0,fat:t.daily_fat||0}):p({calories:2e3,protein:0,carbs:0,fat:0})},[m]),Z=d.useCallback(async()=>{if(!m)return;w(!0);const s=j(b,"yyyy-MM-dd"),{data:t,error:l}=await W.from("meals").select(`
        *,
        meal_items (
          *,
          foods (
            id,
            name
          )
        )
      `).eq("patient_id",m.id).eq("meal_date",s).is("deleted_at",null).order("created_at",{ascending:!0});l?(console.error("Erro ao carregar refeições:",l),x({title:"Erro",description:"Não foi possível carregar as refeições.",variant:"destructive"})):v(t||[]),w(!1)},[m,b,x]);d.useEffect(()=>{ne()},[ne]),d.useEffect(()=>{Z()},[Z]);const oe=d.useCallback(async()=>{if(!m?.id)return;const{data:s}=await ns(m.id);C({daily_log_enabled:s?.daily_log_enabled??!0,measurement_enabled:s?.measurement_enabled??!0,daily_log_time:s?.daily_log_time||"20:00",measurement_time:s?.measurement_time||"09:00",channel_in_app:s?.channel_in_app??!0,timezone:s?.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone||"America/Sao_Paulo",quiet_hours_start:s?.quiet_hours_start||"",quiet_hours_end:s?.quiet_hours_end||""})},[m?.id]);d.useEffect(()=>{oe()},[oe]);const k=y.reduce((s,t)=>({calories:s.calories+(t.total_calories||0),protein:s.protein+(t.total_protein||0),carbs:s.carbs+(t.total_carbs||0),fat:s.fat+(t.total_fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),ue=[...new Set(y.map(s=>s.meal_type))],de=[...new Set([...Q,...ue])],fe=de.reduce((s,t)=>(s[t]=y.filter(l=>l.meal_type===t),s),{}),ge=()=>{P(s=>Je(s,1))},je=()=>{P(s=>Qe(s,1))},be=()=>{P(new Date)},ye=s=>he(s)?"HOJE":gs(s)?"ONTEM":js(s)?"AMANHÃ":j(s,"dd 'de' MMMM",{locale:E}),Ne=s=>j(s,"EEEE, dd 'de' MMMM 'de' yyyy",{locale:E}),_e=async()=>{if(!n)return;const s=y.find(l=>l.id===n),{error:t}=await W.from("meals").update({deleted_at:new Date().toISOString()}).eq("id",n);t?x({title:"Erro",description:"Não foi possível excluir a refeição.",variant:"destructive"}):(s&&await W.rpc("log_meal_action",{p_patient_id:m.id,p_meal_id:n,p_action:"delete",p_meal_type:s.meal_type,p_meal_date:s.meal_date,p_meal_time:s.meal_time,p_details:{total_calories:s.total_calories,total_protein:s.total_protein,total_carbs:s.total_carbs,total_fat:s.total_fat,items:(s.meal_items||[]).map(l=>({food_id:l.food_id,name:l.name,quantity:l.quantity,unit:l.unit,calories:l.calories,protein:l.protein,carbs:l.carbs,fat:l.fat})),deleted_at:new Date().toISOString()}}),x({title:"Sucesso",description:"Refeição excluída com sucesso."}),Z()),F(null)},G=s=>{const t=z?.meal_plan_meals?.find(l=>l.meal_type===s);L("/patient/add-meal",{state:{mealType:s,mealTime:t?.meal_time||j(new Date,"HH:mm"),mealName:t?.name||"",recommendedFoods:t?.meal_plan_foods||[]}}),r(!1)},R=(s,t)=>{C(l=>({...l,[s]:t}))},ve=async()=>{if(m?.id){O(!0);try{const{error:s}=await os(m.id,{daily_log_enabled:o.daily_log_enabled,measurement_enabled:o.measurement_enabled,daily_log_time:o.daily_log_time,measurement_time:o.measurement_time,channel_in_app:o.channel_in_app,timezone:o.timezone,quiet_hours_start:o.quiet_hours_start||null,quiet_hours_end:o.quiet_hours_end||null});if(s)throw s;x({title:"Preferências salvas",description:"Seus lembretes foram atualizados com sucesso."}),N(!1)}catch{x({title:"Erro",description:"Não foi possível salvar as preferências de lembrete.",variant:"destructive"})}finally{O(!1)}}};return e.jsxs("div",{className:"flex flex-col min-h-screen bg-background",children:[e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-8 space-y-6",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Plano Alimentar"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Registre suas refeições do dia"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>H(!0),className:"text-muted-foreground hover:text-foreground",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Ver Plano"})]}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>N(!0),className:"text-muted-foreground hover:text-foreground",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Lembretes"})]}),e.jsxs(f,{variant:"ghost",size:"icon",onClick:()=>I(!0),className:"relative",children:[e.jsx(Se,{className:"w-6 h-6 text-gray-700"}),$>0&&e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]})]})]}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(S,{className:"border-0 shadow-sm",children:e.jsxs(T,{className:"pt-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:ge,className:"flex-shrink-0",children:e.jsx(ms,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-primary",children:ye(b)}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize mt-1",children:Ne(b)})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ze,{value:j(b,"yyyy-MM-dd"),onChange:s=>{const t=us(s);Te(t)&&P(t)},className:"max-w-[170px]"})})]})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:je,className:"flex-shrink-0",disabled:fs(b,new Date),children:e.jsx(ze,{className:"h-5 w-5"})})]}),!he(b)&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:be,className:"text-primary hover:text-primary/80",children:"Ir para Hoje"})})]})})}),h&&e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(S,{className:"border-[#5f6f52]/20 shadow-sm",children:[e.jsxs(Y,{className:"pb-4",children:[e.jsx(V,{className:"text-lg text-[#5f6f52]",children:"Progresso do Dia"}),e.jsx(Fe,{children:"Consumido vs Meta"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Calorias"})]}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[Math.round(k.calories)," / ",Math.round(h.calories)," kcal"]})]}),e.jsx(U,{value:h.calories>0?Math.min(k.calories/h.calories*100,100):0,className:"h-3",indicatorClassName:"bg-gradient-to-r from-orange-500 to-red-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"w-4 h-4 text-sky-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Proteínas"})]}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[Math.round(k.protein)," / ",Math.round(h.protein),"g"]})]}),e.jsx(U,{value:h.protein>0?Math.min(k.protein/h.protein*100,100):0,className:"h-3",indicatorClassName:"bg-sky-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Carboidratos"})]}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[Math.round(k.carbs)," / ",Math.round(h.carbs),"g"]})]}),e.jsx(U,{value:h.carbs>0?Math.min(k.carbs/h.carbs*100,100):0,className:"h-3",indicatorClassName:"bg-amber-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Gorduras"})]}),e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[Math.round(k.fat)," / ",Math.round(h.fat),"g"]})]}),e.jsx(U,{value:h.fat>0?Math.min(k.fat/h.fat*100,100):0,className:"h-3",indicatorClassName:"bg-yellow-500"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:de.map((s,t)=>{const l=fe[s]||[],we=l.length>0;return e.jsx(B.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2+t*.05},children:we?e.jsxs(S,{className:"shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(V,{className:"text-base",children:A(s)})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>G(s),className:"border-[#5f6f52]/30 text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Adicionar mais"]})]})}),e.jsx(T,{children:e.jsx("div",{className:"space-y-3",children:l.map(_=>e.jsxs(B.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"border rounded-lg p-4 bg-background hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("h4",{className:"text-sm font-semibold text-foreground",children:A(s)})}),e.jsxs("p",{className:"text-lg font-bold text-[#5f6f52]",children:[_.total_calories?.toFixed(0)," kcal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["P: ",_.total_protein?.toFixed(1),"g • C: ",_.total_carbs?.toFixed(1),"g • G: ",_.total_fat?.toFixed(1),"g"]})]}),e.jsxs(Oe,{children:[e.jsx(Re,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(pe,{className:"w-4 h-4"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(ce,{onClick:()=>L("/patient/add-meal",{state:{editMode:!0,mealId:_.id}}),children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Editar"]}),e.jsxs(ce,{onClick:()=>F(_.id),className:"text-destructive focus:text-destructive",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Excluir"]})]})]})]}),_.meal_items?.length>0&&e.jsx("div",{className:"space-y-2 mt-3 pt-3 border-t",children:_.meal_items.map((K,Me)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-foreground",children:K.foods?.name||"Alimento desconhecido"}),e.jsxs("span",{className:"font-medium text-muted-foreground",children:[K.quantity," ",K.measure]})]},Me))})]},_.id))})})]}):e.jsx(S,{className:"border-2 border-dashed border-muted-foreground/30 bg-muted/20 hover:bg-muted/30 hover:border-primary/40 transition-all cursor-pointer",onClick:()=>G(s),children:e.jsx(T,{className:"py-8 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-full bg-primary/10",children:e.jsx(q,{className:"w-6 h-6 text-primary/60"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-base font-semibold text-muted-foreground",children:["Registrar ",A(s)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Clique para adicionar alimentos"})]}),e.jsxs(f,{size:"sm",className:"mt-2 bg-primary hover:bg-primary/90",onClick:_=>{_.stopPropagation(),G(s)},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Adicionar"]})]})})})},s)})}),e.jsxs(ae,{open:c,onOpenChange:r,children:[e.jsx(qe,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Registrar Outra Refeição"]})}),e.jsxs(te,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Escolha o Tipo de Refeição"}),e.jsx(le,{children:"Selecione qual refeição deseja registrar"})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 py-4",children:u.map(s=>e.jsxs(f,{variant:"outline",className:"justify-start",onClick:()=>G(s.key),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),s.label]},s.key))})]})]})]}),e.jsx(bs,{open:i,onOpenChange:H,mealPlan:z,patientName:m?.profile?.name}),e.jsx(Le,{isOpen:J,setIsOpen:I}),e.jsx(ae,{open:M,onOpenChange:N,children:e.jsxs(te,{className:"sm:max-w-lg",children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Preferências de Lembrete"}),e.jsx(le,{children:"Configure quais lembretes deseja receber e os horários preferidos."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"rounded-lg border p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Lembrete de diário"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registrar refeições diariamente"})]}),e.jsx(ee,{checked:o.daily_log_enabled,onCheckedChange:s=>R("daily_log_enabled",s)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(X,{htmlFor:"daily-log-time",children:"Horário"}),e.jsx(se,{id:"daily-log-time",type:"time",value:o.daily_log_time,onChange:s=>R("daily_log_time",s.target.value),disabled:!o.daily_log_enabled})]})]}),e.jsxs("div",{className:"rounded-lg border p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Lembrete de medidas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Atualizar dados e evolução"})]}),e.jsx(ee,{checked:o.measurement_enabled,onCheckedChange:s=>R("measurement_enabled",s)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(X,{htmlFor:"measurement-time",children:"Horário"}),e.jsx(se,{id:"measurement-time",type:"time",value:o.measurement_time,onChange:s=>R("measurement_time",s.target.value),disabled:!o.measurement_enabled})]})]}),e.jsxs("div",{className:"rounded-lg border p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Canal in-app"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Receber lembretes dentro do aplicativo"})]}),e.jsx(ee,{checked:o.channel_in_app,onCheckedChange:s=>R("channel_in_app",s)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(X,{htmlFor:"timezone",children:"Fuso horário"}),e.jsx(se,{id:"timezone",type:"text",value:o.timezone,onChange:s=>R("timezone",s.target.value)})]})]})]}),e.jsxs(He,{children:[e.jsx(f,{variant:"outline",onClick:()=>N(!1),disabled:D,children:"Cancelar"}),e.jsx(f,{onClick:ve,disabled:D,children:D?"Salvando...":"Salvar preferências"})]})]})}),e.jsx(Ie,{open:!!n,onOpenChange:()=>F(null),children:e.jsxs($e,{children:[e.jsxs(Ge,{children:[e.jsx(We,{children:"Excluir Refeição"}),e.jsx(Be,{children:"Deseja realmente excluir esta refeição? Esta ação não pode ser desfeita."})]}),e.jsxs(Ue,{children:[e.jsx(Ye,{children:"Cancelar"}),e.jsx(Ve,{onClick:_e,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]})}export{ia as default};
