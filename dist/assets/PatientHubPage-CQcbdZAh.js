import{q as Q,u as Ne,r as u,j as e,C as y,e as C,B as w,U as ve,F as De,b as G,$ as F,a0 as Ee,a1 as we,a2 as Le,c as D,d as R,L as $,a3 as me,a4 as se,s as B,a as Re,Q as Te,X as Fe,w as te,a5 as $e,a6 as Be,g as xe}from"./index-BvWB-6Y-.js";import{T as ze,a as Ge,b as U,c as V}from"./tabs-CA5k0aJI.js";import{m as qe,n as He}from"./patient-queries-DNM8Wnzg.js";import{B as L}from"./badge-CCK5Bs0D.js";import{P as We}from"./pen-square-OCV3PTXs.js";import{M as Ue}from"./mail-DLM9pvGg.js";import{P as Ve,M as Ke}from"./phone-BA7HxFMm.js";import{C as q}from"./calendar-BxLBJTLY.js";import{W as ye}from"./weight-CyN5bFNH.js";import{A as X}from"./activity-CbrTkNiD.js";import{T as K}from"./target-Bs9FM_-p.js";import{d as Je}from"./differenceInYears-DWhJUupZ.js";import{p as Ce}from"./pt-BR-BMtVLtF7.js";import{P as Ye}from"./progress-Di_AUcQX.js";import{F as J}from"./file-text-CyOxrREb.js";import{B as Z,R as Ze}from"./refresh-cw-DBLq2CV4.js";import{C as H}from"./calculator-CBQEutXX.js";import{U as z}from"./utensils-CLVAb11L.js";import{C as ae}from"./check-circle-2-DqvAHxH6.js";import{A as P}from"./arrow-right-BKyQx75l.js";import{S as he,a as ue,b as fe,c as ge,d as T}from"./select-CHitR1r5.js";import{F as Qe}from"./filter-DzB1LpgZ.js";import{s as Xe}from"./subMonths-eleCAaEd.js";import{M as Oe}from"./message-square-d4PysXqo.js";import{f as Ie}from"./formatDistanceToNow-DnOJpndx.js";import{C as es}from"./clock-BDxmKYor.js";import{F as W}from"./flame-DbwLYwhx.js";import{g as ss}from"./anamnesis-queries-CYDtzKhB.js";import{g as ts}from"./lab-results-queries-B3ZMjFH4.js";import{l as re}from"./query-helpers-mbysFH2_.js";import{A as ie}from"./alert-circle-HzKGSyQg.js";import{D as I}from"./droplet-BdKopZMO.js";import{T as _e}from"./trending-down-Be-17Tpn.js";import{T as ne}from"./trending-up-DCN4wKoA.js";import{R as as}from"./ruler-CYjLqm7s.js";import{C as ee}from"./camera-Bs6Kqlhh.js";import{getActiveMealPlan as rs}from"./meal-plan-queries-CiET4OPt.js";import{c as is,g as ns}from"./food-diary-queries-Q2rJq5H2.js";import{A as Ae,a as ke}from"./alert-BZscs13a.js";import{g as ls,a as os,b as cs}from"./goals-queries-C9WNr4yF.js";import{S as ds}from"./scale-B02K6JBe.js";import{a as M,S as ms}from"./skeleton-Dirg_Jda.js";import{A as pe}from"./arrow-left-c5Ho3YFj.js";import{H as xs}from"./heart-BUdr-wPX.js";import"./mealTranslations-B1KHhmEq.js";import"./observability-queries-BxbsnaqH.js";import"./compareAsc-BbDmGHdd.js";import"./extends-CF3RwP-h.js";import"./addMonths-hOFFPW3g.js";import"./constructNow-BDnuN8eJ.js";import"./endOfMonth-Ca9QmV5D.js";import"./date-C2sroe8F.js";import"./nutrition-calculations-DjYFS08l.js";const be=Q("BookHeart",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}],["path",{d:"M16 8.2C16 7 15 6 13.8 6c-.8 0-1.4.3-1.8.9-.4-.6-1-.9-1.8-.9C9 6 8 7 8 8.2c0 .6.3 1.2.7 1.6h0C10 11.1 12 13 12 13s2-1.9 3.3-3.1h0c.4-.4.7-1 .7-1.7z",key:"1dlbw1"}]]),hs=Q("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),us=Q("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]]),fs=Q("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),gs=s=>{const{user:c}=Ne(),[i,t]=u.useState(!0),[r,d]=u.useState(null),[n,f]=u.useState(null),[j,b]=u.useState(null),[p,x]=u.useState({}),[l,o]=u.useState([]),[g,a]=u.useState(!1),m=u.useCallback(async()=>{if(!(!s||!c?.id)){t(!0),d(null);try{const{data:v,error:E}=await qe(s,c.id);if(E)throw E;v?(f(v.profile),b(v.metrics),x(v.modulesStatus)):d(new Error("Paciente n√£o encontrado"))}catch(v){console.error("Erro ao carregar resumo do paciente:",v),d(v),f(null)}finally{t(!1)}}},[s,c?.id]),k=u.useCallback(async()=>{if(s){a(!0);try{const{data:v,error:E}=await He(s,100);if(E)throw E;o(v||[])}catch(v){console.error("Erro ao carregar atividades:",v),o([])}finally{a(!1)}}},[s]),A=u.useCallback(async()=>{await Promise.all([m(),k()])},[m,k]);return u.useEffect(()=>{m()},[m]),u.useEffect(()=>{n&&k()},[n,k]),{loading:i,error:r,patientData:n,latestMetrics:j,modulesStatus:p,activities:l,activitiesLoading:g,refresh:A,loadActivities:k}},ps=({patientData:s,latestMetrics:c,onEditProfile:i,onOpenChat:t,onScheduleAppointment:r})=>{const d=a=>{if(!a)return null;try{const m=new Date(a);return m.setHours(m.getHours()+4),Je(new Date,m)}catch{return null}},n=(a,m)=>{if(!a||!m||m===0)return null;const k=m/100;return(a/(k*k)).toFixed(1)},f=a=>a?a<18.5?{label:"Abaixo do peso",variant:"destructive"}:a<25?{label:"Peso normal",variant:"success"}:a<30?{label:"Sobrepeso",variant:"warning"}:{label:"Obesidade",variant:"destructive"}:{label:"N/A",variant:"secondary"},j=a=>{if(!a)return"N√£o informado";try{return De(new Date(a),"dd/MM/yyyy",{locale:Ce})}catch{return"Data inv√°lida"}},b=a=>{if(!a)return"N√£o informado";const m=a.replace(/\D/g,"");return m.length===11?`(${m.slice(0,2)}) ${m.slice(2,7)}-${m.slice(7)}`:a},p=a=>{if(!a)return null;if(typeof a=="string")return a;const m=[];return a.street&&m.push(a.street),a.number&&m.push(a.number),a.neighborhood&&m.push(a.neighborhood),a.city&&m.push(a.city),a.state&&m.push(a.state),a.zipcode&&m.push(a.zipcode),m.length>0?m.join(", "):null},x=a=>a?{lose:"Perder Peso",gain:"Ganhar Peso",maintain:"Manter Peso",muscle:"Ganhar Massa Muscular",health:"Sa√∫de e Bem-estar"}[a.toLowerCase()]||a:"N√£o definido",l=d(s?.birth_date),o=n(c?.weight,c?.height),g=f(o);return e.jsx(y,{className:"bg-card shadow-lg border-border relative",children:e.jsxs(C,{className:"p-6",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:i,className:"md:hidden absolute top-4 right-4 h-8 w-8 rounded-full hover:bg-primary/10",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-6",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-24 h-24 bg-secondary rounded-full flex items-center justify-center font-bold text-primary overflow-hidden border-4 border-primary/20",children:s?.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx(ve,{className:"w-12 h-12 text-primary/70"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2 pr-10",children:s?.name||"Paciente"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:s?.email||"N√£o informado"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:b(s?.phone)})]}),p(s?.address)&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground md:col-span-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:p(s.address)})]})]})]}),e.jsxs("div",{className:"hidden md:flex flex-row gap-2 items-start",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:i,className:"whitespace-nowrap",children:"Editar Perfil"}),e.jsx(w,{variant:"outline",size:"sm",onClick:t,className:"whitespace-nowrap",children:"Abrir Chat"}),e.jsx(w,{variant:"default",size:"sm",onClick:r,className:"whitespace-nowrap",children:"Agendar Consulta"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Idade"})]}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:l?`${l} anos`:"N/A"})]}),e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Peso Atual"})]}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:c?.weight?`${c.weight} kg`:"N/A"})]}),e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(X,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"IMC"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xl font-bold text-foreground",children:o||"N/A"}),o&&e.jsx(L,{variant:g.variant,className:"text-xs",children:g.label})]})]}),e.jsxs("div",{className:"bg-background p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Objetivo"})]}),e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:x(s?.goal)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-background p-3 rounded-lg border border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Paciente desde"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:j(s?.created_at)})]}),e.jsxs("div",{className:"bg-background p-3 rounded-lg border border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"√öltima consulta"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:c?.last_appointment||"Sem registro"})]}),e.jsxs("div",{className:"bg-background p-3 rounded-lg border border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Pr√≥xima consulta"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:c?.next_appointment||"N√£o agendada"})]})]}),e.jsxs("div",{className:"flex md:hidden flex-row gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:t,className:"flex-1",children:"Abrir Chat"}),e.jsx(w,{variant:"default",size:"sm",onClick:r,className:"flex-1",children:"Agendar"})]})]})})},bs=({patientId:s,modulesStatus:c={},latestMetrics:i={}})=>{const t=G(),[r,d]=u.useState(!1),n=[{id:"anamnesis",title:"Anamnese",description:"Hist√≥rico cl√≠nico e alergias",icon:J,isComplete:c.anamnese==="completed",route:`/nutritionist/patients/${s}/anamnese`},{id:"anthropometry",title:"Avalia√ß√£o Antropom√©trica",description:"Peso, altura e medidas",icon:Z,isComplete:c.anthropometry==="completed",route:`/nutritionist/patients/${s}/anthropometry`},{id:"energy_calculation",title:"C√°lculo de Necessidades",description:"VET e distribui√ß√£o de macros",icon:H,isComplete:c.energy_expenditure==="completed",route:`/nutritionist/patients/${s}/energy-expenditure`},{id:"diet_plan",title:"Plano Alimentar",description:"Prescri√ß√£o diet√©tica vigente",icon:z,isComplete:c.meal_plan==="completed",route:`/nutritionist/patients/${s}/meal-plan`}],f=n.filter(l=>l.isComplete).length,j=n.length,b=Math.round(f/j*100),p=f===j,x=n.find(l=>!l.isComplete);return p?null:r?e.jsxs("div",{className:"bg-gradient-to-r from-[#fefae0]/70 via-[#f9ebc7]/60 to-[#fefae0]/70 border border-[#a9b388]/40 rounded-lg shadow-md overflow-hidden",children:[e.jsxs("button",{onClick:()=>d(!1),className:"w-full text-left px-3 sm:px-4 py-2.5 sm:py-3 flex items-center justify-between hover:bg-[#a9b388]/10 transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsx("div",{className:"w-2 h-2 bg-[#5f6f52] rounded-full flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-sm font-bold text-[#5f6f52] truncate",children:"Guia de Atendimento"}),e.jsx("p",{className:"text-[10px] text-gray-600 mt-0.5 truncate",children:"Siga estas etapas para avalia√ß√£o completa"})]})]}),e.jsx(Le,{className:"w-4 h-4 text-gray-400 group-hover:text-[#5f6f52] transition-colors flex-shrink-0"})]}),e.jsx("div",{className:"px-3 sm:px-4 pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 relative h-1.5 rounded-full overflow-hidden bg-gradient-to-r from-gray-100 to-gray-200 shadow-inner",children:e.jsx("div",{className:"absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-[#5f6f52] via-[#6d7e5f] to-[#7a8d6c] transition-all duration-700",style:{width:`${b}%`}})}),e.jsxs("span",{className:"text-[10px] font-bold text-gray-700 min-w-[2.5rem] text-right",children:[b,"%"]})]})}),e.jsx("div",{className:"px-3 sm:px-4 pb-3 sm:pb-4 space-y-2",children:n.map((l,o)=>{const g=l.icon,a=l.id===x?.id;return e.jsxs("div",{className:F("flex items-center gap-2 sm:gap-3 p-2.5 sm:p-3 rounded-lg transition-all duration-300","border",l.isComplete?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300 shadow-sm":a?"bg-white border-[#c4661f] shadow-sm ring-1 ring-[#c4661f]/20":"bg-white/60 border-gray-200 hover:border-gray-300"),children:[e.jsx("div",{className:F("w-8 h-8 sm:w-9 sm:h-9 rounded-lg flex items-center justify-center flex-shrink-0 transition-all","border",l.isComplete?"bg-gradient-to-br from-green-400 to-emerald-500 border-green-500 shadow-md":a?"bg-gradient-to-br from-[#c4661f] to-[#d4764f] border-[#c4661f] shadow-sm":"bg-gray-100 border-gray-300"),children:l.isComplete?e.jsx(ae,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white",strokeWidth:2.5}):e.jsx(g,{className:F("w-3.5 h-3.5 sm:w-4 sm:h-4",a?"text-white":"text-gray-500")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5 flex-wrap",children:[e.jsxs("span",{className:F("text-[9px] sm:text-[10px] font-bold px-1.5 py-0.5 rounded",l.isComplete?"bg-green-100 text-green-700":a?"bg-orange-100 text-[#c4661f]":"bg-gray-100 text-gray-600"),children:["ETAPA ",o+1]}),l.isComplete&&e.jsx("span",{className:"text-[9px] sm:text-[10px] font-semibold text-green-600",children:"‚úì Conclu√≠da"}),a&&!l.isComplete&&e.jsx("span",{className:"text-[9px] sm:text-[10px] font-semibold text-[#c4661f] animate-pulse",children:"‚Ä¢ Pendente"})]}),e.jsx("h4",{className:F("text-xs sm:text-sm font-bold mb-0.5 truncate",l.isComplete?"text-green-800":"text-gray-800"),children:l.title}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 truncate",children:l.description})]}),e.jsxs("div",{className:"flex-shrink-0",children:[a&&!l.isComplete&&e.jsxs(w,{size:"sm",onClick:()=>t(l.route),className:F("h-7 sm:h-8 px-2 sm:px-3 text-[10px] sm:text-xs font-semibold","bg-gradient-to-r from-[#5f6f52] to-[#6d7e5f] hover:from-[#4a5841] hover:to-[#5f6f52]","shadow-sm hover:shadow-md transition-all"),children:[e.jsx("span",{className:"hidden sm:inline",children:"Iniciar"}),e.jsx("span",{className:"sm:hidden",children:"‚ñ∂"}),e.jsx(P,{className:"ml-0.5 sm:ml-1 w-3 h-3 hidden sm:inline"})]}),l.isComplete&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>t(l.route),className:"h-7 sm:h-8 px-2 sm:px-3 text-[10px] sm:text-xs font-medium border-green-300 text-green-700 hover:bg-green-50",children:[e.jsx("span",{className:"hidden sm:inline",children:"Revisar"}),e.jsx("span",{className:"sm:hidden",children:"‚Üª"})]})]})]},l.id)})})]}):e.jsxs("button",{onClick:()=>d(!0),className:F("w-full text-left transition-all duration-300","bg-gradient-to-r from-[#fefae0]/70 via-[#f9ebc7]/60 to-[#fefae0]/70","border border-[#a9b388]/40 rounded-lg","hover:shadow-md hover:border-[#a9b388]/60 hover:scale-[1.005]","px-3 sm:px-4 py-2.5 sm:py-3 flex items-center gap-2 sm:gap-3","group"),children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"relative w-2 h-2",children:[e.jsx("div",{className:"absolute inset-0 bg-[#5f6f52] rounded-full animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-[#5f6f52] rounded-full animate-ping opacity-40"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 min-w-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("span",{className:"text-sm font-bold text-[#5f6f52] truncate",children:"Jornada Cl√≠nica"}),e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-[#a9b388]/20 text-[10px] sm:text-xs font-semibold text-[#5f6f52] border border-[#a9b388]/30 whitespace-nowrap",children:[f,"/",j]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 relative h-2 rounded-full overflow-hidden bg-gradient-to-r from-gray-100 to-gray-200 shadow-inner",children:e.jsx("div",{className:"absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-[#5f6f52] via-[#6d7e5f] to-[#7a8d6c] shadow-sm transition-all duration-700 ease-out",style:{width:`${b}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})}),e.jsxs("span",{className:"text-xs font-bold text-[#5f6f52] min-w-[2rem] text-right",children:[b,"%"]})]})]}),x&&e.jsxs("div",{className:"hidden lg:flex items-center gap-1.5 px-2 py-1 rounded-md bg-white/60 border border-[#a9b388]/30",children:[e.jsx(Ee,{className:"w-2.5 h-2.5 text-[#c4661f] fill-[#c4661f]"}),e.jsx("span",{className:"text-[10px] text-gray-600",children:"Pr√≥ximo:"}),e.jsx("span",{className:"text-[10px] font-semibold text-[#5f6f52] truncate max-w-[100px]",children:x.title})]}),e.jsx(we,{className:"w-4 h-4 text-gray-400 group-hover:text-[#5f6f52] transition-colors flex-shrink-0"})]})]})},js=({activity:s})=>{const c=t=>{switch(t){case"meal":return e.jsx(z,{className:"w-4 h-4 text-[#c4661f]"});case"weight":return e.jsx(ye,{className:"w-4 h-4 text-[#5f6f52]"});case"achievement":return e.jsx(se,{className:"w-4 h-4 text-[#b99470]"});case"appointment":return e.jsx(q,{className:"w-4 h-4 text-[#783d19]"});case"message":return e.jsx(Oe,{className:"w-4 h-4 text-[#a9b388]"});case"anamnese":return e.jsx(J,{className:"w-4 h-4 text-[#5f6f52]"});default:return e.jsx(J,{className:"w-4 h-4 text-muted-foreground"})}},i=t=>{try{return Ie(new Date(t),{addSuffix:!0,locale:Ce})}catch{return"Data inv√°lida"}};return e.jsxs("div",{className:"flex gap-3 p-3 hover:bg-muted/50 rounded-lg transition-colors cursor-pointer group",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"p-2 rounded-full bg-background border border-border group-hover:border-primary/50 transition-colors",children:c(s.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground group-hover:text-primary transition-colors",children:s.title}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:i(s.timestamp)})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description}),s.metadata&&s.metadata.length>0&&e.jsx("div",{className:"flex gap-2 mt-2 flex-wrap",children:s.metadata.map((t,r)=>e.jsx(L,{variant:"outline",className:"text-xs",children:t},r))})]})]})},Ns=({patientId:s,activities:c=[],loading:i=!1,onLoadMore:t,onFilterChange:r})=>{const[d,n]=u.useState("all"),[f,j]=u.useState("all"),[b,p]=u.useState(10),l=(()=>{let A=[...c];if(d!=="all"&&(A=A.filter(v=>v.type===d)),f!=="all"){const v=new Date;let E;switch(f){case"7d":E=me(v,7);break;case"30d":E=me(v,30);break;case"3m":E=Xe(v,3);break;default:E=null}E&&(A=A.filter(Y=>new Date(Y.timestamp)>=E))}return A})(),o=l.slice(0,b),g=l.length>b;u.useEffect(()=>{p(10)},[d,f]),u.useEffect(()=>{r&&r({type:d,period:f})},[d,f,r]);const a=A=>{n(A)},m=A=>{j(A)},k=()=>{p(A=>A+10)};return e.jsxs(y,{className:"bg-card shadow-lg border-border",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx(R,{className:"text-xl font-bold text-foreground",children:"Feed de Atividades"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[l.length," ",l.length===1?"atividade":"atividades",f!=="all"&&` nos √∫ltimos ${f==="7d"?"7 dias":f==="30d"?"30 dias":"3 meses"}`]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(he,{value:d,onValueChange:a,children:[e.jsxs(ue,{className:"flex-1 md:w-[140px] h-9",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),e.jsx(fe,{placeholder:"Tipo"})]}),e.jsxs(ge,{children:[e.jsx(T,{value:"all",children:"Todos"}),e.jsx(T,{value:"meal",children:"Refei√ß√µes"}),e.jsx(T,{value:"weight",children:"Peso"}),e.jsx(T,{value:"achievement",children:"Conquistas"}),e.jsx(T,{value:"appointment",children:"Consultas"}),e.jsx(T,{value:"message",children:"Mensagens"}),e.jsx(T,{value:"anamnese",children:"Anamnese"})]})]}),e.jsxs(he,{value:f,onValueChange:m,children:[e.jsx(ue,{className:"flex-1 md:w-[120px] h-9",children:e.jsx(fe,{placeholder:"Per√≠odo"})}),e.jsxs(ge,{children:[e.jsx(T,{value:"all",children:"Tudo"}),e.jsx(T,{value:"7d",children:"7 dias"}),e.jsx(T,{value:"30d",children:"30 dias"}),e.jsx(T,{value:"3m",children:"3 meses"})]})]})]})]})}),e.jsx(C,{children:i?e.jsxs("div",{className:"flex flex-col justify-center items-center py-12",children:[e.jsx($,{className:"w-8 h-8 animate-spin text-primary mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando atividades..."})]}):o.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-1 divide-y divide-border",children:o.map(A=>e.jsx(js,{activity:A},A.id))}),g&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(w,{variant:"outline",onClick:k,className:"w-full md:w-auto",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Carregar Mais (",l.length-b," restantes)"]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-12 h-12 text-muted-foreground/50 mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground font-medium mb-1",children:"Nenhuma atividade encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d!=="all"||f!=="all"?"Tente ajustar os filtros acima":"Este paciente ainda n√£o possui atividades registradas"})]})})]})},vs=({patientId:s,activities:c,loading:i,onLoadMore:t})=>{const r=G(),[d,n]=u.useState([]),[f,j]=u.useState(!0);u.useEffect(()=>{(async()=>{if(s){j(!0);try{const{data:g,error:a}=await B.from("meal_audit_log").select("id, action, meal_type, meal_date, meal_time, details, created_at").eq("patient_id",s).order("created_at",{ascending:!1}).limit(4);if(a)throw a;n(g||[])}catch(g){console.error("Erro ao buscar refei√ß√µes:",g),n([])}finally{j(!1)}}})()},[s]);const b=o=>({breakfast:"Caf√© da Manh√£",morning_snack:"Lanche da Manh√£",lunch:"Almo√ßo",afternoon_snack:"Lanche da Tarde",dinner:"Jantar",supper:"Ceia"})[o]||o,p=o=>({create:"Registrado",update:"Editado",delete:"Deletado"})[o]||o,x=o=>({create:"bg-[#5f6f52]",update:"bg-blue-600",delete:"bg-red-600"})[o]||"bg-gray-600",l=()=>e.jsxs(y,{className:"border-l-4 border-l-[#b99470] bg-gradient-to-br from-[#fefae0]/30 to-[#f9ebc7]/20",children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(R,{className:"text-base flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-[#b99470]"}),"Di√°rio Alimentar"]}),e.jsxs(w,{variant:"ghost",size:"sm",onClick:()=>r(`/nutritionist/patients/${s}/food-diary`),className:"h-7 text-xs text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:["Ver tudo",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"√öltimos registros"})]}),e.jsx(C,{className:"space-y-2",children:f?e.jsxs("div",{className:"text-center py-6",children:[e.jsx($,{className:"w-6 h-6 animate-spin text-[#5f6f52] mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carregando..."})]}):d.length>0?e.jsxs(e.Fragment,{children:[d.map(o=>{const g=new Date(o.created_at),a=o.details?.total_calories||0;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-[#fefae0]/50 hover:bg-[#fefae0] transition-colors border border-[#a9b388]/20",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:b(o.meal_type)}),e.jsx(L,{className:`${x(o.action)} text-white text-xs`,children:p(o.action)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(es,{className:"w-3 h-3"}),e.jsx("span",{children:g.toLocaleDateString("pt-BR")}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{children:g.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsx("div",{className:"text-right ml-2 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:"text-sm font-bold text-[#5f6f52]",children:a})]})})]},o.id)}),e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>r(`/nutritionist/patients/${s}/food-diary`),className:"w-full mt-2 border-[#5f6f52] text-[#5f6f52] hover:bg-[#5f6f52]/10",children:["Ver di√°rio completo",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground/40 mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Nenhuma refei√ß√£o registrada"}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>r(`/nutritionist/patients/${s}/food-diary`),className:"text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10 text-xs",children:"Abrir Di√°rio Alimentar"})]})})]});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Ns,{patientId:s,activities:c,loading:i,onLoadMore:t})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(l,{})})]})},Se="pending",je=async({nutritionistId:s,patientId:c=null,status:i=null,limit:t=30})=>{try{let r=B.from("clinical_recommendations").select("*").eq("nutritionist_id",s).order("created_at",{ascending:!1}).limit(t);c&&(r=r.eq("patient_id",c)),i&&(r=r.eq("status",i));const{data:d,error:n}=await r;if(n)throw n;return{data:d||[],error:null}}catch(r){return re("Erro ao buscar recomenda√ß√µes cl√≠nicas",r),{data:[],error:r}}},ws=async({nutritionistId:s,patientId:c,recommendationKey:i,title:t,recommendationText:r,rationale:d,confidenceScore:n=null,sourceModule:f="copilot_v1",inputSnapshot:j={},outputSnapshot:b={},metadata:p={}})=>{try{const{data:x,error:l}=await B.from("clinical_recommendations").insert([{nutritionist_id:s,patient_id:c,recommendation_key:i,source_module:f,title:t,recommendation_text:r,rationale:d,confidence_score:n,input_snapshot:j&&typeof j=="object"?j:{},output_snapshot:b&&typeof b=="object"?b:{},metadata:p&&typeof p=="object"?p:{},status:Se}]).select().single();if(l)throw l;return{data:x,error:null}}catch(x){return re("Erro ao criar recomenda√ß√£o cl√≠nica",x),{data:null,error:x}}},le=async({recommendationId:s,status:c,actorUserId:i=null,metadata:t={}})=>{try{const r=["pending","accepted","dismissed","applied"].includes(c)?c:Se,{data:d,error:n}=await B.from("clinical_recommendations").select("metadata, accepted_by, accepted_at").eq("id",s).maybeSingle();if(n)throw n;const f={...d?.metadata&&typeof d.metadata=="object"?d.metadata:{},...t&&typeof t=="object"?t:{}},j={status:r,metadata:f};r==="accepted"&&(j.accepted_by=i||null,j.accepted_at=new Date().toISOString()),r==="applied"&&(j.applied_at=new Date().toISOString(),d?.accepted_by||(j.accepted_by=i||d?.accepted_by||null),d?.accepted_at||(j.accepted_at=new Date().toISOString()));const{data:b,error:p}=await B.from("clinical_recommendations").update(j).eq("id",s).select().single();if(p)throw p;return{data:b,error:null}}catch(r){return re("Erro ao atualizar status da recomenda√ß√£o cl√≠nica",r),{data:null,error:r}}},ys=async({recommendationId:s,actorUserId:c=null,metadata:i={}})=>le({recommendationId:s,status:"accepted",actorUserId:c,metadata:i}),Cs=async({recommendationId:s,actorUserId:c=null,metadata:i={}})=>le({recommendationId:s,status:"dismissed",actorUserId:c,metadata:i}),_s=async({recommendationId:s,actorUserId:c=null,metadata:i={}})=>le({recommendationId:s,status:"applied",actorUserId:c,metadata:i}),As=({patientId:s,modulesStatus:c={}})=>{const i=G(),{user:t}=Ne(),{toast:r}=Re(),[d,n]=u.useState(null),[f,j]=u.useState(!0),[b,p]=u.useState([]),[x,l]=u.useState(!0),[o,g]=u.useState([]),[a,m]=u.useState(!0),[k,A]=u.useState(null);u.useEffect(()=>{const h=async()=>{if(s){j(!0);try{const{data:N}=await ss(s);n(N)}catch(N){console.error("Erro ao buscar anamnese:",N)}finally{j(!1)}}},_=async()=>{if(s){l(!0);try{const{data:N}=await ts(s);p(N||[])}catch(N){console.error("Erro ao buscar exames:",N),p([])}finally{l(!1)}}};h(),_()},[s]),u.useEffect(()=>{(async()=>{if(!(!s||!t?.id)){m(!0);try{const{data:_,error:N}=await je({nutritionistId:t.id,patientId:s,limit:10});if(N)throw N;g(_||[])}catch(_){console.error("Erro ao buscar recomenda√ß√µes cl√≠nicas:",_),g([])}finally{m(!1)}}})()},[s,t?.id]);const v=h=>{const _={pending:{label:"Pendente",className:"bg-amber-100 text-amber-800 border-amber-300"},accepted:{label:"Aceita",className:"bg-sky-100 text-sky-800 border-sky-300"},dismissed:{label:"Descartada",className:"bg-gray-100 text-gray-800 border-gray-300"},applied:{label:"Aplicada",className:"bg-emerald-100 text-emerald-800 border-emerald-300"}};return _[h]||_.pending},E=()=>{const h=(b||[]).filter(N=>N.status==="high"),_=(b||[]).filter(N=>N.status==="low");if(h.length>0){const N=h.slice(0,2).map(S=>S.test_name).filter(Boolean).join(", ");return{recommendationKey:"lab_risk_followup",title:"Priorizar follow-up de risco laboratorial",recommendationText:"Agendar retorno curto e revisar plano alimentar com foco em normaliza√ß√£o dos marcadores alterados.",rationale:`Foram identificados exames acima da refer√™ncia${N?` (${N})`:""}. A interven√ß√£o precoce reduz risco de piora cl√≠nica.`,confidenceScore:.9,inputSnapshot:{high_count:h.length,low_count:_.length,latest_labs:h.slice(0,3).map(S=>({id:S.id,test_name:S.test_name,status:S.status,test_date:S.test_date})),modules_status:c||{}},outputSnapshot:{action_type:"followup_priority",suggested_route:`/nutritionist/patients/${s}/lab-results`}}}return d?c?.meal_plan!=="completed"?{recommendationKey:"meal_plan_completion",title:"Concluir plano alimentar com metas atuais",recommendationText:"Finalizar um plano alimentar ativo com distribui√ß√£o de macros alinhada ao cen√°rio cl√≠nico atual.",rationale:"A aus√™ncia de plano completo reduz ader√™ncia e dificulta acompanhamento de evolu√ß√£o nutricional.",confidenceScore:.82,inputSnapshot:{meal_plan_status:c?.meal_plan||"not_started",modules_status:c||{}},outputSnapshot:{action_type:"complete_meal_plan",suggested_route:`/nutritionist/patients/${s}/meal-plan`}}:{recommendationKey:"routine_monitoring",title:"Manter monitoramento cl√≠nico e ades√£o",recommendationText:"Manter plano atual e reavaliar indicadores em janela de acompanhamento curto.",rationale:"Sem alertas cr√≠ticos imediatos, o foco √© consist√™ncia de ades√£o e monitoramento peri√≥dico.",confidenceScore:.68,inputSnapshot:{has_anamnesis:!!d,labs_count:b.length,modules_status:c||{}},outputSnapshot:{action_type:"monitoring",suggested_route:`/nutritionist/patients/${s}/hub`}}:{recommendationKey:"anamnesis_missing",title:"Completar anamnese para base cl√≠nica",recommendationText:"Registrar anamnese completa antes de ajustes avan√ßados para maior seguran√ßa na conduta.",rationale:"Sem anamnese consolidada, aumenta o risco de decis√µes sem contexto cl√≠nico suficiente.",confidenceScore:.96,inputSnapshot:{has_anamnesis:!1,modules_status:c||{}},outputSnapshot:{action_type:"collect_context",suggested_route:`/nutritionist/patients/${s}/anamnese`}}},Y=async()=>{if(!s||!t?.id)return;const{data:h,error:_}=await je({nutritionistId:t.id,patientId:s,limit:10});_||g(h||[])},oe=async()=>{if(!(!t?.id||!s)){A("generate");try{const h=E(),{error:_}=await ws({nutritionistId:t.id,patientId:s,recommendationKey:h.recommendationKey,title:h.title,recommendationText:h.recommendationText,rationale:h.rationale,confidenceScore:h.confidenceScore,inputSnapshot:h.inputSnapshot,outputSnapshot:h.outputSnapshot,metadata:{source:"copilot_v1_rule_based"}});if(_)throw _;await Y(),r({title:"Recomenda√ß√£o criada",description:"O copiloto gerou uma recomenda√ß√£o explic√°vel para avalia√ß√£o manual.",variant:"success"})}catch(h){console.error("Erro ao gerar recomenda√ß√£o cl√≠nica:",h),r({title:"Erro ao gerar recomenda√ß√£o",description:"N√£o foi poss√≠vel gerar a recomenda√ß√£o agora.",variant:"destructive"})}finally{A(null)}}},O=async(h,_)=>{if(!(!h?.id||!t?.id)){A(`${_}-${h.id}`);try{let N=null;if(_==="accept"?N=await ys({recommendationId:h.id,actorUserId:t.id}):_==="dismiss"?N=await Cs({recommendationId:h.id,actorUserId:t.id}):_==="apply"&&(N=await _s({recommendationId:h.id,actorUserId:t.id})),N?.error)throw N.error;await Y()}catch(N){console.error("Erro ao atualizar recomenda√ß√£o cl√≠nica:",N),r({title:"Erro de atualiza√ß√£o",description:"N√£o foi poss√≠vel atualizar o status da recomenda√ß√£o.",variant:"destructive"})}finally{A(null)}}},Pe=()=>{const h=!f&&d;if(f)return e.jsx(y,{className:"border-l-4 border-l-[#a9b388] h-full",children:e.jsx(C,{className:"py-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando anamnese..."})})});if(!h)return e.jsx(y,{className:"border-l-4 border-l-[#c4661f] bg-[#fefae0]/30 hover:shadow-md transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/anamnese`),children:e.jsx(C,{className:"py-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center flex-shrink-0",children:e.jsx(ie,{className:"w-6 h-6 text-[#c4661f]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Anamnese"}),e.jsx(L,{className:"bg-[#fefae0] text-[#c4661f] border-[#c4661f]",children:"Pendente"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Hist√≥rico cl√≠nico ainda n√£o registrado. Complete a anamnese para identificar alergias, condi√ß√µes de sa√∫de e medica√ß√µes em uso."}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#c4661f]",children:[e.jsx(J,{className:"w-4 h-4"}),"Iniciar Anamnese",e.jsx(P,{className:"w-4 h-4"})]})]})]})})});const _={draft:{label:"Rascunho",color:"bg-yellow-100 text-yellow-800 border-yellow-300"},completed:{label:"Completa",color:"bg-[#a9b388]/20 text-[#5f6f52] border-[#5f6f52]"}},N=_[d.status]||_.draft;return e.jsxs(y,{className:"border-l-4 border-l-[#5f6f52] hover:shadow-xl transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/anamnese`),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-lg",children:"Anamnese"}),e.jsx(L,{variant:"outline",className:N.color,children:N.label})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"bg-[#fefae0] border border-[#a9b388] rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-xs font-semibold text-[#5f6f52] mb-1 uppercase tracking-wide",children:"üìã Documento"}),e.jsx("p",{className:"text-sm text-foreground",children:d.template?.title||"Anamnese Nutricional"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-3 mt-3 border-t",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),"Registrada em: ",new Date(d.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})]}),e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 text-[#5f6f52] hover:bg-[#5f6f52]/10",onClick:()=>i(`/nutritionist/patients/${s}/anamnesis`),children:["Abrir ",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})]})]})},Me=()=>{if(x)return e.jsx(y,{className:"border-l-4 border-l-[#b99470] h-full",children:e.jsxs(C,{className:"py-8 text-center",children:[e.jsx($,{className:"w-6 h-6 animate-spin text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando exames..."})]})});if(!(b&&b.length>0))return e.jsx(y,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 hover:shadow-md transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/lab-results`),children:e.jsxs(C,{className:"py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(I,{className:"w-6 h-6 text-[#b99470]"})}),e.jsx("h3",{className:"text-base font-semibold text-foreground mb-2",children:"Exames Laboratoriais"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm mx-auto",children:"Nenhum exame registrado. Adicione resultados de an√°lises cl√≠nicas para um acompanhamento mais completo."}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#b99470]",children:[e.jsx(I,{className:"w-4 h-4"}),"Adicionar Exames",e.jsx(P,{className:"w-4 h-4"})]})]})});const _=b.slice(0,3),N=b[0]?.test_date;return e.jsxs(y,{className:"border-l-4 border-l-[#b99470] hover:shadow-xl transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/lab-results`),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-[#b99470]"}),e.jsx(R,{className:"text-base",children:"Exames Laboratoriais"})]})}),e.jsxs(C,{children:[e.jsx("div",{className:"space-y-2 mb-3",children:_.map(S=>e.jsxs("div",{className:F("flex items-center justify-between p-3 rounded-lg border",S.status==="normal"?"bg-emerald-50 border-emerald-200":S.status==="low"?"bg-amber-50 border-amber-200":S.status==="high"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:S.test_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[S.test_value," ",S.test_unit||""]})]}),e.jsx(L,{variant:"outline",className:F("text-xs ml-2",S.status==="normal"?"bg-emerald-100 text-emerald-800 border-emerald-300":S.status==="low"?"bg-amber-100 text-amber-800 border-amber-300":S.status==="high"?"bg-red-100 text-red-800 border-red-300":"bg-gray-100 text-gray-800 border-gray-300"),children:S.status==="normal"?"Normal":S.status==="low"?"Baixo":S.status==="high"?"Alto":"Pendente"})]},S.id))}),e.jsxs("div",{className:"text-xs text-muted-foreground pt-3 border-t flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),N&&`√öltimos exames: ${new Date(N).toLocaleDateString("pt-BR")}`,!N&&"Nenhum exame recente"]}),e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 text-[#b99470] hover:bg-[#b99470]/10",onClick:()=>i(`/nutritionist/patients/${s}/lab-results`),children:["Abrir ",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})]})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-1",children:"Dados Cl√≠nicos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hist√≥rico de sa√∫de e exames laboratoriais"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Pe,{}),e.jsx(Me,{})]}),e.jsxs(y,{className:"border-l-4 border-l-[#5f6f52]",children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"text-lg flex items-center gap-2",children:[e.jsx(hs,{className:"w-5 h-5 text-[#5f6f52]"}),"Copiloto Cl√≠nico v1"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Recomenda√ß√µes explic√°veis com aceite manual obrigat√≥rio."})]}),e.jsxs(w,{size:"sm",onClick:oe,disabled:k==="generate",className:"shrink-0",children:[k==="generate"?e.jsx($,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(fs,{className:"w-4 h-4 mr-2"}),"Gerar recomenda√ß√£o"]})]})}),e.jsx(C,{children:a?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"Carregando recomenda√ß√µes..."}):o.length===0?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"Nenhuma recomenda√ß√£o registrada ainda para este paciente."}):e.jsx("div",{className:"space-y-3",children:o.map(h=>{const _=v(h.status),N=k,S=N===`accept-${h.id}`,ce=N===`dismiss-${h.id}`,de=N===`apply-${h.id}`;return e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:h.title}),e.jsx(L,{variant:"outline",className:_.className,children:_.label})]}),e.jsx("p",{className:"text-sm text-foreground",children:h.recommendation_text}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Justificativa: ",h.rationale]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(us,{className:"w-3 h-3"}),"Confian√ßa: ",Math.round(Number(h.confidence_score||0)*100),"%"]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsxs(w,{size:"sm",variant:"outline",disabled:h.status!=="pending"||S,onClick:()=>O(h,"accept"),children:[S?e.jsx($,{className:"w-3 h-3 mr-1 animate-spin"}):e.jsx(Te,{className:"w-3 h-3 mr-1"}),"Aceitar"]}),e.jsxs(w,{size:"sm",variant:"outline",disabled:h.status!=="pending"||ce,onClick:()=>O(h,"dismiss"),children:[ce?e.jsx($,{className:"w-3 h-3 mr-1 animate-spin"}):e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Descartar"]}),e.jsxs(w,{size:"sm",disabled:h.status!=="accepted"||de,onClick:()=>O(h,"apply"),children:[de?e.jsx($,{className:"w-3 h-3 mr-1 animate-spin"}):e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Marcar aplicada"]})]})]},h.id)})})})]})]})},ks=({patientId:s,modulesStatus:c={},latestMetrics:i={}})=>{const t=G(),r={hasData:c.anthropometry==="completed"||!!i?.weight,currentWeight:i?.weight,previousWeight:i?.previous_weight||null,height:i?.height,bmi:null,lastUpdate:i?.updated_at||i?.created_at};if(r.height&&r.currentWeight){const p=r.height/100;r.bmi=(r.currentWeight/p**2).toFixed(1)}const d=r.previousWeight?r.currentWeight-r.previousWeight:0,n=Math.abs(d).toFixed(1),f=p=>{const x=parseFloat(p);return x<16?{label:"Magreza Grave",color:"bg-red-700/10 text-red-800 border-red-700",severity:"critical"}:x>=16&&x<17?{label:"Magreza Moderada",color:"bg-orange-600/10 text-orange-800 border-orange-600",severity:"high"}:x>=17&&x<18.5?{label:"Magreza Leve",color:"bg-yellow-500/10 text-yellow-800 border-yellow-500",severity:"moderate"}:x>=18.5&&x<25?{label:"Peso Normal",color:"bg-[#5f6f52]/10 text-[#5f6f52] border-[#5f6f52]",severity:"normal"}:x>=25&&x<30?{label:"Sobrepeso",color:"bg-yellow-500/10 text-yellow-800 border-yellow-500",severity:"moderate"}:x>=30&&x<35?{label:"Obesidade Grau I",color:"bg-orange-600/10 text-orange-800 border-orange-600",severity:"high"}:x>=35&&x<40?{label:"Obesidade Grau II",color:"bg-red-600/10 text-red-800 border-red-600",severity:"critical"}:{label:"Obesidade Grau III",color:"bg-red-700/10 text-red-900 border-red-700",severity:"critical"}},j=()=>r.hasData?e.jsxs(y,{className:"border-l-4 border-l-[#5f6f52] hover:shadow-xl transition-all bg-gradient-to-br from-[#fefae0]/20 to-[#fefae0]/30 cursor-pointer h-full",onClick:()=>t(`/nutritionist/patients/${s}/anthropometry`),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-base",children:"Avalia√ß√£o Antropom√©trica"})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#5f6f52] to-[#a9b388] text-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-medium opacity-90",children:"Peso Atual"}),d!==0&&e.jsxs("div",{className:"flex items-center gap-1 bg-[#fefae0]/20 px-1.5 py-0.5 rounded text-xs",children:[d<0?e.jsx(_e,{className:"w-3 h-3 text-green-300"}):e.jsx(ne,{className:"w-3 h-3 text-red-300"}),e.jsxs("span",{className:"font-semibold",children:[d<0?"-":"+",n," kg"]})]})]}),e.jsxs("div",{className:"text-4xl font-bold mb-1",children:[r.currentWeight.toFixed(1),e.jsx("span",{className:"text-lg ml-1 opacity-80",children:"kg"})]}),r.previousWeight&&e.jsxs("div",{className:"text-xs opacity-80",children:["Anterior: ",r.previousWeight.toFixed(1)," kg"]})]}),r.bmi&&(()=>{const p=f(r.bmi);return e.jsxs("div",{className:"bg-[#fefae0] border border-[#a9b388] rounded-lg p-4 text-center flex flex-col justify-center",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"IMC"}),e.jsx("div",{className:"text-3xl font-bold text-foreground mb-2",children:r.bmi}),e.jsx(L,{variant:"outline",className:F("text-xs font-medium mx-auto",p.color),children:p.label})]})})()]}),r.height&&e.jsx("div",{className:"bg-[#f9ebc7] border border-[#a9b388] rounded-lg p-3 text-center mb-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(as,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{className:"text-xl font-bold text-foreground",children:[r.height," cm"]})]})}),r.lastUpdate&&e.jsxs("div",{className:"text-xs pt-3 mt-3 border-t flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(q,{className:"w-3 h-3"}),new Date(r.lastUpdate).toLocaleDateString("pt-BR")]}),e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 text-[#5f6f52] hover:bg-[#5f6f52]/10",onClick:()=>t(`/nutritionist/patients/${s}/anthropometry`),children:["Abrir ",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})]})]}):e.jsx(y,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 hover:shadow-lg transition-all cursor-pointer h-full",onClick:()=>t(`/nutritionist/patients/${s}/anthropometry`),children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#fefae0] flex items-center justify-center mb-4",children:e.jsx(Z,{className:"w-8 h-8 text-[#5f6f52]"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Nenhuma Avalia√ß√£o Registrada"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-md",children:"Registre peso, altura e medidas para acompanhar a evolu√ß√£o do paciente"}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#5f6f52]",children:[e.jsx(Z,{className:"w-4 h-4"}),"Registrar Avalia√ß√£o",e.jsx(P,{className:"w-4 h-4"})]})]})}),b=()=>e.jsxs(y,{className:"border-dashed border-2 border-[#b99470] bg-[#fefae0]/30 hover:shadow-md transition-all cursor-pointer h-full",onClick:()=>t(`/nutritionist/patients/${s}/photos`),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-[#b99470]"}),e.jsx(R,{className:"text-base",children:"Fotos de Progresso"})]})}),e.jsx(C,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(ee,{className:"w-6 h-6 text-[#b99470]"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Nenhuma foto registrada"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Adicione fotos para acompanhar o progresso visual"}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#b99470]",children:[e.jsx(ee,{className:"w-3 h-3"}),"Adicionar Fotos",e.jsx(P,{className:"w-3 h-3"})]})]})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-1",children:"Avalia√ß√£o Corporal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Medidas antropom√©tricas e registro visual do progresso"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-4",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsx(j,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(b,{})})]})]})},Ss=({patientId:s})=>{const c=G(),[i,t]=u.useState(!0),[r,d]=u.useState(!1),[n,f]=u.useState(null),[j,b]=u.useState(null);u.useEffect(()=>{p()},[s]);const p=async()=>{if(s){t(!0);try{const{data:o,error:g}=await B.from("user_profiles").select("name, birth_date, gender, weight, height").eq("id",s).single();if(g)throw g;const{data:a}=await B.from("growth_records").select("weight, height").eq("patient_id",s).order("record_date",{ascending:!1}).limit(1).maybeSingle(),m={weight:a?.weight||o.weight,height:a?.height||o.height,birth_date:o.birth_date,gender:o.gender};b(m);const k=x(m.birth_date),A=m.weight&&m.height&&k&&m.gender;d(A);const{data:v}=await B.from("energy_expenditure_calculations").select("*").eq("patient_id",s).order("created_at",{ascending:!1}).limit(1).maybeSingle();v&&f(v)}catch(o){console.error("Erro ao buscar dados:",o)}finally{t(!1)}}},x=o=>{if(!o)return null;const g=new Date,a=new Date(o);let m=g.getFullYear()-a.getFullYear();const k=g.getMonth()-a.getMonth();return(k<0||k===0&&g.getDate()<a.getDate())&&m--,m},l=()=>{c(`/nutritionist/patients/${s}/energy-expenditure`)};if(i)return e.jsx(y,{className:"hover:shadow-md transition-all",children:e.jsx(C,{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"w-6 h-6 animate-spin text-primary"})})});if(!r)return e.jsxs(y,{className:"hover:shadow-md transition-all border-dashed border-2 border-amber-300 bg-amber-50/30 cursor-pointer",onClick:l,children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-amber-600"}),e.jsx(R,{className:"text-base",children:"Gasto Energ√©tico"})]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ae,{className:"border-amber-300 bg-amber-50/50",children:[e.jsx(ie,{className:"h-4 w-4 text-amber-600"}),e.jsxs(ke,{className:"text-sm",children:[e.jsx("strong",{children:"Dados incompletos"}),e.jsx("p",{className:"mt-1 text-muted-foreground text-xs",children:"Para calcular, √© necess√°rio peso, altura, idade e sexo."})]})]}),e.jsxs(w,{onClick:l,className:"w-full gap-2",variant:"outline",children:[e.jsx(H,{className:"w-4 h-4"}),"Calcular Gasto Energ√©tico",e.jsx(P,{className:"w-4 h-4 ml-auto"})]})]})})]});if(n){const o=n.protocol?.startsWith("eer-iom"),g=n.get_with_activities||n.get||0,a=n.activities&&Array.isArray(n.activities)&&n.activities.length>0,m=n.target_weight&&n.venta_adjusted;return e.jsxs(y,{className:"hover:shadow-md transition-all border-l-4 border-l-[#5f6f52] cursor-pointer",onClick:l,children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(H,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-base",children:"Gasto Energ√©tico"}),a&&e.jsxs(L,{variant:"outline",className:"text-xs border-[#5f6f52] text-[#5f6f52]",children:["+",n.activities.length," ",n.activities.length===1?"atividade":"atividades"]}),m&&e.jsxs(L,{className:"text-xs bg-amber-500 hover:bg-amber-600",children:["Objetivo: ",n.target_weight,"kg"]})]}),e.jsxs(te,{className:"text-xs",children:["Protocolo: ",n.protocol||"Harris-Benedict"]})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[!o&&e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg border border-orange-200",children:[e.jsx(W,{className:"w-4 h-4 text-orange-600 mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:Math.round(n.tmb||0)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"TMB (kcal)"})]}),e.jsxs("div",{className:`text-center p-3 bg-gradient-to-br from-emerald-600 to-emerald-500 rounded-lg text-white ${o?"col-span-2":""}`,children:[e.jsx(X,{className:"w-4 h-4 mx-auto mb-1 opacity-90"}),e.jsx("div",{className:"text-2xl font-bold",children:Math.round(g)}),e.jsxs("div",{className:"text-xs opacity-90",children:[a?"GET + Atividades":o?"EER":"GET"," (kcal)"]})]})]}),m&&e.jsxs("div",{className:"text-center p-2.5 bg-gradient-to-br from-amber-500 to-amber-600 rounded-lg text-white shadow-sm",children:[e.jsxs("div",{className:"text-lg font-bold",children:[Math.round(n.venta_adjusted)," kcal/dia"]}),e.jsxs("div",{className:"text-xs opacity-90",children:["Objetivo: ",n.target_weight,"kg"]})]}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground",children:[n.activity_level==="1.2"&&"Sedent√°rio",n.activity_level==="1.375"&&"Levemente Ativo",n.activity_level==="1.55"&&"Moderadamente Ativo",n.activity_level==="1.725"&&"Muito Ativo",n.activity_level==="1.9"&&"Extremamente Ativo"]}),e.jsxs(w,{onClick:l,variant:"outline",size:"sm",className:"w-full gap-1",children:["Ver detalhes / Editar",e.jsx(P,{className:"w-3 h-3"})]})]})]})}return e.jsxs(y,{className:"hover:shadow-md transition-all border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 cursor-pointer",onClick:l,children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-base",children:"Gasto Energ√©tico"})]})}),e.jsx(C,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(W,{className:"w-6 h-6 text-[#c4661f]"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Calcular TMB e GET"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Dados dispon√≠veis. Calcule o gasto energ√©tico total."}),e.jsxs(w,{onClick:l,className:"gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Calcular Agora",e.jsx(P,{className:"w-4 h-4"})]})]})})]})},Ps=({patientId:s,modulesStatus:c={}})=>{const i=G(),[t,r]=u.useState(null),[d,n]=u.useState(!0),[f,j]=u.useState(null),[b,p]=u.useState(!0);u.useEffect(()=>{(async()=>{if(s){n(!0);try{const{data:g,error:a}=await rs(s);if(a)throw a;r(g)}catch(g){console.error("Erro ao buscar plano ativo:",g),r(null)}finally{n(!1)}}})()},[s]),u.useEffect(()=>{(async()=>{if(s){p(!0);try{const{data:g}=await is(s,7),a=new Date().toISOString().split("T")[0],m=new Date;m.setDate(m.getDate()-7);const k=m.toISOString().split("T")[0],{data:A}=await ns(s,k,a);j({adherence:g||{adherencePercentage:0,totalMeals:0,currentStreak:0},summary:A||{avgCaloriesPerDay:0,avgProteinPerDay:0}})}catch(g){console.error("Erro ao buscar estat√≠sticas do di√°rio:",g),j(null)}finally{p(!1)}}})()},[s]);const x=()=>d?e.jsx(y,{className:"h-full",children:e.jsx(C,{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"w-8 h-8 animate-spin text-[#5f6f52]"})})}):t?e.jsxs(y,{className:"border-l-4 border-l-[#5f6f52] hover:shadow-xl transition-all bg-gradient-to-br from-[#fefae0]/20 to-[#fefae0]/30 cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/meal-plan`),children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(z,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-lg",children:"Plano Alimentar"}),e.jsx(L,{className:"bg-[#a9b388]/20 text-[#5f6f52] border-[#5f6f52]",children:"Vigente"})]}),e.jsx(te,{className:"text-base font-semibold text-foreground",children:t.name})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"text-center p-2 bg-[#fefae0] rounded-lg border border-[#c4661f]",children:[e.jsx(W,{className:"w-4 h-4 text-[#c4661f] mx-auto mb-0.5"}),e.jsx("div",{className:"text-xl font-bold text-foreground",children:t.daily_calories?Math.round(t.daily_calories):0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal/dia"})]}),e.jsxs("div",{className:"text-center p-2 bg-[#fefae0] rounded-lg border border-[#8B3BF2]",children:[e.jsx("div",{className:"text-xs text-[#8B3BF2] font-medium mb-0.5",children:"Prote√≠nas"}),e.jsxs("div",{className:"text-lg font-bold text-[#8B3BF2]",children:[t.daily_protein?Math.round(t.daily_protein):0,"g"]}),e.jsxs("div",{className:"text-xs text-[#8B3BF2]",children:[t.daily_calories?Math.round(t.daily_protein*4/t.daily_calories*100):0,"%"]})]}),e.jsxs("div",{className:"text-center p-2 bg-[#a9b388]/10 rounded-lg border border-[#3B6FF2]",children:[e.jsx("div",{className:"text-xs text-[#3B6FF2] font-medium mb-0.5",children:"Carboidratos"}),e.jsxs("div",{className:"text-lg font-bold text-[#3B6FF2]",children:[t.daily_carbs?Math.round(t.daily_carbs):0,"g"]}),e.jsxs("div",{className:"text-xs text-[#3B6FF2]",children:[t.daily_calories?Math.round(t.daily_carbs*4/t.daily_calories*100):0,"%"]})]}),e.jsxs("div",{className:"text-center p-2 bg-[#f9ebc7] rounded-lg border border-[#F28B3B]",children:[e.jsx("div",{className:"text-xs text-[#F28B3B] font-medium mb-0.5",children:"Gorduras"}),e.jsxs("div",{className:"text-lg font-bold text-[#F28B3B]",children:[t.daily_fat?Math.round(t.daily_fat):0,"g"]}),e.jsxs("div",{className:"text-xs text-[#F28B3B]",children:[t.daily_calories?Math.round(t.daily_fat*9/t.daily_calories*100):0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs pt-3 border-t",children:[e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(q,{className:"w-3 h-3"}),"Iniciado em ",new Date(t.start_date).toLocaleDateString("pt-BR")]}),e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",onClick:()=>i(`/nutritionist/patients/${s}/meal-plan`),children:["Abrir ",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})]})]}):e.jsx(y,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 hover:shadow-lg transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/meal-plan`),children:e.jsxs(C,{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#fefae0] flex items-center justify-center mb-4",children:e.jsx(z,{className:"w-8 h-8 text-[#5f6f52]"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Nenhum Plano Alimentar Ativo"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6 max-w-md",children:"Crie um plano alimentar personalizado com refei√ß√µes, alimentos e valores nutricionais"}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#5f6f52]",children:[e.jsx(z,{className:"w-4 h-4"}),"Criar Plano Alimentar",e.jsx(P,{className:"w-4 h-4"})]})]})}),l=()=>{if(b)return e.jsx(y,{className:"h-full",children:e.jsx(C,{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"w-8 h-8 animate-spin text-[#5f6f52]"})})});const o=f&&f.adherence.totalMeals>0;return e.jsxs(y,{className:"border-l-4 border-l-[#c4661f] hover:shadow-lg transition-all h-full bg-gradient-to-br from-[#fefae0]/20 to-white cursor-pointer",onClick:()=>i(`/nutritionist/patients/${s}/food-diary`),children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(be,{className:"w-5 h-5 text-[#c4661f]"}),e.jsx(R,{className:"text-lg",children:"Di√°rio Alimentar"})]}),e.jsx(te,{className:"text-sm",children:"√öltimos 7 dias"})]}),e.jsx(C,{children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/50 rounded-lg border border-[#a9b388]/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(ne,{className:"w-3 h-3 text-[#5f6f52]"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Ades√£o"})]}),e.jsxs("div",{className:"text-2xl font-bold text-[#5f6f52]",children:[f.adherence.adherencePercentage,"%"]})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/50 rounded-lg border border-[#a9b388]/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(X,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sequ√™ncia"})]}),e.jsx("div",{className:"text-2xl font-bold text-[#c4661f]",children:f.adherence.currentStreak}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"dias"})]})]}),e.jsxs("div",{className:"bg-[#fefae0]/40 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"M√©dia Cal√≥rica"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:"text-sm font-bold text-[#c4661f]",children:f.summary.avgCaloriesPerDay}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"kcal/dia"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total de Refei√ß√µes"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:f.adherence.totalMeals})]})]}),e.jsx("div",{className:"pt-3 border-t flex justify-center",children:e.jsxs(w,{variant:"ghost",size:"sm",className:"text-[#5f6f52] hover:bg-[#5f6f52]/10",onClick:()=>i(`/nutritionist/patients/${s}/food-diary`),children:["Ver Di√°rio Completo",e.jsx(P,{className:"w-3 h-3 ml-1"})]})})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(be,{className:"w-6 h-6 text-[#c4661f]"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Nenhum Registro Recente"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Paciente ainda n√£o registrou refei√ß√µes nos √∫ltimos 7 dias"}),e.jsxs(w,{variant:"outline",size:"sm",className:"border-[#c4661f] text-[#c4661f] hover:bg-[#c4661f]/10",onClick:()=>i(`/nutritionist/patients/${s}/food-diary`),children:["Abrir Di√°rio",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-1",children:"Nutri√ß√£o"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prescri√ß√£o diet√©tica, gasto energ√©tico e acompanhamento alimentar"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ss,{patientId:s}),e.jsx(l,{})]})]})]})},Ms=({patientId:s,modulesStatus:c={}})=>{const i=G(),[t,r]=u.useState(null),[d,n]=u.useState(!0);u.useEffect(()=>{f()},[s]);const f=async()=>{n(!0);try{const{data:x}=await ls(s);r(x)}catch(x){console.error("Erro ao carregar meta ativa:",x)}finally{n(!1)}},j=x=>({weight_loss:_e,weight_gain:ne,weight_maintenance:ds,custom:K})[x]||K,b=()=>{if(d)return e.jsx(y,{className:"border-l-4 border-l-[#a9b388] h-full",children:e.jsx(C,{className:"py-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando meta..."})})});if(!t)return e.jsx(y,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 hover:shadow-md transition-all cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/goals`),children:e.jsxs(C,{className:"py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(K,{className:"w-6 h-6 text-[#5f6f52]"})}),e.jsx("h3",{className:"text-base font-semibold text-foreground mb-2",children:"Metas Nutricionais"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm mx-auto",children:"Nenhuma meta ativa. Defina um objetivo nutricional para o paciente"}),e.jsxs("span",{className:"inline-flex items-center gap-2 text-sm font-medium text-[#5f6f52]",children:[e.jsx(K,{className:"w-4 h-4"}),"Criar Meta",e.jsx(P,{className:"w-3 h-3"})]})]})});const x=j(t.goal_type),l=os(t.target_date),o=cs(t),g=Math.abs(t.current_weight-t.target_weight);return e.jsxs(y,{className:"border-l-4 border-l-[#5f6f52] hover:shadow-xl transition-all bg-gradient-to-br from-[#fefae0]/20 to-[#fefae0]/30 cursor-pointer h-full",onClick:()=>i(`/nutritionist/patients/${s}/goals`),children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-[#5f6f52]"}),e.jsx(R,{className:"text-base",children:"Meta Ativa"}),e.jsx(L,{variant:"outline",className:"bg-green-50 text-green-700 border-green-300 text-xs",children:"Em andamento"})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-2",children:t.title}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{className:"font-semibold text-[#5f6f52]",children:[t.progress_percentage?.toFixed(0)||0,"%"]})]}),e.jsx(Ye,{value:t.progress_percentage||0,className:"h-2"})]}),o&&e.jsx(L,{variant:"outline",className:`text-xs ${o.color}`,children:o.label})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-[#fefae0] border border-[#a9b388] rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-foreground",children:t.current_weight?.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Peso Atual"})]}),e.jsxs("div",{className:"bg-[#fefae0] border border-[#5f6f52] rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-[#5f6f52]",children:t.target_weight?.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Meta"})]})]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Faltam:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:[g.toFixed(1)," kg"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),"Prazo:"]}),e.jsx("span",{className:"font-semibold text-foreground",children:l>0?`${l} dias`:"Prazo expirado"})]}),t.daily_calorie_goal&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"}),"Meta di√°ria:"]}),e.jsxs("span",{className:"font-semibold text-foreground",children:[Math.round(t.daily_calorie_goal)," kcal"]})]})]}),e.jsxs("div",{className:"text-xs pt-3 mt-3 border-t flex items-center justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Meta criada em ",new Date(t.start_date).toLocaleDateString("pt-BR")]}),e.jsxs(w,{variant:"ghost",size:"sm",className:"h-7 text-[#5f6f52] hover:bg-[#5f6f52]/10",onClick:()=>i(`/nutritionist/patients/${s}/goals`),children:["Abrir ",e.jsx(P,{className:"w-3 h-3 ml-1"})]})]})]})]})},p=()=>e.jsx(y,{className:"border-dashed border-2 border-[#a9b388] bg-[#fefae0]/30 hover:shadow-md transition-all",children:e.jsxs(C,{className:"py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#fefae0] flex items-center justify-center mx-auto mb-3",children:e.jsx(se,{className:"w-6 h-6 text-[#5f6f52]"})}),e.jsx("h3",{className:"text-base font-semibold text-foreground mb-2",children:"Conquistas"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 max-w-sm mx-auto",children:"Sistema de gamifica√ß√£o em desenvolvimento - Badges e conquistas para motivar o paciente"}),e.jsxs(w,{variant:"outline",onClick:()=>i(`/nutritionist/patients/${s}/achievements`),className:"gap-2 border-[#5f6f52] text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(se,{className:"w-4 h-4"}),"Ver Conquistas"]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-1",children:"Ades√£o ao Tratamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Metas, prescri√ß√µes e sistema de conquistas"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(b,{}),e.jsx(p,{})]})]})},Mt=()=>{const{patientId:s}=$e(),c=G(),[i,t]=Be(),[r,d]=u.useState(()=>{const v=i.get("tab");return v||"feed"}),{loading:n,error:f,patientData:j,latestMetrics:b,modulesStatus:p,activities:x,activitiesLoading:l,refresh:o,loadActivities:g}=gs(s),a=()=>{},m=()=>{c(`/chat/nutritionist/${s}`)},k=()=>{c("/nutritionist/agenda")},A=()=>{g(x.length+20)};return u.useEffect(()=>{i.get("tab")&&(i.delete("tab"),t(i,{replace:!0}))},[i,t]),n?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-card/80 backdrop-blur-md border-b border-border p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-10 h-10 rounded-md"}),e.jsxs("div",{children:[e.jsx(M,{className:"h-5 w-32 mb-2"}),e.jsx(M,{className:"h-3 w-24"})]})]}),e.jsx(M,{className:"w-24 h-9"})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto w-full p-4 md:p-8 space-y-8",children:[e.jsxs(y,{children:[e.jsxs(D,{className:"flex flex-row items-start justify-between space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{className:"h-20 w-20 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-6 w-48"}),e.jsx(M,{className:"h-4 w-32"}),e.jsx(M,{className:"h-4 w-40"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{className:"h-10 w-24"}),e.jsx(M,{className:"h-10 w-24"})]})]}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(v=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"h-4 w-16"}),e.jsx(M,{className:"h-6 w-20"})]},v))})})]}),e.jsxs(y,{children:[e.jsx(D,{children:e.jsx(M,{className:"h-5 w-40"})}),e.jsx(C,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(v=>e.jsx(M,{className:"h-20 rounded-lg"},v))})})]}),e.jsxs(y,{children:[e.jsx(D,{children:e.jsx(M,{className:"h-10 w-full"})}),e.jsx(C,{className:"space-y-3",children:[1,2,3].map(v=>e.jsx(M,{className:"h-16 w-full"},v))})]})]})]}):f||!j?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-background p-4",children:[e.jsxs(Ae,{variant:"destructive",className:"max-w-md mb-6",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(ke,{children:f?.message||"Paciente n√£o encontrado ou voc√™ n√£o tem permiss√£o para visualiz√°-lo."})]}),e.jsx(w,{asChild:!0,variant:"outline",children:e.jsxs(xe,{to:"/nutritionist/patients",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Voltar para Pacientes"]})})]}):e.jsxs("div",{className:"min-h-screen bg-background overflow-x-hidden",children:[e.jsx("header",{className:"bg-card/80 backdrop-blur-md border-b border-border p-3 md:p-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between min-w-0 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[e.jsx(xe,{to:"/nutritionist/patients",className:"shrink-0",children:e.jsx(w,{variant:"ghost",size:"icon",children:e.jsx(pe,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("h1",{className:"font-semibold text-foreground text-base md:text-lg truncate",children:j.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Hub do Paciente"})]})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:o,className:"gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto w-full p-4 md:p-8 space-y-8 min-w-0 overflow-x-hidden",children:[e.jsx("section",{children:e.jsx(ps,{patientData:j,latestMetrics:b,onEditProfile:a,onOpenChat:m,onScheduleAppointment:k})}),e.jsx("section",{children:e.jsx(bs,{patientId:s,modulesStatus:p,latestMetrics:b})}),e.jsx("section",{children:e.jsxs(ze,{value:r,onValueChange:d,className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-3 lg:grid-cols-5 gap-1 h-auto p-1 bg-muted/30 rounded-lg",children:[e.jsxs(U,{value:"feed",className:"flex flex-col items-center justify-center gap-1.5 py-3 px-2 rounded-md transition-all data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-[#5f6f52] data-[state=inactive]:text-muted-foreground hover:text-foreground",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Feed"})]}),e.jsxs(U,{value:"clinical",className:"flex flex-col items-center justify-center gap-1.5 py-3 px-2 rounded-md transition-all data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-[#5f6f52] data-[state=inactive]:text-muted-foreground hover:text-foreground",children:[e.jsx(ms,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Cl√≠nico"})]}),e.jsxs(U,{value:"body",className:"flex flex-col items-center justify-center gap-1.5 py-3 px-2 rounded-md transition-all data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-[#5f6f52] data-[state=inactive]:text-muted-foreground hover:text-foreground",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Corporal"})]}),e.jsxs(U,{value:"nutrition",className:"flex flex-col items-center justify-center gap-1.5 py-3 px-2 rounded-md transition-all data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-[#5f6f52] data-[state=inactive]:text-muted-foreground hover:text-foreground",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Nutri√ß√£o"})]}),e.jsxs(U,{value:"adherence",className:"flex flex-col items-center justify-center gap-1.5 py-3 px-2 rounded-md transition-all data-[state=active]:bg-background data-[state=active]:shadow-sm data-[state=active]:text-[#5f6f52] data-[state=inactive]:text-muted-foreground hover:text-foreground",children:[e.jsx(xs,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Ades√£o"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx(V,{value:"feed",className:"m-0",children:e.jsx(vs,{patientId:s,activities:x,loading:l,onLoadMore:A})}),e.jsx(V,{value:"clinical",className:"m-0",children:e.jsx(As,{patientId:s,modulesStatus:p})}),e.jsx(V,{value:"body",className:"m-0",children:e.jsx(ks,{patientId:s,modulesStatus:p,latestMetrics:b})}),e.jsx(V,{value:"nutrition",className:"m-0",children:e.jsx(Ps,{patientId:s,modulesStatus:p})}),e.jsx(V,{value:"adherence",className:"m-0",children:e.jsx(Ms,{patientId:s,modulesStatus:p})})]})]})})]})]})};export{Mt as default};
