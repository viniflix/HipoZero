import{u as k,a as F,r as i,s as g,j as e,m as D,C as b,c as N,d as y,w as P,e as C,B as v,F as E,ai as z,aM as B,aj as L,ak as I,al as M}from"./index-BFkiRED3.js";import{I as u}from"./input-CQ4El1yG.js";import{L as h}from"./label-66Dk79vW.js";import{P as _}from"./pen-square-B-aU106W.js";const w=({onSave:o,foodToEdit:n,nutritionistId:c})=>{const[a,r]=i.useState({name:"",calories:"",protein:"",fat:"",carbs:"",group:"Personalizado"}),[x,p]=i.useState(!1),{toast:d}=F();i.useEffect(()=>{r(n||{name:"",calories:"",protein:"",fat:"",carbs:"",group:"Personalizado"})},[n]);const j=async()=>{if(!a.name||!a.calories||!a.protein||!a.fat||!a.carbs){d({title:"Erro",description:"Preencha todos os campos.",variant:"destructive"});return}p(!0);const t={name:a.name,calories:parseFloat(a.calories),protein:parseFloat(a.protein),fat:parseFloat(a.fat),carbs:parseFloat(a.carbs),group:a.group,nutritionist_id:c};let l;if(n?.id){const{error:m}=await g.from("foods").update(t).eq("id",n.id);l=m}else{const{error:m}=await g.from("foods").insert(t);l=m}l?d({title:"Erro",description:`Não foi possível salvar o alimento. ${l.message}`,variant:"destructive"}):(d({title:"Sucesso!",description:`Alimento ${n?"atualizado":"adicionado"}.`}),o()),p(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"foodName",children:"Nome do Alimento"}),e.jsx(u,{id:"foodName",value:a.name,onChange:t=>r({...a,name:t.target.value}),placeholder:"Ex: Frango Grelhado"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"calories",children:"Calorias"}),e.jsx(u,{id:"calories",type:"number",value:a.calories,onChange:t=>r({...a,calories:t.target.value}),placeholder:"165"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"protein",children:"Proteínas"}),e.jsx(u,{id:"protein",type:"number",value:a.protein,onChange:t=>r({...a,protein:t.target.value}),placeholder:"31"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"fat",children:"Gorduras"}),e.jsx(u,{id:"fat",type:"number",value:a.fat,onChange:t=>r({...a,fat:t.target.value}),placeholder:"3.6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"carbs",children:"Carboidratos"}),e.jsx(u,{id:"carbs",type:"number",value:a.carbs,onChange:t=>r({...a,carbs:t.target.value}),placeholder:"0"})]})]}),e.jsx(v,{onClick:j,disabled:x,children:x?"Salvando...":"Salvar Alimento"})]})},q=({food:o,onSaved:n,nutritionistId:c})=>{const[a,r]=i.useState(!1),x=()=>{n(),r(!1)};return e.jsxs(z,{open:a,onOpenChange:r,children:[e.jsx(B,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",children:e.jsx(_,{className:"w-4 h-4 text-accent"})})}),e.jsxs(L,{children:[e.jsx(I,{children:e.jsx(M,{children:"Editar Alimento"})}),e.jsx(w,{onSave:x,foodToEdit:o,nutritionistId:c})]})]})},H=()=>{const{user:o,signOut:n}=k(),{toast:c}=F(),[a,r]=i.useState([]),[x,p]=i.useState(!0),[d,j]=i.useState(""),t=i.useCallback(async()=>{p(!0);const{data:s,error:f}=await g.from("foods").select("*").or(`nutritionist_id.eq.${o.id},nutritionist_id.is.null`).limit(1e3);f?c({title:"Erro",description:"Não foi possível carregar os alimentos.",variant:"destructive"}):r(s),p(!1)},[o.id,c]);i.useEffect(()=>{t()},[t]);const l=i.useMemo(()=>a.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())),[a,d]),m=i.useMemo(()=>l.filter(s=>s.nutritionist_id===o.id),[l,o.id]),S=i.useMemo(()=>l.filter(s=>s.nutritionist_id===null),[l]),A=async s=>{const{error:f}=await g.from("foods").delete().eq("id",s);f?c({title:"Erro",description:`Não foi possível remover o alimento: ${f.message}`,variant:"destructive"}):(t(),c({title:"Sucesso!",description:"Alimento removido."}))};return e.jsx("div",{className:"flex flex-col min-h-screen bg-background",children:e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-8",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-8",children:e.jsxs("div",{className:"flex flex-col justify-center flex-1 text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold font-heading uppercase tracking-wide text-primary",children:"Banco de Alimentos"}),e.jsx("p",{className:"text-neutral-600 mt-1",children:"Gerencie seus alimentos personalizados e consulte o banco público."})]})}),e.jsxs(b,{className:"mb-8",children:[e.jsxs(N,{children:[e.jsx(y,{className:"font-clash text-lg font-semibold text-primary",children:"Adicionar Novo Alimento"}),e.jsx(P,{className:"text-muted-foreground",children:"Adicione itens personalizados ao seu banco de alimentos. Eles estarão disponíveis apenas para você e seus pacientes."})]}),e.jsx(C,{className:"text-primary",children:e.jsx(w,{onSave:t,nutritionistId:o.id})})]}),e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(y,{className:"font-clash text-lg font-semibold text-primary",children:"Consultar Banco de Alimentos"}),e.jsx("div",{className:"mt-4",children:e.jsx(u,{placeholder:"Buscar alimento...",value:d,onChange:s=>j(s.target.value)})})]}),e.jsxs(C,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"Meus Alimentos Personalizados"}),e.jsx("div",{className:"space-y-2 mb-6",children:m.length>0?m.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-foreground font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground hidden sm:block",children:[s.calories,"kcal | P:",s.protein,"g F:",s.fat,"g C:",s.carbs,"g"]}),e.jsx(q,{food:s,onSaved:t,nutritionistId:o.id}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>A(s.id),children:e.jsx(E,{className:"w-4 h-4 text-destructive"})})]})]},s.id)):e.jsx("p",{className:"text-muted-foreground",children:"Nenhum alimento personalizado."})}),e.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"Banco de Dados Público"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:S.map(s=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-foreground font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground hidden sm:block",children:[s.calories,"kcal | P:",s.protein,"g F:",s.fat,"g C:",s.carbs,"g"]})]},s.id))})]})]})]})})};export{H as default};
