import{q as $e,an as Vt,at as Ut,j as e,C as ge,c as Se,d as ke,e as ve,R as ye,r as p,O as Z,w as Oe,H as Ee,B as Y,X as lt,F as Nt,ap as xt,a as st,V as Be,W as Ve,Y as Ue,Z as He,_ as pt,s as ze,A as We,h as Ke,i as Ge,k as Xe,l as Je,n as Ye,o as Qe,p as Ze,v as Ht,as as Me,a1 as Wt,u as Kt,m as Gt,$ as Xt,D as Jt,x as Yt,K as Qt,y as Zt,z as at,T as es}from"./index-CzP_nI2M.js";import{I as he}from"./input-DpEF2plu.js";import{L as Q}from"./label-DACsPsNs.js";import{S as _e,a as Ce,b as we,c as Ne,d as oe}from"./select-D3LMCr-h.js";import{P as ts}from"./progress-o0Ev53RE.js";import{A as St}from"./alert-circle-B-zEa0CI.js";import{T as kt,a as Et,b as et,c as gt}from"./tabs-Ky7EuQAW.js";import{R as nt,T as it,p as vt,B as jt,l as ss}from"./generateCategoricalChart-DaaLLLI7.js";import{B as rs}from"./BarChart--D4S4r7M.js";import{X as yt,Y as bt}from"./YAxis-CAUgcBKY.js";import{P as as,a as ns}from"./PieChart-CXf55wtk.js";import{a as is,L as os}from"./LineChart-CJpEFOCV.js";import{p as Le}from"./parseISO-BczzEZ0Y.js";import{T as $t,a as Dt,b as tt,c as de,d as Rt,e as ue}from"./table-DEHDnTbM.js";import{B as ct}from"./badge-NOGldadv.js";import{S as ls}from"./search-Cz9zTWBR.js";import{P as Pt}from"./pen-square-D0uANbuS.js";import{_ as Pe}from"./extends-CF3RwP-h.js";import{a as cs}from"./addMonths-BS_3JhP5.js";import{g as dt,s as ds,d as us,a as hs,u as ps,b as Tt,r as ms,c as fs,e as xs,f as gs,h as vs,i as js,j as ys,k as bs,l as _s}from"./financial-queries-BdizLBdT.js";import{P as Ft}from"./plus-DMh50SqL.js";import{C as Cs}from"./check-circle-2-DfCWuIEp.js";import{i as ws}from"./isToday-BXFDNHk-.js";import{i as Ns}from"./isYesterday-BJXq0kkk.js";import{A as Ss,a as ks,b as Es}from"./avatar-D9I0s01B.js";import{a as $s}from"./pdfUtils-x5zS8yES.js";import{E as Ds}from"./jspdf.plugin.autotable-aqQXYnL7.js";import{g as Rs}from"./profile-queries-De7AUc8q.js";import{D as Ps}from"./download-C3l9zK4Q.js";import{s as Ts}from"./startOfMonth-D7_dMI_Z.js";import"./isSameDay-DFM5Ogoa.js";import"./html2canvas.esm-B0tyYwQk.js";const Fs=$e("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Ms=$e("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),ot=$e("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),_t=$e("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),As=$e("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),Os=$e("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),zs=$e("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var qe={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Ls=qe.exports,Ct;function Is(){return Ct||(Ct=1,(function(t,l){((o,n)=>{t.exports=n()})(Ls,function o(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},u,f=!n.document&&!!n.postMessage,x=n.IS_PAPA_WORKER||!1,c={},r=0,h={};function w(s){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(a){var d=i(a);d.chunkSize=parseInt(d.chunkSize),a.step||a.chunk||(d.chunkSize=null),this._handle=new B(d),(this._handle.streamer=this)._config=d}).call(this,s),this.parseChunk=function(a,d){var g=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<g){let P=this._config.newline;P||(v=this._config.quoteChar||'"',P=this._handle.guessLineEndings(a,v)),a=[...a.split(P).slice(g)].join(P)}this.isFirstChunk&&C(this._config.beforeFirstChunk)&&(v=this._config.beforeFirstChunk(a))!==void 0&&(a=v),this.isFirstChunk=!1,this._halted=!1;var g=this._partialLine+a,v=(this._partialLine="",this._handle.parse(g,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(a=v.meta.cursor,g=(this._finished||(this._partialLine=g.substring(a-this._baseIndex),this._baseIndex=a),v&&v.data&&(this._rowCount+=v.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),x)n.postMessage({results:v,workerId:h.WORKER_ID,finished:g});else if(C(this._config.chunk)&&!d){if(this._config.chunk(v,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=v=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(v.data),this._completeResults.errors=this._completeResults.errors.concat(v.errors),this._completeResults.meta=v.meta),this._completed||!g||!C(this._config.complete)||v&&v.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),g||v&&v.meta.paused||this._nextChunk(),v}this._halted=!0},this._sendError=function(a){C(this._config.error)?this._config.error(a):x&&this._config.error&&n.postMessage({workerId:h.WORKER_ID,error:a,finished:!1})}}function S(s){var a;(s=s||{}).chunkSize||(s.chunkSize=h.RemoteChunkSize),w.call(this,s),this._nextChunk=f?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(d){this._input=d,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(a=new XMLHttpRequest,this._config.withCredentials&&(a.withCredentials=this._config.withCredentials),f||(a.onload=m(this._chunkLoaded,this),a.onerror=m(this._chunkError,this)),a.open(this._config.downloadRequestBody?"POST":"GET",this._input,!f),this._config.downloadRequestHeaders){var d,g=this._config.downloadRequestHeaders;for(d in g)a.setRequestHeader(d,g[d])}var v;this._config.chunkSize&&(v=this._start+this._config.chunkSize-1,a.setRequestHeader("Range","bytes="+this._start+"-"+v));try{a.send(this._config.downloadRequestBody)}catch(P){this._chunkError(P.message)}f&&a.status===0&&this._chunkError()}},this._chunkLoaded=function(){a.readyState===4&&(a.status<200||400<=a.status?this._chunkError():(this._start+=this._config.chunkSize||a.responseText.length,this._finished=!this._config.chunkSize||this._start>=(d=>(d=d.getResponseHeader("Content-Range"))!==null?parseInt(d.substring(d.lastIndexOf("/")+1)):-1)(a),this.parseChunk(a.responseText)))},this._chunkError=function(d){d=a.statusText||d,this._sendError(new Error(d))}}function D(s){(s=s||{}).chunkSize||(s.chunkSize=h.LocalChunkSize),w.call(this,s);var a,d,g=typeof FileReader<"u";this.stream=function(v){this._input=v,d=v.slice||v.webkitSlice||v.mozSlice,g?((a=new FileReader).onload=m(this._chunkLoaded,this),a.onerror=m(this._chunkError,this)):a=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var v=this._input,P=(this._config.chunkSize&&(P=Math.min(this._start+this._config.chunkSize,this._input.size),v=d.call(v,this._start,P)),a.readAsText(v,this._config.encoding));g||this._chunkLoaded({target:{result:P}})},this._chunkLoaded=function(v){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(v.target.result)},this._chunkError=function(){this._sendError(a.error)}}function j(s){var a;w.call(this,s=s||{}),this.stream=function(d){return a=d,this._nextChunk()},this._nextChunk=function(){var d,g;if(!this._finished)return d=this._config.chunkSize,a=d?(g=a.substring(0,d),a.substring(d)):(g=a,""),this._finished=!a,this.parseChunk(g)}}function T(s){w.call(this,s=s||{});var a=[],d=!0,g=!1;this.pause=function(){w.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){w.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(v){this._input=v,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){g&&a.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),a.length?this.parseChunk(a.shift()):d=!0},this._streamData=m(function(v){try{a.push(typeof v=="string"?v:v.toString(this._config.encoding)),d&&(d=!1,this._checkIsFinished(),this.parseChunk(a.shift()))}catch(P){this._streamError(P)}},this),this._streamError=m(function(v){this._streamCleanUp(),this._sendError(v)},this),this._streamEnd=m(function(){this._streamCleanUp(),g=!0,this._streamData("")},this),this._streamCleanUp=m(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function B(s){var a,d,g,v,P=Math.pow(2,53),L=-P,le=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ee=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,F=this,H=0,N=0,te=!1,E=!1,M=[],_={data:[],errors:[],meta:{}};function X(k){return s.skipEmptyLines==="greedy"?k.join("").trim()==="":k.length===1&&k[0].length===0}function K(){if(_&&g&&(I("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),g=!1),s.skipEmptyLines&&(_.data=_.data.filter(function(b){return!X(b)})),y()){let b=function(W,J){C(s.transformHeader)&&(W=s.transformHeader(W,J)),M.push(W)};if(_)if(Array.isArray(_.data[0])){for(var k=0;y()&&k<_.data.length;k++)_.data[k].forEach(b);_.data.splice(0,1)}else _.data.forEach(b)}function $(b,W){for(var J=s.header?{}:[],O=0;O<b.length;O++){var q=O,A=b[O],A=((pe,R)=>(G=>(s.dynamicTypingFunction&&s.dynamicTyping[G]===void 0&&(s.dynamicTyping[G]=s.dynamicTypingFunction(G)),(s.dynamicTyping[G]||s.dynamicTyping)===!0))(pe)?R==="true"||R==="TRUE"||R!=="false"&&R!=="FALSE"&&((G=>{if(le.test(G)&&(G=parseFloat(G),L<G&&G<P))return 1})(R)?parseFloat(R):ee.test(R)?new Date(R):R===""?null:R):R)(q=s.header?O>=M.length?"__parsed_extra":M[O]:q,A=s.transform?s.transform(A,q):A);q==="__parsed_extra"?(J[q]=J[q]||[],J[q].push(A)):J[q]=A}return s.header&&(O>M.length?I("FieldMismatch","TooManyFields","Too many fields: expected "+M.length+" fields but parsed "+O,N+W):O<M.length&&I("FieldMismatch","TooFewFields","Too few fields: expected "+M.length+" fields but parsed "+O,N+W)),J}var z;_&&(s.header||s.dynamicTyping||s.transform)&&(z=1,!_.data.length||Array.isArray(_.data[0])?(_.data=_.data.map($),z=_.data.length):_.data=$(_.data,0),s.header&&_.meta&&(_.meta.fields=M),N+=z)}function y(){return s.header&&M.length===0}function I(k,$,z,b){k={type:k,code:$,message:z},b!==void 0&&(k.row=b),_.errors.push(k)}C(s.step)&&(v=s.step,s.step=function(k){_=k,y()?K():(K(),_.data.length!==0&&(H+=k.data.length,s.preview&&H>s.preview?d.abort():(_.data=_.data[0],v(_,F))))}),this.parse=function(k,$,z){var b=s.quoteChar||'"',b=(s.newline||(s.newline=this.guessLineEndings(k,b)),g=!1,s.delimiter?C(s.delimiter)&&(s.delimiter=s.delimiter(k),_.meta.delimiter=s.delimiter):((b=((W,J,O,q,A)=>{var pe,R,G,be;A=A||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var De=0;De<A.length;De++){for(var me,Te=A[De],ae=0,fe=0,se=0,ce=(G=void 0,new ne({comments:q,delimiter:Te,newline:J,preview:10}).parse(W)),je=0;je<ce.data.length;je++)O&&X(ce.data[je])?se++:(me=ce.data[je].length,fe+=me,G===void 0?G=me:0<me&&(ae+=Math.abs(me-G),G=me));0<ce.data.length&&(fe/=ce.data.length-se),(R===void 0||ae<=R)&&(be===void 0||be<fe)&&1.99<fe&&(R=ae,pe=Te,be=fe)}return{successful:!!(s.delimiter=pe),bestDelimiter:pe}})(k,s.newline,s.skipEmptyLines,s.comments,s.delimitersToGuess)).successful?s.delimiter=b.bestDelimiter:(g=!0,s.delimiter=h.DefaultDelimiter),_.meta.delimiter=s.delimiter),i(s));return s.preview&&s.header&&b.preview++,a=k,d=new ne(b),_=d.parse(a,$,z),K(),te?{meta:{paused:!0}}:_||{meta:{paused:!1}}},this.paused=function(){return te},this.pause=function(){te=!0,d.abort(),a=C(s.chunk)?"":a.substring(d.getCharIndex())},this.resume=function(){F.streamer._halted?(te=!1,F.streamer.parseChunk(a,!0)):setTimeout(F.resume,3)},this.aborted=function(){return E},this.abort=function(){E=!0,d.abort(),_.meta.aborted=!0,C(s.complete)&&s.complete(_),a=""},this.guessLineEndings=function(W,b){W=W.substring(0,1048576);var b=new RegExp(V(b)+"([^]*?)"+V(b),"gm"),z=(W=W.replace(b,"")).split("\r"),b=W.split(`
`),W=1<b.length&&b[0].length<z[0].length;if(z.length===1||W)return`
`;for(var J=0,O=0;O<z.length;O++)z[O][0]===`
`&&J++;return J>=z.length/2?`\r
`:"\r"}}function V(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ne(s){var a=(s=s||{}).delimiter,d=s.newline,g=s.comments,v=s.step,P=s.preview,L=s.fastMode,le=null,ee=!1,F=s.quoteChar==null?'"':s.quoteChar,H=F;if(s.escapeChar!==void 0&&(H=s.escapeChar),(typeof a!="string"||-1<h.BAD_DELIMITERS.indexOf(a))&&(a=","),g===a)throw new Error("Comment character same as delimiter");g===!0?g="#":(typeof g!="string"||-1<h.BAD_DELIMITERS.indexOf(g))&&(g=!1),d!==`
`&&d!=="\r"&&d!==`\r
`&&(d=`
`);var N=0,te=!1;this.parse=function(E,M,_){if(typeof E!="string")throw new Error("Input must be a string");var X=E.length,K=a.length,y=d.length,I=g.length,k=C(v),$=[],z=[],b=[],W=N=0;if(!E)return ae();if(L||L!==!1&&E.indexOf(F)===-1){for(var J=E.split(d),O=0;O<J.length;O++){if(b=J[O],N+=b.length,O!==J.length-1)N+=d.length;else if(_)return ae();if(!g||b.substring(0,I)!==g){if(k){if($=[],be(b.split(a)),fe(),te)return ae()}else be(b.split(a));if(P&&P<=O)return $=$.slice(0,P),ae(!0)}}return ae()}for(var q=E.indexOf(a,N),A=E.indexOf(d,N),pe=new RegExp(V(H)+V(F),"g"),R=E.indexOf(F,N);;)if(E[N]===F)for(R=N,N++;;){if((R=E.indexOf(F,R+1))===-1)return _||z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:$.length,index:N}),me();if(R===X-1)return me(E.substring(N,R).replace(pe,F));if(F===H&&E[R+1]===H)R++;else if(F===H||R===0||E[R-1]!==H){q!==-1&&q<R+1&&(q=E.indexOf(a,R+1));var G=De((A=A!==-1&&A<R+1?E.indexOf(d,R+1):A)===-1?q:Math.min(q,A));if(E.substr(R+1+G,K)===a){b.push(E.substring(N,R).replace(pe,F)),E[N=R+1+G+K]!==F&&(R=E.indexOf(F,N)),q=E.indexOf(a,N),A=E.indexOf(d,N);break}if(G=De(A),E.substring(R+1+G,R+1+G+y)===d){if(b.push(E.substring(N,R).replace(pe,F)),Te(R+1+G+y),q=E.indexOf(a,N),R=E.indexOf(F,N),k&&(fe(),te))return ae();if(P&&$.length>=P)return ae(!0);break}z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:$.length,index:N}),R++}}else if(g&&b.length===0&&E.substring(N,N+I)===g){if(A===-1)return ae();N=A+y,A=E.indexOf(d,N),q=E.indexOf(a,N)}else if(q!==-1&&(q<A||A===-1))b.push(E.substring(N,q)),N=q+K,q=E.indexOf(a,N);else{if(A===-1)break;if(b.push(E.substring(N,A)),Te(A+y),k&&(fe(),te))return ae();if(P&&$.length>=P)return ae(!0)}return me();function be(se){$.push(se),W=N}function De(se){var ce=0;return ce=se!==-1&&(se=E.substring(R+1,se))&&se.trim()===""?se.length:ce}function me(se){return _||(se===void 0&&(se=E.substring(N)),b.push(se),N=X,be(b),k&&fe()),ae()}function Te(se){N=se,be(b),b=[],A=E.indexOf(d,N)}function ae(se){if(s.header&&!M&&$.length&&!ee){var ce=$[0],je=Object.create(null),rt=new Set(ce);let mt=!1;for(let Re=0;Re<ce.length;Re++){let xe=ce[Re];if(je[xe=C(s.transformHeader)?s.transformHeader(xe,Re):xe]){let Fe,ft=je[xe];for(;Fe=xe+"_"+ft,ft++,rt.has(Fe););rt.add(Fe),ce[Re]=Fe,je[xe]++,mt=!0,(le=le===null?{}:le)[Fe]=xe}else je[xe]=1,ce[Re]=xe;rt.add(xe)}mt&&console.warn("Duplicate headers found and renamed."),ee=!0}return{data:$,errors:z,meta:{delimiter:a,linebreak:d,aborted:te,truncated:!!se,cursor:W+(M||0),renamedHeaders:le}}}function fe(){v(ae()),$=[],z=[]}},this.abort=function(){te=!0},this.getCharIndex=function(){return N}}function re(s){var a=s.data,d=c[a.workerId],g=!1;if(a.error)d.userError(a.error,a.file);else if(a.results&&a.results.data){var v={abort:function(){g=!0,ie(a.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:U,resume:U};if(C(d.userStep)){for(var P=0;P<a.results.data.length&&(d.userStep({data:a.results.data[P],errors:a.results.errors,meta:a.results.meta},v),!g);P++);delete a.results}else C(d.userChunk)&&(d.userChunk(a.results,v,a.file),delete a.results)}a.finished&&!g&&ie(a.workerId,a.results)}function ie(s,a){var d=c[s];C(d.userComplete)&&d.userComplete(a),d.terminate(),delete c[s]}function U(){throw new Error("Not implemented.")}function i(s){if(typeof s!="object"||s===null)return s;var a,d=Array.isArray(s)?[]:{};for(a in s)d[a]=i(s[a]);return d}function m(s,a){return function(){s.apply(a,arguments)}}function C(s){return typeof s=="function"}return h.parse=function(s,a){var d=(a=a||{}).dynamicTyping||!1;if(C(d)&&(a.dynamicTypingFunction=d,d={}),a.dynamicTyping=d,a.transform=!!C(a.transform)&&a.transform,!a.worker||!h.WORKERS_SUPPORTED)return d=null,h.NODE_STREAM_INPUT,typeof s=="string"?(s=(g=>g.charCodeAt(0)!==65279?g:g.slice(1))(s),d=new(a.download?S:j)(a)):s.readable===!0&&C(s.read)&&C(s.on)?d=new T(a):(n.File&&s instanceof File||s instanceof Object)&&(d=new D(a)),d.stream(s);(d=(()=>{var g;return!!h.WORKERS_SUPPORTED&&(g=(()=>{var v=n.URL||n.webkitURL||null,P=o.toString();return h.BLOB_URL||(h.BLOB_URL=v.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",P,")();"],{type:"text/javascript"})))})(),(g=new n.Worker(g)).onmessage=re,g.id=r++,c[g.id]=g)})()).userStep=a.step,d.userChunk=a.chunk,d.userComplete=a.complete,d.userError=a.error,a.step=C(a.step),a.chunk=C(a.chunk),a.complete=C(a.complete),a.error=C(a.error),delete a.worker,d.postMessage({input:s,config:a,workerId:d.id})},h.unparse=function(s,a){var d=!1,g=!0,v=",",P=`\r
`,L='"',le=L+L,ee=!1,F=null,H=!1,N=((()=>{if(typeof a=="object"){if(typeof a.delimiter!="string"||h.BAD_DELIMITERS.filter(function(M){return a.delimiter.indexOf(M)!==-1}).length||(v=a.delimiter),typeof a.quotes!="boolean"&&typeof a.quotes!="function"&&!Array.isArray(a.quotes)||(d=a.quotes),typeof a.skipEmptyLines!="boolean"&&typeof a.skipEmptyLines!="string"||(ee=a.skipEmptyLines),typeof a.newline=="string"&&(P=a.newline),typeof a.quoteChar=="string"&&(L=a.quoteChar),typeof a.header=="boolean"&&(g=a.header),Array.isArray(a.columns)){if(a.columns.length===0)throw new Error("Option columns is empty");F=a.columns}a.escapeChar!==void 0&&(le=a.escapeChar+L),a.escapeFormulae instanceof RegExp?H=a.escapeFormulae:typeof a.escapeFormulae=="boolean"&&a.escapeFormulae&&(H=/^[=+\-@\t\r].*$/)}})(),new RegExp(V(L),"g"));if(typeof s=="string"&&(s=JSON.parse(s)),Array.isArray(s)){if(!s.length||Array.isArray(s[0]))return te(null,s,ee);if(typeof s[0]=="object")return te(F||Object.keys(s[0]),s,ee)}else if(typeof s=="object")return typeof s.data=="string"&&(s.data=JSON.parse(s.data)),Array.isArray(s.data)&&(s.fields||(s.fields=s.meta&&s.meta.fields||F),s.fields||(s.fields=Array.isArray(s.data[0])?s.fields:typeof s.data[0]=="object"?Object.keys(s.data[0]):[]),Array.isArray(s.data[0])||typeof s.data[0]=="object"||(s.data=[s.data])),te(s.fields||[],s.data||[],ee);throw new Error("Unable to serialize unrecognized input");function te(M,_,X){var K="",y=(typeof M=="string"&&(M=JSON.parse(M)),typeof _=="string"&&(_=JSON.parse(_)),Array.isArray(M)&&0<M.length),I=!Array.isArray(_[0]);if(y&&g){for(var k=0;k<M.length;k++)0<k&&(K+=v),K+=E(M[k],k);0<_.length&&(K+=P)}for(var $=0;$<_.length;$++){var z=(y?M:_[$]).length,b=!1,W=y?Object.keys(_[$]).length===0:_[$].length===0;if(X&&!y&&(b=X==="greedy"?_[$].join("").trim()==="":_[$].length===1&&_[$][0].length===0),X==="greedy"&&y){for(var J=[],O=0;O<z;O++){var q=I?M[O]:O;J.push(_[$][q])}b=J.join("").trim()===""}if(!b){for(var A=0;A<z;A++){0<A&&!W&&(K+=v);var pe=y&&I?M[A]:A;K+=E(_[$][pe],A)}$<_.length-1&&(!X||0<z&&!W)&&(K+=P)}}return K}function E(M,_){var X,K;return M==null?"":M.constructor===Date?JSON.stringify(M).slice(1,25):(K=!1,H&&typeof M=="string"&&H.test(M)&&(M="'"+M,K=!0),X=M.toString().replace(N,le),(K=K||d===!0||typeof d=="function"&&d(M,_)||Array.isArray(d)&&d[_]||((y,I)=>{for(var k=0;k<I.length;k++)if(-1<y.indexOf(I[k]))return!0;return!1})(X,h.BAD_DELIMITERS)||-1<X.indexOf(v)||X.charAt(0)===" "||X.charAt(X.length-1)===" ")?L+X+L:X)}},h.RECORD_SEP="",h.UNIT_SEP="",h.BYTE_ORDER_MARK="\uFEFF",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!f&&!!n.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=ne,h.ParserHandle=B,h.NetworkStreamer=S,h.FileStreamer=D,h.StringStreamer=j,h.ReadableStreamStreamer=T,n.jQuery&&((u=n.jQuery).fn.parse=function(s){var a=s.config||{},d=[];return this.each(function(P){if(!(u(this).prop("tagName").toUpperCase()==="INPUT"&&u(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var L=0;L<this.files.length;L++)d.push({file:this.files[L],inputElem:this,instanceConfig:u.extend({},a)})}),g(),this;function g(){if(d.length===0)C(s.complete)&&s.complete();else{var P,L,le,ee,F=d[0];if(C(s.before)){var H=s.before(F.file,F.inputElem);if(typeof H=="object"){if(H.action==="abort")return P="AbortError",L=F.file,le=F.inputElem,ee=H.reason,void(C(s.error)&&s.error({name:P},L,le,ee));if(H.action==="skip")return void v();typeof H.config=="object"&&(F.instanceConfig=u.extend(F.instanceConfig,H.config))}else if(H==="skip")return void v()}var N=F.instanceConfig.complete;F.instanceConfig.complete=function(te){C(N)&&N(te,F.file,F.inputElem),v()},h.parse(F.file,F.instanceConfig)}}function v(){d.splice(0,1),g()}}),x&&(n.onmessage=function(s){s=s.data,h.WORKER_ID===void 0&&s&&(h.WORKER_ID=s.workerId),typeof s.input=="string"?n.postMessage({workerId:h.WORKER_ID,results:h.parse(s.input,s.config),finished:!0}):(n.File&&s.input instanceof File||s.input instanceof Object)&&(s=h.parse(s.input,s.config))&&n.postMessage({workerId:h.WORKER_ID,results:s,finished:!0})}),(S.prototype=Object.create(w.prototype)).constructor=S,(D.prototype=Object.create(w.prototype)).constructor=D,(j.prototype=Object.create(j.prototype)).constructor=j,(T.prototype=Object.create(w.prototype)).constructor=T,h})})(qe)),qe.exports}var qs=Is();const Mt=Vt(qs);function Bs({summary:t,loading:l}){const o=[{title:"Receita Mensal",value:t?.income||0,netValue:t?.netIncome||0,icon:Ms,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-950",borderColor:"border-green-200 dark:border-green-800",showNet:!0},{title:"Despesas",value:t?.expenses||0,icon:Fs,color:"text-red-600",bgColor:"bg-red-50 dark:bg-red-950",borderColor:"border-red-200 dark:border-red-800"},{title:"Resultado Líquido",value:t?.netResult||0,icon:Ut,color:t?.netResult>=0?"text-blue-600":"text-red-600",bgColor:t?.netResult>=0?"bg-blue-50 dark:bg-blue-950":"bg-red-50 dark:bg-red-950",borderColor:t?.netResult>=0?"border-blue-200 dark:border-blue-800":"border-red-200 dark:border-red-800"},{title:"A Receber (Pendente)",value:t?.overdue||0,icon:St,color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-950",borderColor:"border-orange-200 dark:border-orange-800"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:o.map((n,u)=>{const f=n.icon;return e.jsxs(ge,{className:`${n.bgColor} ${n.borderColor} border-2 transition-all hover:shadow-md`,children:[e.jsxs(Se,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ke,{className:"text-sm font-medium text-muted-foreground",children:n.title}),e.jsx(f,{className:`h-4 w-4 ${n.color}`})]}),e.jsx(ve,{children:l?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):e.jsxs("div",{children:[e.jsx("div",{className:`text-2xl font-bold ${n.color}`,children:ye(n.value)}),n.showNet&&n.netValue!==n.value&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Líquido: ",e.jsx("span",{className:"font-semibold",children:ye(n.netValue)})]})]})})]},u)})})}const Ie={income:"#22c55e",expense:"#ef4444",pie:["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#6366f1","#f97316"]};function Vs({cashFlowData:t,expenseDistribution:l,projectedCashFlow:o,loading:n}){const u=p.useMemo(()=>!t||t.length===0?[]:t.map(c=>({...c,date:Z(Le(c.date),"dd/MM",{locale:Ee})})),[t]),f=p.useMemo(()=>!l||l.length===0?[]:l,[l]),x=p.useMemo(()=>!o||o.length===0?[]:o.map(c=>({...c,date:Z(Le(c.date),"dd/MM",{locale:Ee})})),[o]);return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Fluxo de Caixa"}),e.jsx(Oe,{children:"Receitas vs Despesas por período"})]}),e.jsx(ve,{children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):u.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhum dado disponível"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(rs,{data:u,children:[e.jsx(yt,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(bt,{tick:{fontSize:12},tickFormatter:c=>`R$ ${(c/1e3).toFixed(0)}k`}),e.jsx(it,{formatter:c=>`R$ ${c.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(vt,{}),e.jsx(jt,{dataKey:"income",name:"Receitas",fill:Ie.income,radius:[4,4,0,0]}),e.jsx(jt,{dataKey:"expenses",name:"Despesas",fill:Ie.expense,radius:[4,4,0,0]})]})})})]}),e.jsxs(ge,{children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Análise Financeira"}),e.jsx(Oe,{children:"Distribuição de despesas e projeção de caixa"})]}),e.jsx(ve,{children:e.jsxs(kt,{defaultValue:"expenses",className:"w-full",children:[e.jsxs(Et,{className:"grid w-full grid-cols-2",children:[e.jsx(et,{value:"expenses",children:"Despesas"}),e.jsx(et,{value:"projection",children:"Projeção (30 dias)"})]}),e.jsx(gt,{value:"expenses",className:"mt-4",children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):f.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhuma despesa registrada"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(as,{children:[e.jsx(ns,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:c,percent:r})=>`${c}: ${(r*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:f.map((c,r)=>e.jsx(ss,{fill:Ie.pie[r%Ie.pie.length]},`cell-${r}`))}),e.jsx(it,{formatter:c=>`R$ ${c.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}})]})})}),e.jsx(gt,{value:"projection",className:"mt-4",children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):x.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhuma projeção disponível"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(is,{data:x,children:[e.jsx(yt,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(bt,{tick:{fontSize:12},tickFormatter:c=>`R$ ${(c/1e3).toFixed(0)}k`}),e.jsx(it,{formatter:c=>`R$ ${c.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(vt,{}),e.jsx(os,{type:"monotone",dataKey:"balance",name:"Saldo Projetado",stroke:"#3b82f6",strokeWidth:2,dot:{r:3}})]})})})]})})]})]})}const Us={paid:"success",pending:"warning",overdue:"destructive"},Hs={paid:"Pago",pending:"Pendente",overdue:"Vencido"};function Ws({transactions:t,loading:l,onEdit:o,onDelete:n,onGenerateReceipt:u,filters:f,onFiltersChange:x}){const[c,r]=p.useState(f?.search||""),h=j=>{r(j),x({...f,search:j})},w=(j,T)=>{x({...f,[j]:T==="all"?null:T})},S=()=>{r(""),x({type:null,status:null,search:null})},D=f?.type||f?.status||f?.search;return e.jsxs(ge,{children:[e.jsx(Se,{children:e.jsx(ke,{children:"Histórico de Transações"})}),e.jsxs(ve,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ls,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Buscar por descrição...",value:c,onChange:j=>h(j.target.value),className:"pl-9"})]}),e.jsxs(_e,{value:f?.type||"all",onValueChange:j=>w("type",j),children:[e.jsx(Ce,{className:"w-full sm:w-[180px]",children:e.jsx(we,{placeholder:"Tipo"})}),e.jsxs(Ne,{children:[e.jsx(oe,{value:"all",children:"Todos os tipos"}),e.jsx(oe,{value:"income",children:"Receita"}),e.jsx(oe,{value:"expense",children:"Despesa"})]})]}),e.jsxs(_e,{value:f?.status||"all",onValueChange:j=>w("status",j),children:[e.jsx(Ce,{className:"w-full sm:w-[180px]",children:e.jsx(we,{placeholder:"Status"})}),e.jsxs(Ne,{children:[e.jsx(oe,{value:"all",children:"Todos os status"}),e.jsx(oe,{value:"paid",children:"Pago"}),e.jsx(oe,{value:"pending",children:"Pendente"}),e.jsx(oe,{value:"overdue",children:"Vencido"})]})]}),D&&e.jsx(Y,{variant:"outline",size:"icon",onClick:S,className:"flex-shrink-0",children:e.jsx(lt,{className:"h-4 w-4"})})]}),l?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando transações..."}):t.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma transação encontrada."}):e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs($t,{children:[e.jsx(Dt,{children:e.jsxs(tt,{children:[e.jsx(de,{className:"w-[100px]",children:"Data"}),e.jsx(de,{children:"Descrição"}),e.jsx(de,{className:"w-[120px]",children:"Categoria"}),e.jsx(de,{className:"w-[150px]",children:"Paciente"}),e.jsx(de,{className:"w-[120px] text-right",children:"Valor"}),e.jsx(de,{className:"w-[100px]",children:"Status"}),e.jsx(de,{className:"w-[100px] text-right",children:"Ações"})]})}),e.jsx(Rt,{children:t.map(j=>e.jsxs(tt,{children:[e.jsx(ue,{className:"font-medium",children:Z(new Date(j.transaction_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee})}),e.jsx(ue,{className:"max-w-[200px] truncate",children:j.description}),e.jsx(ue,{children:e.jsx(ct,{variant:"outline",children:j.category||(j.type==="income"?"Receita":"Despesa")})}),e.jsx(ue,{className:"max-w-[150px] truncate",children:j.patient?.name||"-"}),e.jsxs(ue,{className:`text-right font-semibold ${j.type==="income"?"text-green-600":"text-red-600"}`,children:[j.type==="income"?"+":"-",ye(j.amount)]}),e.jsx(ue,{children:e.jsx(ct,{variant:Us[j.status]||"default",children:Hs[j.status]||j.status})}),e.jsx(ue,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[j.type==="income"&&j.status==="paid"&&u&&e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>u(j),className:"h-8 w-8",title:"Gerar Recibo",children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>o(j),className:"h-8 w-8",title:"Editar",children:e.jsx(Pt,{className:"h-4 w-4"})}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>n(j.id),className:"h-8 w-8 text-destructive hover:text-destructive",title:"Excluir",children:e.jsx(Nt,{className:"h-4 w-4"})})]})})]},j.id))})]})})]})]})}function Ks(t,l,{checkForDefaultPrevented:o=!0}={}){return function(u){if(t?.(u),o===!1||!u.defaultPrevented)return l?.(u)}}function Gs(t,l){typeof t=="function"?t(l):t!=null&&(t.current=l)}function At(...t){return l=>t.forEach(o=>Gs(o,l))}function Xs(...t){return p.useCallback(At(...t),t)}function Js(t,l=[]){let o=[];function n(f,x){const c=p.createContext(x),r=o.length;o=[...o,x];function h(S){const{scope:D,children:j,...T}=S,B=D?.[t][r]||c,V=p.useMemo(()=>T,Object.values(T));return p.createElement(B.Provider,{value:V},j)}function w(S,D){const j=D?.[t][r]||c,T=p.useContext(j);if(T)return T;if(x!==void 0)return x;throw new Error(`\`${S}\` must be used within \`${f}\``)}return h.displayName=f+"Provider",[h,w]}const u=()=>{const f=o.map(x=>p.createContext(x));return function(c){const r=c?.[t]||f;return p.useMemo(()=>({[`__scope${t}`]:{...c,[t]:r}}),[c,r])}};return u.scopeName=t,[n,Ys(u,...l)]}function Ys(...t){const l=t[0];if(t.length===1)return l;const o=()=>{const n=t.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(f){const x=n.reduce((c,{useScope:r,scopeName:h})=>{const S=r(f)[`__scope${h}`];return{...c,...S}},{});return p.useMemo(()=>({[`__scope${l.scopeName}`]:x}),[x])}};return o.scopeName=l.scopeName,o}function Ot(t){const l=p.useRef(t);return p.useEffect(()=>{l.current=t}),p.useMemo(()=>(...o)=>{var n;return(n=l.current)===null||n===void 0?void 0:n.call(l,...o)},[])}function Qs({prop:t,defaultProp:l,onChange:o=()=>{}}){const[n,u]=Zs({defaultProp:l,onChange:o}),f=t!==void 0,x=f?t:n,c=Ot(o),r=p.useCallback(h=>{if(f){const S=typeof h=="function"?h(t):h;S!==t&&c(S)}else u(h)},[f,t,u,c]);return[x,r]}function Zs({defaultProp:t,onChange:l}){const o=p.useState(t),[n]=o,u=p.useRef(n),f=Ot(l);return p.useEffect(()=>{u.current!==n&&(f(n),u.current=n)},[n,u,f]),o}function er(t){const l=p.useRef({value:t,previous:t});return p.useMemo(()=>(l.current.value!==t&&(l.current.previous=l.current.value,l.current.value=t),l.current.previous),[t])}const tr=globalThis?.document?p.useLayoutEffect:()=>{};function sr(t){const[l,o]=p.useState(void 0);return tr(()=>{if(t){o({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const f=u[0];let x,c;if("borderBoxSize"in f){const r=f.borderBoxSize,h=Array.isArray(r)?r[0]:r;x=h.inlineSize,c=h.blockSize}else x=t.offsetWidth,c=t.offsetHeight;o({width:x,height:c})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else o(void 0)},[t]),l}const zt=p.forwardRef((t,l)=>{const{children:o,...n}=t,u=p.Children.toArray(o),f=u.find(ar);if(f){const x=f.props.children,c=u.map(r=>r===f?p.Children.count(x)>1?p.Children.only(null):p.isValidElement(x)?x.props.children:null:r);return p.createElement(ut,Pe({},n,{ref:l}),p.isValidElement(x)?p.cloneElement(x,void 0,c):null)}return p.createElement(ut,Pe({},n,{ref:l}),o)});zt.displayName="Slot";const ut=p.forwardRef((t,l)=>{const{children:o,...n}=t;return p.isValidElement(o)?p.cloneElement(o,{...nr(n,o.props),ref:l?At(l,o.ref):o.ref}):p.Children.count(o)>1?p.Children.only(null):null});ut.displayName="SlotClone";const rr=({children:t})=>p.createElement(p.Fragment,null,t);function ar(t){return p.isValidElement(t)&&t.type===rr}function nr(t,l){const o={...l};for(const n in l){const u=t[n],f=l[n];/^on[A-Z]/.test(n)?u&&f?o[n]=(...c)=>{f(...c),u(...c)}:u&&(o[n]=u):n==="style"?o[n]={...u,...f}:n==="className"&&(o[n]=[u,f].filter(Boolean).join(" "))}return{...t,...o}}const ir=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Lt=ir.reduce((t,l)=>{const o=p.forwardRef((n,u)=>{const{asChild:f,...x}=n,c=f?zt:l;return p.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),p.createElement(c,Pe({},x,{ref:u}))});return o.displayName=`Primitive.${l}`,{...t,[l]:o}},{}),It="Switch",[or]=Js(It),[lr,cr]=or(It),dr=p.forwardRef((t,l)=>{const{__scopeSwitch:o,name:n,checked:u,defaultChecked:f,required:x,disabled:c,value:r="on",onCheckedChange:h,...w}=t,[S,D]=p.useState(null),j=Xs(l,re=>D(re)),T=p.useRef(!1),B=S?!!S.closest("form"):!0,[V=!1,ne]=Qs({prop:u,defaultProp:f,onChange:h});return p.createElement(lr,{scope:o,checked:V,disabled:c},p.createElement(Lt.button,Pe({type:"button",role:"switch","aria-checked":V,"aria-required":x,"data-state":qt(V),"data-disabled":c?"":void 0,disabled:c,value:r},w,{ref:j,onClick:Ks(t.onClick,re=>{ne(ie=>!ie),B&&(T.current=re.isPropagationStopped(),T.current||re.stopPropagation())})})),B&&p.createElement(pr,{control:S,bubbles:!T.current,name:n,value:r,checked:V,required:x,disabled:c,style:{transform:"translateX(-100%)"}}))}),ur="SwitchThumb",hr=p.forwardRef((t,l)=>{const{__scopeSwitch:o,...n}=t,u=cr(ur,o);return p.createElement(Lt.span,Pe({"data-state":qt(u.checked),"data-disabled":u.disabled?"":void 0},n,{ref:l}))}),pr=t=>{const{control:l,checked:o,bubbles:n=!0,...u}=t,f=p.useRef(null),x=er(o),c=sr(l);return p.useEffect(()=>{const r=f.current,h=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(h,"checked").set;if(x!==o&&S){const D=new Event("click",{bubbles:n});S.call(r,o),r.dispatchEvent(D)}},[x,o,n]),p.createElement("input",Pe({type:"checkbox","aria-hidden":!0,defaultChecked:o},u,{tabIndex:-1,ref:f,style:{...t.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function qt(t){return t?"checked":"unchecked"}const Bt=dr,mr=hr,ht=p.forwardRef(({className:t,...l},o)=>e.jsx(Bt,{className:xt("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...l,ref:o,children:e.jsx(mr,{className:xt("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ht.displayName=Bt.displayName;const fr=[{value:"consulta",label:"Consulta"},{value:"plano_mensal",label:"Plano Mensal"},{value:"outros",label:"Outros"}],xr=[{value:"aluguel",label:"Aluguel"},{value:"marketing",label:"Marketing"},{value:"software",label:"Software"},{value:"outros",label:"Outros"}],gr=[{value:"pix",label:"PIX"},{value:"credit",label:"Cartão de Crédito"},{value:"debit",label:"Cartão de Débito"},{value:"cash",label:"Dinheiro"},{value:"transfer",label:"Transferência Bancária"},{value:"other",label:"Outro"}];function vr({open:t,onOpenChange:l,transaction:o,patients:n=[],services:u=[],nutritionistId:f,onSave:x}){const{toast:c}=st(),[r,h]=p.useState({type:"income",category:"",patient_id:"none",service_id:"none",description:"",amount:"",transaction_date:Z(new Date,"yyyy-MM-dd"),isPaid:!0,due_date:"",isInstallment:!1,installments:2,payment_method:"pix",fee_percentage:"",attachment_file:null,attachment_url:null}),[w,S]=p.useState(!1);p.useEffect(()=>{h(o?{type:o.type||"income",category:o.category||"",patient_id:o.patient_id||"none",service_id:"none",description:o.description||"",amount:o.amount?.toString()||"",transaction_date:o.transaction_date?Z(new Date(o.transaction_date+"T00:00:00"),"yyyy-MM-dd"):Z(new Date,"yyyy-MM-dd"),isPaid:o.status==="paid",due_date:o.due_date?Z(new Date(o.due_date+"T00:00:00"),"yyyy-MM-dd"):"",isInstallment:!1,installments:2,payment_method:o.payment_method||"pix",fee_percentage:o.fee_percentage?.toString()||"",attachment_file:null,attachment_url:o.attachment_url||null}:{type:"income",category:"",patient_id:"none",service_id:"none",description:"",amount:"",transaction_date:Z(new Date,"yyyy-MM-dd"),isPaid:!0,due_date:"",isInstallment:!1,installments:2,payment_method:"pix",fee_percentage:"",attachment_file:null,attachment_url:null})},[o,t]);const D=p.useMemo(()=>{const i=parseFloat(r.amount)||0,m=parseFloat(r.fee_percentage)||0;if(i===0)return 0;if((r.payment_method==="credit"||r.payment_method==="debit")&&m>0){const C=i*m/100;return i-C}return i},[r.amount,r.fee_percentage,r.payment_method]),j=i=>{const m=i.target.files?.[0];if(m){if(m.size>10*1024*1024){c({title:"Erro",description:"O arquivo deve ter no máximo 10MB.",variant:"destructive"});return}h(C=>({...C,attachment_file:m}))}},T=()=>{h(i=>({...i,attachment_file:null,attachment_url:null}))},B=async()=>{if(!r.attachment_file||!f)return null;S(!0);try{const i=r.attachment_file.name.split(".").pop(),m=`${f}/${Date.now()}_${Math.random().toString(36).substring(7)}.${i}`,{error:C}=await ze.storage.from("financial-docs").upload(m,r.attachment_file,{cacheControl:"3600",upsert:!1});if(C)throw C;const{data:{publicUrl:s}}=ze.storage.from("financial-docs").getPublicUrl(m);return s}catch(i){return console.error("Error uploading attachment:",i),c({title:"Erro",description:"Não foi possível fazer upload do arquivo.",variant:"destructive"}),null}finally{S(!1)}},V=i=>{h(m=>({...m,type:i,category:"",patient_id:i==="expense"?"none":m.patient_id||"none",service_id:i==="expense"?"none":m.service_id||"none",isInstallment:i==="expense"?m.isInstallment:!1}))},ne=i=>{if(!i||i==="none"){h(C=>({...C,service_id:"none",amount:"",description:""}));return}const m=u.find(C=>C.id.toString()===i);m&&h(C=>({...C,service_id:i,amount:m.price.toString(),description:m.name,category:m.category||C.category}))},re=async i=>{if(i.preventDefault(),!r.description||!r.amount||!r.category)return;let m=r.attachment_url;if(r.attachment_file&&(m=await B(),!m&&r.attachment_file&&c({title:"Aviso",description:"Salvando sem anexo. Tente fazer upload novamente depois.",variant:"default"})),o?.id){const C={id:o.id,type:r.type,category:r.category,patient_id:r.type==="income"&&r.patient_id&&r.patient_id!=="none"&&r.patient_id!==""?r.patient_id:null,description:r.description,amount:parseFloat(r.amount),transaction_date:r.transaction_date,status:r.isPaid?"paid":"pending",due_date:!r.isPaid&&r.due_date?r.due_date:null,payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:m};x(C);return}if(r.type==="expense"&&r.isInstallment&&r.installments>1){const s=parseFloat(r.amount)/r.installments,a=Le(r.transaction_date+"T00:00:00"),d=[];for(let g=0;g<r.installments;g++){const v=cs(a,g);d.push({type:"expense",category:r.category,description:`${r.description} (${g+1}/${r.installments})`,amount:s,transaction_date:Z(v,"yyyy-MM-dd"),status:g===0&&r.isPaid?"paid":"pending",due_date:Z(v,"yyyy-MM-dd"),payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:g===0?m:null})}x({multiple:!0,transactions:d})}else{const C={type:r.type,category:r.category,patient_id:r.type==="income"&&r.patient_id&&r.patient_id!=="none"&&r.patient_id!==""?r.patient_id:null,description:r.description,amount:parseFloat(r.amount),transaction_date:r.transaction_date,status:r.isPaid?"paid":"pending",due_date:!r.isPaid&&r.due_date?r.due_date:null,payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:m};x(C)}},ie=r.type==="income"?fr:xr,U=r.isInstallment&&r.amount?(parseFloat(r.amount)/r.installments).toFixed(2):"0.00";return e.jsx(Be,{open:t,onOpenChange:l,children:e.jsxs(Ve,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsx(He,{children:o?"Editar Transação":"Nova Transação"})}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Tipo de Transação"}),e.jsx(kt,{value:r.type,onValueChange:V,className:"mt-2",children:e.jsxs(Et,{className:"grid w-full grid-cols-2",children:[e.jsx(et,{value:"income",children:"Receita"}),e.jsx(et,{value:"expense",children:"Despesa"})]})})]}),r.type==="income"&&!o&&u.length>0&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"service_id",children:"Serviço (opcional)"}),e.jsxs(_e,{value:r.service_id||"none",onValueChange:ne,children:[e.jsx(Ce,{children:e.jsx(we,{placeholder:"Selecione um serviço para preencher automaticamente"})}),e.jsxs(Ne,{children:[e.jsx(oe,{value:"none",children:"Nenhum"}),u.map(i=>e.jsxs(oe,{value:i.id.toString(),children:[i.name," - ",ye(i.price)]},i.id))]})]})]}),e.jsxs("div",{children:[e.jsxs(Q,{htmlFor:"category",children:["Categoria ",r.type==="income"?"da Receita":"da Despesa"," *"]}),e.jsxs(_e,{required:!0,value:r.category,onValueChange:i=>h(m=>({...m,category:i})),children:[e.jsx(Ce,{children:e.jsx(we,{placeholder:"Selecione uma categoria"})}),e.jsx(Ne,{children:ie.map(i=>e.jsx(oe,{value:i.value,children:i.label},i.value))})]})]}),r.type==="income"&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"patient_id",children:"Paciente (opcional)"}),e.jsxs(_e,{value:r.patient_id||"none",onValueChange:i=>h(m=>({...m,patient_id:i==="none"?"":i})),children:[e.jsx(Ce,{children:e.jsx(we,{placeholder:"Selecione um paciente"})}),e.jsxs(Ne,{children:[e.jsx(oe,{value:"none",children:"Nenhum"}),n.map(i=>e.jsx(oe,{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"description",children:"Descrição *"}),e.jsx(he,{id:"description",required:!0,value:r.description,onChange:i=>h(m=>({...m,description:i.target.value})),placeholder:"Ex: Consulta com João Silva"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"amount",children:"Valor Total (R$) *"}),e.jsx(he,{id:"amount",type:"number",step:"0.01",min:"0",required:!0,value:r.amount,onChange:i=>h(m=>({...m,amount:i.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"transaction_date",children:"Data *"}),e.jsx(he,{id:"transaction_date",type:"date",required:!0,value:r.transaction_date,onChange:i=>h(m=>({...m,transaction_date:i.target.value}))})]})]}),r.type==="expense"&&!o&&e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Q,{htmlFor:"isInstallment",children:"Parcelado?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dividir esta despesa em múltiplas parcelas"})]}),e.jsx(ht,{id:"isInstallment",checked:r.isInstallment,onCheckedChange:i=>h(m=>({...m,isInstallment:i}))})]}),r.type==="expense"&&r.isInstallment&&!o&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"installments",children:"Número de Parcelas *"}),e.jsxs(_e,{value:r.installments.toString(),onValueChange:i=>h(m=>({...m,installments:parseInt(i)})),children:[e.jsx(Ce,{children:e.jsx(we,{})}),e.jsx(Ne,{children:[2,3,4,5,6,7,8,9,10,11,12].map(i=>e.jsxs(oe,{value:i.toString(),children:[i,"x"]},i))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Valor por Parcela"}),e.jsx("div",{className:"h-10 flex items-center text-lg font-semibold text-primary",children:ye(parseFloat(U))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Q,{htmlFor:"isPaid",children:"Já foi pago?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isInstallment?"Marque se a primeira parcela já foi paga":"Marque se o pagamento já foi realizado"})]}),e.jsx(ht,{id:"isPaid",checked:r.isPaid,onCheckedChange:i=>h(m=>({...m,isPaid:i}))})]}),!r.isPaid&&!r.isInstallment&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"due_date",children:"Data de Vencimento *"}),e.jsx(he,{id:"due_date",type:"date",required:!r.isPaid,value:r.due_date,onChange:i=>h(m=>({...m,due_date:i.target.value})),min:r.transaction_date})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"payment_method",children:"Método de Pagamento"}),e.jsxs(_e,{value:r.payment_method,onValueChange:i=>h(m=>({...m,payment_method:i,fee_percentage:i==="credit"||i==="debit"?m.fee_percentage:""})),children:[e.jsx(Ce,{children:e.jsx(we,{placeholder:"Selecione o método de pagamento"})}),e.jsx(Ne,{children:gr.map(i=>e.jsx(oe,{value:i.value,children:i.label},i.value))})]})]}),(r.payment_method==="credit"||r.payment_method==="debit")&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"fee_percentage",children:"Taxa (%)"}),e.jsx(he,{id:"fee_percentage",type:"number",step:"0.01",min:"0",max:"100",value:r.fee_percentage,onChange:i=>h(m=>({...m,fee_percentage:i.target.value})),placeholder:"Ex: 2.5"}),r.amount&&r.fee_percentage&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Valor Líquido Estimado: ",e.jsx("span",{className:"font-semibold text-primary",children:ye(D)})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"attachment",children:"Anexar Comprovante/NF (opcional)"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[r.attachment_file?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx(_t,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-sm truncate",children:r.attachment_file.name}),e.jsx(Y,{type:"button",variant:"ghost",size:"icon",onClick:T,className:"h-8 w-8",children:e.jsx(lt,{className:"w-4 h-4"})})]}):r.attachment_url?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx(_t,{className:"w-4 h-4"}),e.jsx("a",{href:r.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-sm text-primary hover:underline truncate",children:"Ver anexo existente"}),e.jsx(Y,{type:"button",variant:"ghost",size:"icon",onClick:T,className:"h-8 w-8",children:e.jsx(lt,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(he,{id:"attachment",type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:j,className:"flex-1",disabled:w})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formatos aceitos: PDF, JPG, PNG, DOC, DOCX (máx. 10MB)"})]})]}),e.jsxs(pt,{children:[e.jsx(Y,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(Y,{type:"submit",children:o?"Atualizar":"Salvar"})]})]})]})})}const wt=[{value:"consulta",label:"Consulta"},{value:"plano_mensal",label:"Plano Mensal"},{value:"outros",label:"Outros"}];function jr({open:t,onOpenChange:l,nutritionistId:o}){const{toast:n}=st(),[u,f]=p.useState([]),[x,c]=p.useState(!0),[r,h]=p.useState(!1),[w,S]=p.useState(null),[D,j]=p.useState(null),[T,B]=p.useState({name:"",description:"",price:"",category:"consulta"});p.useEffect(()=>{t&&o&&V()},[t,o]);const V=async()=>{if(o){c(!0);try{const i=await dt(o);f(i)}catch{n({title:"Erro",description:"Não foi possível carregar os serviços.",variant:"destructive"})}finally{c(!1)}}},ne=()=>{S(null),B({name:"",description:"",price:"",category:"consulta"}),h(!0)},re=i=>{S(i),B({name:i.name,description:i.description||"",price:i.price.toString(),category:i.category||"consulta"}),h(!0)},ie=async i=>{if(i.preventDefault(),!T.name||!T.price){n({title:"Erro",description:"Preencha todos os campos obrigatórios.",variant:"destructive"});return}try{await ds({id:w?.id,nutritionist_id:o,name:T.name,description:T.description,price:parseFloat(T.price),category:T.category}),n({title:"Sucesso!",description:`Serviço ${w?"atualizado":"criado"} com sucesso.`}),h(!1),S(null),V()}catch(m){n({title:"Erro",description:`Não foi possível salvar o serviço: ${m.message}`,variant:"destructive"})}},U=async i=>{try{await us(i),n({title:"Sucesso!",description:"Serviço excluído com sucesso."}),j(null),V()}catch{n({title:"Erro",description:"Não foi possível excluir o serviço.",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Be,{open:t,onOpenChange:l,children:e.jsxs(Ve,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsx(He,{children:"Gerenciar Serviços"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Y,{onClick:ne,children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Novo Serviço"]})}),x?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando serviços..."}):u.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhum serviço cadastrado. Clique em "Novo Serviço" para começar.'}):e.jsx(ge,{children:e.jsx(ve,{className:"p-0",children:e.jsxs($t,{children:[e.jsx(Dt,{children:e.jsxs(tt,{children:[e.jsx(de,{children:"Nome"}),e.jsx(de,{children:"Descrição"}),e.jsx(de,{children:"Categoria"}),e.jsx(de,{className:"text-right",children:"Preço"}),e.jsx(de,{className:"text-right",children:"Ações"})]})}),e.jsx(Rt,{children:u.map(i=>e.jsxs(tt,{children:[e.jsx(ue,{className:"font-medium",children:i.name}),e.jsx(ue,{className:"max-w-[300px] truncate",children:i.description||"-"}),e.jsx(ue,{children:wt.find(m=>m.value===i.category)?.label||i.category}),e.jsx(ue,{className:"text-right font-semibold",children:ye(i.price)}),e.jsx(ue,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>re(i),className:"h-8 w-8",children:e.jsx(Pt,{className:"h-4 w-4"})}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>j(i.id),className:"h-8 w-8 text-destructive hover:text-destructive",children:e.jsx(Nt,{className:"h-4 w-4"})})]})})]},i.id))})]})})})]})]})}),e.jsx(Be,{open:r,onOpenChange:h,children:e.jsxs(Ve,{children:[e.jsx(Ue,{children:e.jsx(He,{children:w?"Editar Serviço":"Novo Serviço"})}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"name",children:"Nome do Serviço *"}),e.jsx(he,{id:"name",required:!0,value:T.name,onChange:i=>B(m=>({...m,name:i.target.value})),placeholder:"Ex: Consulta Individual"})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"description",children:"Descrição"}),e.jsx(he,{id:"description",value:T.description,onChange:i=>B(m=>({...m,description:i.target.value})),placeholder:"Descrição opcional do serviço"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"category",children:"Categoria *"}),e.jsxs(_e,{required:!0,value:T.category,onValueChange:i=>B(m=>({...m,category:i})),children:[e.jsx(Ce,{children:e.jsx(we,{})}),e.jsx(Ne,{children:wt.map(i=>e.jsx(oe,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"price",children:"Preço (R$) *"}),e.jsx(he,{id:"price",type:"number",step:"0.01",min:"0",required:!0,value:T.price,onChange:i=>B(m=>({...m,price:i.target.value})),placeholder:"0.00"})]})]}),e.jsxs(pt,{children:[e.jsx(Y,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(Y,{type:"submit",children:w?"Atualizar":"Salvar"})]})]})]})}),e.jsx(We,{open:!!D,onOpenChange:i=>!i&&j(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Xe,{children:"Confirmar Exclusão"}),e.jsx(Je,{children:"Tem certeza que deseja excluir este serviço? Esta ação não pode ser desfeita."})]}),e.jsxs(Ye,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>U(D),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function yr({nutritionistId:t,onUpdate:l}){const{toast:o}=st(),[n,u]=p.useState([]),[f,x]=p.useState(!0),[c,r]=p.useState(null),[h,w]=p.useState(null),[S,D]=p.useState(null),[j,T]=p.useState("");p.useEffect(()=>{t&&B()},[t]);const B=async()=>{if(t){x(!0);try{const i=await hs(t);u(i)}catch(i){console.error("Error loading pending payments:",i),o({title:"Erro",description:"Não foi possível carregar os pagamentos pendentes.",variant:"destructive"})}finally{x(!1)}}},V=async i=>{try{await ps(i,"paid"),o({title:"Sucesso!",description:"Pagamento confirmado com sucesso."}),r(null),B(),l&&l()}catch{o({title:"Erro",description:"Não foi possível confirmar o pagamento.",variant:"destructive"})}},ne=async i=>{try{await Tt(i),o({title:"Sucesso!",description:"Pagamento cancelado e removido."}),w(null),B(),l&&l()}catch{o({title:"Erro",description:"Não foi possível cancelar o pagamento.",variant:"destructive"})}},re=async i=>{if(!j){o({title:"Erro",description:"Selecione uma data para reagendar.",variant:"destructive"});return}try{await ms(i,j),o({title:"Sucesso!",description:"Cobrança reagendada com sucesso."}),D(null),T(""),B(),l&&l()}catch{o({title:"Erro",description:"Não foi possível reagendar a cobrança.",variant:"destructive"})}},ie=i=>{const m=Le(i+"T00:00:00");return ws(m)?"Hoje":Ns(m)?"Ontem":Z(m,"dd 'de' MMMM",{locale:Ee})},U=i=>{const m=Le(i+"T00:00:00"),C=new Date;C.setHours(0,0,0,0);const s=new Date(m);s.setHours(0,0,0,0);const a=C-s;return Math.floor(a/(1e3*60*60*24))};return f||n.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs(ge,{className:"mb-6 border-2 border-orange-200 dark:border-orange-800 bg-orange-50/50 dark:bg-orange-950/20",children:[e.jsxs(Se,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(St,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"}),e.jsx(ke,{className:"text-lg font-semibold text-orange-900 dark:text-orange-100",children:"Pagamentos Pendentes"})]}),e.jsx(Oe,{className:"text-orange-700 dark:text-orange-300",children:"Consultas realizadas aguardando confirmação de pagamento"})]}),e.jsx(ve,{children:e.jsx("div",{className:"space-y-3",children:n.map(i=>{const m=U(i.transaction_date),C=m>0;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-4 bg-white dark:bg-gray-900 rounded-lg border border-orange-200 dark:border-orange-800 shadow-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base text-foreground truncate",children:i.description||`Consulta com ${i.patient?.name||"Paciente"}`}),C&&e.jsxs(ct,{variant:"destructive",className:"text-xs",children:[m," ",m===1?"dia":"dias"," atrasado"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:i.patient?.name||"Paciente não identificado"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:ie(i.transaction_date)}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-semibold text-orange-600 dark:text-orange-400",children:ye(i.amount)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs(Y,{size:"sm",onClick:()=>r(i.id),className:"flex-1 sm:flex-initial bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Cs,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Confirmar Pagamento"}),e.jsx("span",{className:"sm:hidden",children:"Confirmar"})]}),e.jsxs(Y,{size:"sm",variant:"outline",onClick:()=>D({id:i.id,date:i.transaction_date}),className:"flex-1 sm:flex-initial",children:[e.jsx(Ht,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Reagendar"}),e.jsx("span",{className:"sm:hidden",children:"Reagendar"})]}),e.jsxs(Y,{size:"sm",variant:"outline",onClick:()=>w(i.id),className:"flex-1 sm:flex-initial text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(zs,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"}),e.jsx("span",{className:"sm:hidden",children:"Cancelar"})]})]})]},i.id)})})})]}),e.jsx(We,{open:!!c,onOpenChange:i=>!i&&r(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Xe,{children:"Confirmar Pagamento"}),e.jsx(Je,{children:"Tem certeza que deseja confirmar este pagamento? Esta ação marcará a transação como paga."})]}),e.jsxs(Ye,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>V(c),className:"bg-green-600 hover:bg-green-700",children:"Confirmar Pagamento"})]})]})}),e.jsx(We,{open:!!h,onOpenChange:i=>!i&&w(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Xe,{children:"Cancelar Pagamento"}),e.jsx(Je,{children:"Tem certeza que deseja cancelar este pagamento? Esta ação removerá a transação permanentemente."})]}),e.jsxs(Ye,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>ne(h),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Cancelar Pagamento"})]})]})}),e.jsx(Be,{open:!!S,onOpenChange:i=>!i&&D(null),children:e.jsxs(Ve,{children:[e.jsx(Ue,{children:e.jsx(He,{children:"Reagendar Cobrança"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"reschedule_date",children:"Nova Data *"}),e.jsx(he,{id:"reschedule_date",type:"date",required:!0,value:j||(S?S.date:""),onChange:i=>T(i.target.value),min:Z(new Date,"yyyy-MM-dd")})]})}),e.jsxs(pt,{children:[e.jsx(Y,{variant:"outline",onClick:()=>D(null),children:"Cancelar"}),e.jsx(Y,{onClick:()=>re(S.id),children:"Reagendar"})]})]})})]})}function br({nutritionistId:t}){const[l,o]=p.useState([]),[n,u]=p.useState(!0);p.useEffect(()=>{t&&f()},[t]);const f=async()=>{if(t){u(!0);try{const{data:r,error:h}=await ze.from("financial_transactions").select(`
                    patient_id,
                    amount,
                    patient:user_profiles!financial_transactions_patient_id_fkey(
                        id,
                        name,
                        avatar_url,
                        cpf
                    )
                `).eq("nutritionist_id",t).eq("type","income").eq("status","paid").not("patient_id","is",null);if(h){console.error("Error loading top patients:",h);return}const w={};r.forEach(D=>{if(!D.patient_id)return;const j=D.patient_id;w[j]||(w[j]={patient:D.patient,total:0}),w[j].total+=parseFloat(D.amount||0)});const S=Object.values(w).sort((D,j)=>j.total-D.total).slice(0,3);o(S)}catch(r){console.error("Error loading top patients:",r)}finally{u(!1)}}},x=r=>{if(!r)return"?";const h=r.trim().split(" ");return h.length>=2?(h[0][0]+h[h.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()},c=r=>r===0?{icon:Me,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-950",borderColor:"border-yellow-300 dark:border-yellow-700",label:"1º"}:r===1?{icon:As,color:"text-gray-400",bgColor:"bg-gray-50 dark:bg-gray-950",borderColor:"border-gray-300 dark:border-gray-700",label:"2º"}:r===2?{icon:Wt,color:"text-amber-700",bgColor:"bg-amber-50 dark:bg-amber-950",borderColor:"border-amber-300 dark:border-amber-700",label:"3º"}:{icon:Me,color:"text-muted-foreground",bgColor:"bg-muted",borderColor:"border-border",label:`${r+1}º`};return n?e.jsxs(ge,{children:[e.jsx(Se,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Top Pacientes"]})}),e.jsx(ve,{children:e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Carregando..."})})]}):l.length===0?e.jsxs(ge,{children:[e.jsxs(Se,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Top Pacientes"]}),e.jsx(Oe,{children:"Maiores contribuidores (LTV)"})]}),e.jsx(ve,{children:e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhum dado disponível"})})]}):e.jsxs(ge,{children:[e.jsxs(Se,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-yellow-600"}),"Top 3 Pacientes"]}),e.jsx(Oe,{children:"Maiores contribuidores (LTV)"})]}),e.jsx(ve,{children:e.jsx("div",{className:"space-y-3",children:l.map((r,h)=>{const w=c(h),S=w.icon;return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border-2 ${w.bgColor} ${w.borderColor} hover:shadow-md transition-all`,children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${w.bgColor} ${w.borderColor} border-2 flex items-center justify-center`,children:e.jsx(S,{className:`w-5 h-5 ${w.color}`})}),e.jsxs(Ss,{className:"h-10 w-10 flex-shrink-0",children:[e.jsx(ks,{src:r.patient?.avatar_url,alt:r.patient?.name}),e.jsx(Es,{children:x(r.patient?.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-xs font-bold ${w.color}`,children:w.label}),e.jsx("p",{className:"font-semibold text-sm truncate",children:r.patient?.name||"Paciente não identificado"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total investido"})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:e.jsx("p",{className:`font-bold text-lg ${w.color}`,children:ye(r.total)})})]},r.patient?.id||h)})})})]})}function _r(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t||0)}async function Cr(t,l,o){const n=new Ds("p","mm","a4"),u=n.internal.pageSize.getWidth(),f=n.internal.pageSize.getHeight(),x=20;let c=x;const r=[41,128,185],h=[51,51,51];if(n.setFillColor(...r),n.rect(0,0,u,40,"F"),n.setTextColor(255,255,255),n.setFontSize(20),n.setFont("helvetica","bold"),n.text("RECIBO",u/2,20,{align:"center"}),n.setFontSize(10),n.setFont("helvetica","normal"),n.text("Gerado por HipoZero",u/2,28,{align:"center"}),c=50,n.setTextColor(...h),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("PRESTADOR DE SERVIÇOS",x,c),c+=8,n.setFontSize(10),n.setFont("helvetica","normal"),l?.name&&(n.text(`Nome: ${l.name}`,x,c),c+=6),l?.crn&&(n.text(`CRN: ${l.crn}`,x,c),c+=6),l?.address){const U=l.address;let i="";U.street&&(i+=U.street),U.city&&(i+=i?`, ${U.city}`:U.city),U.state&&(i+=i?` - ${U.state}`:U.state),U.zip&&(i+=i?`, CEP: ${U.zip}`:`CEP: ${U.zip}`),i&&(n.text(`Endereço: ${i}`,x,c),c+=6)}l?.phone&&(n.text(`Telefone: ${l.phone}`,x,c),c+=6),l?.email&&(n.text(`E-mail: ${l.email}`,x,c),c+=6),c+=5,n.setDrawColor(200,200,200),n.line(x,c,u-x,c),c+=10,n.setFontSize(12),n.setFont("helvetica","bold"),n.text("RECIBO DE PAGAMENTO",u/2,c,{align:"center"}),c+=10,n.setFontSize(10),n.setFont("helvetica","normal");const w=o?.name||"Paciente",S=o?.cpf?` (CPF: ${wr(o.cpf)})`:"",D=parseFloat(t.amount||0),j=_r(D).replace("R$","").trim(),T=t.description||"Serviço de nutrição",B=t.transaction_date?Z(new Date(t.transaction_date+"T00:00:00"),"dd 'de' MMMM 'de' yyyy",{locale:Ee}):Z(new Date,"dd 'de' MMMM 'de' yyyy",{locale:Ee}),V=`Recebi de ${w}${S} a importância de ${j} (${Nr(D)}) referente a ${T}.`,ne=u-x*2;n.splitTextToSize(V,ne).forEach((U,i)=>{n.text(U,x,c),c+=6}),c+=10,n.text(`Data: ${B}`,x,c),c+=15,n.setDrawColor(150,150,150),n.line(x,c,u-x,c),c+=8,n.setFontSize(9),n.setTextColor(150,150,150),n.text("Assinatura do Prestador de Serviços",u/2,c,{align:"center"}),c=f-20,n.setFontSize(8),n.setTextColor(150,150,150),n.text("Este documento foi gerado automaticamente pelo sistema HipoZero",u/2,c,{align:"center"}),n.text("Para fins de comprovação fiscal e reembolso de planos de saúde",u/2,c+5,{align:"center"});const ie=`recibo_${w.replace(/\s+/g,"_")}_${Z(new Date,"yyyy-MM-dd")}.pdf`;n.save(ie)}function wr(t){if(!t)return"";const l=t.replace(/\D/g,"");return l.length!==11?t:l.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}function Nr(t){const l=["","um","dois","três","quatro","cinco","seis","sete","oito","nove","dez","onze","doze","treze","quatorze","quinze","dezesseis","dezessete","dezoito","dezenove"],o=["","","vinte","trinta","quarenta","cinquenta","sessenta","setenta","oitenta","noventa"],n=["","cento","duzentos","trezentos","quatrocentos","quinhentos","seiscentos","setecentos","oitocentos","novecentos"];if(t===0)return"zero reais";if(t>=1e6)return"valor muito alto";let u="";const f=Math.floor(t),x=Math.round((t-f)*100);return f>0&&(u+=Ae(f,l,o,n),u+=f===1?" real":" reais"),x>0&&(u&&(u+=" e "),u+=Ae(x,l,o,n),u+=x===1?" centavo":" centavos"),u}function Ae(t,l,o,n){if(t===0)return"";if(t<20)return l[t];if(t<100){const u=Math.floor(t/10),f=t%10;return o[u]+(f>0?" e "+l[f]:"")}if(t<1e3){const u=Math.floor(t/100),f=t%100;return u===1&&f===0?"cem":n[u]+(f>0?" e "+Ae(f,l,o,n):"")}if(t<1e6){const u=Math.floor(t/1e3),f=t%1e3;return Ae(u,l,o,n)+" mil"+(f>0?" e "+Ae(f,l,o,n):"")}return""}function Sr(t,l="csv"){if(!t||t.length===0)throw new Error("Nenhum registro para exportar");const o=t.map(n=>({Data:n.transaction_date?l(new Date(n.transaction_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee}):"-",Tipo:n.type==="income"?"Receita":"Despesa",Categoria:n.category||"-",Descrição:n.description||"-","Nome do Paciente":n.patient?.name||"-","CPF do Paciente":n.patient?.cpf?kr(n.patient.cpf):"-","Valor (R$)":parseFloat(n.amount||0).toFixed(2),Status:Er(n.status),"Data de Vencimento":n.due_date?l(new Date(n.due_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee}):"-"}));if(l==="csv"){const n=Mt.unparse(o,{delimiter:";",encoding:"UTF-8"}),u="\uFEFF",f=new Blob([u+n],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a"),c=URL.createObjectURL(f);x.setAttribute("href",c),x.setAttribute("download",`relatorio_financeiro_${l(new Date,"yyyy-MM-dd")}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(c)}else throw new Error(`Formato ${l} não suportado. Use 'csv'.`)}function kr(t){if(!t)return"";const l=t.replace(/\D/g,"");return l.length!==11?t:l.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}function Er(t){return{paid:"Pago",pending:"Pendente",overdue:"Vencido"}[t]||t}function oa(){const{user:t}=Kt(),{toast:l}=st(),[o,n]=p.useState(new Date),[u,f]=p.useState({income:0,expenses:0,netResult:0,overdue:0}),[x,c]=p.useState([]),[r,h]=p.useState([]),[w,S]=p.useState([]),[D,j]=p.useState([]),[T,B]=p.useState([]),[V,ne]=p.useState([]),[re,ie]=p.useState(!0),[U,i]=p.useState(!1),[m,C]=p.useState(!1),[s,a]=p.useState(null),[d,g]=p.useState(null),[v,P]=p.useState({type:null,status:null,search:null}),[L,le]=p.useState(1e4);p.useEffect(()=>{t?.id&&Rs(t.id).then(y=>{y.monthlyFinancialGoal&&le(y.monthlyFinancialGoal)}).catch(console.error)},[t?.id]);const ee=p.useCallback(async()=>{if(t?.id){ie(!0);try{const y=Ts(o),I=await fs(y,t.id);f(I);const k=o.getFullYear(),$=o.getMonth()+1,z=await xs(t.id,{...v,month:$,year:k},{page:1,pageSize:100},{field:"transaction_date",order:"desc"});c(z.data);const[b,W,J]=await Promise.all([gs(t.id,y,"day"),vs(t.id,y),js(t.id,new Date)]);if(j(b),B(W),ne(J),r.length===0){const O=await ys(t.id);h(O)}if(w.length===0){const O=await dt(t.id);S(O)}}catch(y){console.error("Error loading financial data:",y),l({title:"Erro",description:"Não foi possível carregar os dados financeiros.",variant:"destructive"})}finally{ie(!1)}}},[t,o,v,r.length,l]);p.useEffect(()=>{ee()},[ee]);const F=()=>{a(null),i(!0)},H=y=>{a(y),i(!0)},N=async y=>{try{if(!t?.id)return;if(y.multiple&&y.transactions){const I=y.transactions.map(k=>({...k,nutritionist_id:t.id}));await bs(I),l({title:"Sucesso!",description:`${y.transactions.length} parcelas criadas com sucesso.`})}else await _s({...y,nutritionist_id:t.id}),l({title:"Sucesso!",description:`Transação ${y.id?"atualizada":"criada"} com sucesso.`});i(!1),a(null),ee()}catch(I){console.error("Error saving transaction:",I),l({title:"Erro",description:`Não foi possível salvar a transação: ${I.message}`,variant:"destructive"})}},te=async y=>{try{await Tt(y),l({title:"Sucesso!",description:"Transação deletada com sucesso."}),g(null),ee()}catch(I){console.error("Error deleting transaction:",I),l({title:"Erro",description:"Não foi possível deletar a transação.",variant:"destructive"})}},E=()=>{const y=x.map(b=>({Data:Z(new Date(b.transaction_date+"T00:00:00"),"dd/MM/yyyy"),Tipo:b.type==="income"?"Receita":"Despesa",Descrição:b.description,Categoria:b.category||"-",Paciente:b.patient?.name||"-",Valor:b.amount.toFixed(2),Status:b.status==="paid"?"Pago":b.status==="pending"?"Pendente":"Vencido"})),I=Mt.unparse(y),k=new Blob([I],{type:"text/csv;charset=utf-8;"}),$=document.createElement("a"),z=URL.createObjectURL(k);$.setAttribute("href",z),$.setAttribute("download",`financeiro_hipozero_${Z(o,"yyyy-MM")}.csv`),document.body.appendChild($),$.click(),document.body.removeChild($),l({title:"Exportado!",description:"Arquivo CSV baixado com sucesso."})},M=()=>{try{Sr(x,"csv"),l({title:"Exportado!",description:"Relatório completo exportado para contador."})}catch(y){console.error("Error exporting report:",y),l({title:"Erro",description:y.message||"Não foi possível exportar o relatório.",variant:"destructive"})}},_=async y=>{if(t?.id)try{const{data:I,error:k}=await ze.from("user_profiles").select("name, crn, address, phone, email").eq("id",t.id).single();if(k)throw new Error("Não foi possível carregar os dados do nutricionista.");let $=null;if(y.patient_id){const{data:z,error:b}=await ze.from("user_profiles").select("name, cpf").eq("id",y.patient_id).single();!b&&z&&($=z)}await Cr(y,I,$),l({title:"Sucesso!",description:"Recibo gerado e baixado com sucesso."})}catch(I){console.error("Error generating receipt:",I),l({title:"Erro",description:I.message||"Não foi possível gerar o recibo.",variant:"destructive"})}},X=()=>{try{$s(x,u,Z(o,"MMMM yyyy")),l({title:"Exportado!",description:"Arquivo PDF gerado com sucesso."})}catch(y){console.error("Error exporting PDF:",y),l({title:"Erro",description:"Não foi possível gerar o PDF.",variant:"destructive"})}},K=p.useMemo(()=>L<=0?0:Math.min(u.income/L*100,100),[u.income,L]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("main",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:e.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Financeiro"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie receitas, despesas e acompanhe o fluxo de caixa"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(Y,{onClick:()=>C(!0),variant:"outline",size:"lg",children:[e.jsx(Xt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Gerenciar Serviços"}),e.jsx("span",{className:"sm:hidden",children:"Serviços"})]}),e.jsxs(Jt,{children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(Y,{variant:"outline",size:"lg",children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Exportar"}),e.jsx(Qt,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(Zt,{align:"end",children:[e.jsxs(at,{onClick:X,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),e.jsxs(at,{onClick:E,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]}),e.jsxs(at,{onClick:M,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Relatório Completo (CSV)"]})]})]}),e.jsxs(Y,{onClick:F,size:"lg",children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Nova Transação"]})]})]}),e.jsx(yr,{nutritionistId:t?.id,onUpdate:ee}),e.jsx("div",{className:"mb-6",children:e.jsx(he,{type:"month",value:Z(o,"yyyy-MM"),onChange:y=>n(new Date(y.target.value+"-02")),className:"w-full sm:w-auto"})}),e.jsx("div",{className:"mb-4",children:e.jsx(ge,{className:"border-2",children:e.jsx(ve,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(es,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:"Meta Financeira Mensal"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Receita Atual: "}),e.jsxs("span",{className:"font-semibold text-primary",children:["R$ ",u.income.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Meta: "}),e.jsxs("span",{className:"font-semibold",children:["R$ ",L.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsx("div",{children:e.jsx("span",{className:`font-semibold ${L-u.income>0?"text-orange-600":"text-green-600"}`,children:L-u.income>0?`Faltam R$ ${Math.max(0,L-u.income).toLocaleString("pt-BR",{minimumFractionDigits:2})}`:`Superou em R$ ${Math.abs(L-u.income).toLocaleString("pt-BR",{minimumFractionDigits:2})}`})})]})]}),e.jsxs("div",{className:"flex-1 w-full sm:w-auto sm:min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"font-semibold",children:[K.toFixed(1),"%"]})]}),e.jsx(ts,{value:K,className:"h-2"})]})]})})})}),e.jsx("div",{className:"mb-6",children:e.jsx(Bs,{summary:u,loading:re})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:e.jsx(Vs,{cashFlowData:D,expenseDistribution:T,projectedCashFlow:V,loading:re})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6 mb-6",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsx(Ws,{transactions:x,loading:re,onEdit:H,onDelete:y=>g(y),onGenerateReceipt:_,filters:v,onFiltersChange:P})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(br,{nutritionistId:t?.id})})]})]})}),e.jsx(vr,{open:U,onOpenChange:i,transaction:s,patients:r,services:w,nutritionistId:t?.id,onSave:N}),e.jsx(jr,{open:m,onOpenChange:y=>{C(y),!y&&t?.id&&dt(t.id).then(S).catch(console.error)},nutritionistId:t?.id}),e.jsx(We,{open:!!d,onOpenChange:y=>!y&&g(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Xe,{children:"Confirmar Exclusão"}),e.jsx(Je,{children:"Tem certeza que deseja excluir esta transação? Esta ação não pode ser desfeita."})]}),e.jsxs(Ye,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>te(d),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}export{oa as default};
