import{r as p,j as e,C as N,c as v,d as b,e as _,a5 as G,b as z,a as H,B as C,S as U,T as K}from"./index-DL6VMzkS.js";import{A as T,a as P}from"./alert-WBazYc63.js";import{T as y,a as R,b as m,c as r,d as q,e as a}from"./table-BdTjTst7.js";import{R as Z}from"./ReferenceValuesModal-DnQIoq6i.js";import{B as J}from"./badge-CMQ26CgR.js";import{getMealPlanById as Q,getReferenceValues as W,deleteReferenceValues as X}from"./meal-plan-queries-DYlpSijV.js";import{A as Y}from"./arrow-left-Co1jqMwu.js";import{R as ee,l as se,T as ae,p as te}from"./generateCategoricalChart-BeBeaROZ.js";import{P as re,a as ie}from"./PieChart-kOVPY6hD.js";import"./input-CMIeflfg.js";import"./label-c61kF7fH.js";import"./index-BCjh5bjs.js";import"./slider-BlQMCEyH.js";import"./popover-D1PQqJd4.js";import"./extends-CF3RwP-h.js";import"./info-op9RHOfw.js";import"./save-CMbYHicL.js";import"./nutrition-calculations-DjYFS08l.js";import"./date-C2sroe8F.js";import"./query-helpers-mbysFH2_.js";const S={vitamin_a:{value:900,unit:"mcg RAE",name:"Vitamina A"},vitamin_c:{value:90,unit:"mg",name:"Vitamina C"},vitamin_d:{value:15,unit:"mcg",name:"Vitamina D"},vitamin_e:{value:15,unit:"mg",name:"Vitamina E"},vitamin_b12:{value:2.4,unit:"mcg",name:"Vitamina B12"},folate:{value:400,unit:"mcg DFE",name:"Folato"},calcium:{value:1e3,unit:"mg",name:"Cálcio"},iron:{value:8,unit:"mg",name:"Ferro"},magnesium:{value:400,unit:"mg",name:"Magnésio"},phosphorus:{value:700,unit:"mg",name:"Fósforo"},potassium:{value:3400,unit:"mg",name:"Potássio"},zinc:{value:11,unit:"mg",name:"Zinco"},fiber:{value:25,unit:"g",name:"Fibras"},sodium:{value:2300,unit:"mg",name:"Sódio",isLimit:!0}},ne=l=>{if(!l||!l.meals)return{};const n={};return Object.keys(S).forEach(j=>{n[j]=0}),l.meals.forEach(j=>{j.foods&&j.foods.forEach(d=>{d.food&&Object.keys(S).forEach(g=>{const u=parseFloat(d.food[g])||0;if(u>0){const s=d.quantity/100;n[g]+=u*s}})})}),n},le=(l,n,j=!1)=>{if(!l||!n)return"unknown";const d=l/n*100;return j?d<=100?"adequate":d<=150?"adjust":"inadequate":d>=100?"adequate":d>=75?"adjust":"inadequate"},ce=(l,n=!1)=>{switch(l){case"adequate":return"default";case"adjust":return"secondary";case"inadequate":return"destructive";default:return"outline"}},de=(l,n=!1)=>{if(n)switch(l){case"adequate":return"Adequado";case"adjust":return"Atenção";case"inadequate":return"Excesso";default:return"-"}else switch(l){case"adequate":return"Adequado";case"adjust":return"Abaixo";case"inadequate":return"Insuficiente";default:return"-"}};function oe({plan:l}){const n=p.useMemo(()=>ne(l),[l]),j=["vitamin_a","vitamin_c","vitamin_d","vitamin_e","vitamin_b12","folate"],d=["calcium","iron","magnesium","phosphorus","potassium","zinc"],g=["fiber","sodium"],u=s=>{const h=S[s],i=n[s]||0,F=le(i,h.value,h.isLimit),w=h.value?i/h.value*100:0;return e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:h.name}),e.jsx(a,{className:"text-right",children:i.toFixed(1)}),e.jsx(a,{className:"text-right",children:h.value}),e.jsx(a,{className:"text-center",children:h.unit}),e.jsxs(a,{className:"text-right",children:[w.toFixed(0),"%"]}),e.jsx(a,{className:"text-center",children:e.jsx(J,{variant:ce(F,h.isLimit),children:de(F,h.isLimit)})})]},s)};return e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsx(b,{children:"Micronutrientes e Valores DRI"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Comparação com Dietary Reference Intakes (DRIs) para adultos"})]}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-lg",children:"Vitaminas"}),e.jsxs(y,{children:[e.jsx(R,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Nutriente"}),e.jsx(r,{className:"text-right",children:"Prescrito"}),e.jsx(r,{className:"text-right",children:"DRI"}),e.jsx(r,{className:"text-center",children:"Unidade"}),e.jsx(r,{className:"text-right",children:"% DRI"}),e.jsx(r,{className:"text-center",children:"Status"})]})}),e.jsx(q,{children:j.map(u)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-lg",children:"Minerais"}),e.jsxs(y,{children:[e.jsx(R,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Nutriente"}),e.jsx(r,{className:"text-right",children:"Prescrito"}),e.jsx(r,{className:"text-right",children:"DRI"}),e.jsx(r,{className:"text-center",children:"Unidade"}),e.jsx(r,{className:"text-right",children:"% DRI"}),e.jsx(r,{className:"text-center",children:"Status"})]})}),e.jsx(q,{children:d.map(u)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-lg",children:"Outros Nutrientes"}),e.jsxs(y,{children:[e.jsx(R,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Nutriente"}),e.jsx(r,{className:"text-right",children:"Prescrito"}),e.jsx(r,{className:"text-right",children:"Recomendação"}),e.jsx(r,{className:"text-center",children:"Unidade"}),e.jsx(r,{className:"text-right",children:"% Rec."}),e.jsx(r,{className:"text-center",children:"Status"})]})}),e.jsx(q,{children:g.map(u)})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 border-t pt-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"DRI:"})," Dietary Reference Intake (Ingestão Dietética de Referência)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Adequado:"})," Atinge 100% ou mais da recomendação"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Abaixo:"})," Entre 75-99% da recomendação"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Insuficiente:"})," Menos de 75% da recomendação"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Atenção/Excesso (Sódio):"})," Acima do limite recomendado"]}),e.jsxs("p",{className:"text-amber-600",children:[e.jsx("strong",{children:"Nota:"})," Valores DRI são médias para adultos de 19-50 anos. Ajuste conforme necessidades individuais."]})]})]})]})}const M=["#8884d8","#82ca9d","#ffc658","#ff8042","#0088fe","#00c49f","#ffbb28","#ff6b6b","#a57ed0"],Ee=()=>{const{patientId:l,planId:n}=G(),j=z(),{toast:d}=H(),[g,u]=p.useState(!0),[s,h]=p.useState(null),[i,F]=p.useState(null),[w,k]=p.useState(!1);p.useEffect(()=>{E()},[n]);const E=async()=>{u(!0);try{const[t,x]=await Promise.all([Q(n),W(n)]);if(t.error)throw t.error;h(t.data),F(x.data)}catch(t){console.error("Erro ao carregar dados:",t),d({title:"Erro",description:"Não foi possível carregar o resumo nutricional",variant:"destructive"})}finally{u(!1)}},L=()=>{k(!1),E()},$=async()=>{if(window.confirm("Tem certeza que deseja excluir os valores de referência? Esta ação não pode ser desfeita.")){u(!0);try{const t=await X(n);if(t.error)throw t.error;d({title:"Valores deletados",description:"Valores de referência foram excluídos com sucesso."}),E()}catch(t){console.error("Erro ao deletar valores:",t),d({title:"Erro",description:"Não foi possível excluir os valores de referência.",variant:"destructive"})}finally{u(!1)}}},B=()=>!s||!s.meals?[]:s.meals.map(t=>({name:t.name,value:t.total_calories||0})).filter(t=>t.value>0),O=()=>{if(!i)return null;const t=parseFloat(i.weight_kg),x=parseFloat(i.total_energy_kcal);let f,V,I;return i.macro_mode==="percentage"?(f=x*i.protein_percentage/4,V=x*i.carbs_percentage/4,I=x*i.fat_percentage/9):(f=t*i.protein_g_per_kg,V=t*i.carbs_g_per_kg,I=t*i.fat_g_per_kg),{protein:f,carbs:V,fat:I}},o=(t,x)=>{const f=t/x*100;return f>=95&&f<=105?"adequate":f>=85&&f<=115?"adjust":"inadequate"},A=t=>{switch(t){case"adequate":return"text-green-600 bg-green-50";case"adjust":return"text-yellow-600 bg-yellow-50";case"inadequate":return"text-red-600 bg-red-50";default:return""}},D=B(),c=O();return g?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx("p",{children:"Carregando..."})}):s?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>j(`/nutritionist/patients/${l}/meal-plan`),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Resumo Nutricional"}),e.jsx("p",{className:"text-muted-foreground",children:s.name})]})]}),e.jsxs(C,{onClick:()=>k(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Configurar Valores de Referência"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(N,{children:[e.jsx(v,{children:e.jsx(b,{children:"Distribuição de Calorias por Refeição"})}),e.jsx(_,{children:D.length>0?e.jsx(ee,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ie,{data:D,cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:x})=>`${t}: ${(x*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:D.map((t,x)=>e.jsx(se,{fill:M[x%M.length]},`cell-${x}`))}),e.jsx(ae,{formatter:t=>`${t} kcal`}),e.jsx(te,{})]})}):e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Nenhuma refeição com calorias registradas"})})]}),e.jsxs(N,{children:[e.jsx(v,{children:e.jsx(b,{children:"Totais Diários"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Energia"}),e.jsx("div",{className:"text-3xl font-bold",children:s.daily_calories?.toFixed(0)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Proteínas"}),e.jsx("div",{className:"text-3xl font-bold",children:s.daily_protein?.toFixed(1)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Carboidratos"}),e.jsx("div",{className:"text-3xl font-bold",children:s.daily_carbs?.toFixed(1)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Gorduras"}),e.jsx("div",{className:"text-3xl font-bold",children:s.daily_fat?.toFixed(1)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})})]})]}),i&&c&&e.jsxs(N,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{children:"Comparação com Valores de Referência"}),e.jsxs(C,{variant:"destructive",size:"sm",onClick:$,disabled:g,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Excluir Valores"]})]})}),e.jsx(_,{children:e.jsxs(y,{children:[e.jsx(R,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Macronutriente"}),e.jsx(r,{className:"text-right",children:"Prescrito"}),e.jsx(r,{className:"text-right",children:"Meta"}),e.jsx(r,{className:"text-right",children:"Adequação (%)"}),e.jsx(r,{children:"Status"})]})}),e.jsxs(q,{children:[e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:"Energia (kcal)"}),e.jsx(a,{className:"text-right",children:s.daily_calories?.toFixed(0)||0}),e.jsx(a,{className:"text-right",children:i.total_energy_kcal}),e.jsxs(a,{className:"text-right",children:[(s.daily_calories/i.total_energy_kcal*100).toFixed(1),"%"]}),e.jsx(a,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${A(o(s.daily_calories,i.total_energy_kcal))}`,children:o(s.daily_calories,i.total_energy_kcal)==="adequate"?"Adequado":o(s.daily_calories,i.total_energy_kcal)==="adjust"?"Ajustar":"Inadequado"})})]}),e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:"Proteínas (g)"}),e.jsx(a,{className:"text-right",children:s.daily_protein?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:c.protein.toFixed(1)}),e.jsxs(a,{className:"text-right",children:[(s.daily_protein/c.protein*100).toFixed(1),"%"]}),e.jsx(a,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${A(o(s.daily_protein,c.protein))}`,children:o(s.daily_protein,c.protein)==="adequate"?"Adequado":o(s.daily_protein,c.protein)==="adjust"?"Ajustar":"Inadequado"})})]}),e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:"Carboidratos (g)"}),e.jsx(a,{className:"text-right",children:s.daily_carbs?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:c.carbs.toFixed(1)}),e.jsxs(a,{className:"text-right",children:[(s.daily_carbs/c.carbs*100).toFixed(1),"%"]}),e.jsx(a,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${A(o(s.daily_carbs,c.carbs))}`,children:o(s.daily_carbs,c.carbs)==="adequate"?"Adequado":o(s.daily_carbs,c.carbs)==="adjust"?"Ajustar":"Inadequado"})})]}),e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:"Gorduras (g)"}),e.jsx(a,{className:"text-right",children:s.daily_fat?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:c.fat.toFixed(1)}),e.jsxs(a,{className:"text-right",children:[(s.daily_fat/c.fat*100).toFixed(1),"%"]}),e.jsx(a,{children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${A(o(s.daily_fat,c.fat))}`,children:o(s.daily_fat,c.fat)==="adequate"?"Adequado":o(s.daily_fat,c.fat)==="adjust"?"Ajustar":"Inadequado"})})]})]})]})})]}),e.jsxs(N,{children:[e.jsx(v,{children:e.jsx(b,{children:"Distribuição por Refeição"})}),e.jsx(_,{children:e.jsxs(y,{children:[e.jsx(R,{children:e.jsxs(m,{children:[e.jsx(r,{children:"Refeição"}),e.jsx(r,{children:"Horário"}),e.jsx(r,{className:"text-right",children:"Calorias"}),e.jsx(r,{className:"text-right",children:"Proteínas (g)"}),e.jsx(r,{className:"text-right",children:"Carboidratos (g)"}),e.jsx(r,{className:"text-right",children:"Gorduras (g)"})]})}),e.jsxs(q,{children:[s.meals&&s.meals.map(t=>e.jsxs(m,{children:[e.jsx(a,{className:"font-medium",children:t.name}),e.jsx(a,{children:t.meal_time||"-"}),e.jsx(a,{className:"text-right",children:t.total_calories?.toFixed(0)||0}),e.jsx(a,{className:"text-right",children:t.total_protein?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:t.total_carbs?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:t.total_fat?.toFixed(1)||0})]},t.id)),e.jsxs(m,{className:"font-bold bg-muted/50",children:[e.jsx(a,{colSpan:2,children:"TOTAL"}),e.jsx(a,{className:"text-right",children:s.daily_calories?.toFixed(0)||0}),e.jsx(a,{className:"text-right",children:s.daily_protein?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:s.daily_carbs?.toFixed(1)||0}),e.jsx(a,{className:"text-right",children:s.daily_fat?.toFixed(1)||0})]})]})]})})]}),e.jsx(oe,{plan:s}),!i&&e.jsx(T,{children:e.jsxs(P,{children:["Configure os valores de referência para ver a análise de adequação nutricional.",e.jsx(C,{variant:"link",className:"px-2",onClick:()=>k(!0),children:"Configurar agora"})]})}),e.jsx(Z,{isOpen:w,onClose:L,planId:n})]}):e.jsx("div",{className:"p-8",children:e.jsx(T,{variant:"destructive",children:e.jsx(P,{children:"Plano não encontrado"})})})};export{Ee as default};
