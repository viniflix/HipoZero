import{q as de,a5 as ce,b as oe,r,s as O,j as e,B as me,C as x,e as h,c as xe,d as he,a1 as fe,$ as v,J as ue,K as pe,M as je,N as Ne,ad as ge}from"./index-DL6VMzkS.js";import"./input-CMIeflfg.js";import{D as q}from"./date-input-zI4YYSYu.js";import{L}from"./label-c61kF7fH.js";import{S as be,a as ve,b as ye,c as we,d as j}from"./select-BdvFUaSV.js";import{B as y}from"./badge-CMQ26CgR.js";import{T as _e,a as De,b as E,c as J}from"./tabs-DCPXMA94.js";import{a as A,b as U,c as Ce,g as Se,d as Me,f as $,e as z}from"./food-diary-queries-zEi6z3uS.js";import{A as Te}from"./arrow-left-Co1jqMwu.js";import{U as b}from"./utensils-Dewe3o1J.js";import{T as ke}from"./trending-up-D1f-Js4G.js";import{A as Le}from"./activity-CnuM4kS2.js";import{F as Ae}from"./flame-C4A5vNmC.js";import{C as F}from"./calendar-jIa_pVTS.js";import{C as G}from"./clock-C7XUf3fk.js";import{F as Fe}from"./file-text-C4_WSc72.js";import"./calendar-BOiwl0x6.js";import"./endOfMonth-fINJXo8H.js";import"./addMonths-Dpdm5UWc.js";import"./isSameDay-CfSWIrxC.js";import"./chevron-left-HK0xeE4r.js";import"./popover-D1PQqJd4.js";import"./extends-CF3RwP-h.js";import"./pt-BR-faZp8-Xc.js";import"./parseISO-DyXfBXdu.js";import"./date-C2sroe8F.js";import"./query-helpers-mbysFH2_.js";const K=de("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),os=()=>{const{patientId:a}=ce(),c=oe(),[o,n]=r.useState(!0),[m,t]=r.useState(""),[l,f]=r.useState("meals"),[N,p]=r.useState([]),[w,H]=r.useState([]),[_,W]=r.useState(null),[Q,X]=r.useState(null),[u,P]=r.useState({startDate:"",endDate:"",mealType:""}),[D,Y]=r.useState(!1),[I,B]=r.useState(null),[Z,V]=r.useState([]),[ee,C]=r.useState(!1);r.useEffect(()=>{se()},[a]),r.useEffect(()=>{!o&&u.startDate&&u.endDate&&ae()},[u]);const se=async()=>{n(!0);try{const{data:s}=await O.from("user_profiles").select("name").eq("id",a).single();s&&t(s.name);const{data:i}=await O.from("meal_plans").select("start_date").eq("patient_id",a).eq("is_active",!0).order("created_at",{ascending:!1}).limit(1).maybeSingle(),d=new Date().toISOString().split("T")[0],g=i?.start_date||d;P({startDate:g,endDate:d,mealType:""});const{data:T}=await A(a,{startDate:g,endDate:d,mealType:""});p(T||[]);const{data:re}=await U(a,{startDate:g,endDate:d});H(re||[]);const{data:le}=await Ce(a,30);W(le);const k=new Date;k.setDate(k.getDate()-7);const ne=k.toISOString().split("T")[0],{data:ie}=await Se(a,ne,d);X(ie)}catch(s){console.error("Erro ao carregar dados:",s)}finally{n(!1)}},ae=async()=>{try{const{data:s}=await A(a,u);p(s||[]);const{data:i}=await U(a,u);H(i||[])}catch(s){console.error("Erro ao buscar refeições:",s)}},R=async s=>{B(s);const{data:i}=await Me(s.id);V(i||[]),C(!0)},S=(s,i)=>{P(d=>({...d,[s]:i}))},M=s=>({breakfast:"Café da Manhã",morning_snack:"Lanche da Manhã",lunch:"Almoço",afternoon_snack:"Lanche da Tarde",dinner:"Jantar",supper:"Ceia"})[s]||s,te=s=>({breakfast:{bg:"bg-orange-500",border:"#f97316"},morning_snack:{bg:"bg-yellow-500",border:"#eab308"},lunch:{bg:"bg-green-600",border:"#16a34a"},afternoon_snack:{bg:"bg-blue-500",border:"#3b82f6"},dinner:{bg:"bg-purple-600",border:"#9333ea"},supper:{bg:"bg-indigo-500",border:"#6366f1"}})[s]||{bg:"bg-[#5f6f52]",border:"#5f6f52"};return o?null:e.jsx("div",{className:"flex flex-col min-h-screen bg-background overflow-x-hidden",children:e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-6 py-4 md:py-6 min-w-0",children:[e.jsxs("div",{className:"mb-6 min-w-0",children:[e.jsxs(me,{variant:"ghost",size:"sm",onClick:()=>c(`/nutritionist/patients/${a}/hub?tab=nutrition`),className:"mb-3 -ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),"Voltar"]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2 break-words",children:[e.jsx(b,{className:"w-6 h-6 md:w-7 md:h-7 text-[#5f6f52] shrink-0"}),"Diário Alimentar"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 truncate",children:m})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Adesão 30d"}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-[#5f6f52] truncate",children:[_?.adherencePercentage||0,"%"]})]}),e.jsx(ke,{className:"w-6 h-6 text-[#5f6f52] opacity-30 flex-shrink-0"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Sequência"}),e.jsxs("p",{className:"text-xl md:text-2xl font-bold text-[#c4661f] truncate",children:[_?.currentStreak||0," dias"]})]}),e.jsx(Le,{className:"w-6 h-6 text-[#c4661f] opacity-30 flex-shrink-0"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Média Cal. 7d"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-foreground truncate",children:Q?.avgCaloriesPerDay||0})]}),e.jsx(Ae,{className:"w-6 h-6 text-orange-500 opacity-30 flex-shrink-0"})]})})}),e.jsx(x,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Refeições"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-foreground truncate",children:_?.totalMeals||0})]}),e.jsx(b,{className:"w-6 h-6 text-[#5f6f52] opacity-30 flex-shrink-0"})]})})})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(xe,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>Y(!D),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"text-base flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-[#5f6f52]"}),"Filtros"]}),e.jsx(fe,{className:v("w-5 h-5 text-muted-foreground transition-transform",D&&"rotate-180")})]})}),D&&e.jsx(h,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"start_date",className:"text-sm",children:"Data Inicial"}),e.jsx(q,{id:"start_date",value:u.startDate,onChange:s=>S("startDate",s),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"end_date",className:"text-sm",children:"Data Final"}),e.jsx(q,{id:"end_date",value:u.endDate,onChange:s=>S("endDate",s),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"meal_type",className:"text-sm",children:"Tipo de Refeição"}),e.jsxs(be,{value:u.mealType||"all",onValueChange:s=>S("mealType",s==="all"?"":s),children:[e.jsx(ve,{id:"meal_type",className:"h-9",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(we,{children:[e.jsx(j,{value:"all",children:"Todas"}),e.jsx(j,{value:"breakfast",children:"Café da Manhã"}),e.jsx(j,{value:"morning_snack",children:"Lanche da Manhã"}),e.jsx(j,{value:"lunch",children:"Almoço"}),e.jsx(j,{value:"afternoon_snack",children:"Lanche da Tarde"}),e.jsx(j,{value:"dinner",children:"Jantar"}),e.jsx(j,{value:"supper",children:"Ceia"})]})]})]})]})})]}),e.jsxs(_e,{value:l,onValueChange:f,children:[e.jsxs(De,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(E,{value:"meals",className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Refeições"}),e.jsx(y,{variant:"secondary",className:"ml-1",children:N.length})]}),e.jsxs(E,{value:"audit",className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Histórico"}),e.jsx(y,{variant:"secondary",className:"ml-1",children:w.length})]})]}),e.jsx(J,{value:"meals",className:"mt-0",children:N.length===0?e.jsx(x,{children:e.jsx(h,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma refeição registrada no período selecionado"})]})})}):e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsx(He,{meal:s,onClick:()=>R(s),getMealTypeLabel:M,getMealTypeColor:te},s.id))})}),e.jsx(J,{value:"audit",className:"mt-0",children:w.length===0?e.jsx(x,{children:e.jsx(h,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma alteração registrada no período"})]})})}):e.jsx("div",{className:"space-y-3",children:w.map((s,i)=>e.jsx(Pe,{log:s,getMealTypeLabel:M,onClick:async()=>{if(s.meal_id&&s.action!=="delete"){const{data:d}=await A(a,{},1,0),g=d?.find(T=>T.id===s.meal_id);g&&await R(g)}else if(s.action==="delete"){const d={meal_type:s.meal_type,meal_date:s.meal_date,meal_time:s.meal_time,total_calories:s.details?.total_calories||0,total_protein:s.details?.total_protein||0,total_carbs:s.details?.total_carbs||0,total_fat:s.details?.total_fat||0,meal_items:s.details?.meal_items||[],notes:s.details?.notes};B(d),V([s]),C(!0)}}},s.id||i))})})]}),I&&e.jsx(Ie,{meal:I,history:Z,open:ee,onClose:()=>C(!1),getMealTypeLabel:M})]})})},He=({meal:a,onClick:c,getMealTypeLabel:o,getMealTypeColor:n})=>{const m=n(a.meal_type);return e.jsx(x,{className:"hover:shadow-md transition-shadow cursor-pointer border-l-4",style:{borderLeftColor:m.border},onClick:c,children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:v("w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",m.bg),children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:o(a.meal_type)}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mt-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),new Date(a.meal_date).toLocaleDateString("pt-BR")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),a.meal_time]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 sm:gap-3 text-center text-xs flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Kcal"}),e.jsx("p",{className:"font-semibold text-[#5f6f52]",children:Math.round(a.total_calories)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"PTN"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_protein),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"CHO"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_carbs),"g"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"LIP"}),e.jsxs("p",{className:"font-semibold",children:[Math.round(a.total_fat),"g"]})]})]})]}),a.is_edited&&e.jsxs(y,{variant:"outline",className:"mt-3 text-xs",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Editada"]})]})})},Pe=({log:a,getMealTypeLabel:c,onClick:o})=>{const n=$(a),m=z(a.details),t=l=>l==="create"?"default":l==="update"?"secondary":"destructive";return e.jsx(x,{className:v("border-l-4 transition-shadow",n.borderColor.replace("border-","border-l-"),o&&"cursor-pointer hover:shadow-md"),onClick:o,children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(y,{variant:t(a.action),children:n.label}),a.meal_type&&e.jsx("span",{className:"text-sm font-medium truncate",children:c(a.meal_type)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),new Date(a.created_at).toLocaleDateString("pt-BR")]}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(G,{className:"w-3 h-3"}),new Date(a.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]}),m.length>0&&e.jsx("div",{className:v("text-xs space-y-1 pt-3 border-t",n.bgColor),children:m.map((l,f)=>e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium text-muted-foreground",children:[l.label,":"]}),l.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-through text-red-600",children:l.oldValue}),e.jsx("span",{children:"→"})]}),e.jsx("span",{className:"text-green-600 font-medium",children:l.newValue})]},f))})]})})},Ie=({meal:a,history:c,open:o,onClose:n,getMealTypeLabel:m})=>e.jsx(ue,{open:o,onOpenChange:n,children:e.jsxs(pe,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsxs(Ne,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-[#5f6f52]"}),m(a.meal_type)]}),e.jsxs(ge,{children:[new Date(a.meal_date).toLocaleDateString("pt-BR")," às ",a.meal_time]})]}),e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:"Totais Nutricionais"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold text-[#5f6f52]",children:Math.round(a.total_calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Proteínas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center p-3 bg-[#fefae0]/40 rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(a.total_fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:["Alimentos Consumidos (",a.meal_items?.length||0,")"]}),e.jsx("div",{className:"space-y-2",children:a.meal_items?.map((t,l)=>e.jsxs("div",{className:"p-3 bg-white rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:t.name}),e.jsxs(y,{variant:"outline",className:"text-xs",children:[t.quantity," ",t.unit||"g"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[Math.round(t.calories||0)," kcal"]}),e.jsxs("span",{children:[Math.round(t.protein||0),"g PTN"]}),e.jsxs("span",{children:[Math.round(t.carbs||0),"g CHO"]}),e.jsxs("span",{children:[Math.round(t.fat||0),"g LIP"]})]})]},l))})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-[#5f6f52]",children:"Observações"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-[#fefae0]/30 p-3 rounded border",children:a.notes})]}),c&&c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3 text-[#5f6f52]",children:"Histórico de Alterações"}),e.jsx("div",{className:"space-y-2",children:c.map((t,l)=>{const f=$(t),N=z(t.details);return e.jsxs("div",{className:v("p-3 rounded border text-sm",f.bgColor,f.borderColor),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(y,{className:v("text-xs",f.color),children:f.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(t.created_at).toLocaleDateString("pt-BR")," às"," ",new Date(t.created_at).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]}),N.length>0&&e.jsx("div",{className:"text-xs space-y-1",children:N.map((p,w)=>e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-medium",children:[p.label,":"]}),p.oldValue&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-through text-red-600",children:p.oldValue}),e.jsx("span",{children:"→"})]}),e.jsx("span",{className:"text-green-600 font-medium",children:p.newValue})]},w))})]},l)})})]})]})]})});export{os as default};
