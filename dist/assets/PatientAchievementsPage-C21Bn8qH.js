import{u as E,r as i,j as e,m as x,C as j,c as y,d as N,aq as C,e as b,O as P,H as I,W as u,s as v,ar as $,T}from"./index-BiAQYbha.js";import{P as w}from"./progress-Tq8EYPZY.js";import{B as O}from"./badge-CcZw3qQX.js";import{L as z}from"./lock-CtXbytK6.js";import{S as B}from"./star-BNHXrmMg.js";import{F}from"./flame-CFYexw1_.js";const L={trophy:C,award:u,target:T,flame:F,star:B,trending_up:$};function R(r){if(!r)return"Critério não disponível";try{const s=typeof r=="string"?JSON.parse(r):r;return s.type==="meals_logged"?`Registre ${s.count} refeições`:s.type==="days_streak"?`Mantenha ${s.days} dias consecutivos de registro`:s.type==="calories_goal_met"?`Atinja sua meta calórica ${s.times} vezes`:s.type==="protein_goal_met"?`Atinja sua meta de proteína ${s.times} vezes`:"Complete o desafio"}catch{return"Critério não disponível"}}function Q(){const{user:r}=E(),[s,_]=i.useState([]),[k,q]=i.useState(new Set),[A,S]=i.useState({}),[M,h]=i.useState(!0),[n,p]=i.useState({total:0,unlocked:0});i.useEffect(()=>{(async()=>{if(!r)return;h(!0);const{data:l,error:a}=await v.from("achievements").select("*").order("id",{ascending:!0});a?console.error("Erro ao buscar conquistas:",a):(_(l||[]),p(m=>({...m,total:l?.length||0})));const{data:d,error:c}=await v.from("user_achievements").select("achievement_id, achieved_at").eq("user_id",r.id);if(c)console.error("Erro ao buscar conquistas desbloqueadas:",c);else{const m=new Set(d?.map(o=>o.achievement_id)||[]),g={};d?.forEach(o=>{g[o.achievement_id]=o.achieved_at}),q(m),S(g),p(o=>({...o,unlocked:m.size}))}h(!1)})()},[r]);const D=t=>L[t]||u;if(M)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const f=n.total>0?Math.round(n.unlocked/n.total*100):0;return e.jsx("div",{className:"flex flex-col min-h-screen bg-background",children:e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-2",children:"Minhas Conquistas"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe seu progresso e desbloqueie conquistas especiais"})]}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-8",children:e.jsxs(j,{className:"bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-200",children:[e.jsx(y,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-6 h-6 text-yellow-600"}),"Progresso Geral"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[n.unlocked," / ",n.total]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conquistas desbloqueadas"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-3xl font-bold text-yellow-600",children:[f,"%"]})})]}),e.jsx(w,{value:f,className:"h-2 bg-yellow-200",indicatorClassName:"bg-yellow-500"})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map((t,l)=>{const a=k.has(t.id),d=D(t.icon_name),c=A[t.id];return e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1+l*.05},children:e.jsxs(j,{className:`h-full transition-all ${a?"border-yellow-300 shadow-md hover:shadow-lg":"opacity-50 grayscale hover:opacity-70"}`,children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-3 rounded-full flex-shrink-0 ${a?"bg-yellow-500":"bg-gray-400"}`,children:a?e.jsx(d,{className:"w-6 h-6 text-white"}):e.jsx(z,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(N,{className:"text-lg mb-1",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),a&&e.jsx(O,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 flex-shrink-0",children:"Desbloqueada"})]})}),e.jsxs(b,{className:"space-y-3",children:[!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pt-2 border-t border-border",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase mb-1",children:"Objetivo"}),e.jsx("p",{className:"text-sm text-foreground",children:R(t.criteria)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground uppercase",children:"Progresso"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0%"})]}),e.jsx(w,{value:0,className:"h-2 bg-gray-200",indicatorClassName:"bg-gray-400"})]})]}),a&&c&&e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Desbloqueada em ",P(new Date(c),"dd 'de' MMMM 'de' yyyy",{locale:I})]})})]})]})},t.id)})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-16 h-16 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Nenhuma conquista disponível no momento"})]})]})})}export{Q as default};
