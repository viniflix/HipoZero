import{u as ue,a as pe,r as a,F as d,s as c,j as e,m as b,C as x,c as u,d as p,w as f,e as g,J as ge,az as je,B as y,K as fe,M as ye,N as ve,ad as Ne,O as w}from"./index-BvWB-6Y-.js";import{T as be,a as we,b as D,c as _}from"./tabs-CA5k0aJI.js";import{I as v}from"./input-OBodSLFw.js";import{D as C}from"./date-input-NufpG6-F.js";import{L as n}from"./label-Dds-NHUC.js";import{W as De}from"./WeightChart-C9_DDYkp.js";import{S as U}from"./scale-B02K6JBe.js";import{D as $}from"./droplet-BdKopZMO.js";import{R as B}from"./ruler-CYjLqm7s.js";import{C as X}from"./camera-Bs6Kqlhh.js";import{R as Y,T as J}from"./generateCategoricalChart-DYL0xZdm.js";import{a as V,L as Q}from"./LineChart-BKiejqo7.js";import{C as Z}from"./CartesianGrid-BW0W2W8P.js";import{X as ee,Y as se}from"./YAxis-C8erclLc.js";import{P as _e}from"./plus-BWNKYoo4.js";import"./calendar-rgGv7qqU.js";import"./endOfMonth-Ca9QmV5D.js";import"./addMonths-hOFFPW3g.js";import"./isSameDay-CSO39H9U.js";import"./chevron-left-FDyjizdT.js";import"./popover-BK70NwGK.js";import"./extends-CF3RwP-h.js";import"./pt-BR-BMtVLtF7.js";import"./parseISO-DtrTOw4I.js";import"./minus-Doq1nRnQ.js";import"./trending-up-DCN4wKoA.js";import"./trending-down-Be-17Tpn.js";function Ze(){const{user:l}=ue(),{toast:i}=pe(),[r,te]=a.useState("peso"),[F,ae]=a.useState([]),[R,E]=a.useState([]),[N,re]=a.useState([]),[k,T]=a.useState([]),[ie,q]=a.useState(!0),[oe,j]=a.useState(!1),[de,le]=a.useState(null),[M,G]=a.useState(""),[S,W]=a.useState(""),[A,L]=a.useState(""),[P,z]=a.useState(""),[o,m]=a.useState(d(new Date,"yyyy-MM-dd")),h=a.useCallback(async()=>{if(!l)return;q(!0);const{data:s}=await c.from("growth_records").select("*").eq("patient_id",l.id).order("record_date",{ascending:!0});ae(s||[]),le(null);try{const{data:t}=await c.from("glycemia_records").select("*").eq("patient_id",l.id).order("record_date",{ascending:!0});E(t||[])}catch{E([])}try{const{data:t}=await c.from("progress_photos").select("*").eq("patient_id",l.id).order("photo_date",{ascending:!1});T(t||[])}catch{T([])}re(s||[]),q(!1)},[l]);a.useEffect(()=>{h()},[h]);const ce=async s=>{if(s.preventDefault(),!M||!o){i({title:"Erro",description:"Preencha todos os campos.",variant:"destructive"});return}const{error:t}=await c.from("growth_records").insert({patient_id:l.id,record_date:o,weight:parseFloat(M)});t?i({title:"Erro",description:"Não foi possível adicionar o registro.",variant:"destructive"}):(i({title:"Sucesso",description:"Registro de peso adicionado com sucesso!"}),j(!1),G(""),m(d(new Date,"yyyy-MM-dd")),h())},ne=async s=>{if(s.preventDefault(),!S||!o){i({title:"Erro",description:"Preencha todos os campos obrigatórios.",variant:"destructive"});return}const{error:t}=await c.from("growth_records").insert({patient_id:l.id,record_date:o,height:parseFloat(S),head_circumference:A?parseFloat(A):null});t?i({title:"Erro",description:"Não foi possível adicionar o registro.",variant:"destructive"}):(i({title:"Sucesso",description:"Registro de medidas adicionado com sucesso!"}),j(!1),W(""),L(""),m(d(new Date,"yyyy-MM-dd")),h())},me=async s=>{if(s.preventDefault(),!P||!o){i({title:"Erro",description:"Preencha todos os campos.",variant:"destructive"});return}try{const{error:t}=await c.from("glycemia_records").insert({patient_id:l.id,record_date:o,glycemia_value:parseFloat(P)});if(t)throw t;i({title:"Sucesso",description:"Registro de glicemia adicionado com sucesso!"}),j(!1),z(""),m(d(new Date,"yyyy-MM-dd")),h()}catch{i({title:"Erro",description:"Não foi possível adicionar o registro. A tabela pode não estar disponível ainda.",variant:"destructive"})}},he=async s=>{if(!s||!o){i({title:"Erro",description:"Selecione uma foto e uma data.",variant:"destructive"});return}try{const t=s.name.split(".").pop(),I=`${l.id}/${Date.now()}.${t}`,{error:K}=await c.storage.from("progress-photos").upload(I,s);if(K)throw K;const{data:{publicUrl:xe}}=c.storage.from("progress-photos").getPublicUrl(I),{error:O}=await c.from("progress_photos").insert({patient_id:l.id,photo_date:o,photo_url:xe});if(O)throw O;i({title:"Sucesso",description:"Foto de progresso adicionada com sucesso!"}),j(!1),m(d(new Date,"yyyy-MM-dd")),h()}catch{i({title:"Erro",description:"Não foi possível adicionar a foto. A funcionalidade pode não estar disponível ainda.",variant:"destructive"})}},H=R.map(s=>({date:d(new Date(s.record_date),"dd/MM/yy"),value:parseFloat(s.glycemia_value)}));return e.jsxs("div",{className:"flex flex-col min-h-screen bg-background",children:[e.jsxs("div",{className:"max-w-7xl mx-auto w-full px-4 md:px-8 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Meu Progresso"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Acompanhe sua evolução"})]}),e.jsxs(be,{value:r,onValueChange:te,className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-4 mb-4",children:[e.jsxs(D,{value:"peso",className:"text-xs",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Peso"]}),e.jsxs(D,{value:"glicemia",className:"text-xs",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Glicemia"]}),e.jsxs(D,{value:"medidas",className:"text-xs",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Medidas"]}),e.jsxs(D,{value:"fotos",className:"text-xs",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Fotos"]})]}),e.jsx(_,{value:"peso",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:F.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(x,{className:"shadow-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Evolução de Peso"}),e.jsx(f,{children:"Acompanhe sua evolução ao longo do tempo"})]}),e.jsx(g,{children:e.jsx(De,{data:F,goalWeight:de})})]}),e.jsxs(x,{className:"shadow-sm",children:[e.jsx(u,{children:e.jsx(p,{className:"text-lg",children:"Registros Recentes"})}),e.jsx(g,{children:e.jsx("div",{className:"space-y-2",children:F.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),s.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.notes})]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[parseFloat(s.weight).toFixed(1)," kg"]})]},t))})})]})]}):e.jsxs(x,{className:"shadow-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Evolução de Peso"}),e.jsx(f,{children:"Nenhum registro encontrado"})]}),e.jsx(g,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione seu primeiro registro de peso usando o botão +"})]})})]})})}),e.jsx(_,{value:"glicemia",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(x,{className:"shadow-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Evolução da Glicemia"}),e.jsx(f,{children:"Acompanhamento da glicemia ao longo do tempo"})]}),e.jsx(g,{children:H.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Y,{width:"100%",height:300,children:e.jsxs(V,{data:H,children:[e.jsx(Z,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"date",tick:{fontSize:12}}),e.jsx(se,{tick:{fontSize:12}}),e.jsx(J,{}),e.jsx(Q,{type:"monotone",dataKey:"value",name:"Glicemia (mg/dL)",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:4}})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Registros Recentes"}),e.jsx("div",{className:"space-y-2",children:R.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:[parseFloat(s.glycemia_value).toFixed(0)," mg/dL"]})]},t))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum registro de glicemia encontrado"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar seu primeiro registro"})]})})]})})}),e.jsx(_,{value:"medidas",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(x,{className:"shadow-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Medidas Corporais"}),e.jsx(f,{children:"Histórico de medidas antropométricas"})]}),e.jsx(g,{children:N.length>0?e.jsxs("div",{className:"space-y-4",children:[N.filter(s=>s.height).length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Evolução da Altura"}),e.jsx(Y,{width:"100%",height:250,children:e.jsxs(V,{data:N.filter(s=>s.height).map(s=>({date:d(new Date(s.record_date),"dd/MM/yy"),height:parseFloat(s.height)})),children:[e.jsx(Z,{strokeDasharray:"3 3"}),e.jsx(ee,{dataKey:"date",tick:{fontSize:12}}),e.jsx(se,{tick:{fontSize:12}}),e.jsx(J,{}),e.jsx(Q,{type:"monotone",dataKey:"height",name:"Altura (cm)",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4}})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Histórico Completo"}),N.sort((s,t)=>new Date(t.record_date)-new Date(s.record_date)).map((s,t)=>e.jsx("div",{className:"flex justify-between items-center p-4 bg-muted/50 rounded-lg border border-border hover:bg-muted transition-colors",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:d(new Date(s.record_date),"dd/MM/yyyy")}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1",children:[s.weight&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Peso:"})," ",parseFloat(s.weight).toFixed(1)," kg"]}),s.height&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Altura:"})," ",parseFloat(s.height).toFixed(1)," cm"]}),s.head_circumference&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"PC:"})," ",parseFloat(s.head_circumference).toFixed(1)," cm"]}),s.weight&&s.height&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"IMC:"})," ",(parseFloat(s.weight)/Math.pow(parseFloat(s.height)/100,2)).toFixed(1)]})]})]})},t))]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma medida registrada"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar seu primeiro registro"})]})})]})})}),e.jsx(_,{value:"fotos",className:"space-y-4",children:e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(x,{className:"shadow-sm",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Fotos de Progresso"}),e.jsx(f,{children:"Registros visuais da evolução"})]}),e.jsx(g,{children:k.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:k.map((s,t)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted border border-border hover:shadow-md transition-shadow group",children:[e.jsx("img",{src:s.photo_url,alt:`Progresso ${d(new Date(s.photo_date),"dd/MM/yyyy")}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-3",children:e.jsx("p",{className:"text-xs text-white font-medium",children:d(new Date(s.photo_date),"dd/MM/yyyy")})})]},t))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma foto de progresso"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use o botão + para adicionar sua primeira foto"})]})})]})})})]})]}),e.jsxs(ge,{open:oe,onOpenChange:j,children:[e.jsx(je,{asChild:!0,children:e.jsx(y,{size:"lg",className:"fixed bottom-20 right-4 h-14 w-14 rounded-full shadow-lg z-40 bg-primary hover:bg-primary/90 text-white md:bottom-24",children:e.jsx(_e,{className:"h-6 w-6 text-white"})})}),e.jsxs(fe,{children:[e.jsxs(ye,{children:[e.jsxs(ve,{children:[r==="peso"&&"Registrar Peso",r==="glicemia"&&"Registrar Glicemia",r==="medidas"&&"Registrar Medidas",r==="fotos"&&"Adicionar Foto de Progresso"]}),e.jsxs(Ne,{children:[r==="peso"&&"Adicione um novo registro de peso",r==="glicemia"&&"Adicione um novo registro de glicemia",r==="medidas"&&"Adicione um novo registro de medidas corporais",r==="fotos"&&"Adicione uma nova foto de progresso"]})]}),r==="peso"&&e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date",children:"Data"}),e.jsx(C,{id:"date",value:o,onChange:s=>m(s),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(v,{id:"weight",type:"number",step:"0.1",value:M,onChange:s=>G(s.target.value),placeholder:"Ex: 75.5",required:!0})]}),e.jsx(w,{children:e.jsx(y,{type:"submit",children:"Adicionar"})})]}),r==="glicemia"&&e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date",children:"Data"}),e.jsx(C,{id:"date",value:o,onChange:s=>m(s),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"glycemia",children:"Glicemia (mg/dL)"}),e.jsx(v,{id:"glycemia",type:"number",step:"1",value:P,onChange:s=>z(s.target.value),placeholder:"Ex: 95",required:!0})]}),e.jsx(w,{children:e.jsx(y,{type:"submit",children:"Adicionar"})})]}),r==="medidas"&&e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date",children:"Data"}),e.jsx(C,{id:"date",value:o,onChange:s=>m(s),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"height",children:"Altura (cm)"}),e.jsx(v,{id:"height",type:"number",step:"0.1",value:S,onChange:s=>W(s.target.value),placeholder:"Ex: 170",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"headCircumference",children:"Perímetro Cefálico (cm) - Opcional"}),e.jsx(v,{id:"headCircumference",type:"number",step:"0.1",value:A,onChange:s=>L(s.target.value),placeholder:"Ex: 55"})]}),e.jsx(w,{children:e.jsx(y,{type:"submit",children:"Adicionar"})})]}),r==="fotos"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault();const t=document.getElementById("photoFile");t?.files?.[0]&&he(t.files[0])},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date",children:"Data"}),e.jsx(C,{id:"date",value:o,onChange:s=>m(s),required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"photoFile",children:"Foto"}),e.jsx(v,{id:"photoFile",type:"file",accept:"image/*",required:!0})]}),e.jsx(w,{children:e.jsx(y,{type:"submit",children:"Adicionar"})})]})]})]}),ie&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})]})}export{Ze as default};
