import{q as tt,a9 as W,aM as ze,r as p,O as c,j as e,V as fe,W as je,Y as ye,Z as ve,R as Ce,_ as Le,B as h,s as z,u as at,a as st,b as nt,aN as it,m as rt,C as se,e as ne,M as pe,v as ot,aw as De,H as v,c as ue,d as xe,w as Me,X as lt,U as ct,F as dt,A as mt,h as pt,i as ut,k as xt,l as ht,n as gt,o as ft,p as jt,ar as yt,ad as vt,aO as bt}from"./index-CzP_nI2M.js";import{i as wt,a as $e,C as Se,e as ke}from"./calendar-DGsdPNXU.js";import{I as O}from"./input-DpEF2plu.js";import{L as N}from"./label-DACsPsNs.js";import{S as B,a as U,b as J,c as K,d as S}from"./select-D3LMCr-h.js";import{B as Ee}from"./badge-NOGldadv.js";import{b as Nt}from"./pdfUtils-x5zS8yES.js";import{S as be}from"./search-Cz9zTWBR.js";import{l as _t,g as Ct}from"./financial-queries-BdizLBdT.js";import{P as Dt}from"./plus-DMh50SqL.js";import{C as he}from"./chevron-left-QxEt2r-R.js";import{F as Mt}from"./filter-DqqEoVtD.js";import{C as Ae}from"./calendar-days-B4pBU107.js";import{C as St}from"./clock-Bx-qP7aU.js";import{E as kt}from"./eye-BoyWlxbb.js";import{P as Et}from"./pen-square-D0uANbuS.js";import{i as At}from"./isTomorrow-B_2iCN3B.js";import{i as Fe}from"./isSameDay-DFM5Ogoa.js";import{i as M}from"./isToday-BXFDNHk-.js";import{s as Ft}from"./subMonths-DEljFMRJ.js";import{a as Tt}from"./addMonths-BS_3JhP5.js";import{s as Ot}from"./startOfMonth-D7_dMI_Z.js";import"./extends-CF3RwP-h.js";import"./jspdf.plugin.autotable-aqQXYnL7.js";import"./html2canvas.esm-B0tyYwQk.js";import"./parseISO-BczzEZ0Y.js";const Te=tt("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);function Pt(d,_,i){const b=W(d,i),g=W(_,i);return+b==+g}function Oe(d){return wt(d,ze(d))}function Pe(d,_){return Pt(d,ze(d),_)}function zt(d,_){return $e(d,-1)}const ge="custom";function Lt({open:d,onOpenChange:_,appointment:i,patients:b=[],services:g=[],nutritionistId:ee,preSelectedDate:k,onSave:X}){const[o,u]=p.useState({patient_id:"",appointment_time_date:k?c(k,"yyyy-MM-dd"):c(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),[r,j]=p.useState(""),[Y,C]=p.useState(!1),L=b.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())).slice(0,5),E=[{value:"first_appointment",label:"Primeira Consulta"},{value:"return",label:"Retorno"},{value:"evaluation",label:"Avalia√ß√£o"},{value:"online",label:"Online"},{value:"in_person",label:"Presencial"}],F=[{value:"scheduled",label:"Agendada"},{value:"confirmed",label:"Confirmada"},{value:"awaiting_confirmation",label:"Aguardando Confirma√ß√£o"},{value:"completed",label:"Realizada"},{value:"cancelled",label:"Cancelada"},{value:"no_show",label:"Faltou"}],A=[{value:30,label:"30 minutos"},{value:45,label:"45 minutos"},{value:60,label:"1 hora"},{value:90,label:"1h 30min"},{value:120,label:"2 horas"}];p.useEffect(()=>{if(i){if(u({patient_id:i.patient_id||"",appointment_time_date:i.appointment_time?c(new Date(i.appointment_time),"yyyy-MM-dd"):c(new Date,"yyyy-MM-dd"),appointment_time_hour:i.appointment_time?c(new Date(i.appointment_time),"HH:mm"):"",duration:i.duration||60,appointment_type:i.appointment_type||"first_appointment",status:i.status||"scheduled",notes:i.notes||"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),i.patient_id){const s=b.find(l=>l.id===i.patient_id);s&&j(s.name)}}else u({patient_id:"",appointment_time_date:k?c(k,"yyyy-MM-dd"):c(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),j("")},[i,d,k,b]);const y=s=>{s===ge?u(l=>({...l,service_id:"",use_custom_price:!0})):(g.find(l=>l.id.toString()===s),u(l=>({...l,service_id:s,use_custom_price:!1,custom_price:"",custom_description:""})))},D=s=>{if(s.preventDefault(),!o.patient_id||!o.appointment_time_date||!o.appointment_time_hour)return;const[l,Z,P]=o.appointment_time_date.split("-").map(Number),[te,ie]=o.appointment_time_hour.split(":").map(Number),G=new Date(l,Z-1,P,te,ie),re={...i,patient_id:o.patient_id,appointment_time:G.toISOString(),notes:o.notes,duration:o.duration,appointment_type:o.appointment_type,status:o.status},$={service_id:o.use_custom_price?null:o.service_id||null,custom_price:o.use_custom_price?o.custom_price:null,custom_description:o.use_custom_price?o.custom_description:null};X(re,$)},w=g.find(s=>s.id.toString()===o.service_id);return e.jsx(fe,{open:d,onOpenChange:_,children:e.jsxs(je,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(ve,{children:i?"Editar Agendamento":"Novo Agendamento"})}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{htmlFor:"patient_search",children:"Paciente *"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(O,{id:"patient_search",type:"text",placeholder:"Buscar paciente pelo nome...",value:r,onChange:s=>{j(s.target.value),C(!0),s.target.value||u(l=>({...l,patient_id:""}))},onFocus:()=>C(!0),className:"pl-9",required:!o.patient_id})]}),Y&&r&&L.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-lg max-h-60 overflow-auto",children:L.map(s=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-accent hover:text-accent-foreground text-sm",onClick:()=>{u(l=>({...l,patient_id:s.id})),j(s.name),C(!1)},children:s.name},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"date",children:"Data *"}),e.jsx(O,{id:"date",type:"date",required:!0,value:o.appointment_time_date,onChange:s=>u(l=>({...l,appointment_time_date:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"time",children:"Hora *"}),e.jsx(O,{id:"time",type:"time",required:!0,value:o.appointment_time_hour,onChange:s=>u(l=>({...l,appointment_time_hour:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"duration",children:"Dura√ß√£o *"}),e.jsxs(B,{required:!0,value:String(o.duration),onValueChange:s=>u(l=>({...l,duration:Number(s)})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:A.map(s=>e.jsx(S,{value:String(s.value),children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"appointment_type",children:"Tipo *"}),e.jsxs(B,{required:!0,value:o.appointment_type,onValueChange:s=>u(l=>({...l,appointment_type:s})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:E.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"status",children:"Status *"}),e.jsxs(B,{required:!0,value:o.status,onValueChange:s=>u(l=>({...l,status:s})),children:[e.jsx(U,{children:e.jsx(J,{})}),e.jsx(K,{children:F.map(s=>e.jsx(S,{value:s.value,children:s.label},s.value))})]})]}),!i&&e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-base font-semibold",children:"Informa√ß√µes Financeiras"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um servi√ßo padr√£o ou defina um valor personalizado"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"service",children:"Servi√ßo"}),e.jsxs(B,{value:o.use_custom_price?ge:o.service_id||"",onValueChange:y,children:[e.jsx(U,{children:e.jsx(J,{placeholder:"Selecione um servi√ßo ou valor personalizado"})}),e.jsxs(K,{children:[g.map(s=>e.jsxs(S,{value:s.id.toString(),children:[s.name," - ",Ce(s.price)]},s.id)),e.jsx(S,{value:ge,children:"üí∞ Valor Personalizado / Outro"})]})]})]}),o.use_custom_price?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"custom_price",children:"Valor Personalizado (R$) *"}),e.jsx(O,{id:"custom_price",type:"number",step:"0.01",min:"0",required:o.use_custom_price,value:o.custom_price,onChange:s=>u(l=>({...l,custom_price:s.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"custom_description",children:"Descri√ß√£o do Servi√ßo"}),e.jsx(O,{id:"custom_description",value:o.custom_description,onChange:s=>u(l=>({...l,custom_description:s.target.value})),placeholder:"Ex: Consulta especializada"})]})]}):w?e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valor do servi√ßo:"}),e.jsx("p",{className:"text-lg font-semibold text-primary",children:Ce(w.price)})]}):null]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"notes",children:"Observa√ß√µes"}),e.jsx(O,{id:"notes",value:o.notes,onChange:s=>u(l=>({...l,notes:s.target.value})),placeholder:"Informa√ß√µes adicionais (opcional)"})]}),e.jsxs(Le,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>_(!1),children:"Cancelar"}),e.jsx(h,{type:"submit",children:i?"Atualizar":"Salvar"})]})]})]})})}async function $t(d,_){const{nutritionist_id:i,patient_id:b,appointment_time:g,notes:ee,duration:k,appointment_type:X,status:o}=d,{service_id:u,custom_price:r,custom_description:j}=_,{data:Y,error:C}=await z.from("appointments").insert({nutritionist_id:i,patient_id:b,appointment_time:g,notes:ee,duration:k||60,appointment_type:X||"first_appointment",status:o||"scheduled"}).select().single();if(C)throw console.error("Error creating appointment:",C),C;const{data:L}=await z.from("user_profiles").select("name").eq("id",b).single(),E=L?.name||"Paciente";let F=0,A="";if(u){const{data:D}=await z.from("services").select("name, price, category").eq("id",u).single();D&&(F=parseFloat(D.price),A=`Agendamento: ${E} - ${D.name}`)}else r&&(F=parseFloat(r),A=j?`Agendamento: ${E} - ${j}`:`Agendamento: ${E}`);let y=null;if(F>0&&A)try{const D=new Date(g);y=await _t({nutritionist_id:i,patient_id:b,type:"income",category:u?"consulta":"outros",description:A,amount:F,transaction_date:c(D,"yyyy-MM-dd"),status:"pending",due_date:c(D,"yyyy-MM-dd")})}catch(D){console.error("Error creating financial transaction:",D)}return{appointment:Y,transaction:y}}async function qt(d,_){const{data:i,error:b}=await z.from("appointments").update(_).eq("id",d).select().single();if(b)throw console.error("Error updating appointment:",b),b;return i}function ua(){const{user:d,signOut:_}=at(),{toast:i}=st(),b=nt(),[g,ee]=p.useState([]),[k,X]=p.useState([]),[o,u]=p.useState([]),[r,j]=p.useState(null),[Y,C]=p.useState(!1),[L,E]=p.useState(null),[F,A]=p.useState(!0),[y,D]=p.useState("all"),[w,s]=p.useState(""),[l,Z]=p.useState(!1),[P,te]=p.useState(null),[ie,G]=p.useState(!1),[re,$]=p.useState(!1),[Q,qe]=p.useState("week"),[q,oe]=p.useState(W(new Date,{locale:v})),[H,le]=p.useState(new Date),ae=p.useCallback(async()=>{if(!d)return;A(!0);const{data:t,error:a}=await z.from("appointments").select("*, patient:user_profiles!appointments_patient_id_fkey(name, id)").eq("nutritionist_id",d.id).limit(1e3);a?i({title:"Erro",description:a.message,variant:"destructive"}):ee(t||[]);const{data:n,error:m}=await z.from("user_profiles").select("id, name").eq("nutritionist_id",d.id).limit(500);m?i({title:"Erro",description:"N√£o foi poss√≠vel carregar os pacientes.",variant:"destructive"}):X(n||[]);try{const x=await Ct(d.id);u(x||[])}catch(x){console.error("Error loading services:",x),u([])}A(!1)},[d,i]);p.useEffect(()=>{ae()},[ae]);const He=async(t,a)=>{const{patient_id:n,appointment_time:m,notes:x,duration:f,appointment_type:I,status:R}=t,_e=new Date(m),et=new Date(_e.getTime()+f*6e4);if(g.some(T=>{if(t.id&&T.id===t.id)return!1;const de=new Date(T.appointment_time),me=new Date(de.getTime()+(T.duration||60)*6e4);return _e<me&&et>de})){i({title:"Conflito de Hor√°rio",description:"J√° existe um agendamento neste hor√°rio. Por favor, escolha outro hor√°rio.",variant:"destructive"});return}try{if(t.id)await qt(t.id,{patient_id:n,appointment_time:m,notes:x,duration:f||60,appointment_type:I||"first_appointment",status:R||"scheduled"}),i({title:"Sucesso!",description:"Agendamento atualizado com sucesso."});else{const T={nutritionist_id:d.id,patient_id:n,appointment_time:m,notes:x,duration:f||60,appointment_type:I||"first_appointment",status:R||"scheduled"},{appointment:de,transaction:me}=await $t(T,a);i(me?{title:"Sucesso!",description:"Agendamento criado e registro financeiro gerado automaticamente."}:{title:"Sucesso!",description:"Agendamento criado com sucesso."})}C(!1),E(null),ae()}catch(T){console.error("Error saving appointment:",T),i({title:"Erro",description:`N√£o foi poss√≠vel salvar o agendamento. ${T.message}`,variant:"destructive"})}},Ve=t=>{te(t),Z(!0)},Ie=async()=>{if(!P)return;const{error:t}=await z.from("appointments").delete().eq("id",P.id);t?i({title:"Erro",description:"N√£o foi poss√≠vel deletar o agendamento.",variant:"destructive"}):(i({title:"Sucesso!",description:"Agendamento deletado com sucesso."}),ae()),Z(!1),te(null)},we=p.useMemo(()=>{const t=new Date;let a=[...g].sort((n,m)=>new Date(n.appointment_time)-new Date(m.appointment_time));if(r)a=a.filter(n=>Fe(new Date(n.appointment_time),r));else switch(y){case"today":a=a.filter(n=>M(new Date(n.appointment_time)));break;case"week":a=a.filter(n=>Pe(new Date(n.appointment_time),{locale:v}));break;case"month":a=a.filter(n=>Oe(new Date(n.appointment_time)));break;default:a=a.filter(n=>new Date(n.appointment_time)>=it(t))}if(w.trim()){const n=w.toLowerCase();a=a.filter(m=>m.patient?.name?.toLowerCase().includes(n))}return a},[g,y,r,w]),Ne=p.useMemo(()=>{const t={};return we.forEach(a=>{const n=c(new Date(a.appointment_time),"yyyy-MM-dd");t[n]||(t[n]=[]),t[n].push(a)}),t},[we]),V=p.useMemo(()=>{const t={};return g.forEach(a=>{const n=c(new Date(a.appointment_time),"yyyy-MM-dd");t[n]=(t[n]||0)+1}),t},[g]),Re=t=>{const a={scheduled:{label:"Agendada",variant:"outline",color:"text-blue-600 bg-blue-50"},confirmed:{label:"Confirmada",variant:"default",color:"text-green-600 bg-green-50"},awaiting_confirmation:{label:"Aguardando",variant:"secondary",color:"text-yellow-600 bg-yellow-50"},completed:{label:"Realizada",variant:"secondary",color:"text-gray-600 bg-gray-100"},cancelled:{label:"Cancelada",variant:"destructive",color:"text-red-600 bg-red-50"},no_show:{label:"Faltou",variant:"destructive",color:"text-orange-600 bg-orange-50"}};return a[t]||a.scheduled},We=t=>{const a={first_appointment:{label:"Primeira Consulta"},return:{label:"Retorno"},evaluation:{label:"Avalia√ß√£o"},online:{label:"Online"},in_person:{label:"Presencial"}};return a[t]||a.first_appointment},Be=(t,a)=>{const n=new Date(new Date(t).getTime()+(a||60)*6e4);return c(n,"HH:mm")},Ue=t=>{const[a,n,m]=t.split("-").map(Number),x=new Date(a,n-1,m),f=c(x,"EEEE",{locale:v}),I=f.charAt(0).toUpperCase()+f.slice(1),R=c(x,"dd 'de' MMMM",{locale:v});return M(x)?`Hoje ‚Ä¢ ${I}, ${R}`:At(x)?`Amanh√£ ‚Ä¢ ${I}, ${R}`:`${I}, ${R}`},Je=()=>{j(yt(r||new Date,1))},Ke=()=>{j(vt(r||new Date,1))},Xe=()=>{j(new Date)},Ye=()=>{j(null)},Ze=t=>{r&&Fe(t,r)?j(null):j(t)},Ge=t=>{j(t),G(!1)},ce=t=>t>=5?"text-secondary font-bold":t>=3?"text-yellow-600 font-bold":t>=1?"text-primary font-bold":"text-muted-foreground font-bold",Qe=async()=>{try{let t="",a=[],n,m;if(Q==="week"?(n=W(q,{locale:v}),m=ke(q,{locale:v}),t=`Semana de ${c(n,"dd/MM")} a ${c(m,"dd/MM/yyyy")}`,a=g.filter(x=>{const f=new Date(x.appointment_time);return f>=n&&f<=m}).sort((x,f)=>new Date(x.appointment_time)-new Date(f.appointment_time))):(n=Ot(H),m=bt(H),t=c(H,"MMMM 'de' yyyy",{locale:v}),t=t.charAt(0).toUpperCase()+t.slice(1),a=g.filter(x=>{const f=new Date(x.appointment_time);return f>=n&&f<=m}).sort((x,f)=>new Date(x.appointment_time)-new Date(f.appointment_time))),a.length===0){i({title:"Sem agendamentos",description:`N√£o h√° agendamentos para ${t.toLowerCase()}.`,variant:"default"});return}await Nt(a,Q,t,d?.profile?.name||d?.email?.split("@")[0]||null),i({title:"PDF gerado!",description:`Agenda exportada com sucesso (${a.length} consultas).`}),$(!1)}catch(t){console.error("Erro ao exportar PDF:",t),i({title:"Erro ao exportar",description:"N√£o foi poss√≠vel gerar o PDF. Tente novamente.",variant:"destructive"})}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs(rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 text-center sm:text-left",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-heading uppercase tracking-wide text-primary",children:"Agenda de Consultas"}),e.jsx("p",{className:"text-neutral-600 mt-1",children:"Visualize e gerencie todos os seus agendamentos."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-center sm:justify-end",children:[e.jsxs(h,{variant:"outline",onClick:()=>$(!0),className:"border-primary text-primary hover:bg-primary hover:text-white",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"})," Exportar PDF"]}),e.jsxs(h,{onClick:()=>{E(null),C(!0)},className:"bg-primary hover:bg-primary/90",children:[e.jsx(Dt,{className:"w-4 h-4 mr-2"})," Novo Agendamento"]})]})]}),e.jsx("div",{className:"lg:hidden mb-6",children:e.jsx(se,{className:"bg-card shadow-card-dark rounded-xl",children:e.jsxs(ne,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(h,{variant:"outline",size:"icon",onClick:Je,className:"h-10 w-10 flex-shrink-0",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:r?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-primary",children:c(r,"dd 'de' MMMM",{locale:v})}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:c(r,"EEEE",{locale:v})})]}):e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Todos os agendamentos"})}),e.jsx(h,{variant:"outline",size:"icon",onClick:Ke,className:"h-10 w-10 flex-shrink-0",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(h,{variant:r&&M(r)?"default":"outline",size:"sm",onClick:Xe,className:"flex-1",children:"Hoje"}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>G(!0),className:"flex-1",children:[e.jsx(ot,{className:"w-4 h-4 mr-1.5"}),"Calend√°rio"]}),r&&e.jsx(h,{variant:"outline",size:"sm",onClick:Ye,className:"flex-1",children:"Ver Todos"})]})]})})}),e.jsx(fe,{open:ie,onOpenChange:G,children:e.jsxs(je,{className:"max-w-sm",children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Selecionar Data"}),e.jsx(De,{children:"Escolha uma data para ver os agendamentos"})]}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Se,{mode:"single",selected:r,onSelect:Ge,className:"rounded-md border",locale:v,modifiers:{today:t=>M(t),highLoad:t=>(V[c(t,"yyyy-MM-dd")]||0)>=5&&!M(t),mediumLoad:t=>{const a=V[c(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!M(t)},lowLoad:t=>{const a=V[c(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!M(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"space-y-2 pb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground px-2",children:"Legenda:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs px-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"5+"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-7 order-1",children:e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(ue,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"font-heading text-base lg:text-lg font-semibold text-primary",children:"Agendamentos"}),e.jsxs(Me,{className:"text-xs lg:text-sm",children:[r&&`Agendamentos de ${c(r,"dd/MM/yyyy")}`,!r&&y==="all"&&"Todos os pr√≥ximos agendamentos",!r&&y==="today"&&"Agendamentos de hoje",!r&&y==="week"&&"Agendamentos desta semana",!r&&y==="month"&&"Agendamentos deste m√™s"]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col sm:flex-row gap-3",children:[e.jsxs(B,{value:y,onValueChange:D,disabled:!!r,children:[e.jsxs(U,{className:"w-full sm:w-[180px]",children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),e.jsx(J,{})]}),e.jsxs(K,{children:[e.jsx(S,{value:"all",children:"Todos"}),e.jsx(S,{value:"today",children:"Hoje"}),e.jsx(S,{value:"week",children:"Esta Semana"}),e.jsx(S,{value:"month",children:"Este M√™s"})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar paciente...",value:w,onChange:t=>s(t.target.value),className:"pl-9"})]}),(w||r)&&e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{s(""),j(null)},className:"w-full sm:w-auto",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]}),e.jsxs("div",{className:"lg:hidden relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Buscar paciente...",value:w,onChange:t=>s(t.target.value),className:"pl-9"})]})]})}),e.jsx(ne,{className:"p-3 lg:p-6",children:F?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"Carregando agendamentos..."})}):Object.keys(Ne).length>0?e.jsx("div",{className:"space-y-4 lg:space-y-6",children:Object.entries(Ne).map(([t,a])=>e.jsxs("div",{className:"space-y-2 lg:space-y-3",children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 pb-2 border-b",children:[e.jsx(Ae,{className:"w-4 h-4 lg:w-5 lg:h-5 text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-sm lg:text-base text-foreground capitalize truncate",children:Ue(t)}),e.jsx(Ee,{variant:"secondary",className:`ml-auto text-xs whitespace-nowrap border-0 ${a.length>=5?"bg-secondary/80 text-white":a.length>=3?"bg-yellow-400/70 text-yellow-900":"bg-primary/30 text-primary"}`,children:a.length})]}),e.jsx("div",{className:"space-y-2 lg:space-y-3",children:a.map(n=>{const m=Re(n.status||"scheduled"),x=We(n.appointment_type||"first_appointment"),f=Be(n.appointment_time,n.duration);return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-4 p-2.5 lg:p-4 bg-muted/30 hover:bg-muted/50 rounded-lg border border-border/50 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-primary/10 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg min-w-[55px] lg:min-w-[70px] flex-shrink-0",children:[e.jsx(St,{className:"w-3 h-3 lg:w-4 lg:h-4 mb-0.5 lg:mb-1 text-primary"}),e.jsx("span",{className:"text-xs lg:text-sm font-bold text-primary",children:c(new Date(n.appointment_time),"HH:mm")}),e.jsx("span",{className:"text-[10px] lg:text-xs text-muted-foreground",children:f})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 mb-0.5",children:[e.jsx(ct,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-sm lg:text-base text-foreground truncate",children:n.patient?.name||"Paciente n√£o identificado"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(Ee,{className:`text-xs ${m.color} border-0`,children:m.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.label}),n.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1 hidden lg:block",children:["‚Ä¢ ",n.notes]})]})]}),e.jsxs("div",{className:"flex gap-1 lg:gap-2 flex-shrink-0",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>b(`/nutritionist/patients/${n.patient_id}/hub`),className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-blue-50 hover:text-blue-600",title:"Ver detalhes do paciente",children:e.jsx(kt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>{E(n),C(!0)},className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-primary/10 hover:text-primary",title:"Editar agendamento",children:e.jsx(Et,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 lg:h-9 lg:w-9 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>Ve(n),title:"Excluir agendamento",children:e.jsx(dt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})})]})]},n.id)})})]},t))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 lg:py-12 text-center",children:[e.jsx(Ae,{className:"w-12 h-12 lg:w-16 lg:h-16 text-muted-foreground/50 mb-3 lg:mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium text-sm lg:text-base mb-1 lg:mb-2",children:"Nenhum agendamento encontrado"}),e.jsxs("p",{className:"text-xs lg:text-sm text-muted-foreground",children:[w&&"Nenhum agendamento encontrado para esta busca",!w&&r&&"N√£o h√° consultas agendadas para este dia",!w&&!r&&y==="all"&&"Adicione um novo agendamento para come√ßar",!w&&!r&&y==="today"&&"N√£o h√° consultas agendadas para hoje",!w&&!r&&y==="week"&&"N√£o h√° consultas agendadas para esta semana",!w&&!r&&y==="month"&&"N√£o h√° consultas agendadas para este m√™s"]})]})})]})}),e.jsxs("div",{className:"hidden lg:block lg:col-span-3 order-2 space-y-6",children:[e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsxs(ue,{className:"pb-3",children:[e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Calend√°rio"}),e.jsx(Me,{className:"text-xs",children:"Clique em um dia para filtrar ‚Ä¢ Clique novamente para limpar"})]}),e.jsxs(ne,{className:"flex flex-col items-center p-0 pb-3",children:[e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(Se,{mode:"single",selected:r,onSelect:Ze,className:"w-fit",locale:v,modifiers:{today:t=>M(t),highLoad:t=>(V[c(t,"yyyy-MM-dd")]||0)>=5&&!M(t),mediumLoad:t=>{const a=V[c(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!M(t)},lowLoad:t=>{const a=V[c(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!M(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"w-full px-4 mt-3 border-t pt-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Legenda:"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"5+"})]})]})]})]})]}),e.jsxs(se,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(ue,{className:"pb-3",children:e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Resumo"})}),e.jsx(ne,{className:"space-y-3",children:(()=>{const t=g.filter(m=>M(new Date(m.appointment_time))).length,a=g.filter(m=>Pe(new Date(m.appointment_time),{locale:v})).length,n=g.filter(m=>Oe(new Date(m.appointment_time))).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hoje"}),e.jsx("span",{className:ce(t),children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Esta Semana"}),e.jsx("span",{className:ce(a),children:a})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Este M√™s"}),e.jsx("span",{className:ce(n),children:n})]})]})})()})]})]})]}),e.jsx(fe,{open:re,onOpenChange:$,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsxs(ye,{children:[e.jsx(ve,{children:"Exportar Agenda em PDF"}),e.jsx(De,{children:"Selecione o per√≠odo que deseja exportar"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"period-type",children:"Per√≠odo"}),e.jsxs(B,{value:Q,onValueChange:qe,children:[e.jsx(U,{id:"period-type",children:e.jsx(J,{})}),e.jsxs(K,{children:[e.jsx(S,{value:"week",children:"Semana"}),e.jsx(S,{value:"month",children:"M√™s"})]})]})]}),Q==="week"&&e.jsxs("div",{children:[e.jsx(N,{children:"Selecionar Semana"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>oe(zt(q)),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 text-center text-sm font-medium",children:[c(W(q,{locale:v}),"dd/MM")," a"," ",c(ke(q,{locale:v}),"dd/MM/yyyy")]}),e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>oe($e(q,1)),children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>oe(W(new Date,{locale:v})),className:"w-full mt-2 text-xs",children:"Semana Atual"})]}),Q==="month"&&e.jsxs("div",{children:[e.jsx(N,{children:"Selecionar M√™s"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>le(Ft(H,1)),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-center text-sm font-medium capitalize",children:c(H,"MMMM 'de' yyyy",{locale:v})}),e.jsx(h,{type:"button",variant:"outline",size:"icon",onClick:()=>le(Tt(H,1)),children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:()=>le(new Date),className:"w-full mt-2 text-xs",children:"M√™s Atual"})]})]}),e.jsxs(Le,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>$(!1),children:"Cancelar"}),e.jsxs(h,{type:"button",onClick:Qe,className:"bg-primary",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Exportar"]})]})]})}),e.jsx(Lt,{open:Y,onOpenChange:C,appointment:L,patients:k,services:o,nutritionistId:d?.id,preSelectedDate:r,onSave:He}),e.jsx(mt,{open:l,onOpenChange:Z,children:e.jsxs(pt,{children:[e.jsxs(ut,{children:[e.jsx(xt,{children:"Confirmar Exclus√£o"}),e.jsxs(ht,{children:["Tem certeza que deseja excluir o agendamento de"," ",e.jsx("strong",{children:P?.patient?.name})," para"," ",e.jsx("strong",{children:P&&c(new Date(P.appointment_time),"dd/MM/yyyy '√†s' HH:mm")}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta a√ß√£o n√£o pode ser desfeita."]})]}),e.jsxs(gt,{children:[e.jsx(ft,{children:"Cancelar"}),e.jsx(jt,{onClick:Ie,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})})}export{ua as default};
