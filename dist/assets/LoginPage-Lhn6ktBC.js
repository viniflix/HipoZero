import{r as a,u as D,a as S,b as L,j as e,L as P,A as R,m as I,C as O,c as F,d as T,e as H,f as q,B as j,g as B,h as M,i as Z,k as z,l as U,n as V,o as _,p as $,t as v,s as G}from"./index-qjbGaV1R.js";import{I as u}from"./input-DMmXNW5d.js";import{L as x}from"./label-TnYOms6c.js";import{M as J}from"./mail-CTY4A7xI.js";import{L as K}from"./lock-D9McDfjn.js";import{E as Q}from"./eye-off-Ck9sBZKk.js";import{E as W}from"./eye-Bb_eQPku.js";import{A as X}from"./arrow-right-BDM_NTv6.js";function le(){const[l,N]=a.useState(""),[h,b]=a.useState(""),[n,y]=a.useState(!1),[t,o]=a.useState(!1),[c,d]=a.useState(""),[w,p]=a.useState(!1),{signIn:E,user:r,loading:m}=D(),{toast:i}=S(),f=L();a.useEffect(()=>{if(!m){if(r?.profile){const s=r.profile.user_type==="nutritionist"?"/nutritionist":"/patient";console.log("Redirecting authenticated user to dashboard:",s),f(s,{replace:!0});return}if(r&&!r.profile){console.log("User authenticated but profile not loaded yet, waiting...");return}}},[r,m,f]);const C=async s=>{s.preventDefault(),o(!0);const{data:k,error:g}=await E({email:l,password:h});g?i({title:"Erro no login",description:v(g,"E-mail ou senha incorretos."),variant:"destructive"}):k.user&&i({title:"Login realizado com sucesso!",description:"Bem-vindo(a) de volta!"}),o(!1)},A=async()=>{if(c.trim()===""){i({title:"Erro",description:"Por favor, insira seu e-mail.",variant:"destructive"});return}o(!0);const{error:s}=await G.auth.resetPasswordForEmail(c,{redirectTo:`${window.location.origin}/update-password`});o(!1),s?i({title:"Erro ao enviar e-mail",description:v(s,"Não foi possível enviar o e-mail de recuperação."),variant:"destructive"}):(i({title:"Sucesso!",description:"Enviamos um link de recuperação para o seu e-mail."}),p(!1),d(""))};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(P,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."})]})}):e.jsxs(R,{open:w,onOpenChange:p,children:[e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:e.jsxs(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:[e.jsxs(O,{className:"bg-card shadow-card-dark border-border",children:[e.jsxs(F,{className:"space-y-4 pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:"https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png",alt:"HipoZero",className:"h-16 w-auto"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(T,{className:"text-2xl font-semibold text-foreground",children:"Acesso ao Sistema"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Entre com suas credenciais"})]})]}),e.jsxs(H,{children:[e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"email",type:"email",placeholder:"seu@email.com",value:l,onChange:s=>N(s.target.value),required:!0,className:"pl-10 h-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Senha"}),e.jsx(q,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-xs text-primary hover:underline transition-colors",onClick:()=>d(l),children:"Esqueceu a senha?"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"password",type:n?"text":"password",placeholder:"••••••••",value:h,onChange:s=>b(s.target.value),required:!0,className:"pl-10 pr-10 h-10"}),e.jsx("button",{type:"button",onClick:()=>y(!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:n?e.jsx(Q,{className:"w-4 h-4"}):e.jsx(W,{className:"w-4 h-4"})})]})]}),e.jsx(j,{type:"submit",className:"w-full h-10 bg-primary hover:bg-primary/90 text-white font-medium mt-6",disabled:t,children:t?"Entrando...":e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["Entrar",e.jsx(X,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center border-t border-border pt-6",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Não tem uma conta?"," ",e.jsx(B,{to:"/register",className:"text-primary hover:underline font-medium transition-colors",children:"Cadastre-se"})]})})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plataforma profissional de gestão nutricional"})})]})}),e.jsxs(M,{children:[e.jsxs(Z,{children:[e.jsx(z,{children:"Recuperar Senha"}),e.jsx(U,{children:"Digite seu e-mail abaixo. Enviaremos um link para você criar uma nova senha."})]}),e.jsxs("div",{className:"py-2",children:[e.jsx(x,{htmlFor:"reset-email",children:"Email"}),e.jsx(u,{id:"reset-email",type:"email",placeholder:"seu@email.com",value:c,onChange:s=>d(s.target.value),className:"mt-2"})]}),e.jsxs(V,{children:[e.jsx(_,{disabled:t,children:"Cancelar"}),e.jsx($,{asChild:!0,children:e.jsx(j,{onClick:A,disabled:t,className:"bg-primary hover:bg-primary/90",children:t?"Enviando...":"Enviar link"})})]})]})]})}export{le as default};
