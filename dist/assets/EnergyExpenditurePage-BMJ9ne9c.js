import{q as W,j as e,C as $,c as I,d as L,e as P,B as ee,a0 as Te,ap as y,r as h,at as je,w as O,au as $e,b as Pe,a as De,s as k,L as ue,T as Ee,U as ke}from"./index-CzP_nI2M.js";import{I as V}from"./input-DpEF2plu.js";import{L as _}from"./label-DACsPsNs.js";import{S as _e}from"./slider-6VrimJFB.js";import{S as Ie,a as Le,b as Be,c as qe,d as Ge}from"./select-D3LMCr-h.js";import{B as j}from"./badge-NOGldadv.js";import{T as Re,a as Oe,b as xe,c as z,d as He,e as U}from"./table-DEHDnTbM.js";import{P as he,a as ge,b as pe}from"./popover-CMpKjhKQ.js";import{I as fe}from"./info-Bh3uY1d-.js";import{S as Ve}from"./star-BfUaL_Pw.js";import{A as be}from"./activity-CD_GjOXq.js";import{M as ze}from"./minus-DMlAPEsI.js";import{T as Ue}from"./trending-down-BPacV1dp.js";import{e as We,f as Ye}from"./patient-queries-BXknbmTx.js";import{A as Ze}from"./arrow-left-BnQHWRYJ.js";import{C as Je}from"./calculator-CIVz4-s9.js";import{S as Qe}from"./save-CLkVNunr.js";import{D as Xe}from"./database-CjIhk0LW.js";import"./index-DmlFzBo4.js";import"./extends-CF3RwP-h.js";import"./mealTranslations-B1KHhmEq.js";const Ke=W("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),ea=W("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]),aa=W("Sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 11v5a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H6v-2a2 2 0 0 0-4 0Z",key:"u5qfb7"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]),sa=W("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function ve({breakdown:a,variant:i="default"}){if(!a)return null;const s=()=>e.jsx(fe,{className:"w-3.5 h-3.5 text-muted-foreground hover:text-foreground transition-colors cursor-help"});return i==="compact"?e.jsxs(he,{children:[e.jsx(ge,{asChild:!0,children:e.jsx("span",{className:"inline-flex items-center",children:e.jsx(s,{})})}),e.jsx(pe,{className:"w-80 p-0",side:"top",align:"start",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:a.formulaName}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono bg-muted/50 p-2 rounded",children:a.appliedStr})]}),a.baseData&&e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Baseado em:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.baseData.weight&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["Peso: ",a.baseData.weight,"kg"]}),a.baseData.height&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["Altura: ",a.baseData.height,"cm"]}),a.baseData.age&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["Idade: ",a.baseData.age," anos"]}),a.baseData.leanMass&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["MM: ",a.baseData.leanMass,"kg"]}),a.baseData.gender&&e.jsx(j,{variant:"outline",className:"text-[10px]",children:a.baseData.gender})]})]})]})})]}):e.jsxs(he,{children:[e.jsx(ge,{asChild:!0,children:e.jsx("span",{className:"inline-flex items-center",children:e.jsx(s,{})})}),e.jsx(pe,{className:"w-96 p-0",side:"top",align:"start",children:e.jsxs($,{className:"border-0 shadow-none",children:[e.jsx(I,{className:"pb-3",children:e.jsxs(L,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-primary"}),a.formulaName]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:"F√≥rmula:"}),e.jsx("p",{className:"text-sm font-mono bg-muted/50 p-2 rounded",children:a.equationStr})]}),e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:"C√°lculo Aplicado:"}),e.jsx("p",{className:"text-sm font-mono bg-primary/10 p-2 rounded border border-primary/20",children:a.appliedStr})]}),a.steps&&a.steps.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Passos:"}),e.jsx("div",{className:"space-y-1.5",children:a.steps.map((t,n)=>e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:[t.label,":"]}),e.jsx("span",{className:"font-mono font-medium",children:t.value})]},n))})]})]}),a.baseData&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Dados Utilizados:"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[a.baseData.weight&&e.jsxs(j,{variant:"secondary",className:"text-[10px]",children:["Peso: ",a.baseData.weight,"kg"]}),a.baseData.height&&e.jsxs(j,{variant:"secondary",className:"text-[10px]",children:["Altura: ",a.baseData.height,"cm"]}),a.baseData.age&&e.jsxs(j,{variant:"secondary",className:"text-[10px]",children:["Idade: ",a.baseData.age," anos"]}),a.baseData.leanMass&&e.jsxs(j,{variant:"default",className:"text-[10px]",children:["MM: ",a.baseData.leanMass,"kg"]}),a.baseData.gender&&e.jsx(j,{variant:"secondary",className:"text-[10px]",children:a.baseData.gender}),a.baseData.activityLabel&&e.jsx(j,{variant:"outline",className:"text-[10px]",children:a.baseData.activityLabel})]})]})]})]})]})})]})}const ta=(a,i,s,t)=>t==="male"||t==="masculino"||t==="m"?88.362+13.397*a+4.799*i-5.677*s:447.593+9.247*a+3.098*i-4.33*s,ra=(a,i,s,t)=>{const n=t==="male"||t==="masculino"||t==="m"?5:-161;return 10*a+6.25*i-5*s+n},na=a=>!a||a<=0?null:500+22*a,la=(a,i)=>!i||i<=0?null:25.9*i+284,ia=(a,i,s,t)=>t==="male"||t==="masculino"||t==="m"?15.3*a+679:14.7*a+496,ae=[{value:1.2,label:"Sedent√°rio",desc:"Pouco ou nenhum exerc√≠cio",short:"Sedent√°rio"},{value:1.375,label:"Levemente Ativo",desc:"Exerc√≠cio leve 1-3 dias/semana",short:"Leve"},{value:1.55,label:"Moderadamente Ativo",desc:"Exerc√≠cio moderado 3-5 dias/semana",short:"Moderado"},{value:1.725,label:"Muito Ativo",desc:"Exerc√≠cio pesado 6-7 dias/semana",short:"Muito Ativo"},{value:1.9,label:"Extremamente Ativo",desc:"Trabalho f√≠sico pesado ou treino 2x ao dia",short:"Extremo"}],oa=(a,i)=>!a||a<=0||!i||i<=0?0:a*i,ca=a=>{const{weight:i,height:s,age:t,gender:n,leanMass:x}=a;if(!i||!s||!t||!n)return[];const o=[{id:"harris",name:"Harris-Benedict (1984)",description:"Cl√°ssico. Bom para popula√ß√£o geral.",bmr:ta(i,s,t,n),category:"general"},{id:"mifflin",name:"Mifflin-St Jeor",description:"Padr√£o ouro cl√≠nico. Mais preciso para sobrepeso.",recommended:!0,bmr:ra(i,s,t,n),category:"clinical"},{id:"fao",name:"FAO/WHO",description:"Padr√£o da Organiza√ß√£o Mundial da Sa√∫de.",bmr:ia(i,s,t,n),category:"general"}];if(x&&x>0){const d=na(x),m=la(i,x);d!==null&&o.push({id:"cunningham",name:"Cunningham (Atletas)",description:"Baseado na Massa Magra. Ideal para alta performance.",bmr:d,category:"athlete"}),m!==null&&o.push({id:"tinsley",name:"Tinsley (Bodybuilding)",description:"Espec√≠fico para treinamento de for√ßa.",bmr:m,category:"athlete"})}return o},da=(a,i)=>{const{weight:s,height:t,age:n,gender:x,leanMass:o}=i,d=x==="male"||x==="masculino"||x==="m";switch(a){case"harris":{if(!s||!t||!n||!x)return null;const m=d?88.362:447.593,c=d?13.397:9.247,g=d?4.799:3.098,f=d?5.677:4.33,S=c*s,v=g*t,B=f*n,M=m+S+v-B;return{formulaName:`Harris-Benedict (${d?"Masculino":"Feminino"})`,equationStr:d?"88.362 + (13.397 √ó P) + (4.799 √ó A) - (5.677 √ó I)":"447.593 + (9.247 √ó P) + (3.098 √ó A) - (4.330 √ó I)",appliedStr:`${m.toFixed(3)} + (${c.toFixed(3)} √ó ${s}) + (${g.toFixed(3)} √ó ${t}) - (${f.toFixed(3)} √ó ${n})`,steps:[{label:"Constante",value:m.toFixed(3)},{label:"Peso",value:`${c.toFixed(3)} √ó ${s} = ${S.toFixed(2)}`},{label:"Altura",value:`${g.toFixed(3)} √ó ${t} = ${v.toFixed(2)}`},{label:"Idade",value:`${f.toFixed(3)} √ó ${n} = ${B.toFixed(2)}`},{label:"Resultado",value:`${M.toFixed(0)} kcal`}],baseData:{weight:s,height:t,age:n,gender:d?"Masculino":"Feminino"}}}case"mifflin":{if(!s||!t||!n||!x)return null;const m=d?5:-161,c=10*s,g=6.25*t,f=5*n,S=c+g-f+m;return{formulaName:`Mifflin-St Jeor (${d?"Masculino":"Feminino"})`,equationStr:"(10 √ó P) + (6.25 √ó A) - (5 √ó I) + S",appliedStr:`(10 √ó ${s}) + (6.25 √ó ${t}) - (5 √ó ${n}) + ${m}`,steps:[{label:"Peso",value:`10 √ó ${s} = ${c}`},{label:"Altura",value:`6.25 √ó ${t} = ${g.toFixed(2)}`},{label:"Idade",value:`5 √ó ${n} = ${f}`},{label:"Constante (S)",value:m.toString()},{label:"Resultado",value:`${S.toFixed(0)} kcal`}],baseData:{weight:s,height:t,age:n,gender:d?"Masculino":"Feminino"}}}case"cunningham":{if(!o||o<=0)return null;const m=500,c=22*o,g=m+c;return{formulaName:"Cunningham (Atletas)",equationStr:"500 + (22 √ó MM)",appliedStr:`500 + (22 √ó ${o})`,steps:[{label:"Constante",value:"500"},{label:"Massa Magra",value:`22 √ó ${o} = ${c.toFixed(2)}`},{label:"Resultado",value:`${g.toFixed(0)} kcal`}],baseData:{leanMass:o,weight:s,height:t,age:n,gender:d?"Masculino":"Feminino"}}}case"tinsley":{if(!s||!o||o<=0)return null;const m=284,c=25.9*o,g=c+m;return{formulaName:"Tinsley (Bodybuilding)",equationStr:"(25.9 √ó MM) + 284",appliedStr:`(25.9 √ó ${o}) + 284`,steps:[{label:"Massa Magra",value:`25.9 √ó ${o} = ${c.toFixed(2)}`},{label:"Constante",value:"284"},{label:"Resultado",value:`${g.toFixed(0)} kcal`}],baseData:{leanMass:o,weight:s,height:t,age:n,gender:d?"Masculino":"Feminino"}}}case"fao":{if(!s||!x)return null;const m=d?15.3:14.7,c=d?679:496,g=m*s,f=g+c;return{formulaName:`FAO/WHO (${d?"Masculino":"Feminino"})`,equationStr:d?"(15.3 √ó P) + 679":"(14.7 √ó P) + 496",appliedStr:`(${m} √ó ${s}) + ${c}`,steps:[{label:"Peso",value:`${m} √ó ${s} = ${g.toFixed(2)}`},{label:"Constante",value:c.toString()},{label:"Resultado",value:`${f.toFixed(0)} kcal`}],baseData:{weight:s,height:t,age:n,gender:d?"Masculino":"Feminino"}}}default:return null}},ma=(a,i,s=null)=>{if(!a||!i)return null;const t=a*i,n=ae.find(x=>x.value===i);return{formulaName:"Gasto Energ√©tico Total (GET)",equationStr:"TMB √ó NAF",appliedStr:`${Math.round(a)} √ó ${i} = ${Math.round(t)}`,steps:[{label:"Taxa Metab√≥lica Basal (TMB)",value:`${Math.round(a)} kcal`},{label:"N√≠vel de Atividade (NAF)",value:`${i}${s?` (${s})`:""}`},{label:"GET",value:`${Math.round(t)} kcal/dia`}],baseData:{bmr:Math.round(a),activityFactor:i,activityLabel:s||n?.label||"N/A"}}};function ua({protocols:a,activityFactor:i,selectedProtocolId:s,onSelect:t,patientData:n}){if(!a||a.length===0)return null;const x=a.reduce((o,d)=>o+(d.bmr||0),0)/a.length;return e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-card shadow-sm",children:[e.jsxs("div",{className:"p-4 bg-muted/50 border-b flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-primary"}),"Comparativo Cient√≠fico"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Fator de Atividade: ",e.jsxs("strong",{className:"text-foreground",children:["x",i||1]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Re,{children:[e.jsx(Oe,{children:e.jsxs(xe,{children:[e.jsx(z,{children:"Protocolo"}),e.jsx(z,{children:"TMB (Basal)"}),e.jsx(z,{children:"GET (Total)"}),e.jsx(z,{className:"text-right",children:"A√ß√£o"})]})}),e.jsx(He,{children:a.map(o=>{if(!o.bmr||o.bmr<=0)return null;const d=Math.round(o.bmr*(i||1)),m=s===o.id,c=x>0?Math.round((o.bmr-x)/x*100):0;return e.jsxs(xe,{className:m?"bg-primary/5 border-primary/20":"",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2",children:[o.name,o.recommended&&e.jsx(j,{variant:"default",className:"text-[10px] h-5 px-1.5",children:"Recomendado"}),(o.category==="athlete"||o.id==="cunningham"||o.id==="tinsley")&&e.jsx(j,{variant:"secondary",className:"text-[10px] h-5 px-1.5",children:"Atleta"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o.description})]})}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-mono text-base font-semibold",children:[Math.round(o.bmr)," kcal"]}),x>0&&e.jsxs("span",{className:`text-[10px] ${c>0?"text-green-600 dark:text-green-400":c<0?"text-red-600 dark:text-red-400":"text-muted-foreground"}`,children:[c>0?"+":"",c,"% da m√©dia"]})]}),n&&(()=>{const g=da(o.id,n);return g?e.jsx(ve,{breakdown:g,variant:"compact"}):null})()]})}),e.jsxs(U,{children:[e.jsxs("div",{className:"font-bold text-primary text-lg",children:[d," kcal"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Gasto Energ√©tico Total"})]}),e.jsx(U,{className:"text-right",children:e.jsx(ee,{size:"sm",variant:m?"default":"outline",onClick:()=>t&&t(o),className:"gap-2 transition-all",disabled:!t,children:m?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Selecionado"})]}):"Usar este"})})]},o.id)})})]})})]})}const xa={1.2:aa,1.375:ea,1.55:be,1.725:Ke,1.9:sa},ha={1.2:"border-gray-300 bg-gray-50 hover:bg-gray-100",1.375:"border-blue-300 bg-blue-50 hover:bg-blue-100",1.55:"border-green-300 bg-green-50 hover:bg-green-100",1.725:"border-orange-300 bg-orange-50 hover:bg-orange-100",1.9:"border-purple-300 bg-purple-50 hover:bg-purple-100"},ga={1.2:"border-gray-500 bg-gray-100 ring-2 ring-gray-400",1.375:"border-blue-500 bg-blue-100 ring-2 ring-blue-400",1.55:"border-green-500 bg-green-100 ring-2 ring-green-400",1.725:"border-orange-500 bg-orange-100 ring-2 ring-orange-400",1.9:"border-purple-500 bg-purple-100 ring-2 ring-purple-400"};function pa({value:a,onChange:i}){return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3",children:ae.map(s=>{const t=xa[s.value]||be,n=a===s.value;return e.jsx($,{className:y("cursor-pointer transition-all duration-200",n?ga[s.value]:ha[s.value]),onClick:()=>i&&i(s.value),children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[e.jsx(t,{className:y("w-8 h-8",n?"text-primary":"text-muted-foreground")}),e.jsxs("div",{children:[e.jsx("p",{className:y("font-semibold text-sm",n?"text-foreground":"text-muted-foreground"),children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.desc})]}),e.jsxs("div",{className:y("text-xs font-mono px-2 py-1 rounded",n?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:["x",s.value]})]})})},s.value)})})}function fa({dailyDeficit:a=0}){const s=h.useMemo(()=>{if(!a||a===0)return{weeklyMin:0,weeklyMax:0,weeklyAvg:0,monthlyEstimate:0,isLoss:!1,isGain:!1};const t=a<0,n=Math.abs(a)*7/7700,x=n*.1,o=Math.max(0,n-x),d=n+x,m=n*4.33;return{weeklyMin:o,weeklyMax:d,weeklyAvg:n,monthlyEstimate:m,isLoss:t,isGain:!t}},[a]);return a===0?e.jsx($,{className:"border-dashed",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("p",{className:"text-sm",children:"Ajuste o slider para ver a proje√ß√£o"})]})})}):e.jsxs($,{className:y("border-2",s.isLoss?"border-green-500/50 bg-green-50/50 dark:bg-green-950/20":"border-blue-500/50 bg-blue-50/50 dark:bg-blue-950/20"),children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs(L,{className:"text-base flex items-center gap-2",children:[s.isLoss?e.jsx(Ue,{className:"w-5 h-5 text-green-600"}):e.jsx(je,{className:"w-5 h-5 text-blue-600"}),"Proje√ß√£o de Mudan√ßa de Peso"]}),e.jsxs(O,{className:"text-xs",children:["Baseado em ",Math.abs(a)," kcal ",s.isLoss?"de d√©ficit":"de super√°vit"," di√°rio"]})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:y("p-4 rounded-lg",s.isLoss?"bg-green-100 dark:bg-green-900/30":"bg-blue-100 dark:bg-blue-900/30"),children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 text-center",children:"Ritmo Estimado"}),e.jsxs("p",{className:y("text-2xl font-bold text-center",s.isLoss?"text-green-700 dark:text-green-400":"text-blue-700 dark:text-blue-400"),children:[s.isLoss?"-":"+",s.weeklyMin.toFixed(2),"kg - ",s.weeklyMax.toFixed(2),"kg"]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-1",children:"por semana"})]}),e.jsxs("div",{className:y("p-3 rounded-lg text-center",s.isLoss?"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800":"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800"),children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Em 1 m√™s"}),e.jsxs("p",{className:y("text-xl font-semibold",s.isLoss?"text-green-700 dark:text-green-400":"text-blue-700 dark:text-blue-400"),children:["~",s.isLoss?"-":"+",s.monthlyEstimate.toFixed(1)," kg"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:[e.jsx("span",{className:"font-medium",children:"‚ö†Ô∏è Estimativa matem√°tica."})," Resultados variam conforme ades√£o, metabolismo e adapta√ß√£o metab√≥lica."]})})]})]})}const qa=()=>{const{patientId:a}=$e(),i=Pe(),{toast:s}=De(),[t,n]=h.useState(!0),[x,o]=h.useState(!1),[d,m]=h.useState(""),[c,g]=h.useState(""),[f,S]=h.useState(""),[v,B]=h.useState(""),[M,Ne]=h.useState(""),[E,se]=h.useState(""),[te,w]=h.useState({weight:null,height:null,leanMass:null}),[C,D]=h.useState(1.55),[q,Y]=h.useState("mifflin"),[F,G]=h.useState(0),[ye,R]=h.useState(null),[re,Z]=h.useState(null),[ne,J]=h.useState(null),[H,le]=h.useState([]),[N,Q]=h.useState(null),[ie,Se]=h.useState(0),[oe,Me]=h.useState(0);h.useEffect(()=>{we()},[a]),h.useEffect(()=>{c&&f&&v&&M&&Ce()},[c,f,v,M,E]),h.useEffect(()=>{if(N){const r=oa(N.bmr,C);Se(r),Me(r+F)}},[N,C,F]);const we=async()=>{n(!0);try{const{data:r,error:u}=await k.from("user_profiles").select("name, birth_date, gender, weight, height").eq("id",a).single();if(u)throw u;if(m(r.name||"Paciente"),Ne(r.gender||""),r.birth_date){const l=new Date(r.birth_date),K=new Date,de=K.getFullYear()-l.getFullYear(),me=K.getMonth()-l.getMonth(),Ae=me<0||me===0&&K.getDate()<l.getDate()?de-1:de;B(Ae.toString())}const{data:p}=await k.from("growth_records").select("weight, height, results, record_date").eq("patient_id",a).order("record_date",{ascending:!1}).limit(1).maybeSingle();p?.weight?(g(p.weight.toString()),w(l=>({...l,weight:"anthropometry"}))):r.weight&&(g(r.weight.toString()),w(l=>({...l,weight:"profile"}))),p?.height?(S(p.height.toString()),w(l=>({...l,height:"anthropometry"}))):r.height&&(S(r.height.toString()),w(l=>({...l,height:"profile"}))),p?.results?.lean_mass_kg&&(se(p.results.lean_mass_kg.toString()),w(l=>({...l,leanMass:"anthropometry"})));const[b,A]=await Promise.all([We(a),Ye(a)]);if(b.data?.exerciseFrequency){const l=b.data.exerciseFrequency.toString().toLowerCase();l.includes("sedent")||l.includes("n√£o")||l.includes("nao")||l==="0"?(D(1.2),R("Sedent√°rio (baseado na anamnese)")):l.includes("1-3")||l.includes("1 a 3")||l.includes("leve")?(D(1.375),R("Levemente Ativo (baseado na anamnese)")):l.includes("3-5")||l.includes("3 a 5")||l.includes("moder")?(D(1.55),R("Moderadamente Ativo (baseado na anamnese)")):l.includes("6-7")||l.includes("6 a 7")||l.includes("muito")?(D(1.725),R("Muito Ativo (baseado na anamnese)")):(l.includes("2x")||l.includes("duas")||l.includes("extremo"))&&(D(1.9),R("Extremamente Ativo (baseado na anamnese)"))}if(A.data){const l=A.data.type?.toLowerCase();l==="weight_loss"||l==="perda_peso"||l==="emagrecimento"?(G(-500),Z("Perda de Peso"),J("goal")):l==="hypertrophy"||l==="hipertrofia"||l==="ganho_massa"?(G(300),Z("Hipertrofia"),J("goal")):(l==="maintenance"||l==="manutencao")&&(G(0),Z("Manuten√ß√£o"),J("goal"))}const{data:T}=await k.from("energy_expenditure_calculations").select("*").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();T&&(ye||D(parseFloat(T.activity_level)||1.55),!ne&&T.get_with_activities&&T.get&&G(T.get_with_activities-T.get),T.protocol&&Y({"harris-benedict":"harris","mifflin-st-jeor":"mifflin","fao-who":"fao",harris:"harris",mifflin:"mifflin",fao:"fao",cunningham:"cunningham",tinsley:"tinsley"}[T.protocol]||"mifflin"))}catch(r){console.error("Erro ao carregar dados:",r),s({title:"Erro",description:"N√£o foi poss√≠vel carregar os dados do paciente.",variant:"destructive"})}finally{n(!1)}},Ce=()=>{const r={weight:parseFloat(c),height:parseFloat(f),age:parseInt(v),gender:M,leanMass:E?parseFloat(E):null};if(!r.weight||!r.height||!r.age||!r.gender){le([]);return}const u=ca(r);le(u);const p=u.find(b=>b.id===q);if(!p&&u.length>0){const b=u.find(A=>A.recommended)||u[0];Y(b.id),Q(b)}else p&&Q(p)},ce=r=>{Y(r.id),Q(r)},Fe=async()=>{if(!N||!c||!f||!v||!M){s({title:"Dados incompletos",description:"Preencha todos os campos obrigat√≥rios.",variant:"destructive"});return}o(!0);try{const r={harris:"harris-benedict",mifflin:"mifflin-st-jeor",fao:"fao-who",cunningham:"cunningham",tinsley:"tinsley"},u={patient_id:a,weight:parseFloat(c),height:parseFloat(f),age:parseInt(v),gender:M,protocol:r[q]||q,activity_level:C,tmb:N.bmr,get:ie,get_with_activities:oe,updated_at:new Date().toISOString()},{data:p}=await k.from("energy_expenditure_calculations").select("id").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();let b;if(p){const{error:A}=await k.from("energy_expenditure_calculations").update(u).eq("id",p.id);b=A}else{const{error:A}=await k.from("energy_expenditure_calculations").insert(u);b=A}if(b)throw b;s({title:"Salvo!",description:"Planejamento energ√©tico salvo com sucesso."})}catch(r){console.error("Erro ao salvar:",r),s({title:"Erro",description:"N√£o foi poss√≠vel salvar o c√°lculo.",variant:"destructive"})}finally{o(!1)}},X=r=>{const u=te[r];return u==="anthropometry"?e.jsxs(j,{variant:"secondary",className:"text-xs ml-2",children:[e.jsx(Xe,{className:"w-3 h-3 mr-1"}),"Auto"]}):u==="profile"?e.jsxs(j,{variant:"outline",className:"text-xs ml-2",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"Perfil"]}):null};return t?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>i(-1),children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Centro de Controle Metab√≥lico"}),e.jsxs("p",{className:"text-muted-foreground",children:[d," - An√°lise e Planejamento Energ√©tico"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs($,{children:[e.jsxs(I,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5"}),"Dados Biol√≥gicos"]}),e.jsx(O,{children:"Par√¢metros para c√°lculo da TMB"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"weight",className:"flex items-center",children:["Peso (kg) *",X("weight")]}),e.jsx(V,{id:"weight",type:"number",step:"0.1",min:"1",value:c,onChange:r=>{g(r.target.value),w(u=>({...u,weight:"manual"}))},placeholder:"70.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"height",className:"flex items-center",children:["Altura (cm) *",X("height")]}),e.jsx(V,{id:"height",type:"number",step:"0.1",min:"50",value:f,onChange:r=>{S(r.target.value),w(u=>({...u,height:"manual"}))},placeholder:"175.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"age",children:"Idade (anos) *"}),e.jsx(V,{id:"age",type:"number",min:"1",max:"120",value:v,onChange:r=>B(r.target.value),placeholder:"30"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"leanMass",className:"flex items-center",children:["Massa Magra (kg)",X("leanMass")]}),e.jsx(V,{id:"leanMass",type:"number",step:"0.1",min:"0",value:E,onChange:r=>{se(r.target.value),w(u=>({...u,leanMass:"manual"}))},placeholder:"Opcional - Desbloqueia protocolos de atleta"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:te.leanMass==="anthropometry"?"Valor obtido do √∫ltimo registro de antropometria.":"Preencha para habilitar protocolos Cunningham e Tinsley."})]})]})]}),e.jsxs($,{children:[e.jsxs(I,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"N√≠vel de Atividade"]}),e.jsx(O,{children:"Selecione o fator de atividade f√≠sica"})]}),e.jsx(P,{children:e.jsx(pa,{value:C,onChange:D})})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[H.length>0&&e.jsxs($,{children:[e.jsxs(I,{children:[e.jsx(L,{children:"Comparativo Cient√≠fico"}),e.jsx(O,{children:"Compare diferentes f√≥rmulas de c√°lculo de TMB"})]}),e.jsx(P,{children:e.jsx(ua,{protocols:H,activityFactor:C,selectedProtocolId:q,onSelect:ce,patientData:{weight:parseFloat(c)||0,height:parseFloat(f)||0,age:parseInt(v)||0,gender:M||"",leanMass:E?parseFloat(E):null}})})]}),N&&e.jsxs($,{className:"sticky top-6",children:[e.jsxs(I,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Defini√ß√£o de Meta"]}),e.jsx(O,{children:"Configure o objetivo cal√≥rico final"})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"protocolSelect",children:"Protocolo Base"}),e.jsxs(Ie,{value:q,onValueChange:r=>{const u=H.find(p=>p.id===r);u&&ce(u)},children:[e.jsx(Le,{id:"protocolSelect",children:e.jsx(Be,{})}),e.jsx(qe,{children:H.map(r=>e.jsxs(Ge,{value:r.id,children:[r.name,r.recommended&&" (Recomendado)"]},r.id))})]})]}),e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gasto Energ√©tico Total (GET)"}),N&&(()=>{const r=ae.find(p=>p.value===C),u=ma(N.bmr,C,r?.label);return u?e.jsx(ve,{breakdown:u,variant:"compact"}):null})()]}),e.jsxs("p",{className:"text-2xl font-bold text-primary mt-1",children:[Math.round(ie)," ",e.jsx("span",{className:"text-base font-normal",children:"kcal/dia"})]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["TMB: ",Math.round(N.bmr)," kcal"]}),e.jsxs("p",{children:["NAF: x",C]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(_,{htmlFor:"goalAdjustment",children:"Ajuste de Objetivo (D√©ficit/Super√°vit)"}),e.jsxs("span",{className:`text-sm font-semibold ${F>0?"text-green-600":F<0?"text-red-600":"text-muted-foreground"}`,children:[F>0?"+":"",F," kcal"]})]}),re&&ne&&e.jsxs(j,{variant:"outline",className:"self-start text-xs",children:["üí° Sugest√£o baseada no objetivo: ",e.jsx("strong",{children:re})]})]}),e.jsx(_e,{id:"goalAdjustment",min:-1e3,max:1e3,step:50,value:[F],onValueChange:r=>G(r[0]),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"D√©ficit -1000"}),e.jsx("span",{children:"Equil√≠brio 0"}),e.jsx("span",{children:"Super√°vit +1000"})]})]}),e.jsx("div",{className:"p-6 bg-primary/10 border-2 border-primary/20 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Meta da Dieta"}),e.jsxs("p",{className:"text-5xl font-bold text-primary",children:[Math.round(oe)," ",e.jsx("span",{className:"text-3xl font-normal",children:"kcal"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"por dia"})]})}),e.jsx(fa,{dailyDeficit:F}),e.jsx(ee,{onClick:Fe,disabled:x,size:"lg",className:"w-full",children:x?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Salvar Planejamento"]})})]})]})]})]})]})})};export{qa as default};
