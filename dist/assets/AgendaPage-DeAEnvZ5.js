import{q as Qe,a9 as R,aM as Pe,r as p,O as l,j as e,V as ge,W as fe,Y as je,Z as ye,R as _e,_ as ze,B as x,s as P,u as et,a as tt,b as at,aN as st,m as nt,C as te,e as ae,M as me,v as it,aw as Ce,H as y,c as pe,d as ue,w as De,X as rt,U as ot,F as lt,A as ct,h as dt,i as mt,k as pt,l as ut,n as xt,o as ht,p as gt,ar as ft,ad as jt,aO as yt}from"./index-Cl9S2_vK.js";import{i as vt,a as Le,C as Me,e as Se}from"./calendar-Zuc8WWR8.js";import{I as T}from"./input-J8T_OYAP.js";import{L as w}from"./label-B6xwKmAy.js";import{S as W,a as B,b as U,c as J,d as M}from"./select-DVIkm2mv.js";import{B as ke}from"./badge-DPJEOXlY.js";import{b as bt}from"./pdfUtils-EBXEsIXu.js";import{S as ve}from"./search-DBl0ILHl.js";import{l as wt,g as Nt}from"./financial-queries-Cn-8WYGq.js";import{P as _t}from"./plus-2SV3Jemc.js";import{C as xe}from"./chevron-left-B_3ySMk6.js";import{F as Ct}from"./filter-DzDouWgV.js";import{C as Ee}from"./calendar-days-CoRIoi7Z.js";import{C as Dt}from"./clock-DpFyvVKk.js";import{E as Mt}from"./eye-Baiey97a.js";import{P as St}from"./pen-square-BteyrFgO.js";import{i as kt}from"./isTomorrow-B4D8Xyuo.js";import{i as Ae}from"./isSameDay-Csinm5Rf.js";import{i as C}from"./isToday-DzyVf0v2.js";import{s as Et}from"./subMonths-BLetOafQ.js";import{a as At}from"./addMonths-D_HdIz3j.js";import{s as Ft}from"./startOfMonth-BPzLXFQb.js";import"./extends-CF3RwP-h.js";import"./jspdf.plugin.autotable-DR81t-kr.js";import"./html2canvas.esm-B0tyYwQk.js";import"./parseISO-1naG7898.js";const Fe=Qe("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);function Tt(d,N,r){const v=R(d,r),h=R(N,r);return+v==+h}function Te(d){return vt(d,Pe(d))}function Oe(d,N){return Tt(d,Pe(d),N)}function Ot(d,N){return Le(d,-1)}const he="custom";function Pt({open:d,onOpenChange:N,appointment:r,patients:v=[],services:h=[],nutritionistId:Z,preSelectedDate:S,onSave:K}){const[a,c]=p.useState({patient_id:"",appointment_time_date:S?l(S,"yyyy-MM-dd"):l(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),[k,_]=p.useState(""),[X,D]=p.useState(!1),z=v.filter(n=>n.name.toLowerCase().includes(k.toLowerCase())).slice(0,5),E=[{value:"first_appointment",label:"Primeira Consulta"},{value:"return",label:"Retorno"},{value:"evaluation",label:"Avalia√ß√£o"},{value:"online",label:"Online"},{value:"in_person",label:"Presencial"}],g=[{value:"scheduled",label:"Agendada"},{value:"confirmed",label:"Confirmada"},{value:"awaiting_confirmation",label:"Aguardando Confirma√ß√£o"},{value:"completed",label:"Realizada"},{value:"cancelled",label:"Cancelada"},{value:"no_show",label:"Faltou"}],A=[{value:30,label:"30 minutos"},{value:45,label:"45 minutos"},{value:60,label:"1 hora"},{value:90,label:"1h 30min"},{value:120,label:"2 horas"}];p.useEffect(()=>{if(r){if(c({patient_id:r.patient_id||"",appointment_time_date:r.appointment_time?l(new Date(r.appointment_time),"yyyy-MM-dd"):l(new Date,"yyyy-MM-dd"),appointment_time_hour:r.appointment_time?l(new Date(r.appointment_time),"HH:mm"):"",duration:r.duration||60,appointment_type:r.appointment_type||"first_appointment",status:r.status||"scheduled",notes:r.notes||"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),r.patient_id){const n=v.find(o=>o.id===r.patient_id);n&&_(n.name)}}else c({patient_id:"",appointment_time_date:S?l(S,"yyyy-MM-dd"):l(new Date,"yyyy-MM-dd"),appointment_time_hour:"",duration:60,appointment_type:"first_appointment",status:"scheduled",notes:"",service_id:"",use_custom_price:!1,custom_price:"",custom_description:""}),_("")},[r,d,S,v]);const j=n=>{n===he?c(o=>({...o,service_id:"",use_custom_price:!0})):(h.find(o=>o.id.toString()===n),c(o=>({...o,service_id:n,use_custom_price:!1,custom_price:"",custom_description:""})))},b=n=>{if(n.preventDefault(),!a.patient_id||!a.appointment_time_date||!a.appointment_time_hour)return;const[o,Q,se]=a.appointment_time_date.split("-").map(Number),[Y,ne]=a.appointment_time_hour.split(":").map(Number),L=new Date(o,Q-1,se,Y,ne),O={...r,patient_id:a.patient_id,appointment_time:L.toISOString(),notes:a.notes,duration:a.duration,appointment_type:a.appointment_type,status:a.status},ie={service_id:a.use_custom_price?null:a.service_id||null,custom_price:a.use_custom_price?a.custom_price:null,custom_description:a.use_custom_price?a.custom_description:null};K(O,ie)},G=h.find(n=>n.id.toString()===a.service_id);return e.jsx(ge,{open:d,onOpenChange:N,children:e.jsxs(fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(je,{children:e.jsx(ye,{children:r?"Editar Agendamento":"Novo Agendamento"})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{htmlFor:"patient_search",children:"Paciente *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(T,{id:"patient_search",type:"text",placeholder:"Buscar paciente pelo nome...",value:k,onChange:n=>{_(n.target.value),D(!0),n.target.value||c(o=>({...o,patient_id:""}))},onFocus:()=>D(!0),className:"pl-9",required:!a.patient_id})]}),X&&k&&z.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-lg max-h-60 overflow-auto",children:z.map(n=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-accent hover:text-accent-foreground text-sm",onClick:()=>{c(o=>({...o,patient_id:n.id})),_(n.name),D(!1)},children:n.name},n.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"date",children:"Data *"}),e.jsx(T,{id:"date",type:"date",required:!0,value:a.appointment_time_date,onChange:n=>c(o=>({...o,appointment_time_date:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"time",children:"Hora *"}),e.jsx(T,{id:"time",type:"time",required:!0,value:a.appointment_time_hour,onChange:n=>c(o=>({...o,appointment_time_hour:n.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"duration",children:"Dura√ß√£o *"}),e.jsxs(W,{required:!0,value:String(a.duration),onValueChange:n=>c(o=>({...o,duration:Number(n)})),children:[e.jsx(B,{children:e.jsx(U,{})}),e.jsx(J,{children:A.map(n=>e.jsx(M,{value:String(n.value),children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"appointment_type",children:"Tipo *"}),e.jsxs(W,{required:!0,value:a.appointment_type,onValueChange:n=>c(o=>({...o,appointment_type:n})),children:[e.jsx(B,{children:e.jsx(U,{})}),e.jsx(J,{children:E.map(n=>e.jsx(M,{value:n.value,children:n.label},n.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"status",children:"Status *"}),e.jsxs(W,{required:!0,value:a.status,onValueChange:n=>c(o=>({...o,status:n})),children:[e.jsx(B,{children:e.jsx(U,{})}),e.jsx(J,{children:g.map(n=>e.jsx(M,{value:n.value,children:n.label},n.value))})]})]}),!r&&e.jsxs("div",{className:"border-t pt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(w,{className:"text-base font-semibold",children:"Informa√ß√µes Financeiras"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione um servi√ßo padr√£o ou defina um valor personalizado"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"service",children:"Servi√ßo"}),e.jsxs(W,{value:a.use_custom_price?he:a.service_id||"",onValueChange:j,children:[e.jsx(B,{children:e.jsx(U,{placeholder:"Selecione um servi√ßo ou valor personalizado"})}),e.jsxs(J,{children:[h.map(n=>e.jsxs(M,{value:n.id.toString(),children:[n.name," - ",_e(n.price)]},n.id)),e.jsx(M,{value:he,children:"üí∞ Valor Personalizado / Outro"})]})]})]}),a.use_custom_price?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"custom_price",children:"Valor Personalizado (R$) *"}),e.jsx(T,{id:"custom_price",type:"number",step:"0.01",min:"0",required:a.use_custom_price,value:a.custom_price,onChange:n=>c(o=>({...o,custom_price:n.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"custom_description",children:"Descri√ß√£o do Servi√ßo"}),e.jsx(T,{id:"custom_description",value:a.custom_description,onChange:n=>c(o=>({...o,custom_description:n.target.value})),placeholder:"Ex: Consulta especializada"})]})]}):G?e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Valor do servi√ßo:"}),e.jsx("p",{className:"text-lg font-semibold text-primary",children:_e(G.price)})]}):null]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"notes",children:"Observa√ß√µes"}),e.jsx(T,{id:"notes",value:a.notes,onChange:n=>c(o=>({...o,notes:n.target.value})),placeholder:"Informa√ß√µes adicionais (opcional)"})]}),e.jsxs(ze,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(x,{type:"submit",children:r?"Atualizar":"Salvar"})]})]})]})})}async function zt(d,N){const{nutritionist_id:r,patient_id:v,appointment_time:h,notes:Z,duration:S,appointment_type:K,status:a}=d,{service_id:c,custom_price:k,custom_description:_}=N,{data:X,error:D}=await P.from("appointments").insert({nutritionist_id:r,patient_id:v,appointment_time:h,notes:Z,duration:S||60,appointment_type:K||"first_appointment",status:a||"scheduled"}).select().single();if(D)throw console.error("Error creating appointment:",D),D;const{data:z}=await P.from("user_profiles").select("name").eq("id",v).single(),E=z?.name||"Paciente";let g=0,A="";if(c){const{data:b}=await P.from("services").select("name, price, category").eq("id",c).single();b&&(g=parseFloat(b.price),A=`Agendamento: ${E} - ${b.name}`)}else k&&(g=parseFloat(k),A=_?`Agendamento: ${E} - ${_}`:`Agendamento: ${E}`);let j=null;if(g>0&&A)try{const b=new Date(h);j=await wt({nutritionist_id:r,patient_id:v,type:"income",category:c?"consulta":"outros",description:A,amount:g,transaction_date:l(b,"yyyy-MM-dd"),status:"pending",due_date:l(b,"yyyy-MM-dd")})}catch(b){console.error("Error creating financial transaction:",b)}return{appointment:X,transaction:j}}async function Lt(d,N){const{data:r,error:v}=await P.from("appointments").update(N).eq("id",d).select().single();if(v)throw console.error("Error updating appointment:",v),v;return r}function ma(){const{user:d,signOut:N}=et(),{toast:r}=tt(),v=at(),[h,Z]=p.useState([]),[S,K]=p.useState([]),[a,c]=p.useState(null),[k,_]=p.useState(!1),[X,D]=p.useState(null),[z,E]=p.useState(!0),[g,A]=p.useState("all"),[j,b]=p.useState(""),[G,n]=p.useState(!1),[o,Q]=p.useState(null),[se,Y]=p.useState(!1),[ne,L]=p.useState(!1),[O,ie]=p.useState("week"),[$,re]=p.useState(R(new Date,{locale:y})),[q,oe]=p.useState(new Date),ee=p.useCallback(async()=>{if(!d)return;E(!0);const{data:t,error:s}=await P.from("appointments").select("*, patient:user_profiles!appointments_patient_id_fkey(name, id)").eq("nutritionist_id",d.id).limit(1e3);s?r({title:"Erro",description:s.message,variant:"destructive"}):Z(t||[]);const{data:i,error:m}=await P.from("user_profiles").select("id, name").eq("nutritionist_id",d.id).limit(500);if(m?r({title:"Erro",description:"N√£o foi poss√≠vel carregar os pacientes.",variant:"destructive"}):K(i||[]),services.length===0)try{const u=await Nt(d.id);setServices(u)}catch(u){console.error("Error loading services:",u)}E(!1)},[d,r,services.length]);p.useEffect(()=>{ee()},[ee]);const $e=async(t,s)=>{const{patient_id:i,appointment_time:m,notes:u,duration:f,appointment_type:V,status:I}=t,Ne=new Date(m),Ge=new Date(Ne.getTime()+f*6e4);if(h.some(F=>{if(t.id&&F.id===t.id)return!1;const ce=new Date(F.appointment_time),de=new Date(ce.getTime()+(F.duration||60)*6e4);return Ne<de&&Ge>ce})){r({title:"Conflito de Hor√°rio",description:"J√° existe um agendamento neste hor√°rio. Por favor, escolha outro hor√°rio.",variant:"destructive"});return}try{if(t.id)await Lt(t.id,{patient_id:i,appointment_time:m,notes:u,duration:f||60,appointment_type:V||"first_appointment",status:I||"scheduled"}),r({title:"Sucesso!",description:"Agendamento atualizado com sucesso."});else{const F={nutritionist_id:d.id,patient_id:i,appointment_time:m,notes:u,duration:f||60,appointment_type:V||"first_appointment",status:I||"scheduled"},{appointment:ce,transaction:de}=await zt(F,s);r(de?{title:"Sucesso!",description:"Agendamento criado e registro financeiro gerado automaticamente."}:{title:"Sucesso!",description:"Agendamento criado com sucesso."})}_(!1),D(null),ee()}catch(F){console.error("Error saving appointment:",F),r({title:"Erro",description:`N√£o foi poss√≠vel salvar o agendamento. ${F.message}`,variant:"destructive"})}},qe=t=>{Q(t),n(!0)},He=async()=>{if(!o)return;const{error:t}=await P.from("appointments").delete().eq("id",o.id);t?r({title:"Erro",description:"N√£o foi poss√≠vel deletar o agendamento.",variant:"destructive"}):(r({title:"Sucesso!",description:"Agendamento deletado com sucesso."}),ee()),n(!1),Q(null)},be=p.useMemo(()=>{const t=new Date;let s=[...h].sort((i,m)=>new Date(i.appointment_time)-new Date(m.appointment_time));if(a)s=s.filter(i=>Ae(new Date(i.appointment_time),a));else switch(g){case"today":s=s.filter(i=>C(new Date(i.appointment_time)));break;case"week":s=s.filter(i=>Oe(new Date(i.appointment_time),{locale:y}));break;case"month":s=s.filter(i=>Te(new Date(i.appointment_time)));break;default:s=s.filter(i=>new Date(i.appointment_time)>=st(t))}if(j.trim()){const i=j.toLowerCase();s=s.filter(m=>m.patient?.name?.toLowerCase().includes(i))}return s},[h,g,a,j]),we=p.useMemo(()=>{const t={};return be.forEach(s=>{const i=l(new Date(s.appointment_time),"yyyy-MM-dd");t[i]||(t[i]=[]),t[i].push(s)}),t},[be]),H=p.useMemo(()=>{const t={};return h.forEach(s=>{const i=l(new Date(s.appointment_time),"yyyy-MM-dd");t[i]=(t[i]||0)+1}),t},[h]),Ve=t=>{const s={scheduled:{label:"Agendada",variant:"outline",color:"text-blue-600 bg-blue-50"},confirmed:{label:"Confirmada",variant:"default",color:"text-green-600 bg-green-50"},awaiting_confirmation:{label:"Aguardando",variant:"secondary",color:"text-yellow-600 bg-yellow-50"},completed:{label:"Realizada",variant:"secondary",color:"text-gray-600 bg-gray-100"},cancelled:{label:"Cancelada",variant:"destructive",color:"text-red-600 bg-red-50"},no_show:{label:"Faltou",variant:"destructive",color:"text-orange-600 bg-orange-50"}};return s[t]||s.scheduled},Ie=t=>{const s={first_appointment:{label:"Primeira Consulta"},return:{label:"Retorno"},evaluation:{label:"Avalia√ß√£o"},online:{label:"Online"},in_person:{label:"Presencial"}};return s[t]||s.first_appointment},Re=(t,s)=>{const i=new Date(new Date(t).getTime()+(s||60)*6e4);return l(i,"HH:mm")},We=t=>{const[s,i,m]=t.split("-").map(Number),u=new Date(s,i-1,m),f=l(u,"EEEE",{locale:y}),V=f.charAt(0).toUpperCase()+f.slice(1),I=l(u,"dd 'de' MMMM",{locale:y});return C(u)?`Hoje ‚Ä¢ ${V}, ${I}`:kt(u)?`Amanh√£ ‚Ä¢ ${V}, ${I}`:`${V}, ${I}`},Be=()=>{c(ft(a||new Date,1))},Ue=()=>{c(jt(a||new Date,1))},Je=()=>{c(new Date)},Ke=()=>{c(null)},Xe=t=>{a&&Ae(t,a)?c(null):c(t)},Ye=t=>{c(t),Y(!1)},le=t=>t>=5?"text-secondary font-bold":t>=3?"text-yellow-600 font-bold":t>=1?"text-primary font-bold":"text-muted-foreground font-bold",Ze=async()=>{try{let t="",s=[],i,m;if(O==="week"?(i=R($,{locale:y}),m=Se($,{locale:y}),t=`Semana de ${l(i,"dd/MM")} a ${l(m,"dd/MM/yyyy")}`,s=h.filter(u=>{const f=new Date(u.appointment_time);return f>=i&&f<=m}).sort((u,f)=>new Date(u.appointment_time)-new Date(f.appointment_time))):(i=Ft(q),m=yt(q),t=l(q,"MMMM 'de' yyyy",{locale:y}),t=t.charAt(0).toUpperCase()+t.slice(1),s=h.filter(u=>{const f=new Date(u.appointment_time);return f>=i&&f<=m}).sort((u,f)=>new Date(u.appointment_time)-new Date(f.appointment_time))),s.length===0){r({title:"Sem agendamentos",description:`N√£o h√° agendamentos para ${t.toLowerCase()}.`,variant:"default"});return}await bt(s,O,t,d?.profile?.name||d?.email?.split("@")[0]||null),r({title:"PDF gerado!",description:`Agenda exportada com sucesso (${s.length} consultas).`}),L(!1)}catch(t){console.error("Erro ao exportar PDF:",t),r({title:"Erro ao exportar",description:"N√£o foi poss√≠vel gerar o PDF. Tente novamente.",variant:"destructive"})}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs(nt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 text-center sm:text-left",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-heading uppercase tracking-wide text-primary",children:"Agenda de Consultas"}),e.jsx("p",{className:"text-neutral-600 mt-1",children:"Visualize e gerencie todos os seus agendamentos."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-center sm:justify-end",children:[e.jsxs(x,{variant:"outline",onClick:()=>L(!0),className:"border-primary text-primary hover:bg-primary hover:text-white",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Exportar PDF"]}),e.jsxs(x,{onClick:()=>{D(null),_(!0)},className:"bg-primary hover:bg-primary/90",children:[e.jsx(_t,{className:"w-4 h-4 mr-2"})," Novo Agendamento"]})]})]}),e.jsx("div",{className:"lg:hidden mb-6",children:e.jsx(te,{className:"bg-card shadow-card-dark rounded-xl",children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(x,{variant:"outline",size:"icon",onClick:Be,className:"h-10 w-10 flex-shrink-0",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:a?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-primary",children:l(a,"dd 'de' MMMM",{locale:y})}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:l(a,"EEEE",{locale:y})})]}):e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Todos os agendamentos"})}),e.jsx(x,{variant:"outline",size:"icon",onClick:Ue,className:"h-10 w-10 flex-shrink-0",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(x,{variant:a&&C(a)?"default":"outline",size:"sm",onClick:Je,className:"flex-1",children:"Hoje"}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Y(!0),className:"flex-1",children:[e.jsx(it,{className:"w-4 h-4 mr-1.5"}),"Calend√°rio"]}),a&&e.jsx(x,{variant:"outline",size:"sm",onClick:Ke,className:"flex-1",children:"Ver Todos"})]})]})})}),e.jsx(ge,{open:se,onOpenChange:Y,children:e.jsxs(fe,{className:"max-w-sm",children:[e.jsxs(je,{children:[e.jsx(ye,{children:"Selecionar Data"}),e.jsx(Ce,{children:"Escolha uma data para ver os agendamentos"})]}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Me,{mode:"single",selected:a,onSelect:Ye,className:"rounded-md border",locale:y,modifiers:{today:t=>C(t),highLoad:t=>(H[l(t,"yyyy-MM-dd")]||0)>=5&&!C(t),mediumLoad:t=>{const s=H[l(t,"yyyy-MM-dd")]||0;return s>=3&&s<5&&!C(t)},lowLoad:t=>{const s=H[l(t,"yyyy-MM-dd")]||0;return s>=1&&s<3&&!C(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"space-y-2 pb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground px-2",children:"Legenda:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs px-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"5+"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-7 order-1",children:e.jsxs(te,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(pe,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(ue,{className:"font-heading text-base lg:text-lg font-semibold text-primary",children:"Agendamentos"}),e.jsxs(De,{className:"text-xs lg:text-sm",children:[a&&`Agendamentos de ${l(a,"dd/MM/yyyy")}`,!a&&g==="all"&&"Todos os pr√≥ximos agendamentos",!a&&g==="today"&&"Agendamentos de hoje",!a&&g==="week"&&"Agendamentos desta semana",!a&&g==="month"&&"Agendamentos deste m√™s"]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col sm:flex-row gap-3",children:[e.jsxs(W,{value:g,onValueChange:A,disabled:!!a,children:[e.jsxs(B,{className:"w-full sm:w-[180px]",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),e.jsx(U,{})]}),e.jsxs(J,{children:[e.jsx(M,{value:"all",children:"Todos"}),e.jsx(M,{value:"today",children:"Hoje"}),e.jsx(M,{value:"week",children:"Esta Semana"}),e.jsx(M,{value:"month",children:"Este M√™s"})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Buscar paciente...",value:j,onChange:t=>b(t.target.value),className:"pl-9"})]}),(j||a)&&e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{b(""),c(null)},className:"w-full sm:w-auto",children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]}),e.jsxs("div",{className:"lg:hidden relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Buscar paciente...",value:j,onChange:t=>b(t.target.value),className:"pl-9"})]})]})}),e.jsx(ae,{className:"p-3 lg:p-6",children:z?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"Carregando agendamentos..."})}):Object.keys(we).length>0?e.jsx("div",{className:"space-y-4 lg:space-y-6",children:Object.entries(we).map(([t,s])=>e.jsxs("div",{className:"space-y-2 lg:space-y-3",children:[!a&&e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 pb-2 border-b",children:[e.jsx(Ee,{className:"w-4 h-4 lg:w-5 lg:h-5 text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-sm lg:text-base text-foreground capitalize truncate",children:We(t)}),e.jsx(ke,{variant:"secondary",className:`ml-auto text-xs whitespace-nowrap border-0 ${s.length>=5?"bg-secondary/80 text-white":s.length>=3?"bg-yellow-400/70 text-yellow-900":"bg-primary/30 text-primary"}`,children:s.length})]}),e.jsx("div",{className:"space-y-2 lg:space-y-3",children:s.map(i=>{const m=Ve(i.status||"scheduled"),u=Ie(i.appointment_type||"first_appointment"),f=Re(i.appointment_time,i.duration);return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-4 p-2.5 lg:p-4 bg-muted/30 hover:bg-muted/50 rounded-lg border border-border/50 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-primary/10 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg min-w-[55px] lg:min-w-[70px] flex-shrink-0",children:[e.jsx(Dt,{className:"w-3 h-3 lg:w-4 lg:h-4 mb-0.5 lg:mb-1 text-primary"}),e.jsx("span",{className:"text-xs lg:text-sm font-bold text-primary",children:l(new Date(i.appointment_time),"HH:mm")}),e.jsx("span",{className:"text-[10px] lg:text-xs text-muted-foreground",children:f})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 mb-0.5",children:[e.jsx(ot,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-sm lg:text-base text-foreground truncate",children:i.patient?.name||"Paciente n√£o identificado"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(ke,{className:`text-xs ${m.color} border-0`,children:m.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:u.label}),i.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1 hidden lg:block",children:["‚Ä¢ ",i.notes]})]})]}),e.jsxs("div",{className:"flex gap-1 lg:gap-2 flex-shrink-0",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>v(`/nutritionist/patients/${i.patient_id}/hub`),className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-blue-50 hover:text-blue-600",title:"Ver detalhes do paciente",children:e.jsx(Mt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>{D(i),_(!0)},className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-primary/10 hover:text-primary",title:"Editar agendamento",children:e.jsx(St,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 lg:h-9 lg:w-9 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>qe(i),title:"Excluir agendamento",children:e.jsx(lt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})})]})]},i.id)})})]},t))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 lg:py-12 text-center",children:[e.jsx(Ee,{className:"w-12 h-12 lg:w-16 lg:h-16 text-muted-foreground/50 mb-3 lg:mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium text-sm lg:text-base mb-1 lg:mb-2",children:"Nenhum agendamento encontrado"}),e.jsxs("p",{className:"text-xs lg:text-sm text-muted-foreground",children:[j&&"Nenhum agendamento encontrado para esta busca",!j&&a&&"N√£o h√° consultas agendadas para este dia",!j&&!a&&g==="all"&&"Adicione um novo agendamento para come√ßar",!j&&!a&&g==="today"&&"N√£o h√° consultas agendadas para hoje",!j&&!a&&g==="week"&&"N√£o h√° consultas agendadas para esta semana",!j&&!a&&g==="month"&&"N√£o h√° consultas agendadas para este m√™s"]})]})})]})}),e.jsxs("div",{className:"hidden lg:block lg:col-span-3 order-2 space-y-6",children:[e.jsxs(te,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsxs(pe,{className:"pb-3",children:[e.jsx(ue,{className:"font-heading text-lg font-semibold text-primary",children:"Calend√°rio"}),e.jsx(De,{className:"text-xs",children:"Clique em um dia para filtrar ‚Ä¢ Clique novamente para limpar"})]}),e.jsxs(ae,{className:"flex flex-col items-center p-0 pb-3",children:[e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(Me,{mode:"single",selected:a,onSelect:Xe,className:"w-fit",locale:y,modifiers:{today:t=>C(t),highLoad:t=>(H[l(t,"yyyy-MM-dd")]||0)>=5&&!C(t),mediumLoad:t=>{const s=H[l(t,"yyyy-MM-dd")]||0;return s>=3&&s<5&&!C(t)},lowLoad:t=>{const s=H[l(t,"yyyy-MM-dd")]||0;return s>=1&&s<3&&!C(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"w-full px-4 mt-3 border-t pt-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Legenda:"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"5+"})]})]})]})]})]}),e.jsxs(te,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(pe,{className:"pb-3",children:e.jsx(ue,{className:"font-heading text-lg font-semibold text-primary",children:"Resumo"})}),e.jsx(ae,{className:"space-y-3",children:(()=>{const t=h.filter(m=>C(new Date(m.appointment_time))).length,s=h.filter(m=>Oe(new Date(m.appointment_time),{locale:y})).length,i=h.filter(m=>Te(new Date(m.appointment_time))).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hoje"}),e.jsx("span",{className:le(t),children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Esta Semana"}),e.jsx("span",{className:le(s),children:s})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Este M√™s"}),e.jsx("span",{className:le(i),children:i})]})]})})()})]})]})]}),e.jsx(ge,{open:ne,onOpenChange:L,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsxs(je,{children:[e.jsx(ye,{children:"Exportar Agenda em PDF"}),e.jsx(Ce,{children:"Selecione o per√≠odo que deseja exportar"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"period-type",children:"Per√≠odo"}),e.jsxs(W,{value:O,onValueChange:ie,children:[e.jsx(B,{id:"period-type",children:e.jsx(U,{})}),e.jsxs(J,{children:[e.jsx(M,{value:"week",children:"Semana"}),e.jsx(M,{value:"month",children:"M√™s"})]})]})]}),O==="week"&&e.jsxs("div",{children:[e.jsx(w,{children:"Selecionar Semana"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(x,{type:"button",variant:"outline",size:"icon",onClick:()=>re(Ot($)),children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 text-center text-sm font-medium",children:[l(R($,{locale:y}),"dd/MM")," a"," ",l(Se($,{locale:y}),"dd/MM/yyyy")]}),e.jsx(x,{type:"button",variant:"outline",size:"icon",onClick:()=>re(Le($,1)),children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>re(R(new Date,{locale:y})),className:"w-full mt-2 text-xs",children:"Semana Atual"})]}),O==="month"&&e.jsxs("div",{children:[e.jsx(w,{children:"Selecionar M√™s"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(x,{type:"button",variant:"outline",size:"icon",onClick:()=>oe(Et(q,1)),children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-center text-sm font-medium capitalize",children:l(q,"MMMM 'de' yyyy",{locale:y})}),e.jsx(x,{type:"button",variant:"outline",size:"icon",onClick:()=>oe(At(q,1)),children:e.jsx(me,{className:"w-4 h-4"})})]}),e.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>oe(new Date),className:"w-full mt-2 text-xs",children:"M√™s Atual"})]})]}),e.jsxs(ze,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>L(!1),children:"Cancelar"}),e.jsxs(x,{type:"button",onClick:Ze,className:"bg-primary",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Exportar"]})]})]})}),e.jsx(Pt,{open:k,onOpenChange:_,appointment:X,patients:S,services,nutritionistId:d?.id,preSelectedDate:a,onSave:$e}),e.jsx(ct,{open:G,onOpenChange:n,children:e.jsxs(dt,{children:[e.jsxs(mt,{children:[e.jsx(pt,{children:"Confirmar Exclus√£o"}),e.jsxs(ut,{children:["Tem certeza que deseja excluir o agendamento de"," ",e.jsx("strong",{children:o?.patient?.name})," para"," ",e.jsx("strong",{children:o&&l(new Date(o.appointment_time),"dd/MM/yyyy '√†s' HH:mm")}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta a√ß√£o n√£o pode ser desfeita."]})]}),e.jsxs(xt,{children:[e.jsx(ht,{children:"Cancelar"}),e.jsx(gt,{onClick:He,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})})}export{ma as default};
