import{r as a,u as k,a as D,b as S,j as e,L,A as P,m as R,C as I,c as O,d as F,e as T,f as H,B as j,g as q,h as B,i as M,k as Z,l as z,n as U,o as V,p as _,s as $}from"./index-BR6RRKhy.js";import{I as u}from"./input-Dw1LZ4d-.js";import{L as x}from"./label-CMl3sQfF.js";import{M as G}from"./mail-DgH4bo09.js";import{L as J}from"./lock-CxLZ8MA4.js";import{E as K}from"./eye-off-BEXMrfun.js";import{E as Q}from"./eye-D4X56Lig.js";import{A as W}from"./arrow-right-CJqUqs5t.js";function oe(){const[l,v]=a.useState(""),[h,N]=a.useState(""),[n,b]=a.useState(!1),[t,o]=a.useState(!1),[c,d]=a.useState(""),[y,p]=a.useState(!1),{signIn:w,user:r,loading:m}=k(),{toast:i}=D(),f=S();a.useEffect(()=>{if(!m){if(r?.profile){const s=r.profile.user_type==="nutritionist"?"/nutritionist":"/patient";console.log("Redirecting authenticated user to dashboard:",s),f(s,{replace:!0});return}if(r&&!r.profile){console.log("User authenticated but profile not loaded yet, waiting...");return}}},[r,m,f]);const E=async s=>{s.preventDefault(),o(!0);const{data:A,error:g}=await w({email:l,password:h});g?i({title:"Erro no login",description:g.message||"Email ou senha incorretos.",variant:"destructive"}):A.user&&i({title:"Login realizado com sucesso!",description:"Bem-vindo(a) de volta!"}),o(!1)},C=async()=>{if(c.trim()===""){i({title:"Erro",description:"Por favor, insira seu e-mail.",variant:"destructive"});return}o(!0);const{error:s}=await $.auth.resetPasswordForEmail(c,{redirectTo:`${window.location.origin}/update-password`});o(!1),s?i({title:"Erro ao enviar e-mail",description:s.message,variant:"destructive"}):(i({title:"Sucesso!",description:"Enviamos um link de recuperação para o seu e-mail."}),p(!1),d(""))};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Carregando..."})]})}):e.jsxs(P,{open:y,onOpenChange:p,children:[e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:[e.jsxs(I,{className:"bg-card shadow-card-dark border-border",children:[e.jsxs(O,{className:"space-y-4 pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:"https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png",alt:"HipoZero",className:"h-16 w-auto"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"text-2xl font-semibold text-foreground",children:"Acesso ao Sistema"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Entre com suas credenciais"})]})]}),e.jsxs(T,{children:[e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",className:"text-sm font-medium text-foreground",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"email",type:"email",placeholder:"seu@email.com",value:l,onChange:s=>v(s.target.value),required:!0,className:"pl-10 h-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{htmlFor:"password",className:"text-sm font-medium text-foreground",children:"Senha"}),e.jsx(H,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-xs text-primary hover:underline transition-colors",onClick:()=>d(l),children:"Esqueceu a senha?"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{id:"password",type:n?"text":"password",placeholder:"••••••••",value:h,onChange:s=>N(s.target.value),required:!0,className:"pl-10 pr-10 h-10"}),e.jsx("button",{type:"button",onClick:()=>b(!n),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:n?e.jsx(K,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})})]})]}),e.jsx(j,{type:"submit",className:"w-full h-10 bg-primary hover:bg-primary/90 text-white font-medium mt-6",disabled:t,children:t?"Entrando...":e.jsxs("span",{className:"flex items-center justify-center gap-2",children:["Entrar",e.jsx(W,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"mt-6 text-center border-t border-border pt-6",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Não tem uma conta?"," ",e.jsx(q,{to:"/register",className:"text-primary hover:underline font-medium transition-colors",children:"Cadastre-se"})]})})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plataforma profissional de gestão nutricional"})})]})}),e.jsxs(B,{children:[e.jsxs(M,{children:[e.jsx(Z,{children:"Recuperar Senha"}),e.jsx(z,{children:"Digite seu e-mail abaixo. Enviaremos um link para você criar uma nova senha."})]}),e.jsxs("div",{className:"py-2",children:[e.jsx(x,{htmlFor:"reset-email",children:"Email"}),e.jsx(u,{id:"reset-email",type:"email",placeholder:"seu@email.com",value:c,onChange:s=>d(s.target.value),className:"mt-2"})]}),e.jsxs(U,{children:[e.jsx(V,{disabled:t,children:"Cancelar"}),e.jsx(_,{asChild:!0,children:e.jsx(j,{onClick:C,disabled:t,className:"bg-primary hover:bg-primary/90",children:t?"Enviando...":"Enviar link"})})]})]})]})}export{oe as default};
