import{u as _,r as m,s as u,j as e,m as y,C as g,c as b,d as v,B as N,e as j,b as w,N as C,G as k,V as R,P as S,W as q,H as A}from"./index-DAnFA-vR.js";const D=({notification:a,onMarkAsRead:o,user:c})=>{const i=w(),{markChatAsRead:p}=C(),r=(t=>{const{type:n,content:s}=t;let h=e.jsx(S,{className:"w-5 h-5 text-primary"}),d={title:"Nova Notificação",description:"Você tem uma nova atualização."};switch(n){case"new_weekly_summary":d={title:"Novo Resumo Semanal",description:"Seu nutricionista adicionou observações sobre seu progresso.",action:()=>i("/patient/records")};break;case"appointment_reminder":d={title:"Lembrete de Consulta",description:`Sua consulta está agendada para ${new Date(s.appointment_time).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}.`,action:()=>c?.profile?.user_type==="nutritionist"?i("/nutritionist/agenda"):null};break;case"new_message":d={title:"Nova Mensagem no Chat",description:s.message||"Você tem uma nova mensagem.",action:()=>{const x=s.from_id;c?.profile?.user_type==="nutritionist"?i(`/chat/nutritionist/${x}`):i("/chat/patient"),p(x)}};break;case"daily_log_reminder":d={title:"Lembrete Diário",description:"Não se esqueça de registrar suas refeições hoje!",action:()=>i("/patient/add-food")};break;case"new_achievement":h=e.jsx(q,{className:"w-5 h-5 text-yellow-500"}),d={title:`Conquista: ${s.name}`,description:s.description,action:()=>i("/patient/profile",{state:{tab:"achievements"}})};break}return{...d,icon:h}})(a),f=()=>{r.action&&r.action(),a.is_read||o(a.id)};return e.jsx(g,{className:`transition-all ${a.is_read?"opacity-60":"bg-primary/5"}`,children:e.jsxs(j,{className:"p-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow cursor-pointer",onClick:f,children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:r.icon}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold",children:r.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),e.jsx("p",{className:"text-xs text-muted-foreground/80 mt-1",children:k(new Date(a.created_at),{addSuffix:!0,locale:A})})]})]}),!a.is_read&&e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>o(a.id),children:e.jsx(R,{className:"w-5 h-5 text-primary"})})]})})},E=()=>{const{user:a}=_(),[o,c]=m.useState([]),[i,p]=m.useState(!0),l=m.useCallback(async()=>{if(!a)return;p(!0);const{data:t,error:n}=await u.from("notifications").select("*").eq("user_id",a.id).order("created_at",{ascending:!1}).limit(200);n?console.error(n):c(t),p(!1)},[a]);m.useEffect(()=>{l()},[l]),m.useEffect(()=>{if(!a)return;const t=u.channel(`notifications:${a.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${a.id}`},()=>{l()}).subscribe();return()=>{u.removeChannel(t)}},[a,l]);const r=async t=>{await u.from("notifications").update({is_read:!0}).eq("id",t),c(n=>n.map(s=>s.id===t?{...s,is_read:!0}:s))},f=async()=>{await u.from("notifications").update({is_read:!0}).eq("user_id",a.id).eq("is_read",!1),c(t=>t.map(n=>({...n,is_read:!0})))};return e.jsx("div",{className:"pb-24 p-4",children:e.jsx(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:e.jsxs(g,{className:"glass-card",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(v,{children:"Notificações"}),o.some(t=>!t.is_read)&&e.jsx(N,{variant:"outline",size:"sm",onClick:f,children:"Marcar todas como lidas"})]})}),e.jsx(j,{className:"space-y-4",children:i?e.jsx("p",{children:"Carregando..."}):o.length>0?o.map(t=>e.jsx(D,{notification:t,onMarkAsRead:r,user:a},t.id)):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhuma notificação encontrada."})})]})})})};export{E as default};
