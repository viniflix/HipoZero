import{s as g}from"./index-CjuzupBo.js";const D=async(a,e={},r=50,t=0)=>{try{let o=g.from("meals").select(`
                *,
                meal_items (
                    *
                )
            `).eq("patient_id",a).order("meal_date",{ascending:!1}).order("meal_time",{ascending:!1}).range(t,t+r-1);e.startDate&&(o=o.gte("meal_date",e.startDate)),e.endDate&&(o=o.lte("meal_date",e.endDate)),e.mealType&&(o=o.eq("meal_type",e.mealType));const{data:n,error:l,count:c}=await o;if(l)throw l;return{data:n,error:null,count:c}}catch(o){return console.error("Erro ao buscar refeições:",o),{data:null,error:o}}},p=async a=>{try{const{data:e,error:r}=await g.from("meal_audit_log").select("*").eq("meal_id",a).order("created_at",{ascending:!1});if(r)throw r;return{data:e,error:null}}catch(e){return console.error("Erro ao buscar histórico de auditoria:",e),{data:null,error:e}}},f=async(a,e={},r=100)=>{try{let t=g.from("meal_audit_log").select("*").eq("patient_id",a).order("created_at",{ascending:!1}).limit(r);e.action&&(t=t.eq("action",e.action)),e.startDate&&(t=t.gte("meal_date",e.startDate)),e.endDate&&(t=t.lte("meal_date",e.endDate));const{data:o,error:n}=await t;if(n)throw n;return{data:o,error:null}}catch(t){return console.error("Erro ao buscar histórico completo:",t),{data:null,error:t}}},w=async(a,e=30)=>{try{const r=new Date;r.setDate(r.getDate()-e);const t=r.toISOString().split("T")[0],{data:o,error:n}=await g.from("meals").select("meal_date").eq("patient_id",a).gte("meal_date",t);if(n)throw n;const l=new Set(o.map(m=>m.meal_date)),c=l.size,d=c/e*100;let s=0;const u=new Date().toISOString().split("T")[0],i=Array.from(l).sort().reverse();for(let m=0;m<e;m++){const h=new Date;h.setDate(h.getDate()-m);const b=h.toISOString().split("T")[0];if(i.includes(b))s++;else if(b!==u)break}return{data:{totalDays:e,daysWithRecords:c,adherencePercentage:Math.round(d),currentStreak:s,totalMeals:o.length},error:null}}catch(r){return console.error("Erro ao calcular adesão:",r),{data:null,error:r}}},M=async(a,e,r)=>{try{const{data:t,error:o}=await g.from("meals").select(`
                *,
                meal_items (
                    quantity,
                    calories,
                    protein,
                    carbs,
                    fat
                )
            `).eq("patient_id",a).gte("meal_date",e).lte("meal_date",r);if(o)throw o;let n=0,l=0,c=0,d=0;t.forEach(u=>{u.meal_items?.forEach(i=>{n+=i.calories||0,l+=i.protein||0,c+=i.carbs||0,d+=i.fat||0})});const s=t.length>0?new Set(t.map(u=>u.meal_date)).size:1;return{data:{totalMeals:t.length,days:s,avgCaloriesPerDay:Math.round(n/s),avgProteinPerDay:Math.round(l/s),avgCarbsPerDay:Math.round(c/s),avgFatPerDay:Math.round(d/s),totals:{calories:Math.round(n),protein:Math.round(l),carbs:Math.round(c),fat:Math.round(d)}},error:null}}catch(t){return console.error("Erro ao calcular resumo nutricional:",t),{data:null,error:t}}},S=a=>{const e={create:{icon:"Plus",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",label:"Registrou",description:"Nova refeição adicionada"},update:{icon:"Edit",color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",label:"Editou",description:"Refeição modificada"},delete:{icon:"Trash2",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",label:"Excluiu",description:"Refeição removida"}};return e[a.action]||e.create},q=a=>{if(!a||!a.changes)return[];const e=[];return Object.keys(a.changes).forEach(r=>{const t=a.changes[r];e.push({field:r,oldValue:t.old,newValue:t.new,label:_(r)})}),e},_=a=>({meal_type:"Tipo de Refeição",meal_date:"Data",meal_time:"Horário",notes:"Observações",foods:"Alimentos"})[a]||a;export{D as a,f as b,w as c,p as d,q as e,S as f,M as g};
