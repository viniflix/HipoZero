import{q as Be,r as s,aG as Kt,j as e,R as jt,ai as xe,aj as he,ak as fe,al as pe,au as ge,an as Se,B as A,X as Fe,L as ze,s as me,V as Ye,ae as Zt,C as se,c as ve,d as je,e as ae,F as st,b as bt,T as Jt,ar as lt,v as es,a as Nt,I as Ie,E as Xe,A as yt,h as wt,i as St,k as Ct,l as _t,n as $t,o as Pt,p as Et,as as ts,u as ss,D as as,x as rs,y as ns,z as Ae,aH as it}from"./index-DGgtqe62.js";import{I as re}from"./input-C1Ic9mBe.js";import{B as Ce}from"./badge-DGVDmpcG.js";import{A as qe,a as Ue}from"./alert-CXf0xPB7.js";import{L as te}from"./label-ByZ_-J2k.js";import{T as at}from"./textarea-CBcJgsLM.js";import{C as Ge}from"./checkbox-CqUe7DNy.js";import{S as At,a as Tt,b as Ft,c as kt,d as Qe}from"./select-D8SYYGjz.js";import{_ as X}from"./extends-CF3RwP-h.js";import{S as os}from"./SmartFoodForm-sm71H-xG.js";import{P as be}from"./plus-DLJbgUL_.js";import{S as rt}from"./search-BxmDnKV2.js";import{f as Mt}from"./measureTranslations-AG6EuUvS.js";import{P as ke}from"./pen-square-UGEIzMfA.js";import{R as ls}from"./ReferenceValuesModal-uzq6yP_Y.js";import{F as ct}from"./flame-CMhhULMf.js";import{B as Ke}from"./bar-chart-3-s3UU0Ln8.js";import{T as dt}from"./trending-down-jon_vNx-.js";import{M as is}from"./minus-U7BS-O96.js";import{getReferenceValues as Rt,getTemplates as cs,getMealPlanById as Oe,applyTemplateToPatient as ds,getMealPlans as ms,getActiveMealPlan as us,updateFullMealPlan as xs,createMealPlan as hs,addMealToPlan as fs,addFoodToMeal as ps,archiveMealPlan as gs,setActiveMealPlan as vs,deleteMealPlan as js,copyMealPlanToPatient as bs,savePlanAsTemplate as Ns}from"./meal-plan-queries-2WgC2H2z.js";import{S as ys}from"./save-Ca_h8coN.js";import{g as ws}from"./anamnesis-queries-B86s8gfB.js";import{R as Ss}from"./ruler-CC1sg4dL.js";import{e as Cs}from"./pdfUtils-CmDFPXq6.js";import{E as _s,a as $s}from"./jspdf.plugin.autotable-1hrly3AI.js";import{t as Ps}from"./mealTranslations-B1KHhmEq.js";import{A as mt}from"./arrow-left-Dh54ORp5.js";import{R as ut}from"./refresh-cw-CQ3wbvvN.js";import{M as Es}from"./more-vertical-CWkyer9S.js";import{D as xt}from"./download-DMbtZ0RA.js";import"./index-zv1rXw9e.js";import"./tabs-CsBOgm3t.js";import"./foodService-BX23jDYT.js";import"./calculator-BZhWNrQj.js";import"./popover-CDJaaO_h.js";import"./info-BAzdUoRc.js";import"./html2canvas.esm-B0tyYwQk.js";const As=Be("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),Ze=Be("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),ht=Be("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),ft=Be("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function Ts(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function Dt(...t){return n=>t.forEach(a=>Ts(a,n))}function Pe(...t){return s.useCallback(Dt(...t),t)}const Lt=s.forwardRef((t,n)=>{const{children:a,...o}=t,r=s.Children.toArray(a),l=r.find(ks);if(l){const i=l.props.children,d=r.map(m=>m===l?s.Children.count(i)>1?s.Children.only(null):s.isValidElement(i)?i.props.children:null:m);return s.createElement(Je,X({},o,{ref:n}),s.isValidElement(i)?s.cloneElement(i,void 0,d):null)}return s.createElement(Je,X({},o,{ref:n}),a)});Lt.displayName="Slot";const Je=s.forwardRef((t,n)=>{const{children:a,...o}=t;return s.isValidElement(a)?s.cloneElement(a,{...Ms(o,a.props),ref:n?Dt(n,a.ref):a.ref}):s.Children.count(a)>1?s.Children.only(null):null});Je.displayName="SlotClone";const Fs=({children:t})=>s.createElement(s.Fragment,null,t);function ks(t){return s.isValidElement(t)&&t.type===Fs}function Ms(t,n){const a={...n};for(const o in n){const r=t[o],l=n[o];/^on[A-Z]/.test(o)?r&&l?a[o]=(...d)=>{l(...d),r(...d)}:r&&(a[o]=r):o==="style"?a[o]={...r,...l}:o==="className"&&(a[o]=[r,l].filter(Boolean).join(" "))}return{...t,...a}}const Rs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Re=Rs.reduce((t,n)=>{const a=s.forwardRef((o,r)=>{const{asChild:l,...i}=o,d=l?Lt:n;return s.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),s.createElement(d,X({},i,{ref:r}))});return a.displayName=`Primitive.${n}`,{...t,[n]:a}},{}),et=globalThis?.document?s.useLayoutEffect:()=>{};function Ds(t,n){return s.useReducer((a,o)=>{const r=n[a][o];return r??a},t)}const De=t=>{const{present:n,children:a}=t,o=Ls(n),r=typeof a=="function"?a({present:o.isPresent}):s.Children.only(a),l=Pe(o.ref,r.ref);return typeof a=="function"||o.isPresent?s.cloneElement(r,{ref:l}):null};De.displayName="Presence";function Ls(t){const[n,a]=s.useState(),o=s.useRef({}),r=s.useRef(t),l=s.useRef("none"),i=t?"mounted":"unmounted",[d,m]=Ds(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return s.useEffect(()=>{const x=Le(o.current);l.current=d==="mounted"?x:"none"},[d]),et(()=>{const x=o.current,c=r.current;if(c!==t){const u=l.current,w=Le(x);t?m("MOUNT"):w==="none"||x?.display==="none"?m("UNMOUNT"):m(c&&u!==w?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,m]),et(()=>{if(n){const x=p=>{const w=Le(o.current).includes(p.animationName);p.target===n&&w&&Kt.flushSync(()=>m("ANIMATION_END"))},c=p=>{p.target===n&&(l.current=Le(o.current))};return n.addEventListener("animationstart",c),n.addEventListener("animationcancel",x),n.addEventListener("animationend",x),()=>{n.removeEventListener("animationstart",c),n.removeEventListener("animationcancel",x),n.removeEventListener("animationend",x)}}else m("ANIMATION_END")},[n,m]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:s.useCallback(x=>{x&&(o.current=getComputedStyle(x)),a(x)},[])}}function Le(t){return t?.animationName||"none"}function zs(t,n=[]){let a=[];function o(l,i){const d=s.createContext(i),m=a.length;a=[...a,i];function x(p){const{scope:u,children:w,...y}=p,T=u?.[t][m]||d,F=s.useMemo(()=>y,Object.values(y));return s.createElement(T.Provider,{value:F},w)}function c(p,u){const w=u?.[t][m]||d,y=s.useContext(w);if(y)return y;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${l}\``)}return x.displayName=l+"Provider",[x,c]}const r=()=>{const l=a.map(i=>s.createContext(i));return function(d){const m=d?.[t]||l;return s.useMemo(()=>({[`__scope${t}`]:{...d,[t]:m}}),[d,m])}};return r.scopeName=t,[o,Is(r,...n)]}function Is(...t){const n=t[0];if(t.length===1)return n;const a=()=>{const o=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(l){const i=o.reduce((d,{useScope:m,scopeName:x})=>{const p=m(l)[`__scope${x}`];return{...d,...p}},{});return s.useMemo(()=>({[`__scope${n.scopeName}`]:i}),[i])}};return a.scopeName=n.scopeName,a}function _e(t){const n=s.useRef(t);return s.useEffect(()=>{n.current=t}),s.useMemo(()=>(...a)=>{var o;return(o=n.current)===null||o===void 0?void 0:o.call(n,...a)},[])}const Os=s.createContext(void 0);function qs(t){const n=s.useContext(Os);return t||n||"ltr"}function Us(t,[n,a]){return Math.min(a,Math.max(n,t))}function $e(t,n,{checkForDefaultPrevented:a=!0}={}){return function(r){if(t?.(r),a===!1||!r.defaultPrevented)return n?.(r)}}function Ws(t,n){return s.useReducer((a,o)=>{const r=n[a][o];return r??a},t)}const zt="ScrollArea",[It]=zs(zt),[Bs,le]=It(zt),Hs=s.forwardRef((t,n)=>{const{__scopeScrollArea:a,type:o="hover",dir:r,scrollHideDelay:l=600,...i}=t,[d,m]=s.useState(null),[x,c]=s.useState(null),[p,u]=s.useState(null),[w,y]=s.useState(null),[T,F]=s.useState(null),[k,R]=s.useState(0),[N,h]=s.useState(0),[_,E]=s.useState(!1),[I,V]=s.useState(!1),$=Pe(n,M=>m(M)),v=qs(r);return s.createElement(Bs,{scope:a,type:o,dir:v,scrollHideDelay:l,scrollArea:d,viewport:x,onViewportChange:c,content:p,onContentChange:u,scrollbarX:w,onScrollbarXChange:y,scrollbarXEnabled:_,onScrollbarXEnabledChange:E,scrollbarY:T,onScrollbarYChange:F,scrollbarYEnabled:I,onScrollbarYEnabledChange:V,onCornerWidthChange:R,onCornerHeightChange:h},s.createElement(Re.div,X({dir:v},i,{ref:$,style:{position:"relative","--radix-scroll-area-corner-width":k+"px","--radix-scroll-area-corner-height":N+"px",...t.style}})))}),Vs="ScrollAreaViewport",Ys=s.forwardRef((t,n)=>{const{__scopeScrollArea:a,children:o,...r}=t,l=le(Vs,a),i=s.useRef(null),d=Pe(n,i,l.onViewportChange);return s.createElement(s.Fragment,null,s.createElement("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"}}),s.createElement(Re.div,X({"data-radix-scroll-area-viewport":""},r,{ref:d,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...t.style}}),s.createElement("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"}},o)))}),Ne="ScrollAreaScrollbar",Ot=s.forwardRef((t,n)=>{const{forceMount:a,...o}=t,r=le(Ne,t.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:i}=r,d=t.orientation==="horizontal";return s.useEffect(()=>(d?l(!0):i(!0),()=>{d?l(!1):i(!1)}),[d,l,i]),r.type==="hover"?s.createElement(Xs,X({},o,{ref:n,forceMount:a})):r.type==="scroll"?s.createElement(Gs,X({},o,{ref:n,forceMount:a})):r.type==="auto"?s.createElement(qt,X({},o,{ref:n,forceMount:a})):r.type==="always"?s.createElement(nt,X({},o,{ref:n})):null}),Xs=s.forwardRef((t,n)=>{const{forceMount:a,...o}=t,r=le(Ne,t.__scopeScrollArea),[l,i]=s.useState(!1);return s.useEffect(()=>{const d=r.scrollArea;let m=0;if(d){const x=()=>{window.clearTimeout(m),i(!0)},c=()=>{m=window.setTimeout(()=>i(!1),r.scrollHideDelay)};return d.addEventListener("pointerenter",x),d.addEventListener("pointerleave",c),()=>{window.clearTimeout(m),d.removeEventListener("pointerenter",x),d.removeEventListener("pointerleave",c)}}},[r.scrollArea,r.scrollHideDelay]),s.createElement(De,{present:a||l},s.createElement(qt,X({"data-state":l?"visible":"hidden"},o,{ref:n})))}),Gs=s.forwardRef((t,n)=>{const{forceMount:a,...o}=t,r=le(Ne,t.__scopeScrollArea),l=t.orientation==="horizontal",i=Ve(()=>m("SCROLL_END"),100),[d,m]=Ws("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return s.useEffect(()=>{if(d==="idle"){const x=window.setTimeout(()=>m("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(x)}},[d,r.scrollHideDelay,m]),s.useEffect(()=>{const x=r.viewport,c=l?"scrollLeft":"scrollTop";if(x){let p=x[c];const u=()=>{const w=x[c];p!==w&&(m("SCROLL"),i()),p=w};return x.addEventListener("scroll",u),()=>x.removeEventListener("scroll",u)}},[r.viewport,l,m,i]),s.createElement(De,{present:a||d!=="hidden"},s.createElement(nt,X({"data-state":d==="hidden"?"hidden":"visible"},o,{ref:n,onPointerEnter:$e(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:$e(t.onPointerLeave,()=>m("POINTER_LEAVE"))})))}),qt=s.forwardRef((t,n)=>{const a=le(Ne,t.__scopeScrollArea),{forceMount:o,...r}=t,[l,i]=s.useState(!1),d=t.orientation==="horizontal",m=Ve(()=>{if(a.viewport){const x=a.viewport.offsetWidth<a.viewport.scrollWidth,c=a.viewport.offsetHeight<a.viewport.scrollHeight;i(d?x:c)}},10);return Te(a.viewport,m),Te(a.content,m),s.createElement(De,{present:o||l},s.createElement(nt,X({"data-state":l?"visible":"hidden"},r,{ref:n})))}),nt=s.forwardRef((t,n)=>{const{orientation:a="vertical",...o}=t,r=le(Ne,t.__scopeScrollArea),l=s.useRef(null),i=s.useRef(0),[d,m]=s.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=Ht(d.viewport,d.content),c={...o,sizes:d,onSizesChange:m,hasThumb:x>0&&x<1,onThumbChange:u=>l.current=u,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:u=>i.current=u};function p(u,w){return aa(u,i.current,d,w)}return a==="horizontal"?s.createElement(Qs,X({},c,{ref:n,onThumbPositionChange:()=>{if(r.viewport&&l.current){const u=r.viewport.scrollLeft,w=pt(u,d,r.dir);l.current.style.transform=`translate3d(${w}px, 0, 0)`}},onWheelScroll:u=>{r.viewport&&(r.viewport.scrollLeft=u)},onDragScroll:u=>{r.viewport&&(r.viewport.scrollLeft=p(u,r.dir))}})):a==="vertical"?s.createElement(Ks,X({},c,{ref:n,onThumbPositionChange:()=>{if(r.viewport&&l.current){const u=r.viewport.scrollTop,w=pt(u,d);l.current.style.transform=`translate3d(0, ${w}px, 0)`}},onWheelScroll:u=>{r.viewport&&(r.viewport.scrollTop=u)},onDragScroll:u=>{r.viewport&&(r.viewport.scrollTop=p(u))}})):null}),Qs=s.forwardRef((t,n)=>{const{sizes:a,onSizesChange:o,...r}=t,l=le(Ne,t.__scopeScrollArea),[i,d]=s.useState(),m=s.useRef(null),x=Pe(n,m,l.onScrollbarXChange);return s.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),s.createElement(Wt,X({"data-orientation":"horizontal"},r,{ref:x,sizes:a,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":He(a)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.x),onDragScroll:c=>t.onDragScroll(c.x),onWheelScroll:(c,p)=>{if(l.viewport){const u=l.viewport.scrollLeft+c.deltaX;t.onWheelScroll(u),Yt(u,p)&&c.preventDefault()}},onResize:()=>{m.current&&l.viewport&&i&&o({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:We(i.paddingLeft),paddingEnd:We(i.paddingRight)}})}}))}),Ks=s.forwardRef((t,n)=>{const{sizes:a,onSizesChange:o,...r}=t,l=le(Ne,t.__scopeScrollArea),[i,d]=s.useState(),m=s.useRef(null),x=Pe(n,m,l.onScrollbarYChange);return s.useEffect(()=>{m.current&&d(getComputedStyle(m.current))},[m]),s.createElement(Wt,X({"data-orientation":"vertical"},r,{ref:x,sizes:a,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":He(a)+"px",...t.style},onThumbPointerDown:c=>t.onThumbPointerDown(c.y),onDragScroll:c=>t.onDragScroll(c.y),onWheelScroll:(c,p)=>{if(l.viewport){const u=l.viewport.scrollTop+c.deltaY;t.onWheelScroll(u),Yt(u,p)&&c.preventDefault()}},onResize:()=>{m.current&&l.viewport&&i&&o({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:We(i.paddingTop),paddingEnd:We(i.paddingBottom)}})}}))}),[Zs,Ut]=It(Ne),Wt=s.forwardRef((t,n)=>{const{__scopeScrollArea:a,sizes:o,hasThumb:r,onThumbChange:l,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:m,onDragScroll:x,onWheelScroll:c,onResize:p,...u}=t,w=le(Ne,a),[y,T]=s.useState(null),F=Pe(n,$=>T($)),k=s.useRef(null),R=s.useRef(""),N=w.viewport,h=o.content-o.viewport,_=_e(c),E=_e(m),I=Ve(p,10);function V($){if(k.current){const v=$.clientX-k.current.left,M=$.clientY-k.current.top;x({x:v,y:M})}}return s.useEffect(()=>{const $=v=>{const M=v.target;y?.contains(M)&&_(v,h)};return document.addEventListener("wheel",$,{passive:!1}),()=>document.removeEventListener("wheel",$,{passive:!1})},[N,y,h,_]),s.useEffect(E,[o,E]),Te(y,I),Te(w.content,I),s.createElement(Zs,{scope:a,scrollbar:y,hasThumb:r,onThumbChange:_e(l),onThumbPointerUp:_e(i),onThumbPositionChange:E,onThumbPointerDown:_e(d)},s.createElement(Re.div,X({},u,{ref:F,style:{position:"absolute",...u.style},onPointerDown:$e(t.onPointerDown,$=>{$.button===0&&($.target.setPointerCapture($.pointerId),k.current=y.getBoundingClientRect(),R.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",w.viewport&&(w.viewport.style.scrollBehavior="auto"),V($))}),onPointerMove:$e(t.onPointerMove,V),onPointerUp:$e(t.onPointerUp,$=>{const v=$.target;v.hasPointerCapture($.pointerId)&&v.releasePointerCapture($.pointerId),document.body.style.webkitUserSelect=R.current,w.viewport&&(w.viewport.style.scrollBehavior=""),k.current=null})})))}),tt="ScrollAreaThumb",Js=s.forwardRef((t,n)=>{const{forceMount:a,...o}=t,r=Ut(tt,t.__scopeScrollArea);return s.createElement(De,{present:a||r.hasThumb},s.createElement(ea,X({ref:n},o)))}),ea=s.forwardRef((t,n)=>{const{__scopeScrollArea:a,style:o,...r}=t,l=le(tt,a),i=Ut(tt,a),{onThumbPositionChange:d}=i,m=Pe(n,p=>i.onThumbChange(p)),x=s.useRef(),c=Ve(()=>{x.current&&(x.current(),x.current=void 0)},100);return s.useEffect(()=>{const p=l.viewport;if(p){const u=()=>{if(c(),!x.current){const w=ra(p,d);x.current=w,d()}};return d(),p.addEventListener("scroll",u),()=>p.removeEventListener("scroll",u)}},[l.viewport,c,d]),s.createElement(Re.div,X({"data-state":i.hasThumb?"visible":"hidden"},r,{ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:$e(t.onPointerDownCapture,p=>{const w=p.target.getBoundingClientRect(),y=p.clientX-w.left,T=p.clientY-w.top;i.onThumbPointerDown({x:y,y:T})}),onPointerUp:$e(t.onPointerUp,i.onThumbPointerUp)}))}),Bt="ScrollAreaCorner",ta=s.forwardRef((t,n)=>{const a=le(Bt,t.__scopeScrollArea),o=!!(a.scrollbarX&&a.scrollbarY);return a.type!=="scroll"&&o?s.createElement(sa,X({},t,{ref:n})):null}),sa=s.forwardRef((t,n)=>{const{__scopeScrollArea:a,...o}=t,r=le(Bt,a),[l,i]=s.useState(0),[d,m]=s.useState(0),x=!!(l&&d);return Te(r.scrollbarX,()=>{var c;const p=((c=r.scrollbarX)===null||c===void 0?void 0:c.offsetHeight)||0;r.onCornerHeightChange(p),m(p)}),Te(r.scrollbarY,()=>{var c;const p=((c=r.scrollbarY)===null||c===void 0?void 0:c.offsetWidth)||0;r.onCornerWidthChange(p),i(p)}),x?s.createElement(Re.div,X({},o,{ref:n,style:{width:l,height:d,position:"absolute",right:r.dir==="ltr"?0:void 0,left:r.dir==="rtl"?0:void 0,bottom:0,...t.style}})):null});function We(t){return t?parseInt(t,10):0}function Ht(t,n){const a=t/n;return isNaN(a)?0:a}function He(t){const n=Ht(t.viewport,t.content),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,o=(t.scrollbar.size-a)*n;return Math.max(o,18)}function aa(t,n,a,o="ltr"){const r=He(a),l=r/2,i=n||l,d=r-i,m=a.scrollbar.paddingStart+i,x=a.scrollbar.size-a.scrollbar.paddingEnd-d,c=a.content-a.viewport,p=o==="ltr"?[0,c]:[c*-1,0];return Vt([m,x],p)(t)}function pt(t,n,a="ltr"){const o=He(n),r=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,l=n.scrollbar.size-r,i=n.content-n.viewport,d=l-o,m=a==="ltr"?[0,i]:[i*-1,0],x=Us(t,m);return Vt([0,i],[0,d])(x)}function Vt(t,n){return a=>{if(t[0]===t[1]||n[0]===n[1])return n[0];const o=(n[1]-n[0])/(t[1]-t[0]);return n[0]+o*(a-t[0])}}function Yt(t,n){return t>0&&t<n}const ra=(t,n=()=>{})=>{let a={left:t.scrollLeft,top:t.scrollTop},o=0;return(function r(){const l={left:t.scrollLeft,top:t.scrollTop},i=a.left!==l.left,d=a.top!==l.top;(i||d)&&n(),a=l,o=window.requestAnimationFrame(r)})(),()=>window.cancelAnimationFrame(o)};function Ve(t,n){const a=_e(t),o=s.useRef(0);return s.useEffect(()=>()=>window.clearTimeout(o.current),[]),s.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(a,n)},[a,n])}function Te(t,n){const a=_e(n);et(()=>{let o=0;if(t){const r=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(a)});return r.observe(t),()=>{window.cancelAnimationFrame(o),r.unobserve(t)}}},[t,a])}const Xt=Hs,na=Ys,oa=ta,Me=s.forwardRef(({className:t,children:n,...a},o)=>e.jsxs(Xt,{ref:o,className:jt("relative overflow-hidden",t),...a,children:[e.jsx(na,{className:"h-full w-full rounded-[inherit]",children:n}),e.jsx(Gt,{}),e.jsx(oa,{})]}));Me.displayName=Xt.displayName;const Gt=s.forwardRef(({className:t,orientation:n="vertical",...a},o)=>e.jsx(Ot,{ref:o,orientation:n,className:jt("flex touch-none select-none transition-colors",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...a,children:e.jsx(Js,{className:"relative flex-1 rounded-full bg-border"})}));Gt.displayName=Ot.displayName;function la({open:t,onOpenChange:n,initialName:a="",onFoodCreated:o}){const[r,l]=s.useState(!1),i=s.useRef(null),d=c=>{l(!1),o&&o(c),x()},m=()=>{i.current&&(l(!0),i.current.submit())},x=()=>{l(!1),n(!1)};return e.jsx(xe,{open:t,onOpenChange:x,children:e.jsxs(he,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Cadastrar Alimento RÃ¡pido"]}),e.jsx(ge,{children:"Crie um alimento customizado com busca por cÃ³digo de barras e cÃ¡lculo automÃ¡tico"})]}),e.jsx(os,{ref:i,mode:"compact",initialName:a,onSuccess:d}),e.jsxs(Se,{children:[e.jsxs(A,{variant:"outline",onClick:x,disabled:r,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsx(A,{onClick:m,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2 animate-spin"}),"Criando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Criar Alimento"]})})]})]})})}const ia=({isOpen:t,onClose:n,onSelect:a})=>{const[o,r]=s.useState(""),[l,i]=s.useState([]),[d,m]=s.useState(!1),[x,c]=s.useState(null),[p,u]=s.useState(null),[w,y]=s.useState(!1),T=[{value:null,label:"Todos"},{value:"TACO",label:"TACO"},{value:"IBGE",label:"IBGE"},{value:"USDA",label:"USDA"},{value:"Tucunduva",label:"Tucunduva"},{value:"TBCA",label:"TBCA"},{value:"custom",label:"Personalizados"}];s.useEffect(()=>{t&&F()},[t,o,p]);const F=async()=>{if(o.length<2){i([]);return}m(!0);try{let h=me.from("foods").select("id, name, group, description, source, calories, protein, carbs, fat, fiber, sodium").eq("is_active",!0).ilike("name",`%${o}%`).order("name",{ascending:!0}).limit(50);p&&(h=h.eq("source",p));const{data:_,error:E}=await h;if(E)throw E;i(_||[])}catch(h){console.error("Erro ao buscar alimentos:",h),i([])}finally{m(!1)}},k=()=>{x&&(a(x),R())},R=()=>{r(""),i([]),c(null),u(null),n()},N=async h=>{y(!1),i([h,...l]),c(h),o&&await F()};return e.jsxs(xe,{open:t,onOpenChange:R,children:[e.jsxs(he,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Buscar Alimento"}),e.jsx(ge,{children:"Procure alimentos por nome nas bases de dados nutricionais"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"search",children:"Nome do Alimento"}),e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(re,{id:"search",placeholder:"Digite pelo menos 2 caracteres...",value:o,onChange:h=>r(h.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:T.map(h=>e.jsx(Ce,{variant:p===h.value?"default":"outline",className:"cursor-pointer",onClick:()=>u(h.value),children:h.label},h.value||"all"))}),e.jsxs(Me,{className:"h-[400px] border rounded-md p-4",children:[d&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Buscando..."}),!d&&o.length<2&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Digite pelo menos 2 caracteres para buscar"}),!d&&o.length>=2&&l.length===0&&e.jsxs("div",{className:"text-center py-8 space-y-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhum alimento encontrado"}),e.jsxs(A,{variant:"outline",onClick:()=>y(!0),className:"mx-auto",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Cadastrar '",o,"' agora"]})]}),!d&&l.length>0&&e.jsx("div",{className:"space-y-2",children:l.map(h=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${x?.id===h.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>c(h),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:h.name}),x?.id===h.id&&e.jsx(Ye,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ce,{variant:"outline",className:"text-xs",children:h.source||"N/A"}),h.group&&e.jsx("span",{className:"text-xs text-muted-foreground",children:h.group})]}),h.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:h.description})]}),e.jsxs("div",{className:"ml-4 text-right text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[h.calories," kcal"]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["P: ",h.protein,"g | C: ",h.carbs,"g | G: ",h.fat,"g"]})]})]})},h.id))})]})]}),e.jsxs(Se,{children:[e.jsxs(A,{variant:"outline",onClick:R,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(A,{onClick:k,disabled:!x,children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Selecionar"]})]})]}),e.jsx(la,{open:w,onOpenChange:y,initialName:o,onFoodCreated:N})]})},ca=async()=>{try{const{data:t,error:n}=await me.from("household_measures").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(n)throw n;return{data:t||[],error:null}}catch(t){return console.error("Erro ao buscar medidas caseiras:",t),{data:null,error:t}}},da=async t=>{try{const{data:n,error:a}=await me.from("food_household_measures").select(`
        id,
        food_id,
        measure_id,
        quantity,
        grams,
        created_at,
        updated_at,
        measure:household_measures(
          id,
          name,
          code,
          category,
          description,
          ml_equivalent,
          grams_equivalent,
          order_index
        )
      `).eq("food_id",t).order("measure(order_index)",{ascending:!0});if(a)throw a;return{data:n||[],error:null}}catch(n){return console.error("Erro ao buscar medidas do alimento:",n),{data:null,error:n}}},ma=t=>{const[n,a]=s.useState([]),[o,r]=s.useState(!1),[l,i]=s.useState(null),d=s.useCallback(async()=>{if(!t){a([]);return}r(!0),i(null);try{const m=await da(t);if(m.error)throw m.error;a(m.data||[])}catch(m){console.error("Erro ao carregar medidas:",m),i(m),a([])}finally{r(!1)}},[t]);return s.useEffect(()=>{d()},[d]),{data:n,isLoading:o,error:l,refetch:d}},ua=(t={})=>{const[n,a]=s.useState([]),[o,r]=s.useState(!0),[l,i]=s.useState(null),d=s.useCallback(async()=>{r(!0),i(null);try{const m=await ca();if(m.error)throw m.error;a(m.data||[])}catch(m){console.error("Erro ao carregar medidas caseiras:",m),i(m),a([])}finally{r(!1)}},[]);return s.useEffect(()=>{d()},[d]),{data:n,isLoading:o,error:l,refetch:d}};function xa({food:t,value:n={quantity:100,measureId:null},onChange:a,showNutrition:o=!0,className:r="",onNutritionChange:l=null}){const{data:i=[],isLoading:d}=ua(),{data:m=[],isLoading:x}=ma(t?.id),c=d||x,p=s.useMemo(()=>i.map(N=>({...N,hasSpecificConversion:m.some(h=>h.measure_id===N.id)})),[i,m]),u=s.useMemo(()=>{if(!n.measureId||n.measureId==="grams"||m.find(_=>_.measure_id===n.measureId))return!1;const h=i.find(_=>_.id===n.measureId);return h&&h.grams_equivalent?!1:!!h},[n.measureId,m,i]),w=s.useMemo(()=>{if(!t||!n.quantity)return 0;if(n.measureId===null||n.measureId==="grams")return n.quantity;const N=m.find(_=>_.measure_id===n.measureId);if(N)return N.grams*n.quantity/N.quantity;const h=i.find(_=>_.id===n.measureId);return h&&h.grams_equivalent?h.grams_equivalent*n.quantity:h?(console.warn(`Usando portion_size como fallback para medida "${h.name}"`),(t.portion_size||100)*n.quantity):(console.error(`Medida ${n.measureId} nÃ£o encontrada`),0)},[t,n,m,i]),y=s.useMemo(()=>{if(!t||w===0)return{grams:0,calories:0,protein:0,carbs:0,fat:0,fiber:0,sodium:0};const N=w/100,h=(t.protein||0)*N,_=(t.carbs||0)*N,E=(t.fat||0)*N,I=h*4+_*4+E*9;return{grams:w,calories:parseFloat(I.toFixed(2)),protein:parseFloat(h.toFixed(2)),carbs:parseFloat(_.toFixed(2)),fat:parseFloat(E.toFixed(2)),fiber:t.fiber?parseFloat((t.fiber*N).toFixed(2)):0,sodium:t.sodium?parseFloat((t.sodium*N).toFixed(2)):0}},[t,w]);s.useEffect(()=>{l&&l(y)},[y,l]);const T=N=>{a({...n,quantity:parseFloat(N)||0})},F=N=>{a({...n,measureId:N==="grams"?null:parseInt(N)})},k=s.useMemo(()=>p.reduce((N,h)=>{const _=h.category||"other";return N[_]||(N[_]=[]),N[_].push(h),N},{}),[p]),R={volume:"Medidas de Volume",weight:"Medidas de Peso",unit:"Unidades",other:"Outras"};return e.jsxs("div",{className:`space-y-2 ${r}`,children:[e.jsx(te,{children:"PorÃ§Ã£o"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{type:"number",value:n.quantity,onChange:N=>T(N.target.value),min:0,step:.5,className:"w-24",placeholder:"0",disabled:!t}),e.jsxs(At,{value:n.measureId?.toString()??"grams",onValueChange:F,disabled:!t||c,children:[e.jsx(Tt,{className:"w-40",children:e.jsx(Ft,{placeholder:c?"Carregando...":"Selecione"})}),e.jsxs(kt,{className:"max-h-[300px]",children:[e.jsx(Qe,{value:"grams",children:"g"}),e.jsx("div",{className:"overflow-y-auto max-h-[280px]",children:Object.entries(k).map(([N,h])=>e.jsxs(Zt.Fragment,{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground sticky top-0 bg-popover",children:R[N]||N}),h.map(_=>e.jsxs(Qe,{value:_.id.toString(),className:"pl-6",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:_.name}),_.hasSpecificConversion&&e.jsx("span",{className:"ml-2 text-xs text-primary",children:"â˜…"})]}),_.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:_.description})]},_.id))]},N))})]})]}),o&&t&&w>0&&e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["â‰ˆ ",y.grams.toFixed(0),"g | ",Math.round(y.calories)," kcal"]})]}),t&&!c&&m.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"â˜… = ConversÃ£o especÃ­fica para este alimento"}),u&&e.jsxs("div",{className:"text-xs text-amber-600 dark:text-amber-500 bg-amber-50 dark:bg-amber-950/30 p-2 rounded border border-amber-200 dark:border-amber-800",children:["âš ï¸ Estimativa aproximada (",t.portion_size||100,"g por unidade). Para maior precisÃ£o, cadastre a conversÃ£o especÃ­fica."]})]})}const ha=({isOpen:t,onClose:n,onAdd:a,mealName:o,initialData:r=null})=>{const[l,i]=s.useState(null),[d,m]=s.useState({quantity:100,measureId:null}),[x,c]=s.useState(""),[p,u]=s.useState(null),[w,y]=s.useState(!1),[T,F]=s.useState({});s.useEffect(()=>{r&&(i(r.food),m({quantity:r.quantity||100,measureId:r.unit==="gram"?null:r.unit}),c(r.notes||""),u({calories:r.calories||0,protein:r.protein||0,carbs:r.carbs||0,fat:r.fat||0}))},[r]);const k=E=>{i(E),y(!1),m({quantity:100,measureId:null}),u(null)},R=E=>{u(E)},N=()=>{const E={};return l||(E.food="Selecione um alimento"),(!d.quantity||d.quantity<=0)&&(E.portion="Quantidade deve ser maior que zero"),F(E),Object.keys(E).length===0},h=()=>{if(!N())return;const E={food_id:l.id,food:l,quantity:d.quantity,unit:d.measureId||"gram",calories:p?.calories||0,protein:p?.protein||0,carbs:p?.carbs||0,fat:p?.fat||0,notes:x.trim()||null};a(E),_()},_=()=>{i(null),m({quantity:100,measureId:null}),c(""),u(null),F({}),n()};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{open:t,onOpenChange:_,children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsxs(fe,{children:[e.jsx(pe,{children:r?"Editar Alimento":"Adicionar Alimento"}),e.jsx(ge,{children:r?`Editar alimento: ${r.food?.name||""}`:o?`Adicionar alimento Ã  refeiÃ§Ã£o: ${o}`:"Adicionar novo alimento"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(te,{children:["Alimento ",e.jsx("span",{className:"text-destructive",children:"*"})]}),l?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:l.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.group," â€¢ ",l.source]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Base 100g: ",l.calories," kcal | P: ",l.protein,"g | C: ",l.carbs,"g | G: ",l.fat,"g"]})]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>y(!0),children:"Trocar"})]}):e.jsxs(A,{variant:"outline",className:"w-full",onClick:()=>y(!0),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Buscar Alimento"]}),T.food&&e.jsx("p",{className:"text-xs text-destructive",children:T.food})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xa,{food:l,value:d,onChange:m,showNutrition:!1,onNutritionChange:R}),T.portion&&e.jsx("p",{className:"text-xs text-destructive",children:T.portion})]}),p&&e.jsx(qe,{className:"bg-primary/5",children:e.jsxs(Ue,{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Valores Nutricionais:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:Math.round(p.calories)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"ProteÃ­nas"}),e.jsx("div",{className:"font-bold text-lg",children:p.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:p.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:p.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"notes",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx(at,{id:"notes",rows:2,placeholder:"Ex: sem sal, sem aÃ§Ãºcar, etc.",value:x,onChange:E=>c(E.target.value)})]})]}),e.jsxs(Se,{children:[e.jsxs(A,{variant:"outline",onClick:_,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(A,{onClick:h,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),r?"Atualizar":"Adicionar"]})]})]})}),e.jsx(ia,{isOpen:w,onClose:()=>y(!1),onSelect:k})]})},fa=({isOpen:t,onClose:n,onSave:a,initialData:o=null})=>{const[r,l]=s.useState({name:"",meal_type:"",meal_time:"",notes:""}),[i,d]=s.useState([]),[m,x]=s.useState(!1),[c,p]=s.useState(null),[u,w]=s.useState({}),y=[{value:"breakfast",label:"CafÃ© da ManhÃ£"},{value:"morning_snack",label:"Lanche da ManhÃ£"},{value:"lunch",label:"AlmoÃ§o"},{value:"afternoon_snack",label:"Lanche da Tarde"},{value:"dinner",label:"Jantar"},{value:"supper",label:"Ceia"},{value:"pre_workout",label:"PrÃ©-Treino"},{value:"post_workout",label:"PÃ³s-Treino"},{value:"other",label:"Outro"}];s.useEffect(()=>{o&&(l({name:o.name||"",meal_type:o.meal_type||"",meal_time:o.meal_time||"",notes:o.notes||""}),d(o.foods||[]))},[o]);const T=(v,M)=>{l(q=>{const G={...q,[v]:M};return v==="meal_type"&&M!=="other"&&(G.name=""),G}),u[v]&&w(q=>({...q,[v]:null}))},F=v=>{d(M=>[...M,{...v,tempId:Date.now()}])},k=v=>{p(v),x(!0)},R=v=>{d(M=>M.map(q=>q.tempId===c.tempId?{...v,tempId:q.tempId}:q)),p(null)},N=v=>{d(M=>M.filter(q=>q.tempId!==v))},h=()=>{x(!1),p(null)},_=()=>i.reduce((v,M)=>({calories:v.calories+(M.calories||0),protein:v.protein+(M.protein||0),carbs:v.carbs+(M.carbs||0),fat:v.fat+(M.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),E=()=>{const v={};return r.meal_type||(v.meal_type="Tipo de refeiÃ§Ã£o Ã© obrigatÃ³rio"),r.meal_type==="other"&&!r.name.trim()&&(v.name='Nome da refeiÃ§Ã£o Ã© obrigatÃ³rio quando tipo Ã© "Outro"'),i.length===0&&(v.foods="Adicione pelo menos um alimento"),w(v),Object.keys(v).length===0},I=()=>{if(!E())return;const v=_(),q={name:r.meal_type==="other"?r.name:y.find(G=>G.value===r.meal_type)?.label||"",meal_type:r.meal_type,meal_time:r.meal_time,notes:r.notes,foods:i,...v};a(q),V()},V=()=>{l({name:"",meal_type:"",meal_time:"",notes:""}),d([]),w({}),n()},$=_();return e.jsxs(e.Fragment,{children:[e.jsx(xe,{open:t,onOpenChange:V,children:e.jsxs(he,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(pe,{children:o?"Editar RefeiÃ§Ã£o":"Nova RefeiÃ§Ã£o"}),e.jsx(ge,{children:"Configure a refeiÃ§Ã£o e adicione os alimentos"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(ve,{children:e.jsx(je,{className:"text-lg",children:"InformaÃ§Ãµes da RefeiÃ§Ã£o"})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(te,{htmlFor:"meal_type",children:["Tipo de RefeiÃ§Ã£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(At,{value:r.meal_type,onValueChange:v=>T("meal_type",v),children:[e.jsx(Tt,{id:"meal_type",className:u.meal_type?"border-destructive":"",children:e.jsx(Ft,{placeholder:"Selecione o tipo"})}),e.jsx(kt,{children:y.map(v=>e.jsx(Qe,{value:v.value,children:v.label},v.value))})]}),u.meal_type&&e.jsx("p",{className:"text-xs text-destructive",children:u.meal_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"meal_time",children:"HorÃ¡rio (opcional)"}),e.jsx(re,{id:"meal_time",type:"time",value:r.meal_time,onChange:v=>T("meal_time",v.target.value)})]})]}),r.meal_type==="other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(te,{htmlFor:"name",children:["Nome da RefeiÃ§Ã£o ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"name",placeholder:"Ex: Lanche Noturno, SuplementaÃ§Ã£o",value:r.name,onChange:v=>T("name",v.target.value),className:u.name?"border-destructive":""}),u.name&&e.jsx("p",{className:"text-xs text-destructive",children:u.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"notes",children:"ObservaÃ§Ãµes (opcional)"}),e.jsx(at,{id:"notes",rows:2,placeholder:"ObservaÃ§Ãµes sobre a refeiÃ§Ã£o...",value:r.notes,onChange:v=>T("notes",v.target.value)})]})]})]}),e.jsxs(se,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"text-lg",children:"Alimentos"}),e.jsxs(A,{size:"sm",onClick:()=>x(!0),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Adicionar Alimento"]})]})}),e.jsx(ae,{children:i.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhum alimento adicionado ainda",u.foods&&e.jsx("p",{className:"text-destructive mt-2",children:u.foods})]}):e.jsxs("div",{className:"space-y-2",children:[i.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:v.food.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Mt(v.quantity,v.unit,v.measure)," â€¢"," ",v.calories," kcal â€¢ P: ",v.protein,"g â€¢ C: ",v.carbs,"g â€¢ G: ",v.fat,"g"]}),v.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:v.notes})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>k(v),title:"Editar alimento",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>N(v.tempId),title:"Remover alimento",children:e.jsx(st,{className:"h-4 w-4 text-destructive"})})]})]},v.tempId)),e.jsxs("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Totais da RefeiÃ§Ã£o:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Calorias"}),e.jsx("div",{className:"font-bold text-lg",children:$.calories.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"ProteÃ­nas"}),e.jsx("div",{className:"font-bold text-lg",children:$.protein.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Carboidratos"}),e.jsx("div",{className:"font-bold text-lg",children:$.carbs.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Gorduras"}),e.jsx("div",{className:"font-bold text-lg",children:$.fat.toFixed(1)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})]})})]})]}),e.jsxs(Se,{children:[e.jsxs(A,{variant:"outline",onClick:V,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(A,{onClick:I,children:[o?"Atualizar":"Adicionar"," RefeiÃ§Ã£o"]})]})]})}),e.jsx(ha,{isOpen:m,onClose:h,onAdd:c?R:F,initialData:c,mealName:r.meal_type==="other"?r.name:y.find(v=>v.value===r.meal_type)?.label})]})},Qt=({protein:t,carbs:n,fat:a,calories:o,patientId:r,planId:l,referenceValues:i,onReferenceUpdate:d,readOnly:m=!1})=>{const x=bt(),[c,p]=s.useState(!1),u={protein:"#8B3BF2",carbs:"#3B6FF2",fat:"#F28B3B"},w=t*4,y=n*4,T=a*9,F=w+y+T,k=F>0?w/F*100:0,R=F>0?y/F*100:0,N=F>0?T/F*100:0,h=i?.weight_kg?parseFloat(i.weight_kg):null,_=h?t/h:null,E=h?n/h:null,I=h?a/h:null,$=(()=>{if(!i)return null;const b=parseFloat(i.weight_kg),S=parseFloat(i.total_energy_kcal);if(!b||!S)return null;let D,z,B;return i.macro_mode==="percentage"?(D=S*i.protein_percentage/4,z=S*i.carbs_percentage/4,B=S*i.fat_percentage/9):(D=b*i.protein_g_per_kg,z=b*i.carbs_g_per_kg,B=b*i.fat_g_per_kg),{calories:S,protein:D,carbs:z,fat:B,proteinPerKg:D/b,carbsPerKg:z/b,fatPerKg:B/b}})(),v=(b,S)=>{if(!S||S===0)return null;const D=b/S*100,z=b-S,B=D-100;let K="adequate";return D<95||D>105?K="inadequate":D<100?K="below":D>100&&(K="above"),{percentage:D,diff:z,diffPerc:B,status:K}},M=$?v(o,$.calories):null,q=$?v(t,$.protein):null,G=$?v(n,$.carbs):null,ye=$?v(a,$.fat):null,ne=({adequacy:b,compact:S=!1})=>{if(!b)return null;const z=(B=>{switch(B){case"adequate":return{color:"bg-green-100 text-green-700 border-green-300",icon:e.jsx(is,{className:"w-3 h-3"}),label:"OK"};case"below":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(dt,{className:"w-3 h-3"}),label:b.diffPerc.toFixed(0)};case"above":return{color:"bg-yellow-100 text-yellow-700 border-yellow-300",icon:e.jsx(lt,{className:"w-3 h-3"}),label:`+${b.diffPerc.toFixed(0)}`};case"inadequate":return{color:b.percentage<95?"bg-red-100 text-red-700 border-red-300":"bg-orange-100 text-orange-700 border-orange-300",icon:b.percentage<95?e.jsx(dt,{className:"w-3 h-3"}):e.jsx(lt,{className:"w-3 h-3"}),label:b.percentage<95?b.diffPerc.toFixed(0):`+${b.diffPerc.toFixed(0)}`};default:return null}})(b.status);return z?S?e.jsxs("div",{className:`inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-md border text-xs font-semibold ${z.color}`,children:[z.icon,e.jsxs("span",{children:[z.label,"%"]})]}):e.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-md border text-xs font-semibold ${z.color}`,children:[z.icon,e.jsxs("span",{children:[b.percentage.toFixed(0),"%"]})]}):null},ie=()=>{const B=(Y,Z)=>{const de=K(75,75,60,Z),we=K(75,75,60,Y),ue=Z-Y<=180?"0":"1";return["M",75,75,"L",de.x,de.y,"A",60,60,0,ue,0,we.x,we.y,"Z"].join(" ")},K=(Y,Z,de,we)=>{const ue=(we-90)*Math.PI/180;return{x:Y+de*Math.cos(ue),y:Z+de*Math.sin(ue)}};let Q=0;const oe=k/100*360,ce=R/100*360;return e.jsxs("svg",{width:150,height:150,viewBox:"0 0 150 150",className:"mx-auto",children:[k>0&&e.jsx("path",{d:B(Q,Q+oe),fill:u.protein,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),R>0&&e.jsx("path",{d:B(Q+oe,Q+oe+ce),fill:u.carbs,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),N>0&&e.jsx("path",{d:B(Q+oe+ce,360),fill:u.fat,opacity:"0.9",className:"hover:opacity-100 transition-opacity cursor-pointer"}),e.jsx("circle",{cx:75,cy:75,r:38,fill:"#fefae0"}),e.jsx("text",{x:75,y:72,textAnchor:"middle",className:"text-xl font-bold",fill:"#000",children:o.toFixed(0)}),e.jsx("text",{x:75,y:87,textAnchor:"middle",className:"text-[10px]",fill:"#666",children:"kcal"})]})},j=({label:b,color:S,current:D,target:z,currentPerKg:B,targetPerKg:K,percentage:Q,adequacy:oe,unit:ce="g",isEnergy:Y=!1})=>e.jsxs("div",{className:"p-2 rounded-lg border transition-colors",style:S?{backgroundColor:`${S}0D`,borderColor:`${S}33`}:{backgroundColor:"rgb(250 250 249 / 0.3)",borderColor:"rgb(228 228 231)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[S&&!Y&&e.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:S}}),Y&&e.jsx(ct,{className:"w-3 h-3 text-[#c4661f]"}),e.jsx("span",{className:`text-[10px] font-semibold uppercase tracking-wider ${S&&!Y?"":"text-muted-foreground"}`,style:S&&!Y?{color:S}:void 0,children:b})]}),oe&&e.jsx(ne,{adequacy:oe,compact:!0})]}),e.jsxs("div",{className:"flex items-baseline justify-between gap-2 flex-wrap min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-1 flex-wrap min-w-0",children:[e.jsx("span",{className:`text-lg font-bold ${S&&!Y?"":"text-foreground"}`,style:S&&!Y?{color:S}:void 0,children:D.toFixed(Y?0:1)}),e.jsx("span",{className:"text-[10px] text-muted-foreground font-medium",children:ce}),B&&!Y&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["(",B.toFixed(1)," g/kg)"]}),Q!==void 0&&!Y&&e.jsxs("span",{className:"text-[10px] text-muted-foreground whitespace-nowrap",children:["â€¢ ",Q.toFixed(0),"%"]})]}),z&&e.jsxs("div",{className:"flex items-baseline gap-1 text-[10px] flex-wrap",children:[e.jsx("span",{className:"text-muted-foreground font-medium whitespace-nowrap",children:"Meta:"}),e.jsxs("span",{className:"font-bold text-foreground whitespace-nowrap",children:[z.toFixed(Y?0:1),ce]}),K&&!Y&&e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["(",K.toFixed(1)," g/kg)"]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsxs(se,{className:"h-full bg-gradient-to-br from-[#fefae0]/30 to-[#f9ebc7]/30 border-[#a9b388]",children:[e.jsx(ve,{className:"pb-2",children:e.jsxs(je,{className:"text-base flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-[#c4661f]"}),"DistribuiÃ§Ã£o de Macronutrientes"]})}),e.jsxs(ae,{className:"space-y-2",children:[e.jsx(ie,{}),e.jsxs("div",{className:"space-y-1",children:[$&&e.jsx(j,{label:"Energia",current:o,target:$.calories,adequacy:M,unit:"kcal",isEnergy:!0}),e.jsx(j,{label:"ProteÃ­nas",color:u.protein,current:t,target:$?.protein,currentPerKg:_,targetPerKg:$?.proteinPerKg,percentage:k,adequacy:q}),e.jsx(j,{label:"Carboidratos",color:u.carbs,current:n,target:$?.carbs,currentPerKg:E,targetPerKg:$?.carbsPerKg,percentage:R,adequacy:G}),e.jsx(j,{label:"Gorduras",color:u.fat,current:a,target:$?.fat,currentPerKg:I,targetPerKg:$?.fatPerKg,percentage:N,adequacy:ye})]}),$&&e.jsx("div",{className:"flex items-center justify-center pt-1 border-t",children:[M,q,G,ye].every(b=>b?.status==="adequate")?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-green-700 bg-green-50 px-3 py-1.5 rounded-full border border-green-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{className:"font-medium",children:"Plano adequado"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-yellow-700 bg-yellow-50 px-3 py-1.5 rounded-full border border-yellow-200",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium",children:"Ajustes sugeridos"})]})}),!m&&e.jsxs("div",{className:"pt-1.5 border-t space-y-1",children:[e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:()=>p(!0),className:"w-full gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),$?"Editar Valores de ReferÃªncia":"Configurar Valores de ReferÃªncia"]}),l&&e.jsxs(A,{type:"button",variant:"outline",size:"sm",onClick:()=>x(`/nutritionist/patients/${r}/meal-plan/${l}/summary`),className:"w-full gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Ver Resumo Nutricional Completo"]}),!$&&e.jsx("div",{className:"text-[10px] text-muted-foreground bg-[#fefae0] p-2 rounded-lg border border-[#a9b388]/30 text-center",children:"ðŸ’¡ Configure os valores de referÃªncia para ver anÃ¡lise de adequaÃ§Ã£o e g/kg"})]})]})]}),l&&e.jsx(ls,{isOpen:c,onClose:()=>{p(!1),d&&d()},planId:l})]})},pa=({patientId:t,nutritionistId:n,initialData:a=null,onSubmit:o,onCancel:r,loading:l=!1})=>{const[i,d]=s.useState({name:"",description:"",start_date:new Date().toISOString().split("T")[0],end_date:"",active_days:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]}),[m,x]=s.useState([]),[c,p]=s.useState(!1),[u,w]=s.useState(null),[y,T]=s.useState({}),[F,k]=s.useState(null),R=[{value:"monday",label:"Segunda"},{value:"tuesday",label:"TerÃ§a"},{value:"wednesday",label:"Quarta"},{value:"thursday",label:"Quinta"},{value:"friday",label:"Sexta"},{value:"saturday",label:"SÃ¡bado"},{value:"sunday",label:"Domingo"}],N=s.useCallback(async()=>{if(a?.id){const{data:j}=await Rt(a.id);k(j)}},[a?.id]);s.useEffect(()=>{if(a){d({name:a.name||"",description:a.description||"",start_date:a.start_date||new Date().toISOString().split("T")[0],end_date:a.end_date||"",active_days:a.active_days||[]});const j=(a.meals||[]).map((b,S)=>({...b,tempId:b.tempId||Date.now()+S,foods:(b.foods||[]).map((D,z)=>({...D,tempId:D.tempId||Date.now()+S+z+1e3}))}));x(j),N()}},[a,N]);const h=(j,b)=>{d(S=>({...S,[j]:b})),y[j]&&T(S=>({...S,[j]:null}))},_=j=>{d(b=>({...b,active_days:b.active_days.includes(j)?b.active_days.filter(S=>S!==j):[...b.active_days,j]}))},E=()=>{d(j=>({...j,active_days:j.active_days.length===7?[]:R.map(b=>b.value)}))},I=()=>{const j=["monday","tuesday","wednesday","thursday","friday"];d(b=>({...b,active_days:j}))},V=()=>{const j=["saturday","sunday"];d(b=>({...b,active_days:j}))},$=j=>{x(b=>[...b,{...j,tempId:Date.now(),order_index:b.length}])},v=j=>{w(j),p(!0)},M=j=>{x(b=>b.map(S=>S.tempId===u.tempId?{...j,tempId:S.tempId}:S)),w(null)},q=j=>{x(b=>b.filter(S=>S.tempId!==j))},G=()=>m.reduce((j,b)=>({calories:j.calories+(b.calories||0),protein:j.protein+(b.protein||0),carbs:j.carbs+(b.carbs||0),fat:j.fat+(b.fat||0)}),{calories:0,protein:0,carbs:0,fat:0}),ye=()=>{const j={};return i.name.trim()||(j.name="Nome do plano Ã© obrigatÃ³rio"),i.active_days.length===0&&(j.active_days="Selecione pelo menos um dia da semana"),i.start_date||(j.start_date="Data de inÃ­cio Ã© obrigatÃ³ria"),i.end_date&&i.end_date<i.start_date&&(j.end_date="Data final deve ser posterior Ã  data inicial"),m.length===0&&(j.meals="Adicione pelo menos uma refeiÃ§Ã£o"),T(j),Object.keys(j).length===0},ne=j=>{if(j.preventDefault(),!ye())return;const b=G(),S={patient_id:t,nutritionist_id:n,...i,...b,meals:m};o(S,a?.id)},ie=G();return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:ne,className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(ve,{children:e.jsx(je,{className:"text-lg",children:"InformaÃ§Ãµes do Plano"})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(te,{htmlFor:"name",children:["Nome do Plano ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"name",placeholder:"Ex: Dieta Hipertrofia",value:i.name,onChange:j=>h("name",j.target.value),className:y.name?"border-destructive":"",disabled:l}),y.name&&e.jsx("p",{className:"text-xs text-destructive",children:y.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"description",children:"DescriÃ§Ã£o (opcional)"}),e.jsx(at,{id:"description",rows:3,placeholder:"Descreva os objetivos e caracterÃ­sticas do plano alimentar...",value:i.description,onChange:j=>h("description",j.target.value),disabled:l})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(te,{htmlFor:"start_date",children:["Data de InÃ­cio ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"start_date",type:"date",value:i.start_date,onChange:j=>h("start_date",j.target.value),className:y.start_date?"border-destructive":"",disabled:l}),y.start_date&&e.jsx("p",{className:"text-xs text-destructive",children:y.start_date})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"end_date",children:"Data de TÃ©rmino (opcional)"}),e.jsx(re,{id:"end_date",type:"date",value:i.end_date,onChange:j=>h("end_date",j.target.value),className:y.end_date?"border-destructive":"",disabled:l}),y.end_date&&e.jsx("p",{className:"text-xs text-destructive",children:y.end_date})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs(te,{children:["Dias Ativos ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:I,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Dias Ãºteis"}),e.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:V,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:"Fins de semana"}),e.jsx(A,{type:"button",variant:"outline",size:"sm",onClick:E,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:i.active_days.length===7?"Limpar":"Todos"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:R.map(j=>e.jsxs("label",{className:`
                                            flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 px-1 sm:px-3 py-2 border rounded-lg cursor-pointer transition-colors text-xs sm:text-sm
                                            ${i.active_days.includes(j.value)?"bg-primary text-primary-foreground border-primary":"hover:bg-muted"}
                                        `,children:[e.jsx(Ge,{checked:i.active_days.includes(j.value),onCheckedChange:()=>_(j.value),disabled:l,className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"text-[10px] sm:text-sm leading-tight text-center",children:j.label})]},j.value))}),y.active_days&&e.jsx("p",{className:"text-xs text-destructive",children:y.active_days})]})]})]}),m.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:e.jsxs(se,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"text-lg",children:"RefeiÃ§Ãµes"}),e.jsxs(A,{type:"button",size:"sm",onClick:()=>{w(null),p(!0)},disabled:l,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Adicionar RefeiÃ§Ã£o"]})]})}),e.jsx(ae,{children:e.jsx("div",{className:"space-y-3",children:m.map((j,b)=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["#",b+1]}),e.jsx("h4",{className:"font-semibold",children:j.name}),j.meal_time&&e.jsxs(Ce,{variant:"outline",children:[e.jsx(es,{className:"h-3 w-3 mr-1"}),j.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[j.foods?.length||0," alimento(s) â€¢"," ",j.calories?.toFixed(0)||0," kcal â€¢ P: ",j.protein?.toFixed(1)||0,"g â€¢ C: ",j.carbs?.toFixed(1)||0,"g â€¢ G: ",j.fat?.toFixed(1)||0,"g"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>v(j),children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(j.tempId),children:e.jsx(st,{className:"h-4 w-4 text-destructive"})})]})]})},j.tempId))})})]})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(Qt,{protein:ie.protein,carbs:ie.carbs,fat:ie.fat,calories:ie.calories,patientId:t,planId:a?.id,referenceValues:F,onReferenceUpdate:N})})]}),m.length===0&&e.jsxs(se,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"text-lg",children:"RefeiÃ§Ãµes"}),e.jsxs(A,{type:"button",size:"sm",onClick:()=>{w(null),p(!0)},disabled:l,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Adicionar RefeiÃ§Ã£o"]})]})}),e.jsx(ae,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["Nenhuma refeiÃ§Ã£o adicionada ainda",y.meals&&e.jsx("p",{className:"text-destructive mt-2",children:y.meals})]})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(A,{type:"button",variant:"outline",onClick:r,disabled:l,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),e.jsxs(A,{type:"submit",disabled:l,children:[e.jsx(ys,{className:"w-4 h-4 mr-2"}),l?"Salvando...":a?"Atualizar Plano":"Criar Plano"]})]})]}),e.jsx(fa,{isOpen:c,onClose:()=>{p(!1),w(null)},onSave:u?M:$,initialData:u})]})},ga=({isOpen:t,onClose:n,planId:a,planName:o,onCopy:r})=>{const[l,i]=s.useState([]),[d,m]=s.useState([]),[x,c]=s.useState(""),[p,u]=s.useState(null),[w,y]=s.useState(!1),[T,F]=s.useState(!1);s.useEffect(()=>{t&&k()},[t]),s.useEffect(()=>{if(x){const h=l.filter(_=>_.name?.toLowerCase().includes(x.toLowerCase())||_.email?.toLowerCase().includes(x.toLowerCase()));m(h)}else m(l)},[x,l]);const k=async()=>{y(!0);try{const{data:{user:h}}=await me.auth.getUser();if(!h)return;const{data:_,error:E}=await me.from("user_profiles").select("id, name, email").eq("user_type","patient").eq("nutritionist_id",h.id).order("name",{ascending:!0});if(E)throw E;i(_||[]),m(_||[])}catch(h){console.error("Erro ao carregar pacientes:",h)}finally{y(!1)}},R=async()=>{if(p){F(!0);try{await r(p.id),N()}catch(h){console.error("Erro ao copiar modelo:",h)}finally{F(!1)}}},N=()=>{c(""),u(null),n()};return e.jsx(xe,{open:t,onOpenChange:N,children:e.jsxs(he,{className:"max-w-2xl",children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Copiar Modelo de Dieta"}),e.jsxs(ge,{children:["Selecione o paciente para aplicar o plano: ",e.jsx("strong",{children:o})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{htmlFor:"search",children:"Buscar Paciente"}),e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(re,{id:"search",placeholder:"Digite o nome ou email do paciente...",value:x,onChange:h=>c(h.target.value),className:"pl-10",autoFocus:!0})]})]}),e.jsxs(Me,{className:"h-[400px] border rounded-md p-4",children:[w&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando pacientes..."}),!w&&d.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:x?"Nenhum paciente encontrado":"VocÃª nÃ£o tem pacientes cadastrados"}),!w&&d.length>0&&e.jsx("div",{className:"space-y-2",children:d.map(h=>e.jsx("div",{className:`
                                            p-3 border rounded-lg cursor-pointer transition-colors
                                            ${p?.id===h.id?"bg-primary/10 border-primary":"hover:bg-muted"}
                                        `,onClick:()=>u(h),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:h.name}),p?.id===h.id&&e.jsx(Ye,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.email})]})})},h.id))})]})]}),e.jsxs(Se,{children:[e.jsxs(A,{variant:"outline",onClick:N,disabled:T,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(A,{onClick:R,disabled:!p||T,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),T?"Copiando...":"Copiar Modelo"]})]})]})})};function va(t,n){if(!t||!n||n.length===0)return null;const a=t.toLowerCase();for(const o of n)if(o&&a.includes(o.toLowerCase()))return o;return null}function gt({open:t,onOpenChange:n,patientId:a,nutritionistId:o,onTemplateApplied:r}){const{toast:l}=Nt(),[i,d]=s.useState([]),[m,x]=s.useState([]),[c,p]=s.useState(null),[u,w]=s.useState(null),[y,T]=s.useState(""),[F,k]=s.useState(null),[R,N]=s.useState(!1),[h,_]=s.useState(!1),[E,I]=s.useState(null),[V,$]=s.useState(!1),[v,M]=s.useState(1),[q,G]=s.useState(!1),[ye,ne]=s.useState([]),[ie,j]=s.useState(null),[b,S]=s.useState(new Set);s.useEffect(()=>{t&&o&&z(),t&&a&&K()},[t,o,a]),s.useEffect(()=>{let g=i;y&&(g=g.filter(P=>P.name.toLowerCase().includes(y.toLowerCase())||P.description&&P.description.toLowerCase().includes(y.toLowerCase()))),F&&(g=g.filter(P=>P.template_tags?(Array.isArray(P.template_tags)?P.template_tags:[P.template_tags]).some(L=>L.toLowerCase()===F.toLowerCase()):!1)),x(g)},[i,y,F]);const D=(g,P=null)=>!g||!g.meals?{calories:0,protein:0,carbs:0,fat:0}:(P&&P.size>0?g.meals.filter(L=>P.has(L.id)):g.meals).reduce((L,J)=>({calories:L.calories+(parseFloat(J.total_calories)||0),protein:L.protein+(parseFloat(J.total_protein)||0),carbs:L.carbs+(parseFloat(J.total_carbs)||0),fat:L.fat+(parseFloat(J.total_fat)||0)}),{calories:0,protein:0,carbs:0,fat:0});s.useEffect(()=>{c&&B(c.id)},[c]),s.useEffect(()=>{if(u&&E&&V&&b.size>0){const g=D(u,b).calories;if(g>0){const P=E/g;M(P)}}else M(1)},[u,E,V,b]);const z=async()=>{N(!0);try{const{data:g,error:P}=await cs(o);if(P)throw P;d(g||[]),x(g||[])}catch(g){console.error("Erro ao carregar templates:",g),l({title:"Erro",description:"NÃ£o foi possÃ­vel carregar os templates.",variant:"destructive"})}finally{N(!1)}},B=async g=>{try{const{data:P,error:U}=await Oe(g);if(U)throw U;if(w(P),$(!1),P?.meals){const L=new Set(P.meals.map(J=>J.id));S(L)}else S(new Set)}catch(P){console.error("Erro ao carregar detalhes do template:",P),w(null),S(new Set)}},K=async()=>{if(a)try{const{data:g}=await me.from("patient_goals").select("daily_calorie_goal").eq("patient_id",a).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(g?.daily_calorie_goal){I(parseFloat(g.daily_calorie_goal));return}const P=new Date().toISOString().split("T")[0],{data:U}=await me.from("prescriptions").select("calories").eq("patient_id",a).lte("start_date",P).or(`end_date.is.null,end_date.gte.${P}`).order("start_date",{ascending:!1}).limit(1).maybeSingle();if(U?.calories){I(parseFloat(U.calories));return}const{data:L}=await me.from("energy_expenditure_calculations").select("total_daily_energy_expenditure").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(L?.total_daily_energy_expenditure){I(parseFloat(L.total_daily_energy_expenditure));return}I(null)}catch(g){console.error("Erro ao buscar meta calÃ³rica do paciente:",g),I(null)}},Q=async()=>{if(!u||!a)return[];try{const{data:g,error:P}=await ws(a,!0);if(P||!g||!g.content)return[];const U=g.content,J=(U.historico_clinico?.alergias||[]).filter(O=>O&&O.alimento).map(O=>O.alimento.trim()).filter(O=>O.length>0),f=(U.habitos_alimentares?.alimentos_nao_gosta||"").split(/[,;]/).map(O=>O.trim()).filter(O=>O.length>0),C=[...J,...f];if(C.length===0)return[];const W=[];if(u.meals){for(const O of u.meals)if(b.has(O.id)&&O.foods)for(const H of O.foods){const ot=H.food?.name||H.foods?.name||H.name||"";ot&&W.push(ot)}}const ee=[];for(const O of W)va(O,C)&&(ee.includes(O)||ee.push(O));return ee}catch(g){return console.error("Erro ao verificar conflitos de alimentos:",g),[]}},oe=async(g=!1)=>{if(!(!c||!a)){if(b.size===0){l({title:"Nenhuma RefeiÃ§Ã£o Selecionada",description:"Selecione pelo menos uma refeiÃ§Ã£o para importar.",variant:"destructive"});return}if(!g){const P=await Q();if(P.length>0){ne(P),G(!0),j({templateId:c.id,patientId:a,scaleFactor:V?v:1,selectedMealIds:Array.from(b)});return}}_(!0);try{const P=ie||{templateId:c.id,patientId:a,scaleFactor:V?v:1,selectedMealIds:Array.from(b)},{data:U,error:L}=await ds(P.templateId,P.patientId,null,P.scaleFactor,P.selectedMealIds);if(L)throw L;const J=P.scaleFactor!==1?` (quantidades ajustadas para ${Math.round(E)} kcal)`:"",Ee=P.selectedMealIds?.length||b.size,f=Ee<(u?.meals?.length||0)?` (${Ee} de ${u?.meals?.length||0} refeiÃ§Ãµes importadas)`:"";l({title:"Template Aplicado",description:`O template "${c.name}" foi aplicado ao paciente com sucesso.${J}${f}`}),r&&r(U),j(null),ne([]),G(!1),n(!1)}catch(P){console.error("Erro ao aplicar template:",P),l({title:"Erro",description:"NÃ£o foi possÃ­vel aplicar o template.",variant:"destructive"})}finally{_(!1)}}},ce=()=>{G(!1),oe(!0)},Y=Array.from(new Set(i.filter(g=>g.template_tags).flatMap(g=>Array.isArray(g.template_tags)?g.template_tags:[g.template_tags]))),Z=u?D(u,b):null,de=Z&&E&&Z.calories>0,we=de?Math.abs((Z.calories-E)/Z.calories)*100:0,ue=de&&we>10;return e.jsxs(xe,{open:t,onOpenChange:n,children:[e.jsxs(he,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(fe,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Meus Modelos de Dieta"]}),e.jsx(ge,{children:"Selecione um template para aplicar ao paciente"})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 flex flex-col border-r pr-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(re,{placeholder:"Buscar templates...",value:y,onChange:g=>T(g.target.value),className:"pl-8"})]})}),Y.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Filtrar por Tag:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(A,{variant:F===null?"default":"outline",size:"sm",onClick:()=>k(null),children:"Todos"}),Y.map(g=>e.jsx(A,{variant:F===g?"default":"outline",size:"sm",onClick:()=>k(g),children:g},g))]})]}),e.jsx(Me,{className:"flex-1",children:R?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ze,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):m.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum template encontrado"})]}):e.jsx("div",{className:"space-y-2",children:m.map(g=>e.jsx(se,{className:`cursor-pointer transition-colors ${c?.id===g.id?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>p(g),children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:g.name}),g.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:g.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("span",{children:g.daily_calories?`${Math.round(g.daily_calories)} kcal`:"N/A"})]}),g.template_tags&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:(Array.isArray(g.template_tags)?g.template_tags:[g.template_tags]).map((P,U)=>e.jsxs(Ce,{variant:"secondary",className:"text-xs",children:[e.jsx(ft,{className:"w-2 h-2 mr-1"}),P]},U))})]})})},g.id))})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:c?e.jsxs(e.Fragment,{children:[u?e.jsx(Me,{className:"flex-1",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs(se,{children:[e.jsxs(ve,{children:[e.jsx(je,{children:u.name}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})]}),e.jsxs(ae,{children:[Z&&e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Calorias"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Z.calories)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"kcal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"ProteÃ­nas"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Z.protein)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Carboidratos"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Z.carbs)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gorduras"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(Z.fat)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[u.meals?.length||0," refeiÃ§Ãµes"]})]}),u.template_tags&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ft,{className:"w-4 h-4 text-muted-foreground"}),(Array.isArray(u.template_tags)?u.template_tags:[u.template_tags]).map((g,P)=>e.jsx(Ce,{variant:"secondary",children:g},P))]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Selecione as RefeiÃ§Ãµes para Importar:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{if(u?.meals){const g=new Set(u.meals.map(P=>P.id));S(g)}},className:"text-xs h-7",children:"Selecionar Todas"}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>S(new Set),className:"text-xs h-7",children:"Desmarcar Todas"})]})]}),e.jsx("div",{className:"space-y-2",children:u.meals?.map((g,P)=>{const U=b.has(g.id);return e.jsx(se,{className:`cursor-pointer transition-colors ${U?"border-primary bg-primary/5":"hover:bg-muted/50"}`,onClick:()=>{const L=new Set(b);U?L.delete(g.id):L.add(g.id),S(L)},children:e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{checked:U,onCheckedChange:L=>{const J=new Set(b);L?J.add(g.id):J.delete(g.id),S(J)},onClick:L=>L.stopPropagation()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:g.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g.meal_type})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[Math.round(g.total_calories||0)," kcal"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["P: ",Math.round(g.total_protein||0),"g | C: ",Math.round(g.total_carbs||0),"g | G: ",Math.round(g.total_fat||0),"g"]})]})]}),g.foods&&g.foods.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.foods.length," alimento(s)"]})})]})]})})},g.id||P)})}),u.meals&&u.meals.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:[b.size," de ",u.meals.length," refeiÃ§Ãµes selecionadas"]})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ze,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),ue&&e.jsxs(qe,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(Ss,{className:"h-4 w-4 text-blue-600"}),e.jsx(Ue,{children:e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{id:"auto-scale",checked:V,onCheckedChange:g=>$(g===!0)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(te,{htmlFor:"auto-scale",className:"text-sm font-medium cursor-pointer",children:["Ajustar quantidades automaticamente para atingir ",Math.round(E)," kcal?"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["O template tem ",Math.round(Z.calories)," kcal.",V&&e.jsxs("span",{className:"block mt-1",children:["As porÃ§Ãµes serÃ£o ajustadas por um fator de ",v.toFixed(2),"x (aproximadamente ",Math.round(Z.calories*v)," kcal apÃ³s ajuste)."]})]})]})]})})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsx(A,{onClick:oe,disabled:h||!a,className:"w-full sm:w-auto",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-4 h-4 mr-2 animate-spin"}),"Aplicando..."]}):e.jsx(e.Fragment,{children:"Aplicar este Modelo"})})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Selecione um template para visualizar os detalhes"})]})})})]})]}),e.jsx(yt,{open:q,onOpenChange:G,children:e.jsxs(wt,{children:[e.jsxs(St,{children:[e.jsx(Ct,{className:"flex items-center gap-2",children:"âš ï¸ Alerta de RestriÃ§Ã£o Alimentar"}),e.jsxs(_t,{className:"space-y-3",children:[e.jsx("p",{children:"Este modelo contÃ©m alimentos que o paciente marcou como alergia ou aversÃ£o:"}),e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:ye.map((g,P)=>e.jsx("li",{className:"font-semibold text-destructive",children:g},P))})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Deseja continuar mesmo assim? Esta aÃ§Ã£o pode causar reaÃ§Ãµes adversas no paciente."})]})]}),e.jsxs($t,{children:[e.jsx(Pt,{onClick:()=>{G(!1),ne([]),j(null)},children:"Cancelar ImportaÃ§Ã£o"}),e.jsx(Et,{onClick:ce,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Ignorar e Aplicar"})]})]})})]})}const ja=async(t,n="Paciente")=>{if(!t||!t.meals||t.meals.length===0)throw new Error("Plano alimentar invÃ¡lido ou sem refeiÃ§Ãµes");const a=ba(t.meals),o=Na(a),r=new _s("p","mm","a4"),l=r.internal.pageSize.width,i=r.internal.pageSize.height,d=[70,125,70],m=[68,64,60],x=[120,113,108];let c=20;r.setFont("helvetica");try{const k=await(await fetch("https://afyoidxrshkmplxhcyeh.supabase.co/storage/v1/object/public/IDV/HIPOZERO%20(2).png")).blob();await new Promise(R=>{const N=new Image;N.onload=()=>{const h=l*.15,_=N.height/N.width*h,E=new FileReader;E.onloadend=()=>{const I=E.result;r.addImage(I,"PNG",14,10,h,_),R()},E.readAsDataURL(k)},N.src=URL.createObjectURL(k)})}catch(T){console.error("Erro ao carregar logo:",T)}r.setFontSize(20),r.setTextColor(...d),r.setFont("helvetica","bold"),r.text("Lista de Compras",l/2,c,{align:"center"}),c+=8,r.setFontSize(12),r.setTextColor(...m),r.setFont("helvetica","normal"),r.text(`Paciente: ${n}`,14,c),c+=6;const p=new Date().toLocaleDateString("pt-BR");r.setFontSize(10),r.setTextColor(...x),r.text(`Gerado em: ${p}`,14,c),c+=10,r.setDrawColor(...d),r.setLineWidth(.5),r.line(14,c,l-14,c),c+=8;const u=Object.keys(o).sort();for(let T=0;T<u.length;T++){const F=u[T],k=o[F];c>i-60&&(r.addPage(),c=20),r.setFontSize(14),r.setTextColor(...d),r.setFont("helvetica","bold"),r.text(F,14,c),c+=6;const R=k.map(N=>["",N.name,N.totalQuantity]);$s(r,{startY:c,head:[["","Item","Quantidade Total"]],body:R,theme:"grid",headStyles:{fillColor:d,textColor:[255,255,255],fontStyle:"bold",fontSize:10},bodyStyles:{textColor:m,fontSize:10},columnStyles:{0:{cellWidth:10,halign:"center"},1:{cellWidth:"auto",halign:"left"},2:{cellWidth:50,halign:"right"}},margin:{left:14,right:14},styles:{lineColor:[200,200,200],lineWidth:.1},didParseCell:function(N){if(N.column.index===0&&N.row.index>=0){const h=N.cell.x+2,_=N.cell.y+2,E=4;r.setDrawColor(150,150,150),r.setLineWidth(.3),r.rect(h,_,E,E)}}}),c=r.lastAutoTable.finalY+8,T<u.length-1&&(c+=5)}const w=i-15;r.setFontSize(8),r.setTextColor(...x),r.setFont("helvetica","italic"),r.text("Gerado por HipoZero",l/2,w,{align:"center"});const y=`lista_compras_${n.replace(/\s+/g,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;r.save(y)};function ba(t){const n=new Map;for(const a of t)if(!(!a.foods||a.foods.length===0))for(const o of a.foods){const r=o.foods?.name||o.food?.name||o.name||"Alimento nÃ£o identificado",l=parseFloat(o.quantity)||0,i=o.unit||"g",d=o.foods?.group||o.food?.group||"Outros",m=`${r.toLowerCase()}_${i}`;if(n.has(m)){const x=n.get(m);x.totalQuantity=vt(x.totalQuantityValue+l,i),x.totalQuantityValue+=l}else n.set(m,{name:r,unit:i,category:d,totalQuantity:vt(l,i),totalQuantityValue:l})}return Array.from(n.values())}function Na(t){const n={},a={"Cereais e derivados":"Cereais e Derivados","Verduras, hortaliÃ§as e derivados":"Verduras e HortaliÃ§as","Frutas e sucos":"Frutas","Carnes e derivados":"Carnes","Leite e derivados":"LaticÃ­nios","Ã“leos e gorduras":"Ã“leos e Gorduras","Pescados e frutos do mar":"Peixes e Frutos do Mar",Leguminosas:"Leguminosas","Nozes e sementes":"Nozes e Sementes",Bebidas:"Bebidas",Outros:"Outros"};for(const o of t){const r=a[o.category]||o.category||"Outros";n[r]||(n[r]=[]),n[r].push(o)}for(const o in n)n[o].sort((r,l)=>r.name.localeCompare(l.name,"pt-BR"));return n}function vt(t,n){const a=Math.round(t*100)/100;return a%1===0?`${a} ${n}`:`${a.toFixed(2)} ${n}`}const nr=()=>{const{patientId:t}=ts(),n=bt(),{toast:a}=Nt(),{user:o}=ss(),[r,l]=s.useState(!0),[i,d]=s.useState(!1),[m,x]=s.useState([]),[c,p]=s.useState(null),[u,w]=s.useState(""),[y,T]=s.useState(null),[F,k]=s.useState(!1),[R,N]=s.useState(null),[h,_]=s.useState(null),[E,I]=s.useState(!1),[V,$]=s.useState(null),[v,M]=s.useState(!1),[q,G]=s.useState(null),[ye,ne]=s.useState(!1),[ie,j]=s.useState(!1),[b,S]=s.useState(!1),[D,z]=s.useState(""),[B,K]=s.useState("");s.useEffect(()=>{(async()=>{const{data:{user:C}}=await me.auth.getUser();C&&_(C.id)})()},[]),s.useEffect(()=>{(async()=>{if(t)try{const{data:C,error:W}=await me.from("user_profiles").select("name").eq("id",t).single();!W&&C&&w(C.name)}catch(C){console.error("Erro ao carregar nome do paciente:",C)}})()},[t]);const Q=s.useCallback(async()=>{if(t){l(!0);try{const[f,C]=await Promise.all([ms(t),us(t)]);if(f.error)throw f.error;x(f.data||[]),p(C.data)}catch(f){console.error("Erro ao carregar planos:",f),a({title:"Erro",description:"NÃ£o foi possÃ­vel carregar os planos alimentares",variant:"destructive"})}finally{l(!1)}}},[t,a]);s.useEffect(()=>{Q()},[Q]),s.useEffect(()=>{(async()=>{if(c?.id){const{data:C}=await Rt(c.id);T(C)}else T(null)})()},[c?.id]);const oe=async(f,C=null)=>{d(!0);try{if(C){const W=await xs(C,f);if(W.error)throw W.error}else{const W=await hs({patient_id:f.patient_id,nutritionist_id:f.nutritionist_id,name:f.name,description:f.description,active_days:f.active_days,start_date:f.start_date,end_date:f.end_date||null});if(W.error)throw W.error;for(const ee of f.meals){const O=await fs({meal_plan_id:W.data.id,name:ee.name,meal_type:ee.meal_type,meal_time:ee.meal_time,notes:ee.notes,order_index:ee.order_index});if(O.error)throw O.error;for(const H of ee.foods||[])await ps({meal_plan_meal_id:O.data.id,food_id:H.food_id,quantity:H.quantity,unit:H.unit,calories:H.calories,protein:H.protein,carbs:H.carbs,fat:H.fat,notes:H.notes,order_index:H.order_index||0})}}a({title:"Sucesso",description:C?"Plano atualizado com sucesso":"Plano criado com sucesso",variant:"success"}),k(!1),N(null),await Q()}catch(W){console.error("Erro ao salvar plano:",W),a({title:"Erro",description:"NÃ£o foi possÃ­vel salvar o plano alimentar",variant:"destructive"})}finally{d(!1)}},ce=async f=>{try{const C=await Oe(f);if(C.error)throw C.error;N(C.data),k(!0)}catch(C){console.error("Erro ao carregar plano para ediÃ§Ã£o:",C),a({title:"Erro",description:"NÃ£o foi possÃ­vel carregar o plano para ediÃ§Ã£o",variant:"destructive"})}},Y=async f=>{try{const C=await gs(f);if(C.error)throw C.error;a({title:"Sucesso",description:"Plano arquivado com sucesso",variant:"success"}),await Q()}catch(C){console.error("Erro ao arquivar plano:",C),a({title:"Erro",description:"NÃ£o foi possÃ­vel arquivar o plano",variant:"destructive"})}},Z=async f=>{try{const C=await vs(f);if(C.error)throw C.error;a({title:"Sucesso",description:"Plano ativado com sucesso",variant:"success"}),await Q()}catch(C){console.error("Erro ao ativar plano:",C),a({title:"Erro",description:"NÃ£o foi possÃ­vel ativar o plano",variant:"destructive"})}},de=f=>{const C=m.find(W=>W.id===f)||c;C&&(G(C),M(!0))},we=async f=>{try{const C=await bs(q.id,f);if(C.error)throw C.error;a({title:"Sucesso",description:"Plano copiado para o paciente com sucesso",variant:"success"}),M(!1),G(null)}catch(C){console.error("Erro ao copiar modelo:",C),a({title:"Erro",description:"NÃ£o foi possÃ­vel copiar o modelo para o paciente",variant:"destructive"})}},ue=async()=>{if(!c){a({title:"Erro",description:"Nenhum plano ativo encontrado.",variant:"destructive"});return}try{const f=await Oe(c.id);if(f.error)throw f.error;const C=f.data;await ja(C,u),a({title:"Lista de Compras gerada!",description:"O PDF foi baixado com sucesso."})}catch(f){console.error("Erro ao gerar lista de compras:",f),a({title:"Erro",description:"NÃ£o foi possÃ­vel gerar a lista de compras. Tente novamente.",variant:"destructive"})}},g=async f=>{if(c)try{ne(!1);const C=await Oe(c.id);if(C.error)throw C.error;const W=C.data;await Cs(W,u,o?.profile?.name,f,Ps,Mt),a({title:"PDF gerado!",description:"Plano alimentar exportado com sucesso.",variant:"success"})}catch(C){console.error("Erro ao exportar PDF:",C),a({title:"Erro",description:"NÃ£o foi possÃ­vel exportar o plano alimentar",variant:"destructive"})}},P=async()=>{if(V)try{const f=await js(V);if(f.error)throw f.error;a({title:"Sucesso",description:"Plano deletado com sucesso",variant:"success"}),$(null),I(!1),await Q()}catch(f){console.error("Erro ao deletar plano:",f),a({title:"Erro",description:"NÃ£o foi possÃ­vel deletar o plano",variant:"destructive"})}},U=f=>f?new Date(f).toLocaleDateString("pt-BR"):null,L=f=>{if(!f||f.length===0)return"Nenhum dia";if(f.length===7)return"Todos os dias";const C=["monday","tuesday","wednesday","thursday","friday"],W=["saturday","sunday"],ee=C.every(H=>f.includes(H))&&!W.some(H=>f.includes(H)),O=W.every(H=>f.includes(H))&&!C.some(H=>f.includes(H));return ee?"Dias Ãºteis":O?"Fins de semana":`${f.length} dias`},J=async()=>{if(!(!c||!D.trim())){d(!0);try{const f=B?B.split(",").map(ee=>ee.trim()).filter(ee=>ee.length>0):[],{data:C,error:W}=await Ns(c.id,D.trim(),f);if(W)throw W;a({title:"Template Salvo",description:`O plano foi salvo como template "${D}" com sucesso.`,variant:"success"}),S(!1),z(""),K("")}catch(f){console.error("Erro ao salvar template:",f),a({title:"Erro",description:"NÃ£o foi possÃ­vel salvar o template.",variant:"destructive"})}finally{d(!1)}}},Ee=async f=>{await Q(),f&&p(f)};return r?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Carregando..."})}):F?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(A,{variant:"ghost",onClick:()=>{k(!1),N(null)},children:[e.jsx(mt,{className:"mr-2 h-4 w-4"}),"Voltar"]})}),e.jsx(pa,{patientId:t,nutritionistId:h,initialData:R,onSubmit:oe,onCancel:()=>{k(!1),N(null)},loading:i})]}):e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{variant:"ghost",size:"sm",onClick:()=>n(`/nutritionist/patients/${t}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(mt,{className:"h-4 w-4 mr-1"}),"Voltar"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:Q,className:"flex-shrink-0",children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Xe,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"truncate",children:"Planos Alimentares"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gerencie os planos alimentares do paciente"})]}),e.jsxs(A,{size:"sm",onClick:()=>k(!0),className:"w-full sm:w-auto",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Novo Plano"]})]})]}),c&&e.jsxs(se,{className:"mb-6 border-primary shadow-sm",children:[e.jsx(ve,{children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs(je,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx("span",{className:"break-words",children:c.name}),e.jsx(Ce,{className:"bg-primary",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>ce(c.id),className:"hidden sm:flex",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(A,{size:"sm",onClick:()=>n(`/nutritionist/patients/${t}/meal-plan/${c.id}/summary`),className:"hidden sm:flex",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Resumo Nutricional"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:ue,className:"hidden sm:flex",children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Lista de Compras"]}),e.jsxs(as,{children:[e.jsx(rs,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:e.jsx(Es,{className:"h-4 w-4"})})}),e.jsxs(ns,{align:"end",className:"w-56",children:[e.jsxs("div",{className:"sm:hidden",children:[e.jsxs(Ae,{onClick:()=>ce(c.id),children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Editar Plano"]}),e.jsxs(Ae,{onClick:()=>n(`/nutritionist/patients/${t}/meal-plan/${c.id}/summary`),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Ver Resumo Nutricional"]}),e.jsx(it,{})]}),e.jsxs(Ae,{onClick:()=>ne(!0),children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),e.jsxs(Ae,{onClick:ue,children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Gerar Lista de Compras"]}),e.jsxs(Ae,{onClick:()=>de(c.id),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Copiar como Modelo"]}),e.jsx(it,{}),e.jsxs(Ae,{onClick:()=>Y(c.id),className:"text-destructive focus:text-destructive",children:[e.jsx(As,{className:"h-4 w-4 mr-2"}),"Arquivar Plano"]})]})]})]})]})})}),e.jsxs(ae,{children:[c.description&&e.jsx("p",{className:"text-muted-foreground mb-4",children:c.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"InÃ­cio"}),e.jsx("div",{className:"font-semibold",children:U(c.start_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"TÃ©rmino"}),e.jsx("div",{className:"font-semibold",children:c.end_date?U(c.end_date):"Indeterminado"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Dias Ativos"}),e.jsx("div",{className:"font-semibold",children:L(c.active_days)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"RefeiÃ§Ãµes"}),e.jsx("div",{className:"font-semibold",children:c.meals?.length||0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-6",children:c.meals&&c.meals.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold mb-3",children:"RefeiÃ§Ãµes:"}),c.meals.map((f,C)=>e.jsx("div",{className:"p-3 border rounded-lg bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[C+1,". ",f.name,f.meal_time&&e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["Ã s ",f.meal_time]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[f.foods?.length||0," alimento(s) â€¢"," ",f.total_calories?.toFixed(0)||0," kcal"]})]})})},f.id))]}):e.jsx(qe,{children:e.jsx(Ue,{children:"Nenhuma refeiÃ§Ã£o adicionada ainda."})})}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(Qt,{protein:c.daily_protein||0,carbs:c.daily_carbs||0,fat:c.daily_fat||0,calories:c.daily_calories||0,patientId:t,planId:null,referenceValues:y,onReferenceUpdate:null,readOnly:!0})})]})]})]}),e.jsxs(se,{children:[e.jsx(ve,{children:e.jsx(je,{children:"Todos os Planos"})}),e.jsx(ae,{children:m.length===0?e.jsx(qe,{children:e.jsx(Ue,{children:'Nenhum plano alimentar criado ainda. Clique em "Novo Plano" para comeÃ§ar.'})}):e.jsx("div",{className:"space-y-3",children:m.map(f=>e.jsx("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:f.name}),f.is_active&&e.jsx(Ce,{variant:"outline",children:"Ativo"}),!f.is_active&&e.jsx(Ce,{variant:"secondary",children:"Arquivado"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[U(f.start_date),f.end_date&&` atÃ© ${U(f.end_date)}`," ","â€¢ ",L(f.active_days)," ","â€¢ ",f.daily_calories?.toFixed(0)||0," kcal/dia"]})]}),e.jsxs("div",{className:"flex gap-2",children:[!f.is_active&&e.jsx(A,{variant:"default",size:"sm",onClick:()=>Z(f.id),title:"Ativar este plano",children:e.jsx(ut,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>ce(f.id),title:"Editar plano",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>de(f.id),title:"Copiar modelo",children:e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx(A,{variant:"outline",size:"sm",onClick:()=>{$(f.id),I(!0)},title:"Deletar plano",children:e.jsx(st,{className:"h-4 w-4 text-destructive"})})]})]})},f.id))})})]}),e.jsx(yt,{open:E,onOpenChange:I,children:e.jsxs(wt,{children:[e.jsxs(St,{children:[e.jsx(Ct,{children:"Confirmar ExclusÃ£o"}),e.jsx(_t,{children:"Tem certeza que deseja deletar este plano alimentar? Esta aÃ§Ã£o nÃ£o pode ser desfeita."})]}),e.jsxs($t,{children:[e.jsx(Pt,{onClick:()=>$(null),children:"Cancelar"}),e.jsx(Et,{onClick:P,className:"bg-destructive",children:"Deletar"})]})]})}),e.jsx(ga,{isOpen:v,onClose:()=>{M(!1),G(null)},planId:q?.id,planName:q?.name,onCopy:we}),e.jsx(xe,{open:b,onOpenChange:S,children:e.jsxs(he,{children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Salvar Plano como Modelo"}),e.jsx(ge,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:D,onChange:f=>z(f.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por vÃ­rgula)"}),e.jsx(re,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:B,onChange:f=>K(f.target.value),disabled:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(Se,{children:[e.jsx(A,{variant:"outline",onClick:()=>{S(!1),z(""),K("")},disabled:i,children:"Cancelar"}),e.jsx(A,{onClick:J,disabled:i||!D.trim(),children:i?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(gt,{open:ie,onOpenChange:j,patientId:t,nutritionistId:h,onTemplateApplied:Ee}),e.jsx(xe,{open:ye,onOpenChange:ne,children:e.jsxs(he,{className:"sm:max-w-md",children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Exportar Plano Alimentar"}),e.jsx(ge,{children:"Escolha o formato de exportaÃ§Ã£o para PDF"})]}),e.jsxs("div",{className:"grid gap-3 py-4",children:[e.jsx(se,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>g(!1),children:e.jsxs(ae,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary",children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Simples"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macronutrientes bÃ¡sicos (calorias, proteÃ­nas, carboidratos e gorduras)"})]})]})}),e.jsx(se,{className:"cursor-pointer hover:bg-accent/50 transition-colors border-2 hover:border-primary",onClick:()=>g(!0),children:e.jsxs(ae,{className:"flex items-start gap-3 p-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-secondary/10 text-secondary",children:e.jsx(xt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h4",{className:"text-sm font-semibold leading-none",children:"Plano Completo"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Macros + micronutrientes (fibras, vitaminas, minerais)"})]})]})})]}),e.jsx(Se,{className:"sm:justify-start",children:e.jsx(A,{variant:"ghost",onClick:()=>ne(!1),className:"w-full sm:w-auto",children:"Cancelar"})})]})}),e.jsx(xe,{open:b,onOpenChange:S,children:e.jsxs(he,{children:[e.jsxs(fe,{children:[e.jsx(pe,{children:"Salvar Plano como Modelo"}),e.jsx(ge,{children:"Salve este plano como um template para reutilizar em outros pacientes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"template-name",className:"text-sm font-medium",children:["Nome do Modelo ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(re,{id:"template-name",placeholder:"Ex: Hipertrofia 3000kcal",value:D,onChange:f=>z(f.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template-tags",className:"text-sm font-medium",children:"Tags (separadas por vÃ­rgula)"}),e.jsx(re,{id:"template-tags",placeholder:"Ex: hipertrofia, ganho de peso, 3000kcal",value:B,onChange:f=>K(f.target.value),disabled:i}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use tags para facilitar a busca dos templates"})]})]}),e.jsxs(Se,{children:[e.jsx(A,{variant:"outline",onClick:()=>{S(!1),z(""),K("")},disabled:i,children:"Cancelar"}),e.jsx(A,{onClick:J,disabled:i||!D.trim(),children:i?"Salvando...":"Salvar Modelo"})]})]})}),e.jsx(gt,{open:ie,onOpenChange:j,patientId:t,nutritionistId:h,onTemplateApplied:Ee})]})};export{nr as default};
