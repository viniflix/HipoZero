import{q as De,Z as At,j as e,C as xe,c as Se,d as ke,e as ge,I as ve,r as N,F as Y,w as Oe,B as J,X as lt,T as Ct,a as st,J as Be,K as Ve,M as Ue,N as He,O as ut,s as ze,A as We,h as Ke,i as Ge,k as Je,l as Xe,n as Qe,o as Ye,p as Ze,t as Le,a4 as Pe,u as Ot,m as zt,S as $t,D as It,x as Lt,a1 as qt,y as Bt,z as rt}from"./index-BvWB-6Y-.js";import{I as Ne}from"./input-OBodSLFw.js";import{D as ct,M as Vt}from"./date-input-NufpG6-F.js";import{L as Q}from"./label-Dds-NHUC.js";import{S as be,a as _e,b as we,c as Ce,d as re}from"./select-CHitR1r5.js";import{P as Ut}from"./progress-Di_AUcQX.js";import{T as Ht}from"./trending-up-DCN4wKoA.js";import{A as Nt}from"./alert-circle-HzKGSyQg.js";import{T as St,a as kt,b as et,c as ft}from"./tabs-CA5k0aJI.js";import{R as nt,T as it,p as xt,B as gt,l as Wt}from"./generateCategoricalChart-DYL0xZdm.js";import{B as Kt}from"./BarChart-CSZMxWtq.js";import{X as jt,Y as vt}from"./YAxis-C8erclLc.js";import{P as Gt,a as Jt}from"./PieChart-DtG1PSoL.js";import{a as Xt,L as Qt}from"./LineChart-BKiejqo7.js";import{p as Ee}from"./pt-BR-BMtVLtF7.js";import{p as $e}from"./parseISO-DtrTOw4I.js";import{T as Et,a as Dt,b as tt,c as de,d as Rt,e as he}from"./table-C34wbah6.js";import{B as dt}from"./badge-CCK5Bs0D.js";import{S as Yt}from"./search-DAzfs9rU.js";import{P as Ft}from"./pen-square-OCV3PTXs.js";import{S as yt}from"./switch-DstVlsQb.js";import{a as Zt}from"./addMonths-hOFFPW3g.js";import{g as ht,s as es,d as ts,a as ss,u as as,b as Tt,r as rs,c as ns,e as is,f as os,h as ls,i as cs,j as ds,k as hs,l as us}from"./financial-queries-Co2vDJmL.js";import{P as Mt}from"./plus-BWNKYoo4.js";import{C as ms}from"./check-circle-2-DqvAHxH6.js";import{C as ps}from"./calendar-BxLBJTLY.js";import{i as fs}from"./isToday-kGhyZ0TX.js";import{i as xs}from"./isYesterday-9BPB-yUf.js";import{A as gs,a as js,b as vs}from"./avatar-DPn5jeVM.js";import{A as ys}from"./award-CmPEDryx.js";import{a as bs}from"./pdfUtils-DbTjH_I8.js";import{E as _s}from"./jspdf.es.min-B7ZBL3OL.js";import{g as ws}from"./profile-queries-CdHimGjG.js";import{D as Cs}from"./download-CU2JC9ir.js";import{T as Ns}from"./target-Bs9FM_-p.js";import{s as Ss}from"./calendar-rgGv7qqU.js";import"./popover-BK70NwGK.js";import"./extends-CF3RwP-h.js";import"./query-helpers-mbysFH2_.js";import"./endOfMonth-Ca9QmV5D.js";import"./constructNow-BDnuN8eJ.js";import"./isSameDay-CSO39H9U.js";import"./jspdf.plugin.autotable-C3NxY6Hi.js";import"./html2canvas.esm-B0tyYwQk.js";import"./chevron-left-FDyjizdT.js";const ks=De("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Es=De("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),ot=De("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),bt=De("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),Ds=De("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]),Rs=De("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),Fs=De("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var qe={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Ts=qe.exports,_t;function Ms(){return _t||(_t=1,(function(o,u){((h,n)=>{o.exports=n()})(Ts,function h(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},f,_=!n.document&&!!n.postMessage,b=n.IS_PAPA_WORKER||!1,d={},r=0,l={};function C(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(s){var i=a(s);i.chunkSize=parseInt(i.chunkSize),s.step||s.chunk||(i.chunkSize=null),this._handle=new X(i),(this._handle.streamer=this)._config=i}).call(this,t),this.parseChunk=function(s,i){var m=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<m){let R=this._config.newline;R||(p=this._config.quoteChar||'"',R=this._handle.guessLineEndings(s,p)),s=[...s.split(R).slice(m)].join(R)}this.isFirstChunk&&y(this._config.beforeFirstChunk)&&(p=this._config.beforeFirstChunk(s))!==void 0&&(s=p),this.isFirstChunk=!1,this._halted=!1;var m=this._partialLine+s,p=(this._partialLine="",this._handle.parse(m,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(s=p.meta.cursor,m=(this._finished||(this._partialLine=m.substring(s-this._baseIndex),this._baseIndex=s),p&&p.data&&(this._rowCount+=p.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),b)n.postMessage({results:p,workerId:l.WORKER_ID,finished:m});else if(y(this._config.chunk)&&!i){if(this._config.chunk(p,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=p=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(p.data),this._completeResults.errors=this._completeResults.errors.concat(p.errors),this._completeResults.meta=p.meta),this._completed||!m||!y(this._config.complete)||p&&p.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),m||p&&p.meta.paused||this._nextChunk(),p}this._halted=!0},this._sendError=function(s){y(this._config.error)?this._config.error(s):b&&this._config.error&&n.postMessage({workerId:l.WORKER_ID,error:s,finished:!1})}}function L(t){var s;(t=t||{}).chunkSize||(t.chunkSize=l.RemoteChunkSize),C.call(this,t),this._nextChunk=_?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(i){this._input=i,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),_||(s.onload=c(this._chunkLoaded,this),s.onerror=c(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!_),this._config.downloadRequestHeaders){var i,m=this._config.downloadRequestHeaders;for(i in m)s.setRequestHeader(i,m[i])}var p;this._config.chunkSize&&(p=this._start+this._config.chunkSize-1,s.setRequestHeader("Range","bytes="+this._start+"-"+p));try{s.send(this._config.downloadRequestBody)}catch(R){this._chunkError(R.message)}_&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize||s.responseText.length,this._finished=!this._config.chunkSize||this._start>=(i=>(i=i.getResponseHeader("Content-Range"))!==null?parseInt(i.substring(i.lastIndexOf("/")+1)):-1)(s),this.parseChunk(s.responseText)))},this._chunkError=function(i){i=s.statusText||i,this._sendError(new Error(i))}}function O(t){(t=t||{}).chunkSize||(t.chunkSize=l.LocalChunkSize),C.call(this,t);var s,i,m=typeof FileReader<"u";this.stream=function(p){this._input=p,i=p.slice||p.webkitSlice||p.mozSlice,m?((s=new FileReader).onload=c(this._chunkLoaded,this),s.onerror=c(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var p=this._input,R=(this._config.chunkSize&&(R=Math.min(this._start+this._config.chunkSize,this._input.size),p=i.call(p,this._start,R)),s.readAsText(p,this._config.encoding));m||this._chunkLoaded({target:{result:R}})},this._chunkLoaded=function(p){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(p.target.result)},this._chunkError=function(){this._sendError(s.error)}}function v(t){var s;C.call(this,t=t||{}),this.stream=function(i){return s=i,this._nextChunk()},this._nextChunk=function(){var i,m;if(!this._finished)return i=this._config.chunkSize,s=i?(m=s.substring(0,i),s.substring(i)):(m=s,""),this._finished=!s,this.parseChunk(m)}}function z(t){C.call(this,t=t||{});var s=[],i=!0,m=!1;this.pause=function(){C.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){C.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(p){this._input=p,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){m&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):i=!0},this._streamData=c(function(p){try{s.push(typeof p=="string"?p:p.toString(this._config.encoding)),i&&(i=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(R){this._streamError(R)}},this),this._streamError=c(function(p){this._streamCleanUp(),this._sendError(p)},this),this._streamEnd=c(function(){this._streamCleanUp(),m=!0,this._streamData("")},this),this._streamCleanUp=c(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function X(t){var s,i,m,p,R=Math.pow(2,53),$=-R,ne=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Z=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,F=this,V=0,w=0,ee=!1,k=!1,T=[],j={data:[],errors:[],meta:{}};function K(S){return t.skipEmptyLines==="greedy"?S.join("").trim()==="":S.length===1&&S[0].length===0}function H(){if(j&&m&&(I("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),m=!1),t.skipEmptyLines&&(j.data=j.data.filter(function(g){return!K(g)})),x()){let g=function(U,G){y(t.transformHeader)&&(U=t.transformHeader(U,G)),T.push(U)};if(j)if(Array.isArray(j.data[0])){for(var S=0;x()&&S<j.data.length;S++)j.data[S].forEach(g);j.data.splice(0,1)}else j.data.forEach(g)}function E(g,U){for(var G=t.header?{}:[],P=0;P<g.length;P++){var q=P,M=g[P],M=((ue,D)=>(W=>(t.dynamicTypingFunction&&t.dynamicTyping[W]===void 0&&(t.dynamicTyping[W]=t.dynamicTypingFunction(W)),(t.dynamicTyping[W]||t.dynamicTyping)===!0))(ue)?D==="true"||D==="TRUE"||D!=="false"&&D!=="FALSE"&&((W=>{if(ne.test(W)&&(W=parseFloat(W),$<W&&W<R))return 1})(D)?parseFloat(D):Z.test(D)?new Date(D):D===""?null:D):D)(q=t.header?P>=T.length?"__parsed_extra":T[P]:q,M=t.transform?t.transform(M,q):M);q==="__parsed_extra"?(G[q]=G[q]||[],G[q].push(M)):G[q]=M}return t.header&&(P>T.length?I("FieldMismatch","TooManyFields","Too many fields: expected "+T.length+" fields but parsed "+P,w+U):P<T.length&&I("FieldMismatch","TooFewFields","Too few fields: expected "+T.length+" fields but parsed "+P,w+U)),G}var A;j&&(t.header||t.dynamicTyping||t.transform)&&(A=1,!j.data.length||Array.isArray(j.data[0])?(j.data=j.data.map(E),A=j.data.length):j.data=E(j.data,0),t.header&&j.meta&&(j.meta.fields=T),w+=A)}function x(){return t.header&&T.length===0}function I(S,E,A,g){S={type:S,code:E,message:A},g!==void 0&&(S.row=g),j.errors.push(S)}y(t.step)&&(p=t.step,t.step=function(S){j=S,x()?H():(H(),j.data.length!==0&&(V+=S.data.length,t.preview&&V>t.preview?i.abort():(j.data=j.data[0],p(j,F))))}),this.parse=function(S,E,A){var g=t.quoteChar||'"',g=(t.newline||(t.newline=this.guessLineEndings(S,g)),m=!1,t.delimiter?y(t.delimiter)&&(t.delimiter=t.delimiter(S),j.meta.delimiter=t.delimiter):((g=((U,G,P,q,M)=>{var ue,D,W,ye;M=M||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var Re=0;Re<M.length;Re++){for(var me,Te=M[Re],ae=0,pe=0,te=0,ie=(W=void 0,new oe({comments:q,delimiter:Te,newline:G,preview:10}).parse(U)),je=0;je<ie.data.length;je++)P&&K(ie.data[je])?te++:(me=ie.data[je].length,pe+=me,W===void 0?W=me:0<me&&(ae+=Math.abs(me-W),W=me));0<ie.data.length&&(pe/=ie.data.length-te),(D===void 0||ae<=D)&&(ye===void 0||ye<pe)&&1.99<pe&&(D=ae,ue=Te,ye=pe)}return{successful:!!(t.delimiter=ue),bestDelimiter:ue}})(S,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=g.bestDelimiter:(m=!0,t.delimiter=l.DefaultDelimiter),j.meta.delimiter=t.delimiter),a(t));return t.preview&&t.header&&g.preview++,s=S,i=new oe(g),j=i.parse(s,E,A),H(),ee?{meta:{paused:!0}}:j||{meta:{paused:!1}}},this.paused=function(){return ee},this.pause=function(){ee=!0,i.abort(),s=y(t.chunk)?"":s.substring(i.getCharIndex())},this.resume=function(){F.streamer._halted?(ee=!1,F.streamer.parseChunk(s,!0)):setTimeout(F.resume,3)},this.aborted=function(){return k},this.abort=function(){k=!0,i.abort(),j.meta.aborted=!0,y(t.complete)&&t.complete(j),s=""},this.guessLineEndings=function(U,g){U=U.substring(0,1048576);var g=new RegExp(se(g)+"([^]*?)"+se(g),"gm"),A=(U=U.replace(g,"")).split("\r"),g=U.split(`
`),U=1<g.length&&g[0].length<A[0].length;if(A.length===1||U)return`
`;for(var G=0,P=0;P<A.length;P++)A[P][0]===`
`&&G++;return G>=A.length/2?`\r
`:"\r"}}function se(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function oe(t){var s=(t=t||{}).delimiter,i=t.newline,m=t.comments,p=t.step,R=t.preview,$=t.fastMode,ne=null,Z=!1,F=t.quoteChar==null?'"':t.quoteChar,V=F;if(t.escapeChar!==void 0&&(V=t.escapeChar),(typeof s!="string"||-1<l.BAD_DELIMITERS.indexOf(s))&&(s=","),m===s)throw new Error("Comment character same as delimiter");m===!0?m="#":(typeof m!="string"||-1<l.BAD_DELIMITERS.indexOf(m))&&(m=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var w=0,ee=!1;this.parse=function(k,T,j){if(typeof k!="string")throw new Error("Input must be a string");var K=k.length,H=s.length,x=i.length,I=m.length,S=y(p),E=[],A=[],g=[],U=w=0;if(!k)return ae();if($||$!==!1&&k.indexOf(F)===-1){for(var G=k.split(i),P=0;P<G.length;P++){if(g=G[P],w+=g.length,P!==G.length-1)w+=i.length;else if(j)return ae();if(!m||g.substring(0,I)!==m){if(S){if(E=[],ye(g.split(s)),pe(),ee)return ae()}else ye(g.split(s));if(R&&R<=P)return E=E.slice(0,R),ae(!0)}}return ae()}for(var q=k.indexOf(s,w),M=k.indexOf(i,w),ue=new RegExp(se(V)+se(F),"g"),D=k.indexOf(F,w);;)if(k[w]===F)for(D=w,w++;;){if((D=k.indexOf(F,D+1))===-1)return j||A.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:E.length,index:w}),me();if(D===K-1)return me(k.substring(w,D).replace(ue,F));if(F===V&&k[D+1]===V)D++;else if(F===V||D===0||k[D-1]!==V){q!==-1&&q<D+1&&(q=k.indexOf(s,D+1));var W=Re((M=M!==-1&&M<D+1?k.indexOf(i,D+1):M)===-1?q:Math.min(q,M));if(k.substr(D+1+W,H)===s){g.push(k.substring(w,D).replace(ue,F)),k[w=D+1+W+H]!==F&&(D=k.indexOf(F,w)),q=k.indexOf(s,w),M=k.indexOf(i,w);break}if(W=Re(M),k.substring(D+1+W,D+1+W+x)===i){if(g.push(k.substring(w,D).replace(ue,F)),Te(D+1+W+x),q=k.indexOf(s,w),D=k.indexOf(F,w),S&&(pe(),ee))return ae();if(R&&E.length>=R)return ae(!0);break}A.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:E.length,index:w}),D++}}else if(m&&g.length===0&&k.substring(w,w+I)===m){if(M===-1)return ae();w=M+x,M=k.indexOf(i,w),q=k.indexOf(s,w)}else if(q!==-1&&(q<M||M===-1))g.push(k.substring(w,q)),w=q+H,q=k.indexOf(s,w);else{if(M===-1)break;if(g.push(k.substring(w,M)),Te(M+x),S&&(pe(),ee))return ae();if(R&&E.length>=R)return ae(!0)}return me();function ye(te){E.push(te),U=w}function Re(te){var ie=0;return ie=te!==-1&&(te=k.substring(D+1,te))&&te.trim()===""?te.length:ie}function me(te){return j||(te===void 0&&(te=k.substring(w)),g.push(te),w=K,ye(g),S&&pe()),ae()}function Te(te){w=te,ye(g),g=[],M=k.indexOf(i,w)}function ae(te){if(t.header&&!T&&E.length&&!Z){var ie=E[0],je=Object.create(null),at=new Set(ie);let mt=!1;for(let Fe=0;Fe<ie.length;Fe++){let fe=ie[Fe];if(je[fe=y(t.transformHeader)?t.transformHeader(fe,Fe):fe]){let Me,pt=je[fe];for(;Me=fe+"_"+pt,pt++,at.has(Me););at.add(Me),ie[Fe]=Me,je[fe]++,mt=!0,(ne=ne===null?{}:ne)[Me]=fe}else je[fe]=1,ie[Fe]=fe;at.add(fe)}mt&&console.warn("Duplicate headers found and renamed."),Z=!0}return{data:E,errors:A,meta:{delimiter:s,linebreak:i,aborted:ee,truncated:!!te,cursor:U+(T||0),renamedHeaders:ne}}}function pe(){p(ae()),E=[],A=[]}},this.abort=function(){ee=!0},this.getCharIndex=function(){return w}}function ce(t){var s=t.data,i=d[s.workerId],m=!1;if(s.error)i.userError(s.error,s.file);else if(s.results&&s.results.data){var p={abort:function(){m=!0,le(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:B,resume:B};if(y(i.userStep)){for(var R=0;R<s.results.data.length&&(i.userStep({data:s.results.data[R],errors:s.results.errors,meta:s.results.meta},p),!m);R++);delete s.results}else y(i.userChunk)&&(i.userChunk(s.results,p,s.file),delete s.results)}s.finished&&!m&&le(s.workerId,s.results)}function le(t,s){var i=d[t];y(i.userComplete)&&i.userComplete(s),i.terminate(),delete d[t]}function B(){throw new Error("Not implemented.")}function a(t){if(typeof t!="object"||t===null)return t;var s,i=Array.isArray(t)?[]:{};for(s in t)i[s]=a(t[s]);return i}function c(t,s){return function(){t.apply(s,arguments)}}function y(t){return typeof t=="function"}return l.parse=function(t,s){var i=(s=s||{}).dynamicTyping||!1;if(y(i)&&(s.dynamicTypingFunction=i,i={}),s.dynamicTyping=i,s.transform=!!y(s.transform)&&s.transform,!s.worker||!l.WORKERS_SUPPORTED)return i=null,l.NODE_STREAM_INPUT,typeof t=="string"?(t=(m=>m.charCodeAt(0)!==65279?m:m.slice(1))(t),i=new(s.download?L:v)(s)):t.readable===!0&&y(t.read)&&y(t.on)?i=new z(s):(n.File&&t instanceof File||t instanceof Object)&&(i=new O(s)),i.stream(t);(i=(()=>{var m;return!!l.WORKERS_SUPPORTED&&(m=(()=>{var p=n.URL||n.webkitURL||null,R=h.toString();return l.BLOB_URL||(l.BLOB_URL=p.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",R,")();"],{type:"text/javascript"})))})(),(m=new n.Worker(m)).onmessage=ce,m.id=r++,d[m.id]=m)})()).userStep=s.step,i.userChunk=s.chunk,i.userComplete=s.complete,i.userError=s.error,s.step=y(s.step),s.chunk=y(s.chunk),s.complete=y(s.complete),s.error=y(s.error),delete s.worker,i.postMessage({input:t,config:s,workerId:i.id})},l.unparse=function(t,s){var i=!1,m=!0,p=",",R=`\r
`,$='"',ne=$+$,Z=!1,F=null,V=!1,w=((()=>{if(typeof s=="object"){if(typeof s.delimiter!="string"||l.BAD_DELIMITERS.filter(function(T){return s.delimiter.indexOf(T)!==-1}).length||(p=s.delimiter),typeof s.quotes!="boolean"&&typeof s.quotes!="function"&&!Array.isArray(s.quotes)||(i=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(Z=s.skipEmptyLines),typeof s.newline=="string"&&(R=s.newline),typeof s.quoteChar=="string"&&($=s.quoteChar),typeof s.header=="boolean"&&(m=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");F=s.columns}s.escapeChar!==void 0&&(ne=s.escapeChar+$),s.escapeFormulae instanceof RegExp?V=s.escapeFormulae:typeof s.escapeFormulae=="boolean"&&s.escapeFormulae&&(V=/^[=+\-@\t\r].*$/)}})(),new RegExp(se($),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return ee(null,t,Z);if(typeof t[0]=="object")return ee(F||Object.keys(t[0]),t,Z)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||F),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),ee(t.fields||[],t.data||[],Z);throw new Error("Unable to serialize unrecognized input");function ee(T,j,K){var H="",x=(typeof T=="string"&&(T=JSON.parse(T)),typeof j=="string"&&(j=JSON.parse(j)),Array.isArray(T)&&0<T.length),I=!Array.isArray(j[0]);if(x&&m){for(var S=0;S<T.length;S++)0<S&&(H+=p),H+=k(T[S],S);0<j.length&&(H+=R)}for(var E=0;E<j.length;E++){var A=(x?T:j[E]).length,g=!1,U=x?Object.keys(j[E]).length===0:j[E].length===0;if(K&&!x&&(g=K==="greedy"?j[E].join("").trim()==="":j[E].length===1&&j[E][0].length===0),K==="greedy"&&x){for(var G=[],P=0;P<A;P++){var q=I?T[P]:P;G.push(j[E][q])}g=G.join("").trim()===""}if(!g){for(var M=0;M<A;M++){0<M&&!U&&(H+=p);var ue=x&&I?T[M]:M;H+=k(j[E][ue],M)}E<j.length-1&&(!K||0<A&&!U)&&(H+=R)}}return H}function k(T,j){var K,H;return T==null?"":T.constructor===Date?JSON.stringify(T).slice(1,25):(H=!1,V&&typeof T=="string"&&V.test(T)&&(T="'"+T,H=!0),K=T.toString().replace(w,ne),(H=H||i===!0||typeof i=="function"&&i(T,j)||Array.isArray(i)&&i[j]||((x,I)=>{for(var S=0;S<I.length;S++)if(-1<x.indexOf(I[S]))return!0;return!1})(K,l.BAD_DELIMITERS)||-1<K.indexOf(p)||K.charAt(0)===" "||K.charAt(K.length-1)===" ")?$+K+$:K)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!_&&!!n.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=oe,l.ParserHandle=X,l.NetworkStreamer=L,l.FileStreamer=O,l.StringStreamer=v,l.ReadableStreamStreamer=z,n.jQuery&&((f=n.jQuery).fn.parse=function(t){var s=t.config||{},i=[];return this.each(function(R){if(!(f(this).prop("tagName").toUpperCase()==="INPUT"&&f(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var $=0;$<this.files.length;$++)i.push({file:this.files[$],inputElem:this,instanceConfig:f.extend({},s)})}),m(),this;function m(){if(i.length===0)y(t.complete)&&t.complete();else{var R,$,ne,Z,F=i[0];if(y(t.before)){var V=t.before(F.file,F.inputElem);if(typeof V=="object"){if(V.action==="abort")return R="AbortError",$=F.file,ne=F.inputElem,Z=V.reason,void(y(t.error)&&t.error({name:R},$,ne,Z));if(V.action==="skip")return void p();typeof V.config=="object"&&(F.instanceConfig=f.extend(F.instanceConfig,V.config))}else if(V==="skip")return void p()}var w=F.instanceConfig.complete;F.instanceConfig.complete=function(ee){y(w)&&w(ee,F.file,F.inputElem),p()},l.parse(F.file,F.instanceConfig)}}function p(){i.splice(0,1),m()}}),b&&(n.onmessage=function(t){t=t.data,l.WORKER_ID===void 0&&t&&(l.WORKER_ID=t.workerId),typeof t.input=="string"?n.postMessage({workerId:l.WORKER_ID,results:l.parse(t.input,t.config),finished:!0}):(n.File&&t.input instanceof File||t.input instanceof Object)&&(t=l.parse(t.input,t.config))&&n.postMessage({workerId:l.WORKER_ID,results:t,finished:!0})}),(L.prototype=Object.create(C.prototype)).constructor=L,(O.prototype=Object.create(C.prototype)).constructor=O,(v.prototype=Object.create(v.prototype)).constructor=v,(z.prototype=Object.create(C.prototype)).constructor=z,l})})(qe)),qe.exports}var Ps=Ms();const Pt=At(Ps);function As({summary:o,loading:u}){const h=[{title:"Receita Mensal",value:o?.income||0,netValue:o?.netIncome||0,icon:Es,color:"text-green-600",bgColor:"bg-green-50 dark:bg-green-950",borderColor:"border-green-200 dark:border-green-800",showNet:!0},{title:"Despesas",value:o?.expenses||0,icon:ks,color:"text-red-600",bgColor:"bg-red-50 dark:bg-red-950",borderColor:"border-red-200 dark:border-red-800"},{title:"Resultado Líquido",value:o?.netResult||0,icon:Ht,color:o?.netResult>=0?"text-blue-600":"text-red-600",bgColor:o?.netResult>=0?"bg-blue-50 dark:bg-blue-950":"bg-red-50 dark:bg-red-950",borderColor:o?.netResult>=0?"border-blue-200 dark:border-blue-800":"border-red-200 dark:border-red-800"},{title:"A Receber (Pendente)",value:o?.overdue||0,icon:Nt,color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-950",borderColor:"border-orange-200 dark:border-orange-800"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 min-w-0",children:h.map((n,f)=>{const _=n.icon;return e.jsxs(xe,{className:`${n.bgColor} ${n.borderColor} border-2 transition-all hover:shadow-md overflow-hidden min-w-0`,children:[e.jsxs(Se,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ke,{className:"text-xs md:text-sm font-medium text-muted-foreground break-words",children:n.title}),e.jsx(_,{className:`h-4 w-4 ${n.color}`})]}),e.jsx(ge,{children:u?e.jsx("div",{className:"h-8 w-24 bg-muted animate-pulse rounded"}):e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:`text-xl md:text-2xl font-bold break-all ${n.color}`,children:ve(n.value)}),n.showNet&&n.netValue!==n.value&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Líquido: ",e.jsx("span",{className:"font-semibold",children:ve(n.netValue)})]})]})})]},f)})})}const Ie={income:"#22c55e",expense:"#ef4444",pie:["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#6366f1","#f97316"]};function Os({cashFlowData:o,expenseDistribution:u,projectedCashFlow:h,loading:n}){const f=N.useMemo(()=>!o||o.length===0?[]:o.map(d=>({...d,date:Y($e(d.date),"dd/MM",{locale:Ee})})),[o]),_=N.useMemo(()=>!u||u.length===0?[]:u,[u]),b=N.useMemo(()=>!h||h.length===0?[]:h.map(d=>({...d,date:Y($e(d.date),"dd/MM",{locale:Ee})})),[h]);return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Fluxo de Caixa"}),e.jsx(Oe,{children:"Receitas vs Despesas por período"})]}),e.jsx(ge,{children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):f.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhum dado disponível"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Kt,{data:f,children:[e.jsx(jt,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(vt,{tick:{fontSize:12},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(it,{formatter:d=>`R$ ${d.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(xt,{}),e.jsx(gt,{dataKey:"income",name:"Receitas",fill:Ie.income,radius:[4,4,0,0]}),e.jsx(gt,{dataKey:"expenses",name:"Despesas",fill:Ie.expense,radius:[4,4,0,0]})]})})})]}),e.jsxs(xe,{children:[e.jsxs(Se,{children:[e.jsx(ke,{children:"Análise Financeira"}),e.jsx(Oe,{children:"Distribuição de despesas e projeção de caixa"})]}),e.jsx(ge,{children:e.jsxs(St,{defaultValue:"expenses",className:"w-full",children:[e.jsxs(kt,{className:"grid w-full grid-cols-2",children:[e.jsx(et,{value:"expenses",children:"Despesas"}),e.jsx(et,{value:"projection",children:"Projeção (30 dias)"})]}),e.jsx(ft,{value:"expenses",className:"mt-4",children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):_.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhuma despesa registrada"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Gt,{children:[e.jsx(Jt,{data:_,cx:"50%",cy:"50%",labelLine:!1,label:({name:d,percent:r})=>`${d}: ${(r*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:_.map((d,r)=>e.jsx(Wt,{fill:Ie.pie[r%Ie.pie.length]},`cell-${r}`))}),e.jsx(it,{formatter:d=>`R$ ${d.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}})]})})}),e.jsx(ft,{value:"projection",className:"mt-4",children:n?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Carregando..."})}):b.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Nenhuma projeção disponível"})}):e.jsx(nt,{width:"100%",height:300,children:e.jsxs(Xt,{data:b,children:[e.jsx(jt,{dataKey:"date",tick:{fontSize:12},angle:-45,textAnchor:"end",height:80}),e.jsx(vt,{tick:{fontSize:12},tickFormatter:d=>`R$ ${(d/1e3).toFixed(0)}k`}),e.jsx(it,{formatter:d=>`R$ ${d.toFixed(2)}`,contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(xt,{}),e.jsx(Qt,{type:"monotone",dataKey:"balance",name:"Saldo Projetado",stroke:"#3b82f6",strokeWidth:2,dot:{r:3}})]})})})]})})]})]})}const zs={paid:"success",pending:"warning",overdue:"destructive"},$s={paid:"Pago",pending:"Pendente",overdue:"Vencido"};function Is({transactions:o,loading:u,onEdit:h,onDelete:n,onGenerateReceipt:f,filters:_,onFiltersChange:b}){const[d,r]=N.useState(_?.search||""),l=v=>{r(v),b({..._,search:v})},C=(v,z)=>{b({..._,[v]:z==="all"?null:z})},L=()=>{r(""),b({type:null,status:null,search:null})},O=_?.type||_?.status||_?.search;return e.jsxs(xe,{className:"overflow-hidden",children:[e.jsx(Se,{className:"pb-2",children:e.jsx(ke,{className:"text-base md:text-lg break-words",children:"Histórico de Transações"})}),e.jsxs(ge,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4 min-w-0",children:[e.jsxs("div",{className:"flex-1 relative min-w-0",children:[e.jsx(Yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ne,{placeholder:"Buscar por descrição...",value:d,onChange:v=>l(v.target.value),className:"pl-9 min-w-0"})]}),e.jsxs(be,{value:_?.type||"all",onValueChange:v=>C("type",v),children:[e.jsx(_e,{className:"w-full sm:w-[180px]",children:e.jsx(we,{placeholder:"Tipo"})}),e.jsxs(Ce,{children:[e.jsx(re,{value:"all",children:"Todos os tipos"}),e.jsx(re,{value:"income",children:"Receita"}),e.jsx(re,{value:"expense",children:"Despesa"})]})]}),e.jsxs(be,{value:_?.status||"all",onValueChange:v=>C("status",v),children:[e.jsx(_e,{className:"w-full sm:w-[180px]",children:e.jsx(we,{placeholder:"Status"})}),e.jsxs(Ce,{children:[e.jsx(re,{value:"all",children:"Todos os status"}),e.jsx(re,{value:"paid",children:"Pago"}),e.jsx(re,{value:"pending",children:"Pendente"}),e.jsx(re,{value:"overdue",children:"Vencido"})]})]}),O&&e.jsx(J,{variant:"outline",size:"icon",onClick:L,className:"flex-shrink-0",children:e.jsx(lt,{className:"h-4 w-4"})})]}),u?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando transações..."}):o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma transação encontrada."}):e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Et,{children:[e.jsx(Dt,{children:e.jsxs(tt,{children:[e.jsx(de,{className:"w-[100px]",children:"Data"}),e.jsx(de,{children:"Descrição"}),e.jsx(de,{className:"w-[120px]",children:"Categoria"}),e.jsx(de,{className:"w-[150px]",children:"Paciente"}),e.jsx(de,{className:"w-[120px] text-right",children:"Valor"}),e.jsx(de,{className:"w-[100px]",children:"Status"}),e.jsx(de,{className:"w-[100px] text-right",children:"Ações"})]})}),e.jsx(Rt,{children:o.map(v=>e.jsxs(tt,{children:[e.jsx(he,{className:"font-medium",children:Y(new Date(v.transaction_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee})}),e.jsx(he,{className:"max-w-[200px] truncate",children:v.description}),e.jsx(he,{children:e.jsx(dt,{variant:"outline",children:v.category||(v.type==="income"?"Receita":"Despesa")})}),e.jsx(he,{className:"max-w-[150px] truncate",children:v.patient?.name||"-"}),e.jsxs(he,{className:`text-right font-semibold ${v.type==="income"?"text-green-600":"text-red-600"}`,children:[v.type==="income"?"+":"-",ve(v.amount)]}),e.jsx(he,{children:e.jsx(dt,{variant:zs[v.status]||"default",children:$s[v.status]||v.status})}),e.jsx(he,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[v.type==="income"&&v.status==="paid"&&f&&e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>f(v),className:"h-8 w-8",title:"Gerar Recibo",children:e.jsx(Rs,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>h(v),className:"h-8 w-8",title:"Editar",children:e.jsx(Ft,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>n(v.id),className:"h-8 w-8 text-destructive hover:text-destructive",title:"Excluir",children:e.jsx(Ct,{className:"h-4 w-4"})})]})})]},v.id))})]})})]})]})}const Ls=[{value:"consulta",label:"Consulta"},{value:"plano_mensal",label:"Plano Mensal"},{value:"outros",label:"Outros"}],qs=[{value:"aluguel",label:"Aluguel"},{value:"marketing",label:"Marketing"},{value:"software",label:"Software"},{value:"outros",label:"Outros"}],Bs=[{value:"pix",label:"PIX"},{value:"credit",label:"Cartão de Crédito"},{value:"debit",label:"Cartão de Débito"},{value:"cash",label:"Dinheiro"},{value:"transfer",label:"Transferência Bancária"},{value:"other",label:"Outro"}];function Vs({open:o,onOpenChange:u,transaction:h,patients:n=[],services:f=[],nutritionistId:_,onSave:b}){const{toast:d}=st(),[r,l]=N.useState({type:"income",category:"",patient_id:"none",service_id:"none",description:"",amount:"",transaction_date:Y(new Date,"yyyy-MM-dd"),isPaid:!0,due_date:"",isInstallment:!1,installments:2,payment_method:"pix",fee_percentage:"",attachment_file:null,attachment_url:null}),[C,L]=N.useState(!1);N.useEffect(()=>{l(h?{type:h.type||"income",category:h.category||"",patient_id:h.patient_id||"none",service_id:"none",description:h.description||"",amount:h.amount?.toString()||"",transaction_date:h.transaction_date?Y(new Date(h.transaction_date+"T00:00:00"),"yyyy-MM-dd"):Y(new Date,"yyyy-MM-dd"),isPaid:h.status==="paid",due_date:h.due_date?Y(new Date(h.due_date+"T00:00:00"),"yyyy-MM-dd"):"",isInstallment:!1,installments:2,payment_method:h.payment_method||"pix",fee_percentage:h.fee_percentage?.toString()||"",attachment_file:null,attachment_url:h.attachment_url||null}:{type:"income",category:"",patient_id:"none",service_id:"none",description:"",amount:"",transaction_date:Y(new Date,"yyyy-MM-dd"),isPaid:!0,due_date:"",isInstallment:!1,installments:2,payment_method:"pix",fee_percentage:"",attachment_file:null,attachment_url:null})},[h,o]);const O=N.useMemo(()=>{const a=parseFloat(r.amount)||0,c=parseFloat(r.fee_percentage)||0;if(a===0)return 0;if((r.payment_method==="credit"||r.payment_method==="debit")&&c>0){const y=a*c/100;return a-y}return a},[r.amount,r.fee_percentage,r.payment_method]),v=a=>{const c=a.target.files?.[0];if(c){if(c.size>10*1024*1024){d({title:"Erro",description:"O arquivo deve ter no máximo 10MB.",variant:"destructive"});return}l(y=>({...y,attachment_file:c}))}},z=()=>{l(a=>({...a,attachment_file:null,attachment_url:null}))},X=async()=>{if(!r.attachment_file||!_)return null;L(!0);try{const a=r.attachment_file.name.split(".").pop(),c=`${_}/${Date.now()}_${Math.random().toString(36).substring(7)}.${a}`,{error:y}=await ze.storage.from("financial-docs").upload(c,r.attachment_file,{cacheControl:"3600",upsert:!1});if(y)throw y;const{data:{publicUrl:t}}=ze.storage.from("financial-docs").getPublicUrl(c);return t}catch(a){return console.error("Error uploading attachment:",a),d({title:"Erro",description:"Não foi possível fazer upload do arquivo.",variant:"destructive"}),null}finally{L(!1)}},se=a=>{l(c=>({...c,type:a,category:"",patient_id:a==="expense"?"none":c.patient_id||"none",service_id:a==="expense"?"none":c.service_id||"none",isInstallment:a==="expense"?c.isInstallment:!1}))},oe=a=>{if(!a||a==="none"){l(y=>({...y,service_id:"none",amount:"",description:""}));return}const c=f.find(y=>y.id.toString()===a);c&&l(y=>({...y,service_id:a,amount:c.price.toString(),description:c.name,category:c.category||y.category}))},ce=async a=>{if(a.preventDefault(),!r.description||!r.amount||!r.category)return;let c=r.attachment_url;if(r.attachment_file&&(c=await X(),!c&&r.attachment_file&&d({title:"Aviso",description:"Salvando sem anexo. Tente fazer upload novamente depois.",variant:"default"})),h?.id){const y={id:h.id,type:r.type,category:r.category,patient_id:r.type==="income"&&r.patient_id&&r.patient_id!=="none"&&r.patient_id!==""?r.patient_id:null,description:r.description,amount:parseFloat(r.amount),transaction_date:r.transaction_date,status:r.isPaid?"paid":"pending",due_date:!r.isPaid&&r.due_date?r.due_date:null,payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:c};b(y);return}if(r.type==="expense"&&r.isInstallment&&r.installments>1){const t=parseFloat(r.amount)/r.installments,s=$e(r.transaction_date+"T00:00:00"),i=[];for(let m=0;m<r.installments;m++){const p=Zt(s,m);i.push({type:"expense",category:r.category,description:`${r.description} (${m+1}/${r.installments})`,amount:t,transaction_date:Y(p,"yyyy-MM-dd"),status:m===0&&r.isPaid?"paid":"pending",due_date:Y(p,"yyyy-MM-dd"),payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:m===0?c:null})}b({multiple:!0,transactions:i})}else{const y={type:r.type,category:r.category,patient_id:r.type==="income"&&r.patient_id&&r.patient_id!=="none"&&r.patient_id!==""?r.patient_id:null,description:r.description,amount:parseFloat(r.amount),transaction_date:r.transaction_date,status:r.isPaid?"paid":"pending",due_date:!r.isPaid&&r.due_date?r.due_date:null,payment_method:r.payment_method,fee_percentage:r.fee_percentage?parseFloat(r.fee_percentage):null,attachment_url:c};b(y)}},le=r.type==="income"?Ls:qs,B=r.isInstallment&&r.amount?(parseFloat(r.amount)/r.installments).toFixed(2):"0.00";return e.jsx(Be,{open:o,onOpenChange:u,children:e.jsxs(Ve,{className:"w-[calc(100vw-2rem)] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsx(He,{children:h?"Editar Transação":"Nova Transação"})}),e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Tipo de Transação"}),e.jsx(St,{value:r.type,onValueChange:se,className:"mt-2",children:e.jsxs(kt,{className:"grid w-full grid-cols-2",children:[e.jsx(et,{value:"income",children:"Receita"}),e.jsx(et,{value:"expense",children:"Despesa"})]})})]}),r.type==="income"&&!h&&f.length>0&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"service_id",children:"Serviço (opcional)"}),e.jsxs(be,{value:r.service_id||"none",onValueChange:oe,children:[e.jsx(_e,{children:e.jsx(we,{placeholder:"Selecione um serviço para preencher automaticamente"})}),e.jsxs(Ce,{children:[e.jsx(re,{value:"none",children:"Nenhum"}),f.map(a=>e.jsxs(re,{value:a.id.toString(),children:[a.name," - ",ve(a.price)]},a.id))]})]})]}),e.jsxs("div",{children:[e.jsxs(Q,{htmlFor:"category",children:["Categoria ",r.type==="income"?"da Receita":"da Despesa"," *"]}),e.jsxs(be,{required:!0,value:r.category,onValueChange:a=>l(c=>({...c,category:a})),children:[e.jsx(_e,{children:e.jsx(we,{placeholder:"Selecione uma categoria"})}),e.jsx(Ce,{children:le.map(a=>e.jsx(re,{value:a.value,children:a.label},a.value))})]})]}),r.type==="income"&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"patient_id",children:"Paciente (opcional)"}),e.jsxs(be,{value:r.patient_id||"none",onValueChange:a=>l(c=>({...c,patient_id:a==="none"?"":a})),children:[e.jsx(_e,{children:e.jsx(we,{placeholder:"Selecione um paciente"})}),e.jsxs(Ce,{children:[e.jsx(re,{value:"none",children:"Nenhum"}),n.map(a=>e.jsx(re,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"description",children:"Descrição *"}),e.jsx(Ne,{id:"description",required:!0,value:r.description,onChange:a=>l(c=>({...c,description:a.target.value})),placeholder:"Ex: Consulta com João Silva"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"amount",children:"Valor Total (R$) *"}),e.jsx(Ne,{id:"amount",type:"number",step:"0.01",min:"0",required:!0,value:r.amount,onChange:a=>l(c=>({...c,amount:a.target.value})),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"transaction_date",children:"Data *"}),e.jsx(ct,{id:"transaction_date",required:!0,value:r.transaction_date,onChange:a=>l(c=>({...c,transaction_date:a}))})]})]}),r.type==="expense"&&!h&&e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Q,{htmlFor:"isInstallment",children:"Parcelado?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dividir esta despesa em múltiplas parcelas"})]}),e.jsx(yt,{id:"isInstallment",checked:r.isInstallment,onCheckedChange:a=>l(c=>({...c,isInstallment:a}))})]}),r.type==="expense"&&r.isInstallment&&!h&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"installments",children:"Número de Parcelas *"}),e.jsxs(be,{value:r.installments.toString(),onValueChange:a=>l(c=>({...c,installments:parseInt(a)})),children:[e.jsx(_e,{children:e.jsx(we,{})}),e.jsx(Ce,{children:[2,3,4,5,6,7,8,9,10,11,12].map(a=>e.jsxs(re,{value:a.toString(),children:[a,"x"]},a))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{children:"Valor por Parcela"}),e.jsx("div",{className:"h-10 flex items-center text-lg font-semibold text-primary",children:ve(parseFloat(B))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(Q,{htmlFor:"isPaid",children:"Já foi pago?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.isInstallment?"Marque se a primeira parcela já foi paga":"Marque se o pagamento já foi realizado"})]}),e.jsx(yt,{id:"isPaid",checked:r.isPaid,onCheckedChange:a=>l(c=>({...c,isPaid:a}))})]}),!r.isPaid&&!r.isInstallment&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"due_date",children:"Data de Vencimento *"}),e.jsx(ct,{id:"due_date",required:!r.isPaid,value:r.due_date,onChange:a=>l(c=>({...c,due_date:a})),min:r.transaction_date})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"payment_method",children:"Método de Pagamento"}),e.jsxs(be,{value:r.payment_method,onValueChange:a=>l(c=>({...c,payment_method:a,fee_percentage:a==="credit"||a==="debit"?c.fee_percentage:""})),children:[e.jsx(_e,{children:e.jsx(we,{placeholder:"Selecione o método de pagamento"})}),e.jsx(Ce,{children:Bs.map(a=>e.jsx(re,{value:a.value,children:a.label},a.value))})]})]}),(r.payment_method==="credit"||r.payment_method==="debit")&&e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"fee_percentage",children:"Taxa (%)"}),e.jsx(Ne,{id:"fee_percentage",type:"number",step:"0.01",min:"0",max:"100",value:r.fee_percentage,onChange:a=>l(c=>({...c,fee_percentage:a.target.value})),placeholder:"Ex: 2.5"}),r.amount&&r.fee_percentage&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Valor Líquido Estimado: ",e.jsx("span",{className:"font-semibold text-primary",children:ve(O)})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"attachment",children:"Anexar Comprovante/NF (opcional)"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[r.attachment_file?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-sm truncate",children:r.attachment_file.name}),e.jsx(J,{type:"button",variant:"ghost",size:"icon",onClick:z,className:"h-8 w-8",children:e.jsx(lt,{className:"w-4 h-4"})})]}):r.attachment_url?e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("a",{href:r.attachment_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-sm text-primary hover:underline truncate",children:"Ver anexo existente"}),e.jsx(J,{type:"button",variant:"ghost",size:"icon",onClick:z,className:"h-8 w-8",children:e.jsx(lt,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ne,{id:"attachment",type:"file",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:v,className:"flex-1",disabled:C})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Formatos aceitos: PDF, JPG, PNG, DOC, DOCX (máx. 10MB)"})]})]}),e.jsxs(ut,{children:[e.jsx(J,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(J,{type:"submit",children:h?"Atualizar":"Salvar"})]})]})]})})}const wt=[{value:"consulta",label:"Consulta"},{value:"plano_mensal",label:"Plano Mensal"},{value:"outros",label:"Outros"}];function Us({open:o,onOpenChange:u,nutritionistId:h}){const{toast:n}=st(),[f,_]=N.useState([]),[b,d]=N.useState(!0),[r,l]=N.useState(!1),[C,L]=N.useState(null),[O,v]=N.useState(null),[z,X]=N.useState({name:"",description:"",price:"",category:"consulta"});N.useEffect(()=>{o&&h&&se()},[o,h]);const se=async()=>{if(h){d(!0);try{const a=await ht(h);_(a)}catch{n({title:"Erro",description:"Não foi possível carregar os serviços.",variant:"destructive"})}finally{d(!1)}}},oe=()=>{L(null),X({name:"",description:"",price:"",category:"consulta"}),l(!0)},ce=a=>{L(a),X({name:a.name,description:a.description||"",price:a.price.toString(),category:a.category||"consulta"}),l(!0)},le=async a=>{if(a.preventDefault(),!z.name||!z.price){n({title:"Erro",description:"Preencha todos os campos obrigatórios.",variant:"destructive"});return}try{await es({id:C?.id,nutritionist_id:h,name:z.name,description:z.description,price:parseFloat(z.price),category:z.category}),n({title:"Sucesso!",description:`Serviço ${C?"atualizado":"criado"} com sucesso.`}),l(!1),L(null),se()}catch(c){n({title:"Erro",description:Le(c,"Não foi possível salvar o serviço."),variant:"destructive"})}},B=async a=>{try{await ts(a),n({title:"Sucesso!",description:"Serviço excluído com sucesso."}),v(null),se()}catch{n({title:"Erro",description:"Não foi possível excluir o serviço.",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsx(Be,{open:o,onOpenChange:u,children:e.jsxs(Ve,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsx(He,{children:"Gerenciar Serviços"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(J,{onClick:oe,children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Novo Serviço"]})}),b?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando serviços..."}):f.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:'Nenhum serviço cadastrado. Clique em "Novo Serviço" para começar.'}):e.jsx(xe,{children:e.jsx(ge,{className:"p-0",children:e.jsxs(Et,{children:[e.jsx(Dt,{children:e.jsxs(tt,{children:[e.jsx(de,{children:"Nome"}),e.jsx(de,{children:"Descrição"}),e.jsx(de,{children:"Categoria"}),e.jsx(de,{className:"text-right",children:"Preço"}),e.jsx(de,{className:"text-right",children:"Ações"})]})}),e.jsx(Rt,{children:f.map(a=>e.jsxs(tt,{children:[e.jsx(he,{className:"font-medium",children:a.name}),e.jsx(he,{className:"max-w-[300px] truncate",children:a.description||"-"}),e.jsx(he,{children:wt.find(c=>c.value===a.category)?.label||a.category}),e.jsx(he,{className:"text-right font-semibold",children:ve(a.price)}),e.jsx(he,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>ce(a),className:"h-8 w-8",children:e.jsx(Ft,{className:"h-4 w-4"})}),e.jsx(J,{variant:"ghost",size:"icon",onClick:()=>v(a.id),className:"h-8 w-8 text-destructive hover:text-destructive",children:e.jsx(Ct,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]})]})}),e.jsx(Be,{open:r,onOpenChange:l,children:e.jsxs(Ve,{children:[e.jsx(Ue,{children:e.jsx(He,{children:C?"Editar Serviço":"Novo Serviço"})}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"name",children:"Nome do Serviço *"}),e.jsx(Ne,{id:"name",required:!0,value:z.name,onChange:a=>X(c=>({...c,name:a.target.value})),placeholder:"Ex: Consulta Individual"})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"description",children:"Descrição"}),e.jsx(Ne,{id:"description",value:z.description,onChange:a=>X(c=>({...c,description:a.target.value})),placeholder:"Descrição opcional do serviço"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"category",children:"Categoria *"}),e.jsxs(be,{required:!0,value:z.category,onValueChange:a=>X(c=>({...c,category:a})),children:[e.jsx(_e,{children:e.jsx(we,{})}),e.jsx(Ce,{children:wt.map(a=>e.jsx(re,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"price",children:"Preço (R$) *"}),e.jsx(Ne,{id:"price",type:"number",step:"0.01",min:"0",required:!0,value:z.price,onChange:a=>X(c=>({...c,price:a.target.value})),placeholder:"0.00"})]})]}),e.jsxs(ut,{children:[e.jsx(J,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancelar"}),e.jsx(J,{type:"submit",children:C?"Atualizar":"Salvar"})]})]})]})}),e.jsx(We,{open:!!O,onOpenChange:a=>!a&&v(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Je,{children:"Confirmar Exclusão"}),e.jsx(Xe,{children:"Tem certeza que deseja excluir este serviço? Esta ação não pode ser desfeita."})]}),e.jsxs(Qe,{children:[e.jsx(Ye,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>B(O),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function Hs({nutritionistId:o,onUpdate:u}){const{toast:h}=st(),[n,f]=N.useState([]),[_,b]=N.useState(!0),[d,r]=N.useState(null),[l,C]=N.useState(null),[L,O]=N.useState(null),[v,z]=N.useState("");N.useEffect(()=>{o&&X()},[o]);const X=async()=>{if(o){b(!0);try{const a=await ss(o);f(a)}catch(a){console.error("Error loading pending payments:",a),h({title:"Erro",description:"Não foi possível carregar os pagamentos pendentes.",variant:"destructive"})}finally{b(!1)}}},se=async a=>{try{await as(a,"paid"),h({title:"Sucesso!",description:"Pagamento confirmado com sucesso."}),r(null),X(),u&&u()}catch{h({title:"Erro",description:"Não foi possível confirmar o pagamento.",variant:"destructive"})}},oe=async a=>{try{await Tt(a),h({title:"Sucesso!",description:"Pagamento cancelado e removido."}),C(null),X(),u&&u()}catch{h({title:"Erro",description:"Não foi possível cancelar o pagamento.",variant:"destructive"})}},ce=async a=>{if(!v){h({title:"Erro",description:"Selecione uma data para reagendar.",variant:"destructive"});return}try{await rs(a,v),h({title:"Sucesso!",description:"Cobrança reagendada com sucesso."}),O(null),z(""),X(),u&&u()}catch{h({title:"Erro",description:"Não foi possível reagendar a cobrança.",variant:"destructive"})}},le=a=>{const c=$e(a+"T00:00:00");return fs(c)?"Hoje":xs(c)?"Ontem":Y(c,"dd 'de' MMMM",{locale:Ee})},B=a=>{const c=$e(a+"T00:00:00"),y=new Date;y.setHours(0,0,0,0);const t=new Date(c);t.setHours(0,0,0,0);const s=y-t;return Math.floor(s/(1e3*60*60*24))};return _||n.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs(xe,{className:"mb-6 border-2 border-orange-200 dark:border-orange-800 bg-orange-50/50 dark:bg-orange-950/20 overflow-hidden",children:[e.jsxs(Se,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Nt,{className:"w-5 h-5 text-orange-600 dark:text-orange-400 shrink-0"}),e.jsx(ke,{className:"text-base md:text-lg font-semibold text-orange-900 dark:text-orange-100 break-words",children:"Pagamentos Pendentes"})]}),e.jsx(Oe,{className:"text-orange-700 dark:text-orange-300 text-xs md:text-sm",children:"Consultas realizadas aguardando confirmação de pagamento"})]}),e.jsx(ge,{children:e.jsx("div",{className:"space-y-3",children:n.map(a=>{const c=B(a.transaction_date),y=c>0;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 p-4 bg-white dark:bg-gray-900 rounded-lg border border-orange-200 dark:border-orange-800 shadow-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-sm sm:text-base text-foreground truncate",children:a.description||`Consulta com ${a.patient?.name||"Paciente"}`}),y&&e.jsxs(dt,{variant:"destructive",className:"text-xs",children:[c," ",c===1?"dia":"dias"," atrasado"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm text-muted-foreground",children:[e.jsx("span",{children:a.patient?.name||"Paciente não identificado"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:le(a.transaction_date)}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"font-semibold text-orange-600 dark:text-orange-400",children:ve(a.amount)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[e.jsxs(J,{size:"sm",onClick:()=>r(a.id),className:"flex-1 sm:flex-initial bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ms,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Confirmar Pagamento"}),e.jsx("span",{className:"sm:hidden",children:"Confirmar"})]}),e.jsxs(J,{size:"sm",variant:"outline",onClick:()=>O({id:a.id,date:a.transaction_date}),className:"flex-1 sm:flex-initial",children:[e.jsx(ps,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Reagendar"}),e.jsx("span",{className:"sm:hidden",children:"Reagendar"})]}),e.jsxs(J,{size:"sm",variant:"outline",onClick:()=>C(a.id),className:"flex-1 sm:flex-initial text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(Fs,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Cancelar"}),e.jsx("span",{className:"sm:hidden",children:"Cancelar"})]})]})]},a.id)})})})]}),e.jsx(We,{open:!!d,onOpenChange:a=>!a&&r(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Je,{children:"Confirmar Pagamento"}),e.jsx(Xe,{children:"Tem certeza que deseja confirmar este pagamento? Esta ação marcará a transação como paga."})]}),e.jsxs(Qe,{children:[e.jsx(Ye,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>se(d),className:"bg-green-600 hover:bg-green-700",children:"Confirmar Pagamento"})]})]})}),e.jsx(We,{open:!!l,onOpenChange:a=>!a&&C(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Je,{children:"Cancelar Pagamento"}),e.jsx(Xe,{children:"Tem certeza que deseja cancelar este pagamento? Esta ação removerá a transação permanentemente."})]}),e.jsxs(Qe,{children:[e.jsx(Ye,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>oe(l),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Cancelar Pagamento"})]})]})}),e.jsx(Be,{open:!!L,onOpenChange:a=>!a&&O(null),children:e.jsxs(Ve,{children:[e.jsx(Ue,{children:e.jsx(He,{children:"Reagendar Cobrança"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(Q,{htmlFor:"reschedule_date",children:"Nova Data *"}),e.jsx(ct,{id:"reschedule_date",required:!0,value:v||(L?L.date:""),onChange:a=>z(a),min:Y(new Date,"yyyy-MM-dd")})]})}),e.jsxs(ut,{children:[e.jsx(J,{variant:"outline",onClick:()=>O(null),children:"Cancelar"}),e.jsx(J,{onClick:()=>ce(L.id),children:"Reagendar"})]})]})})]})}function Ws({nutritionistId:o}){const[u,h]=N.useState([]),[n,f]=N.useState(!0);N.useEffect(()=>{o&&_()},[o]);const _=async()=>{if(o){f(!0);try{const{data:r,error:l}=await ze.from("financial_transactions").select(`
                    patient_id,
                    amount,
                    patient:user_profiles!financial_transactions_patient_id_fkey(
                        id,
                        name,
                        avatar_url,
                        cpf
                    )
                `).eq("nutritionist_id",o).eq("type","income").eq("status","paid").not("patient_id","is",null);if(l){console.error("Error loading top patients:",l);return}const C={};r.forEach(O=>{if(!O.patient_id)return;const v=O.patient_id;C[v]||(C[v]={patient:O.patient,total:0}),C[v].total+=parseFloat(O.amount||0)});const L=Object.values(C).sort((O,v)=>v.total-O.total).slice(0,3);h(L)}catch(r){console.error("Error loading top patients:",r)}finally{f(!1)}}},b=r=>{if(!r)return"?";const l=r.trim().split(" ");return l.length>=2?(l[0][0]+l[l.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()},d=r=>r===0?{icon:Pe,color:"text-yellow-600",bgColor:"bg-yellow-50 dark:bg-yellow-950",borderColor:"border-yellow-300 dark:border-yellow-700",label:"1º"}:r===1?{icon:Ds,color:"text-gray-400",bgColor:"bg-gray-50 dark:bg-gray-950",borderColor:"border-gray-300 dark:border-gray-700",label:"2º"}:r===2?{icon:ys,color:"text-amber-700",bgColor:"bg-amber-50 dark:bg-amber-950",borderColor:"border-amber-300 dark:border-amber-700",label:"3º"}:{icon:Pe,color:"text-muted-foreground",bgColor:"bg-muted",borderColor:"border-border",label:`${r+1}º`};return n?e.jsxs(xe,{children:[e.jsx(Se,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Top Pacientes"]})}),e.jsx(ge,{children:e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Carregando..."})})]}):u.length===0?e.jsxs(xe,{children:[e.jsxs(Se,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Top Pacientes"]}),e.jsx(Oe,{children:"Maiores contribuidores (LTV)"})]}),e.jsx(ge,{children:e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhum dado disponível"})})]}):e.jsxs(xe,{children:[e.jsxs(Se,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-yellow-600"}),"Top 3 Pacientes"]}),e.jsx(Oe,{children:"Maiores contribuidores (LTV)"})]}),e.jsx(ge,{children:e.jsx("div",{className:"space-y-3",children:u.map((r,l)=>{const C=d(l),L=C.icon;return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border-2 ${C.bgColor} ${C.borderColor} hover:shadow-md transition-all`,children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${C.bgColor} ${C.borderColor} border-2 flex items-center justify-center`,children:e.jsx(L,{className:`w-5 h-5 ${C.color}`})}),e.jsxs(gs,{className:"h-10 w-10 flex-shrink-0",children:[e.jsx(js,{src:r.patient?.avatar_url,alt:r.patient?.name}),e.jsx(vs,{children:b(r.patient?.name)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-xs font-bold ${C.color}`,children:C.label}),e.jsx("p",{className:"font-semibold text-sm truncate",children:r.patient?.name||"Paciente não identificado"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total investido"})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:e.jsx("p",{className:`font-bold text-lg ${C.color}`,children:ve(r.total)})})]},r.patient?.id||l)})})})]})}function Ks(o){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o||0)}async function Gs(o,u,h){const n=new _s("p","mm","a4"),f=n.internal.pageSize.getWidth(),_=n.internal.pageSize.getHeight(),b=20;let d=b;const r=[41,128,185],l=[51,51,51];if(n.setFillColor(...r),n.rect(0,0,f,40,"F"),n.setTextColor(255,255,255),n.setFontSize(20),n.setFont("helvetica","bold"),n.text("RECIBO",f/2,20,{align:"center"}),n.setFontSize(10),n.setFont("helvetica","normal"),n.text("Gerado por HipoZero",f/2,28,{align:"center"}),d=50,n.setTextColor(...l),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("PRESTADOR DE SERVIÇOS",b,d),d+=8,n.setFontSize(10),n.setFont("helvetica","normal"),u?.name&&(n.text(`Nome: ${u.name}`,b,d),d+=6),u?.crn&&(n.text(`CRN: ${u.crn}`,b,d),d+=6),u?.address){const B=u.address;let a="";B.street&&(a+=B.street),B.city&&(a+=a?`, ${B.city}`:B.city),B.state&&(a+=a?` - ${B.state}`:B.state),B.zip&&(a+=a?`, CEP: ${B.zip}`:`CEP: ${B.zip}`),a&&(n.text(`Endereço: ${a}`,b,d),d+=6)}u?.phone&&(n.text(`Telefone: ${u.phone}`,b,d),d+=6),u?.email&&(n.text(`E-mail: ${u.email}`,b,d),d+=6),d+=5,n.setDrawColor(200,200,200),n.line(b,d,f-b,d),d+=10,n.setFontSize(12),n.setFont("helvetica","bold"),n.text("RECIBO DE PAGAMENTO",f/2,d,{align:"center"}),d+=10,n.setFontSize(10),n.setFont("helvetica","normal");const C=h?.name||"Paciente",L=h?.cpf?` (CPF: ${Js(h.cpf)})`:"",O=parseFloat(o.amount||0),v=Ks(O).replace("R$","").trim(),z=o.description||"Serviço de nutrição",X=o.transaction_date?Y(new Date(o.transaction_date+"T00:00:00"),"dd 'de' MMMM 'de' yyyy",{locale:Ee}):Y(new Date,"dd 'de' MMMM 'de' yyyy",{locale:Ee}),se=`Recebi de ${C}${L} a importância de ${v} (${Xs(O)}) referente a ${z}.`,oe=f-b*2;n.splitTextToSize(se,oe).forEach((B,a)=>{n.text(B,b,d),d+=6}),d+=10,n.text(`Data: ${X}`,b,d),d+=15,n.setDrawColor(150,150,150),n.line(b,d,f-b,d),d+=8,n.setFontSize(9),n.setTextColor(150,150,150),n.text("Assinatura do Prestador de Serviços",f/2,d,{align:"center"}),d=_-20,n.setFontSize(8),n.setTextColor(150,150,150),n.text("Este documento foi gerado automaticamente pelo sistema HipoZero",f/2,d,{align:"center"}),n.text("Para fins de comprovação fiscal e reembolso de planos de saúde",f/2,d+5,{align:"center"});const le=`recibo_${C.replace(/\s+/g,"_")}_${Y(new Date,"yyyy-MM-dd")}.pdf`;n.save(le)}function Js(o){if(!o)return"";const u=o.replace(/\D/g,"");return u.length!==11?o:u.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}function Xs(o){const u=["","um","dois","três","quatro","cinco","seis","sete","oito","nove","dez","onze","doze","treze","quatorze","quinze","dezesseis","dezessete","dezoito","dezenove"],h=["","","vinte","trinta","quarenta","cinquenta","sessenta","setenta","oitenta","noventa"],n=["","cento","duzentos","trezentos","quatrocentos","quinhentos","seiscentos","setecentos","oitocentos","novecentos"];if(o===0)return"zero reais";if(o>=1e6)return"valor muito alto";let f="";const _=Math.floor(o),b=Math.round((o-_)*100);return _>0&&(f+=Ae(_,u,h,n),f+=_===1?" real":" reais"),b>0&&(f&&(f+=" e "),f+=Ae(b,u,h,n),f+=b===1?" centavo":" centavos"),f}function Ae(o,u,h,n){if(o===0)return"";if(o<20)return u[o];if(o<100){const f=Math.floor(o/10),_=o%10;return h[f]+(_>0?" e "+u[_]:"")}if(o<1e3){const f=Math.floor(o/100),_=o%100;return f===1&&_===0?"cem":n[f]+(_>0?" e "+Ae(_,u,h,n):"")}if(o<1e6){const f=Math.floor(o/1e3),_=o%1e3;return Ae(f,u,h,n)+" mil"+(_>0?" e "+Ae(_,u,h,n):"")}return""}function Qs(o,u="csv"){if(!o||o.length===0)throw new Error("Nenhum registro para exportar");const h=o.map(n=>({Data:n.transaction_date?u(new Date(n.transaction_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee}):"-",Tipo:n.type==="income"?"Receita":"Despesa",Categoria:n.category||"-",Descrição:n.description||"-","Nome do Paciente":n.patient?.name||"-","CPF do Paciente":n.patient?.cpf?Ys(n.patient.cpf):"-","Valor (R$)":parseFloat(n.amount||0).toFixed(2),Status:Zs(n.status),"Data de Vencimento":n.due_date?u(new Date(n.due_date+"T00:00:00"),"dd/MM/yyyy",{locale:Ee}):"-"}));if(u==="csv"){const n=Pt.unparse(h,{delimiter:";",encoding:"UTF-8"}),f="\uFEFF",_=new Blob([f+n],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),d=URL.createObjectURL(_);b.setAttribute("href",d),b.setAttribute("download",`relatorio_financeiro_${u(new Date,"yyyy-MM-dd")}.csv`),document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(d)}else throw new Error(`Formato ${u} não suportado. Use 'csv'.`)}function Ys(o){if(!o)return"";const u=o.replace(/\D/g,"");return u.length!==11?o:u.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}function Zs(o){return{paid:"Pago",pending:"Pendente",overdue:"Vencido"}[o]||o}function Ha(){const{user:o}=Ot(),{toast:u}=st(),[h,n]=N.useState(new Date),[f,_]=N.useState({income:0,expenses:0,netResult:0,overdue:0}),[b,d]=N.useState([]),[r,l]=N.useState([]),[C,L]=N.useState([]),[O,v]=N.useState([]),[z,X]=N.useState([]),[se,oe]=N.useState([]),[ce,le]=N.useState(!0),[B,a]=N.useState(!1),[c,y]=N.useState(!1),[t,s]=N.useState(null),[i,m]=N.useState(null),[p,R]=N.useState({type:null,status:null,search:null}),[$,ne]=N.useState(1e4);N.useEffect(()=>{o?.id&&ws(o.id).then(x=>{x.monthlyFinancialGoal&&ne(x.monthlyFinancialGoal)}).catch(console.error)},[o?.id]);const Z=N.useCallback(async()=>{if(o?.id){le(!0);try{const x=Ss(h),I=await ns(x,o.id);_(I);const S=h.getFullYear(),E=h.getMonth()+1,A=await is(o.id,{...p,month:E,year:S},{page:1,pageSize:100},{field:"transaction_date",order:"desc"});d(A.data);const[g,U,G]=await Promise.all([os(o.id,x,"day"),ls(o.id,x),cs(o.id,new Date)]);if(v(g),X(U),oe(G),r.length===0){const P=await ds(o.id);l(P)}if(C.length===0){const P=await ht(o.id);L(P)}}catch(x){console.error("Error loading financial data:",x),u({title:"Erro",description:"Não foi possível carregar os dados financeiros.",variant:"destructive"})}finally{le(!1)}}},[o,h,p,r.length,u]);N.useEffect(()=>{Z()},[Z]);const F=()=>{s(null),a(!0)},V=x=>{s(x),a(!0)},w=async x=>{try{if(!o?.id)return;if(x.multiple&&x.transactions){const I=x.transactions.map(S=>({...S,nutritionist_id:o.id}));await hs(I),u({title:"Sucesso!",description:`${x.transactions.length} parcelas criadas com sucesso.`})}else await us({...x,nutritionist_id:o.id}),u({title:"Sucesso!",description:`Transação ${x.id?"atualizada":"criada"} com sucesso.`});a(!1),s(null),Z()}catch(I){console.error("Error saving transaction:",I),u({title:"Erro",description:Le(I,"Não foi possível salvar a transação."),variant:"destructive"})}},ee=async x=>{try{await Tt(x),u({title:"Sucesso!",description:"Transação deletada com sucesso."}),m(null),Z()}catch(I){console.error("Error deleting transaction:",I),u({title:"Erro",description:"Não foi possível deletar a transação.",variant:"destructive"})}},k=()=>{const x=b.map(g=>({Data:Y(new Date(g.transaction_date+"T00:00:00"),"dd/MM/yyyy"),Tipo:g.type==="income"?"Receita":"Despesa",Descrição:g.description,Categoria:g.category||"-",Paciente:g.patient?.name||"-",Valor:g.amount.toFixed(2),Status:g.status==="paid"?"Pago":g.status==="pending"?"Pendente":"Vencido"})),I=Pt.unparse(x),S=new Blob([I],{type:"text/csv;charset=utf-8;"}),E=document.createElement("a"),A=URL.createObjectURL(S);E.setAttribute("href",A),E.setAttribute("download",`financeiro_hipozero_${Y(h,"yyyy-MM")}.csv`),document.body.appendChild(E),E.click(),document.body.removeChild(E),u({title:"Exportado!",description:"Arquivo CSV baixado com sucesso."})},T=()=>{try{Qs(b,"csv"),u({title:"Exportado!",description:"Relatório completo exportado para contador."})}catch(x){console.error("Error exporting report:",x),u({title:"Erro",description:Le(x,"Não foi possível exportar o relatório."),variant:"destructive"})}},j=async x=>{if(o?.id)try{const{data:I,error:S}=await ze.from("user_profiles").select("name, crn, address, phone, email").eq("id",o.id).single();if(S)throw new Error("Não foi possível carregar os dados do nutricionista.");let E=null;if(x.patient_id){const{data:A,error:g}=await ze.from("user_profiles").select("name, cpf").eq("id",x.patient_id).single();!g&&A&&(E=A)}await Gs(x,I,E),u({title:"Sucesso!",description:"Recibo gerado e baixado com sucesso."})}catch(I){console.error("Error generating receipt:",I),u({title:"Erro",description:Le(I,"Não foi possível gerar o recibo."),variant:"destructive"})}},K=()=>{try{bs(b,f,Y(h,"MMMM yyyy")),u({title:"Exportado!",description:"Arquivo PDF gerado com sucesso."})}catch(x){console.error("Error exporting PDF:",x),u({title:"Erro",description:"Não foi possível gerar o PDF.",variant:"destructive"})}},H=N.useMemo(()=>$<=0?0:Math.min(f.income/$*100,100),[f.income,$]);return e.jsxs("div",{className:"min-h-screen bg-background overflow-x-hidden",children:[e.jsx("main",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 min-w-0 overflow-x-hidden",children:e.jsxs(zt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold break-words",children:"Financeiro"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm md:text-base",children:"Gerencie receitas, despesas e acompanhe o fluxo de caixa"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(J,{onClick:()=>y(!0),variant:"outline",size:"lg",children:[e.jsx($t,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Gerenciar Serviços"}),e.jsx("span",{className:"sm:hidden",children:"Serviços"})]}),e.jsxs(It,{children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(J,{variant:"outline",size:"lg",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar"}),e.jsx("span",{className:"sm:hidden",children:"Exportar"}),e.jsx(qt,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(Bt,{align:"end",children:[e.jsxs(rt,{onClick:K,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),e.jsxs(rt,{onClick:k,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Exportar CSV"]}),e.jsxs(rt,{onClick:T,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),"Relatório Completo (CSV)"]})]})]}),e.jsxs(J,{onClick:F,size:"lg",children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"}),"Nova Transação"]})]})]}),e.jsx(Hs,{nutritionistId:o?.id,onUpdate:Z}),e.jsx("div",{className:"mb-6",children:e.jsx(Vt,{value:Y(h,"yyyy-MM"),onChange:x=>x&&n(new Date(x+"-02")),className:"w-full sm:w-auto"})}),e.jsx("div",{className:"mb-4",children:e.jsx(xe,{className:"border-2 overflow-hidden",children:e.jsx(ge,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("span",{className:"text-sm font-semibold break-words",children:"Meta Financeira Mensal"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Receita Atual: "}),e.jsxs("span",{className:"font-semibold text-primary break-all",children:["R$ ",f.income.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Meta: "}),e.jsxs("span",{className:"font-semibold break-all",children:["R$ ",$.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"min-w-0",children:e.jsx("span",{className:`font-semibold break-all ${$-f.income>0?"text-orange-600":"text-green-600"}`,children:$-f.income>0?`Faltam R$ ${Math.max(0,$-f.income).toLocaleString("pt-BR",{minimumFractionDigits:2})}`:`Superou em R$ ${Math.abs($-f.income).toLocaleString("pt-BR",{minimumFractionDigits:2})}`})})]})]}),e.jsxs("div",{className:"flex-1 w-full sm:w-auto sm:min-w-[200px]",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progresso"}),e.jsxs("span",{className:"font-semibold",children:[H.toFixed(1),"%"]})]}),e.jsx(Ut,{value:H,className:"h-2"})]})]})})})}),e.jsx("div",{className:"mb-6",children:e.jsx(As,{summary:f,loading:ce})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:e.jsx(Os,{cashFlowData:O,expenseDistribution:z,projectedCashFlow:se,loading:ce})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6 mb-6",children:[e.jsx("div",{className:"lg:col-span-7",children:e.jsx(Is,{transactions:b,loading:ce,onEdit:V,onDelete:x=>m(x),onGenerateReceipt:j,filters:p,onFiltersChange:R})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Ws,{nutritionistId:o?.id})})]})]})}),e.jsx(Vs,{open:B,onOpenChange:a,transaction:t,patients:r,services:C,nutritionistId:o?.id,onSave:w}),e.jsx(Us,{open:c,onOpenChange:x=>{y(x),!x&&o?.id&&ht(o.id).then(L).catch(console.error)},nutritionistId:o?.id}),e.jsx(We,{open:!!i,onOpenChange:x=>!x&&m(null),children:e.jsxs(Ke,{children:[e.jsxs(Ge,{children:[e.jsx(Je,{children:"Confirmar Exclusão"}),e.jsx(Xe,{children:"Tem certeza que deseja excluir esta transação? Esta ação não pode ser desfeita."})]}),e.jsxs(Qe,{children:[e.jsx(Ye,{children:"Cancelar"}),e.jsx(Ze,{onClick:()=>ee(i),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}export{Ha as default};
