import{q as Cs,a as Is,r as j,j as e,C as pe,c as he,d as fe,w as we,e as ge,B as L,L as it,X as Ls,s as os,T as Fs,F as es,V as se,am as ot,a5 as nt,b as lt,u as ct,J as dt,K as mt,M as ut,N as xt,ad as pt,O as ht}from"./index-BvWB-6Y-.js";import{A as Fe,a as Pe}from"./alert-BZscs13a.js";import{B as Y}from"./badge-CCK5Bs0D.js";import{S as cs,a as ds,b as ms,c as us,d as ae}from"./select-CHitR1r5.js";import{I as ee}from"./input-OBodSLFw.js";import{D as ft}from"./date-input-NufpG6-F.js";import{L as q}from"./label-Dds-NHUC.js";import{T as gt}from"./textarea-DCWQIVw9.js";import{T as bt,a as jt,b as Xe,c as Ye}from"./tabs-CA5k0aJI.js";import{g as vt,a as Nt,b as yt,c as wt,d as _t,e as Ps,f as kt}from"./anthropometry-queries-6h0yDXkz.js";import{U as Ct}from"./upload-r4K88bxr.js";import{A as ns}from"./alert-circle-HzKGSyQg.js";import{C as Te}from"./calculator-CBQEutXX.js";import{R as Es}from"./ruler-CYjLqm7s.js";import{S as St}from"./save-BW9rbxWl.js";import{d as At}from"./differenceInYears-DWhJUupZ.js";import{T as Ft,a as Pt,b as Ms,c as _e,d as Et,e as ke}from"./table-C34wbah6.js";import{E as Os}from"./eye-D-rBLbjZ.js";import{M as vs}from"./minus-Doq1nRnQ.js";import{T as qs}from"./trending-up-DCN4wKoA.js";import{T as Ks}from"./trending-down-Be-17Tpn.js";import{W as Mt}from"./WeightChart-C9_DDYkp.js";import{S as Ds,a as Ot,f as js,L as Ue,b as Dt,A as $t,i as is,c as Tt,d as Vs,E as Rt,g as ls,e as Bt,h as zt,C as It,j as Re,k as Lt,u as qt,G as Kt,l as Ws,m as $s,n as Gs,o as Hs,B as Vt,R as xs,T as ps,p as Ns,q as Ee}from"./generateCategoricalChart-DYL0xZdm.js";import{A as Xs}from"./Area-BDkzEYBk.js";import{L as Je,a as Wt}from"./LineChart-BKiejqo7.js";import{X as Be,Y as ze}from"./YAxis-C8erclLc.js";import{C as hs}from"./CartesianGrid-BW0W2W8P.js";import{p as ys}from"./pt-BR-BMtVLtF7.js";import{g as Gt}from"./goals-queries-C9WNr4yF.js";import{g as Ht}from"./anamnesis-queries-CYDtzKhB.js";import{E as Xt}from"./jspdf.es.min-B7ZBL3OL.js";import{A as Yt}from"./arrow-left-c5Ho3YFj.js";import{R as Ut,B as Jt}from"./refresh-cw-DBLq2CV4.js";import"./extends-CF3RwP-h.js";import"./calendar-rgGv7qqU.js";import"./endOfMonth-Ca9QmV5D.js";import"./addMonths-hOFFPW3g.js";import"./isSameDay-CSO39H9U.js";import"./chevron-left-FDyjizdT.js";import"./popover-BK70NwGK.js";import"./parseISO-DtrTOw4I.js";import"./query-helpers-mbysFH2_.js";import"./patient-queries-DNM8Wnzg.js";import"./mealTranslations-B1KHhmEq.js";import"./lab-results-queries-B3ZMjFH4.js";import"./date-C2sroe8F.js";import"./observability-queries-BxbsnaqH.js";import"./compareAsc-BbDmGHdd.js";const Ts=Cs("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Rs=Cs("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Zt=Cs("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);function Qt({recordId:s,initialPhotos:t=[],onPhotosChange:o}){const{toast:r}=Is(),[c,m]=j.useState(t||[]),[u,_]=j.useState(!1),h=!s||s.toString().startsWith("temp-"),a=async v=>{const b=v.target.files?.[0];if(b){if(h){r({title:"Atenção",description:"Salve o registro primeiro antes de adicionar fotos.",variant:"destructive"}),v.target.value="";return}if(!b.type.startsWith("image/")){r({title:"Erro",description:"Por favor, selecione um arquivo de imagem.",variant:"destructive"});return}if(b.size>5*1024*1024){r({title:"Erro",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}_(!0);try{const y=b.name.split(".").pop(),n=`${s}-${Date.now()}.${y}`,x=`${s}/${n}`,{error:N}=await os.storage.from("patient-photos").upload(x,b,{cacheControl:"3600",upsert:!1});if(N)throw console.error("Erro no upload:",N),N;const{data:{publicUrl:E}}=os.storage.from("patient-photos").getPublicUrl(x),S=[...c,E];m(S),o&&o(S),r({title:"Sucesso",description:"Foto enviada com sucesso!"})}catch(y){console.error("Erro ao fazer upload da foto:",y),r({title:"Erro",description:"Não foi possível fazer upload da foto. Tente novamente.",variant:"destructive"})}finally{_(!1),v.target.value=""}}},p=async(v,b)=>{try{const y=v.split("/"),n=y.slice(y.indexOf("patient-photos")+1).join("/"),{error:x}=await os.storage.from("patient-photos").remove([n]);x&&console.error("Erro ao deletar foto:",x);const N=c.filter((E,S)=>S!==b);m(N),o&&o(N),r({title:"Sucesso",description:"Foto removida com sucesso!"})}catch(y){console.error("Erro ao deletar foto:",y),r({title:"Erro",description:"Não foi possível remover a foto.",variant:"destructive"})}};return e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ts,{className:"w-5 h-5"}),"Fotos de Progresso"]}),e.jsx(we,{children:"Adicione fotos antes/depois para acompanhar a evolução do paciente"})]}),e.jsxs(ge,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"photo-upload",children:e.jsx(L,{type:"button",variant:"outline",className:"cursor-pointer",disabled:u||h,asChild:!0,children:e.jsx("span",{children:u?e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Adicionar Foto"]})})})}),h&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Salve o registro primeiro"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:a,className:"hidden",disabled:u}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Máximo 5MB por foto"})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map((v,b)=>e.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-border bg-muted",children:[e.jsx("img",{src:v,alt:`Foto ${b+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs(L,{type:"button",variant:"destructive",size:"sm",onClick:()=>p(v,b),className:"opacity-100",children:[e.jsx(Ls,{className:"w-4 h-4 mr-1"}),"Remover"]})})]},b))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center border-2 border-dashed border-muted rounded-lg",children:[e.jsx(Ts,{className:"w-12 h-12 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma foto adicionada ainda"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Clique em "Adicionar Foto" para começar'})]})]})]})}function er(s,t,o){if(!s||!t||s<=0||t<=0)return null;const r=s/t;return o?r>10.9?{size:"Pequena",ratio:r,label:"Pequena"}:r>9.9?{size:"Média",ratio:r,label:"Média"}:{size:"Grande",ratio:r,label:"Grande"}:r>11?{size:"Pequena",ratio:r,label:"Pequena"}:r>10.1?{size:"Média",ratio:r,label:"Média"}:{size:"Grande",ratio:r,label:"Grande"}}function sr(s){const{height:t,weight:o,triceps:r,subscapular:c,suprailiac:m,humerusWidth:u,femurWidth:_,armCirc:h,calfCirc:a}=s;if(!t||!o)return null;let p=null;if(r&&c&&m){const x=r+c+m;p=-.7182+.1451*x-68e-5*x*x+14e-7*x*x*x,p<0&&(p=0)}let v=null;if(t&&u&&_&&h&&a){const x=t/100,N=h-(r||0)/10,E=a-(c||0)/10;v=.858*u+.601*_+.188*N+.161*E-x*.131+4.5,v<0&&(v=0)}let b=null;if(t&&o){const N=t/100/Math.pow(o,1/3);N>=.462?b=.732*N-28.58:N>=.231?b=.463*N-5.5:b=.1,b<0&&(b=0)}if(p===null||v===null||b===null)return null;const y=b-p,n=2*v-(p+b);return{endo:parseFloat(p.toFixed(2)),meso:parseFloat(v.toFixed(2)),ecto:parseFloat(b.toFixed(2)),x:parseFloat(y.toFixed(2)),y:parseFloat(n.toFixed(2))}}function ws(s,t,o){if(!s||!t||!o)return"Incompleto";const r=Math.max(s,t,o);return r===s?t>o?"Endomorfo-Mesomorfo":"Endomorfo":r===t?s>o?"Mesomorfo-Endomorfo":o>s?"Mesomorfo-Ectomorfo":"Mesomorfo":t>s?"Ectomorfo-Mesomorfo":"Ectomorfo"}const tr=({patientId:s,initialData:t=null,onSubmit:o,onCancel:r,loading:c=!1,patientGender:m=null,patientBirthDate:u=null})=>{const[_,h]=j.useState("basico"),[a,p]=j.useState({weight:"",height:"",record_date:new Date().toISOString().split("T")[0],notes:"",circumferences:{ombro:"",peito:"",cintura:"",abdomen:"",quadril:"",braco_relaxado_e:"",braco_relaxado_d:"",braco_contraido_e:"",braco_contraido_d:"",coxa_proximal_e:"",coxa_proximal_d:"",coxa_medial_e:"",coxa_medial_d:"",panturrilha_e:"",panturrilha_d:""},skinfolds:{triceps:"",biceps:"",subescapular:"",suprailiaca:"",abdominal:"",coxa:"",panturrilha:"",peito:"",axilar:""},bone_diameters:{punho:"",femur:"",umero:""},bioimpedance:{percent_gordura:"",percent_massa_magra:"",gordura_visceral:""},photos:[]}),[v,b]=j.useState(null),[y,n]=j.useState(null),[x,N]=j.useState(null),[E,S]=j.useState(null),[A,z]=j.useState(null),[C,ie]=j.useState({}),[M,ye]=j.useState("pollock7"),[oe,je]=j.useState(null),[be,ve]=j.useState(null),[ne,F]=j.useState(null);j.useEffect(()=>{(async()=>{if(!t&&s){const{data:w}=await vt(s);w&&b(w)}})()},[s,t]),j.useEffect(()=>{t&&p({weight:t.weight||"",height:t.height||"",record_date:t.record_date||new Date().toISOString().split("T")[0],notes:t.notes||"",circumferences:t.circumferences||a.circumferences,skinfolds:t.skinfolds||a.skinfolds,bone_diameters:t.bone_diameters||{punho:"",femur:"",umero:""},bioimpedance:t.bioimpedance||a.bioimpedance,photos:t.photos||[]})},[t]),j.useEffect(()=>{const{weight:l,height:w}=a;if(l&&w){const k=parseFloat(w)/100,D=parseFloat(l)/Math.pow(k,2);n(D);const U=18.5*Math.pow(k,2),R=24.9*Math.pow(k,2);N({min:U,max:R,current:parseFloat(l)})}else n(null),N(null)},[a.weight,a.height]),j.useEffect(()=>{const{cintura:l,quadril:w}=a.circumferences;if(l&&w){const k=parseFloat(l)/parseFloat(w);S(k)}else S(null)},[a.circumferences.cintura,a.circumferences.quadril]),j.useEffect(()=>{const l=parseFloat(a.weight),w=parseFloat(a.height),k=u?At(new Date,new Date(u)):null,D=m?.toLowerCase()||"",U=D.includes("m")||D==="masculino"||D==="male";if(!l||!w){je(null),z(null);return}let R=null,W=null,G=null,B=null;if(M==="bioimpedance"&&a.bioimpedance?.percent_gordura)W=parseFloat(a.bioimpedance.percent_gordura);else if(M==="pollock3"){const T=parseFloat(a.skinfolds.triceps),le=parseFloat(a.skinfolds.subescapular),Ne=parseFloat(a.skinfolds.suprailiaca);if(T&&le&&Ne&&k){const re=T+le+Ne;U?R=1.10938-8267e-7*re+16e-7*re*re-2574e-7*k:R=1.0994921-9929e-7*re+23e-7*re*re-1392e-7*k}}else if(M==="pollock7"){const T=parseFloat(a.skinfolds.peito),le=parseFloat(a.skinfolds.axilar),Ne=parseFloat(a.skinfolds.triceps),re=parseFloat(a.skinfolds.subescapular),De=parseFloat(a.skinfolds.abdominal),Ae=parseFloat(a.skinfolds.suprailiaca),H=parseFloat(a.skinfolds.coxa);if(T&&le&&Ne&&re&&De&&Ae&&H&&k){const K=T+le+Ne+re+De+Ae+H;U?R=1.112-43499e-8*K+55e-8*K*K-28826e-8*k:R=1.097-46971e-8*K+56e-8*K*K-12828e-8*k}}else if(M==="weltman"){const T=parseFloat(a.skinfolds.triceps),le=parseFloat(a.skinfolds.biceps),Ne=parseFloat(a.skinfolds.subescapular),re=parseFloat(a.skinfolds.suprailiaca);if(T&&le&&Ne&&re&&k){const De=T+le+Ne+re,Ae=Math.log10(De);U?R=1.1714-.0671*Ae:R=1.1665-.0706*Ae}}R&&R>0&&(W=(4.95/R-4.5)*100),W&&W>0&&W<100?(G=l*W/100,B=l-G,je({body_density:R,body_fat_percent:W,fat_mass_kg:G,lean_mass_kg:B,protocol:M}),z(W)):(je(null),z(null))},[a.weight,a.height,a.skinfolds,a.bioimpedance,M,m,u]),j.useEffect(()=>{const l=parseFloat(a.height),w=parseFloat(a.bone_diameters?.punho),k=m?.toLowerCase()||"",D=k.includes("m")||k==="masculino"||k==="male";if(l&&w){const U=er(l,w,D);ve(U)}else ve(null)},[a.height,a.bone_diameters?.punho,m]),j.useEffect(()=>{const l=parseFloat(a.height),w=parseFloat(a.weight),k=parseFloat(a.skinfolds.triceps),D=parseFloat(a.skinfolds.subescapular),U=parseFloat(a.skinfolds.suprailiaca),R=parseFloat(a.bone_diameters?.umero),W=parseFloat(a.bone_diameters?.femur),G=a.circumferences.braco_contraido_e||a.circumferences.braco_contraido_d,B=a.circumferences.panturrilha_e||a.circumferences.panturrilha_d,T=m?.toLowerCase()||"";if(T.includes("m"),l&&w){const le=sr({height:l,weight:w,triceps:k,subscapular:D,suprailiac:U,humerusWidth:R,femurWidth:W,armCirc:parseFloat(G),calfCirc:parseFloat(B)});F(le)}else F(null)},[a.height,a.weight,a.skinfolds.triceps,a.skinfolds.subescapular,a.skinfolds.suprailiaca,a.bone_diameters?.umero,a.bone_diameters?.femur,a.circumferences.braco_contraido_e,a.circumferences.braco_contraido_d,a.circumferences.panturrilha_e,a.circumferences.panturrilha_d,m]);const qe=l=>{const{name:w,value:k}=l.target;p(D=>({...D,[w]:k})),C[w]&&ie(D=>({...D,[w]:null}))},te=(l,w,k)=>{p(D=>({...D,[l]:{...D[l],[w]:k}}))},Oe=l=>{p(w=>({...w,photos:l}))},Ke=()=>{const l={},w=a.weight&&parseFloat(a.weight)>0,k=a.height&&parseFloat(a.height)>0,D=Object.values(a.circumferences||{}).some(T=>T&&T!==""),U=Object.values(a.skinfolds||{}).some(T=>T&&T!==""),R=Object.values(a.bone_diameters||{}).some(T=>T&&T!==""),W=Object.values(a.bioimpedance||{}).some(T=>T&&T!==""),G=Array.isArray(a.photos)&&a.photos.length>0;return a.record_date||(l.record_date="Data é obrigatória"),(w&&!k||!w&&k)&&(l.weight="Para seção básica, preencha peso e altura juntos",l.height="Para seção básica, preencha peso e altura juntos"),w&&k||D||U||R||W||G||(l.form="Preencha ao menos uma seção (básico, circunferências, dobras, diâmetros ou fotos)."),ie(l),Object.keys(l).length===0},Ve=l=>{if(l.preventDefault(),!Ke())return;const w=Object.fromEntries(Object.entries(a.circumferences).filter(([G,B])=>B&&B!=="")),k=Object.fromEntries(Object.entries(a.skinfolds).filter(([G,B])=>B&&B!=="")),D=Object.fromEntries(Object.entries(a.bioimpedance).filter(([G,B])=>B&&B!=="")),U=a.weight&&parseFloat(a.weight)>0?parseFloat(a.weight):null,R=a.height&&parseFloat(a.height)>0?parseFloat(a.height):null,W={patient_id:s,weight:U,height:R,record_date:a.record_date,notes:a.notes.trim()||null,circumferences:Object.keys(w).length>0?w:null,skinfolds:Object.keys(k).length>0?k:null,bone_diameters:Object.keys(a.bone_diameters||{}).filter(G=>a.bone_diameters[G]&&a.bone_diameters[G]!=="").length>0?Object.fromEntries(Object.entries(a.bone_diameters).filter(([G,B])=>B&&B!=="")):null,bioimpedance:Object.keys(D).length>0?D:null,photos:a.photos.length>0?a.photos:null,results:{...oe||{},...be&&{frame_size:be.size,frame_ratio:be.ratio},...ne&&{somatotype:ne}}};o(W,t?.id)},de=()=>{p({weight:"",height:"",record_date:new Date().toISOString().split("T")[0],notes:"",circumferences:{ombro:"",peito:"",cintura:"",abdomen:"",quadril:"",braco_relaxado_e:"",braco_relaxado_d:"",braco_contraido_e:"",braco_contraido_d:"",coxa_proximal_e:"",coxa_proximal_d:"",coxa_medial_e:"",coxa_medial_d:"",panturrilha_e:"",panturrilha_d:""},skinfolds:{triceps:"",biceps:"",subescapular:"",suprailiaca:"",abdominal:"",coxa:"",panturrilha:""},bone_diameters:{punho:"",femur:"",umero:""},bioimpedance:{percent_gordura:"",percent_massa_magra:"",gordura_visceral:""},photos:[]}),ie({}),n(null),N(null),S(null),z(null),r&&r()},Se=l=>l?l<18.5?{label:"Abaixo do peso",color:"text-blue-600"}:l<25?{label:"Peso normal",color:"text-green-600"}:l<30?{label:"Sobrepeso",color:"text-yellow-600"}:{label:"Obesidade",color:"text-red-600"}:null,ts=l=>l?l<.85?{label:"Baixo risco",color:"text-green-600"}:l<.95?{label:"Risco moderado",color:"text-yellow-600"}:{label:"Alto risco",color:"text-red-600"}:null,We=Se(y),V=ts(E);return e.jsxs(pe,{children:[e.jsx(he,{children:e.jsx(fe,{className:"text-lg md:text-xl tracking-wide",style:{wordSpacing:"0.16em"},children:t?"Revisão de Registro":"Registro Antropométrico"})}),e.jsx(ge,{children:e.jsxs("form",{onSubmit:Ve,className:"space-y-6",children:[C.form&&e.jsxs(Fe,{variant:"destructive",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx(Pe,{children:C.form})]}),e.jsx("div",{className:"rounded-md border bg-muted/30 px-3 py-2 text-xs text-muted-foreground",children:"Você pode registrar tudo de uma vez ou apenas as seções avaliadas nesta consulta."}),e.jsxs(bt,{value:_,onValueChange:h,className:"w-full",children:[e.jsxs("div",{className:"md:hidden mb-3",children:[e.jsx(q,{className:"text-xs text-muted-foreground mb-1.5 block",children:"Seção do registro"}),e.jsxs(cs,{value:_,onValueChange:h,children:[e.jsx(ds,{className:"h-10",children:e.jsx(ms,{placeholder:"Selecione uma seção"})}),e.jsxs(us,{children:[e.jsx(ae,{value:"basico",children:"Básico"}),e.jsx(ae,{value:"circunferencias",children:"Circunferências"}),e.jsx(ae,{value:"dobras",children:"Dobras & Composição"}),e.jsx(ae,{value:"diametros",children:"Diâmetros Ósseos"}),e.jsx(ae,{value:"fotos",children:"Fotos"})]})]})]}),e.jsxs(jt,{className:"hidden md:grid w-full md:grid-cols-5 gap-1 h-auto p-1",children:[e.jsx(Xe,{value:"basico",className:"text-sm px-3 py-2 text-center whitespace-nowrap",children:"Básico"}),e.jsx(Xe,{value:"circunferencias",className:"text-sm px-3 py-2 text-center whitespace-nowrap",children:"Circunferências"}),e.jsx(Xe,{value:"dobras",className:"text-sm px-3 py-2 text-center whitespace-nowrap",children:"Dobras & Composição"}),e.jsx(Xe,{value:"diametros",className:"text-sm px-3 py-2 text-center whitespace-nowrap",children:"Diâmetros Ósseos"}),e.jsx(Xe,{value:"fotos",className:"text-sm px-3 py-2 text-center whitespace-nowrap",children:"Fotos"})]}),e.jsxs(Ye,{value:"basico",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(ee,{id:"weight",name:"weight",type:"number",step:"0.1",min:"0",placeholder:v?.weight?`Último: ${v.weight} kg`:"Ex: 70.5",value:a.weight,onChange:qe,className:C.weight?"border-destructive":"",disabled:c}),C.weight&&e.jsx("p",{className:"text-xs text-destructive",children:C.weight})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"height",children:"Altura (cm)"}),e.jsx(ee,{id:"height",name:"height",type:"number",step:"0.1",min:"0",placeholder:v?.height?`Último: ${v.height} cm`:"Ex: 170",value:a.height,onChange:qe,className:C.height?"border-destructive":"",disabled:c}),C.height&&e.jsx("p",{className:"text-xs text-destructive",children:C.height})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:"record_date",children:["Data ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ft,{id:"record_date",name:"record_date",value:a.record_date,onChange:l=>{p(w=>({...w,record_date:l})),C.record_date&&ie(w=>({...w,record_date:null}))},className:C.record_date?"border-destructive":"",disabled:c}),C.record_date&&e.jsx("p",{className:"text-xs text-destructive",children:C.record_date})]})]}),y&&e.jsxs(Fe,{className:"bg-muted/50",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx(Pe,{children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"IMC Calculado:"}),e.jsx("span",{className:"text-lg font-bold",children:y.toFixed(1)}),We&&e.jsx(Y,{variant:"outline",className:We.color,children:We.label})]})})]}),x&&e.jsxs(Fe,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(Te,{className:"h-4 w-4 text-blue-600"}),e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Faixa de Peso Ideal (IMC 18.5-24.9):"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[x.min.toFixed(1)," kg - ",x.max.toFixed(1)," kg"]}),x.current&&e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Peso atual: ",x.current.toFixed(1)," kg",x.current<x.min&&e.jsx("span",{className:"ml-2",children:"(Abaixo do ideal)"}),x.current>x.max&&e.jsx("span",{className:"ml-2",children:"(Acima do ideal)"}),x.current>=x.min&&x.current<=x.max&&e.jsx("span",{className:"ml-2",children:"(Dentro do ideal)"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"notes",children:"Observações (opcional)"}),e.jsx(gt,{id:"notes",name:"notes",rows:3,placeholder:"Adicione observações sobre o registro...",value:a.notes,onChange:qe,disabled:c})]})]}),e.jsx(Ye,{value:"circunferencias",className:"space-y-6 mt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Tronco"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:["ombro","peito","cintura","abdomen","quadril"].map(l=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:`circ_${l}`,children:[l.charAt(0).toUpperCase()+l.slice(1).replace("_"," ")," (cm)"]}),e.jsx(ee,{id:`circ_${l}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[l]||"",onChange:w=>te("circumferences",l,w.target.value),disabled:c})]},l))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Membros (E/D)"}),e.jsx("div",{className:"space-y-4",children:[{key:"braco_relaxado",label:"Braço Relaxado"},{key:"braco_contraido",label:"Braço Contraído"},{key:"coxa_proximal",label:"Coxa Proximal"},{key:"coxa_medial",label:"Coxa Medial"},{key:"panturrilha",label:"Panturrilha"}].map(({key:l,label:w})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(q,{className:"col-span-3 text-xs text-muted-foreground",children:w}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:`circ_${l}_e`,children:"Esquerdo (cm)"}),e.jsx(ee,{id:`circ_${l}_e`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[`${l}_e`]||"",onChange:k=>te("circumferences",`${l}_e`,k.target.value),disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:`circ_${l}_d`,children:"Direito (cm)"}),e.jsx(ee,{id:`circ_${l}_d`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[`${l}_d`]||"",onChange:k=>te("circumferences",`${l}_d`,k.target.value),disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:`circ_${l}_media`,children:"Média (cm)"}),e.jsx(ee,{id:`circ_${l}_media`,type:"number",step:"0.1",disabled:!0,value:a.circumferences[`${l}_e`]&&a.circumferences[`${l}_d`]?((parseFloat(a.circumferences[`${l}_e`])+parseFloat(a.circumferences[`${l}_d`]))/2).toFixed(1):"",className:"bg-muted"})]})]},l))})]}),E&&e.jsxs(Fe,{className:"bg-muted/50",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx(Pe,{children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"RCQ (Relação Cintura-Quadril):"}),e.jsx("span",{className:"text-lg font-bold",children:E.toFixed(2)}),V&&e.jsx(Y,{variant:"outline",className:V.color,children:V.label})]})})]})]})}),e.jsxs(Ye,{value:"dobras",className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"protocol",children:"Protocolo de Cálculo"}),e.jsxs(cs,{value:M,onValueChange:ye,children:[e.jsx(ds,{id:"protocol",children:e.jsx(ms,{placeholder:"Selecione o protocolo"})}),e.jsxs(us,{children:[e.jsx(ae,{value:"pollock3",children:"Pollock 3 Dobras (Tríceps, Subescapular, Suprailíaca)"}),e.jsx(ae,{value:"pollock7",children:"Pollock 7 Dobras (Peito, Axilar, Tríceps, Subescapular, Abdominal, Suprailíaca, Coxa)"}),e.jsx(ae,{value:"weltman",children:"Weltman 4 Dobras (Tríceps, Bíceps, Subescapular, Suprailíaca)"}),e.jsx(ae,{value:"bioimpedance",children:"Bioimpedância (Direto)"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[M==="pollock3"&&"Requer: Tríceps, Subescapular, Suprailíaca, Idade, Gênero",M==="pollock7"&&"Requer: Peito, Axilar, Tríceps, Subescapular, Abdominal, Suprailíaca, Coxa, Idade, Gênero",M==="weltman"&&"Requer: Tríceps, Bíceps, Subescapular, Suprailíaca, Idade, Gênero",M==="bioimpedance"&&"Use os valores de bioimpedância diretamente"]})]}),M!=="bioimpedance"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Zt,{className:"w-4 h-4"}),"Dobras Cutâneas (mm)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[M==="pollock3"&&[{key:"triceps",label:"Tríceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0}].map(({key:l,label:w,required:k})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:`fold_${l}`,children:[w," (mm) ",k&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ee,{id:`fold_${l}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[l]||"",onChange:D=>te("skinfolds",l,D.target.value),disabled:c})]},l)),M==="pollock7"&&[{key:"peito",label:"Peito",required:!0},{key:"axilar",label:"Axilar",required:!0},{key:"triceps",label:"Tríceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"abdominal",label:"Abdominal",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0},{key:"coxa",label:"Coxa",required:!0}].map(({key:l,label:w,required:k})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:`fold_${l}`,children:[w," (mm) ",k&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ee,{id:`fold_${l}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[l]||"",onChange:D=>te("skinfolds",l,D.target.value),disabled:c})]},l)),M==="weltman"&&[{key:"triceps",label:"Tríceps",required:!0},{key:"biceps",label:"Bíceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0}].map(({key:l,label:w,required:k})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:`fold_${l}`,children:[w," (mm) ",k&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ee,{id:`fold_${l}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[l]||"",onChange:D=>te("skinfolds",l,D.target.value),disabled:c})]},l))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Bioimpedância"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(q,{htmlFor:"bio_percent_gordura",children:["% Gordura Corporal ",M==="bioimpedance"&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ee,{id:"bio_percent_gordura",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0.0",value:a.bioimpedance.percent_gordura||"",onChange:l=>te("bioimpedance","percent_gordura",l.target.value),disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"bio_percent_massa_magra",children:"% Massa Magra"}),e.jsx(ee,{id:"bio_percent_massa_magra",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0.0",value:a.bioimpedance.percent_massa_magra||"",onChange:l=>te("bioimpedance","percent_massa_magra",l.target.value),disabled:c})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"bio_gordura_visceral",children:"Gordura Visceral"}),e.jsx(ee,{id:"bio_gordura_visceral",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bioimpedance.gordura_visceral||"",onChange:l=>te("bioimpedance","gordura_visceral",l.target.value),disabled:c})]})]})]}),e.jsxs(pe,{className:"bg-gradient-to-br from-emerald-50 to-blue-50 dark:from-emerald-950/20 dark:to-blue-950/20 border-emerald-200 dark:border-emerald-800",children:[e.jsxs(he,{children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-emerald-600"}),"Resultados Calculados em Tempo Real"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Protocolo: ",M==="pollock3"?"Pollock 3 Dobras":M==="pollock7"?"Pollock 7 Dobras":M==="weltman"?"Weltman 4 Dobras":"Bioimpedância"]})]}),e.jsx(ge,{children:oe?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1 p-3 bg-white/50 dark:bg-black/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Densidade Corporal"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:oe.body_density?.toFixed(4)||"N/A"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"g/cm³"})]}),e.jsxs("div",{className:"space-y-1 p-3 bg-white/50 dark:bg-black/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"% Gordura Corporal"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[oe.body_fat_percent?.toFixed(1)||"N/A","%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Percentual de gordura"})]}),e.jsxs("div",{className:"space-y-1 p-3 bg-white/50 dark:bg-black/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa Gorda"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[oe.fat_mass_kg?.toFixed(1)||"N/A"," kg"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Peso de gordura"})]}),e.jsxs("div",{className:"space-y-1 p-3 bg-white/50 dark:bg-black/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa Magra"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[oe.lean_mass_kg?.toFixed(1)||"N/A"," kg"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Peso sem gordura"})]})]}),e.jsx("div",{className:"pt-4 border-t border-emerald-200 dark:border-emerald-800",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["*Cálculos baseados em ",M==="pollock3"?"Jackson & Pollock (1985) - 3 dobras":M==="pollock7"?"Jackson & Pollock (1985) - 7 dobras":M==="weltman"?"Weltman et al. (1988)":"Bioimpedância direta"," e equação de Siri (1961) para conversão de densidade em % de gordura."]})})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ns,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Preencha os dados necessários para ver os resultados calculados"})]})})]}),!oe&&M!=="bioimpedance"&&e.jsxs(Fe,{className:"bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800",children:[e.jsx(ns,{className:"h-4 w-4 text-amber-600"}),e.jsx(Pe,{children:e.jsx("p",{className:"text-sm text-amber-900 dark:text-amber-100",children:"Preencha todas as dobras cutâneas necessárias para o protocolo selecionado e certifique-se de que o paciente tem idade e gênero cadastrados no perfil."})})]}),ne&&e.jsxs(pe,{className:"bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/20 dark:to-indigo-950/20 border-purple-200 dark:border-purple-800",children:[e.jsxs(he,{children:[e.jsxs(fe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5 text-purple-600"}),"Somatotipo (Heath-Carter)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Classificação da composição corporal"})]}),e.jsx(ge,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 text-center p-4 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Endomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:ne.endo}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gordura relativa"})]}),e.jsxs("div",{className:"space-y-1 text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mesomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:ne.meso}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa muscular/óssea"})]}),e.jsxs("div",{className:"space-y-1 text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ectomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:ne.ecto}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Linearidade"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-purple-200 dark:border-purple-800",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Classificação:"}),e.jsx("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-200",children:ws(ne.endo,ne.meso,ne.ecto)}),e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 mt-2",children:["Coordenadas para Somatochart: X = ",ne.x,", Y = ",ne.y]})]})]})})]})]}),e.jsx(Ye,{value:"diametros",className:"space-y-6 mt-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Es,{className:"w-4 h-4"}),"Diâmetros Ósseos (cm)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"bone_punho",children:"Punho (Estiloide) (cm)"}),e.jsx(ee,{id:"bone_punho",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.punho||"",onChange:l=>te("bone_diameters","punho",l.target.value),disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Medida do processo estilóide do rádio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"bone_femur",children:"Fêmur (Biepicondilar) (cm)"}),e.jsx(ee,{id:"bone_femur",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.femur||"",onChange:l=>te("bone_diameters","femur",l.target.value),disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Largura biepicondilar do fêmur"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"bone_umero",children:"Úmero (Biepicondilar) (cm)"}),e.jsx(ee,{id:"bone_umero",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.umero||"",onChange:l=>te("bone_diameters","umero",l.target.value),disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Largura biepicondilar do úmero"})]})]}),be&&e.jsxs(Fe,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800 mt-4",children:[e.jsx(Te,{className:"h-4 w-4 text-blue-600"}),e.jsx(Pe,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Compleição Óssea (Frame Size):"}),e.jsx("div",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:be.label}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Ratio Altura/Punho: ",be.ratio.toFixed(2)]})]})})]})]})}),e.jsx(Ye,{value:"fotos",className:"mt-4",children:e.jsx(Qt,{recordId:t?.id||`temp-${Date.now()}`,initialPhotos:a.photos,onPhotosChange:Oe})})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4 border-t",children:[e.jsxs(L,{type:"button",variant:"outline",onClick:de,disabled:c,children:[e.jsx(Ls,{className:"w-4 h-4 mr-2"}),t?"Cancelar":"Limpar"]}),e.jsxs(L,{type:"submit",disabled:c,children:[e.jsx(St,{className:"w-4 h-4 mr-2"}),c?"Salvando...":t?"Atualizar":"Salvar"]})]})]})})]})},rr=({records:s=[],onEdit:t,onDelete:o,onView:r,highlightSections:c=[],loading:m=!1})=>{const u=n=>n?n<18.5?{label:"Abaixo do peso",short:"Abaixo",variant:"secondary"}:n<25?{label:"Peso normal",short:"Normal",variant:"success"}:n<30?{label:"Sobrepeso",short:"Sobrepeso",variant:"warning"}:{label:"Obesidade",short:"Obesidade",variant:"destructive"}:{label:"N/A",short:"N/A",variant:"outline"},_=(n,x)=>{if(!x)return null;const N=n-x;return Math.abs(N)<.1?{icon:vs,color:"text-gray-500",text:"Estável"}:N>0?{icon:qs,color:"text-red-500",text:`+${N.toFixed(1)} kg`}:{icon:Ks,color:"text-green-500",text:`${N.toFixed(1)} kg`}},h=n=>{try{return es(new Date(n),"dd/MM/yyyy")}catch{return n}},a=n=>Object.values(n||{}).filter(x=>x!=null&&x!=="").length,p=n=>`${[!!(n?.weight||n?.height),a(n?.circumferences)>0,a(n?.skinfolds)>0||a(n?.bioimpedance)>0,a(n?.bone_diameters)>0,Array.isArray(n?.photos)&&n.photos.length>0].filter(Boolean).length}/5 seções`,v=n=>({basico:!!(n?.weight||n?.height),circunferencias:a(n?.circumferences)>0,dobras:a(n?.skinfolds)>0||a(n?.bioimpedance)>0,diametros:a(n?.bone_diameters)>0,fotos:Array.isArray(n?.photos)&&n.photos.length>0}),b=(n,x)=>n?c.length===0?"bg-primary/15 text-primary border-primary/30":c.includes(x)?"bg-[#5f6f52]/15 text-[#5f6f52] border-[#5f6f52]/30":"bg-muted/40 text-muted-foreground border-border":"bg-muted/30 text-muted-foreground border-border";if(m)return e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"Carregando registros..."});if(s.length===0)return e.jsxs("div",{className:"border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground font-medium",children:"Nenhum registro encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Adicione o primeiro registro usando o formulário acima"})]});const y=(n,x)=>{const N=n.bmi||(n.height?n.weight/Math.pow(n.height/100,2):null),E=u(N),S=x<s.length-1?s[x+1].weight:null,A=_(n.weight,S),z=A?.icon;return e.jsxs("div",{className:"rounded-lg border bg-card p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-foreground whitespace-nowrap",children:h(n.record_date)}),e.jsx(Y,{variant:E.variant,className:"text-[10px] px-1.5 py-0 h-5 whitespace-nowrap",children:E.short})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Peso"}),e.jsxs("p",{className:"text-sm font-semibold",children:[n.weight," kg"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Altura"}),e.jsx("p",{className:"text-sm font-semibold",children:n.height?`${n.height} cm`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"IMC"}),e.jsx("p",{className:"text-sm font-semibold",children:N?N.toFixed(1):"N/A"})]})]}),e.jsx("p",{className:"mt-2 text-[11px] text-muted-foreground",children:p(n)}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:Object.entries(v(n)).map(([C,ie])=>e.jsxs(Y,{variant:"outline",className:`text-[10px] h-5 ${b(ie,C)}`,children:[C==="basico"&&"Básico",C==="circunferencias"&&"Circ.",C==="dobras"&&"Dobras",C==="diametros"&&"Diâm.",C==="fotos"&&"Fotos"]},`${n.id}-${C}`))}),e.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[A?e.jsxs("span",{className:`flex items-center gap-1 ${A.color}`,children:[e.jsx(z,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"text-xs",children:A.text})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sem tendência"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>r?.(n),className:"h-8 w-8 p-0",children:e.jsx(Os,{className:"w-4 h-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>t(n),className:"h-8 w-8 p-0",children:e.jsx(Rs,{className:"w-4 h-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>o(n),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(Fs,{className:"w-4 h-4"})})]})]}),n.notes?e.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-2",children:n.notes}):e.jsx("p",{className:"mt-2 text-[11px] text-muted-foreground italic",children:"Sem observações"})]},n.id)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"md:hidden space-y-2",children:[e.jsx("div",{className:"px-1 text-[11px] font-medium text-muted-foreground uppercase tracking-wide",children:"Histórico de registros"}),e.jsx("div",{className:"space-y-2",children:s.map((n,x)=>y(n,x))})]}),e.jsx("div",{className:"hidden md:block border rounded-lg overflow-hidden",children:e.jsxs(Ft,{children:[e.jsx(Pt,{children:e.jsxs(Ms,{children:[e.jsx(_e,{children:"Data"}),e.jsx(_e,{children:"Peso (kg)"}),e.jsx(_e,{children:"Altura (cm)"}),e.jsx(_e,{children:"IMC"}),e.jsx(_e,{children:"Classificação"}),e.jsx(_e,{children:"Tendência"}),e.jsx(_e,{children:"Observações"}),e.jsx(_e,{className:"text-right",children:"Ações"})]})}),e.jsx(Et,{children:s.map((n,x)=>{const N=n.bmi||(n.height?n.weight/Math.pow(n.height/100,2):null),E=u(N),S=x<s.length-1?s[x+1].weight:null,A=_(n.weight,S),z=A?.icon;return e.jsxs(Ms,{children:[e.jsxs(ke,{className:"font-medium whitespace-nowrap",children:[h(n.record_date),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:p(n)}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:Object.entries(v(n)).map(([C,ie])=>e.jsxs(Y,{variant:"outline",className:`text-[10px] h-5 ${b(ie,C)}`,children:[C==="basico"&&"Básico",C==="circunferencias"&&"Circ.",C==="dobras"&&"Dobras",C==="diametros"&&"Diâm.",C==="fotos"&&"Fotos"]},`${n.id}-${C}`))})]}),e.jsxs(ke,{children:[e.jsx("span",{className:"font-semibold",children:n.weight})," kg"]}),e.jsx(ke,{children:n.height?`${n.height} cm`:"N/A"}),e.jsx(ke,{children:N?e.jsx("span",{className:"font-semibold",children:N.toFixed(1)}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(ke,{children:e.jsx(Y,{variant:E.variant,className:"text-xs",children:E.label})}),e.jsx(ke,{children:A&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:`w-4 h-4 ${A.color}`}),e.jsx("span",{className:`text-sm ${A.color}`,children:A.text})]})}),e.jsx(ke,{className:"max-w-xs",children:n.notes?e.jsx("span",{className:"text-sm text-muted-foreground line-clamp-2",children:n.notes}):e.jsx("span",{className:"text-xs text-muted-foreground italic",children:"Sem observações"})}),e.jsx(ke,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>r?.(n),className:"h-8 w-8 p-0",children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>t(n),className:"h-8 w-8 p-0",children:e.jsx(Rs,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>o(n),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(Fs,{className:"h-4 w-4"})})]})})]},n.id)})})]})})]})};function Ie(s){"@babel/helpers - typeof";return Ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ie(s)}function ar(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function ir(s,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,Js(r.key),r)}}function or(s,t,o){return t&&ir(s.prototype,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function nr(s,t,o){return t=fs(t),lr(s,Ys()?Reflect.construct(t,o||[],fs(s).constructor):t.apply(s,o))}function lr(s,t){if(t&&(Ie(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cr(s)}function cr(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Ys(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ys=function(){return!!s})()}function fs(s){return fs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},fs(s)}function dr(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),t&&_s(s,t)}function _s(s,t){return _s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,c){return r.__proto__=c,r},_s(s,t)}function Us(s,t,o){return t=Js(t),t in s?Object.defineProperty(s,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[t]=o,s}function Js(s){var t=mr(s,"string");return Ie(t)=="symbol"?t:t+""}function mr(s,t){if(Ie(s)!="object"||!s)return s;var o=s[Symbol.toPrimitive];if(o!==void 0){var r=o.call(s,t);if(Ie(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var ss=(function(s){function t(){return ar(this,t),nr(this,t,arguments)}return dr(t,s),or(t,[{key:"render",value:function(){return null}}])})(j.Component);Us(ss,"displayName","ZAxis");Us(ss,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var ur=["option","isActive"];function Ze(){return Ze=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(s[r]=o[r])}return s},Ze.apply(this,arguments)}function xr(s,t){if(s==null)return{};var o=pr(s,t),r,c;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(s);for(c=0;c<m.length;c++)r=m[c],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(o[r]=s[r])}return o}function pr(s,t){if(s==null)return{};var o={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(t.indexOf(r)>=0)continue;o[r]=s[r]}return o}function hr(s){var t=s.option,o=s.isActive,r=xr(s,ur);return typeof t=="string"?j.createElement(Ds,Ze({option:j.createElement(Ot,Ze({type:t},r)),isActive:o,shapeType:"symbols"},r)):j.createElement(Ds,Ze({option:t,isActive:o,shapeType:"symbols"},r))}function Le(s){"@babel/helpers - typeof";return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le(s)}function Qe(){return Qe=Object.assign?Object.assign.bind():function(s){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(s[r]=o[r])}return s},Qe.apply(this,arguments)}function Bs(s,t){var o=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);t&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(s,c).enumerable})),o.push.apply(o,r)}return o}function xe(s){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Bs(Object(o),!0).forEach(function(r){Ce(s,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(o)):Bs(Object(o)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(o,r))})}return s}function fr(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function zs(s,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(s,Qs(r.key),r)}}function gr(s,t,o){return t&&zs(s.prototype,t),o&&zs(s,o),Object.defineProperty(s,"prototype",{writable:!1}),s}function br(s,t,o){return t=gs(t),jr(s,Zs()?Reflect.construct(t,o||[],gs(s).constructor):t.apply(s,o))}function jr(s,t){if(t&&(Le(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vr(s)}function vr(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Zs(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zs=function(){return!!s})()}function gs(s){return gs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},gs(s)}function Nr(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),t&&ks(s,t)}function ks(s,t){return ks=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,c){return r.__proto__=c,r},ks(s,t)}function Ce(s,t,o){return t=Qs(t),t in s?Object.defineProperty(s,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[t]=o,s}function Qs(s){var t=yr(s,"string");return Le(t)=="symbol"?t:t+""}function yr(s,t){if(Le(s)!="object"||!s)return s;var o=s[Symbol.toPrimitive];if(o!==void 0){var r=o.call(s,t);if(Le(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}var Me=(function(s){function t(){var o;fr(this,t);for(var r=arguments.length,c=new Array(r),m=0;m<r;m++)c[m]=arguments[m];return o=br(this,t,[].concat(c)),Ce(o,"state",{isAnimationFinished:!1}),Ce(o,"handleAnimationEnd",function(){o.setState({isAnimationFinished:!0})}),Ce(o,"handleAnimationStart",function(){o.setState({isAnimationFinished:!1})}),Ce(o,"id",qt("recharts-scatter-")),o}return Nr(t,s),gr(t,[{key:"renderSymbolsStatically",value:function(r){var c=this,m=this.props,u=m.shape,_=m.activeShape,h=m.activeIndex,a=js(this.props,!1);return r.map(function(p,v){var b=h===v,y=b?_:u,n=xe(xe({},a),p);return se.createElement(Ue,Qe({className:"recharts-scatter-symbol",key:"symbol-".concat(p?.cx,"-").concat(p?.cy,"-").concat(p?.size,"-").concat(v)},Dt(c.props,p,v),{role:"img"}),se.createElement(hr,Qe({option:y,isActive:b,key:"symbol-".concat(v)},n)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,c=this.props,m=c.points,u=c.isAnimationActive,_=c.animationBegin,h=c.animationDuration,a=c.animationEasing,p=c.animationId,v=this.state.prevPoints;return se.createElement($t,{begin:_,duration:h,isActive:u,easing:a,from:{t:0},to:{t:1},key:"pie-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(b){var y=b.t,n=m.map(function(x,N){var E=v&&v[N];if(E){var S=is(E.cx,x.cx),A=is(E.cy,x.cy),z=is(E.size,x.size);return xe(xe({},x),{},{cx:S(y),cy:A(y),size:z(y)})}var C=is(0,x.size);return xe(xe({},x),{},{size:C(y)})});return se.createElement(Ue,null,r.renderSymbolsStatically(n))})}},{key:"renderSymbols",value:function(){var r=this.props,c=r.points,m=r.isAnimationActive,u=this.state.prevPoints;return m&&c&&c.length&&(!u||!Tt(u,c))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(c)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var c=this.props,m=c.points,u=c.xAxis,_=c.yAxis,h=c.children,a=Vs(h,Rt);return a?a.map(function(p,v){var b=p.props,y=b.direction,n=b.dataKey;return se.cloneElement(p,{key:"".concat(y,"-").concat(n,"-").concat(m[v]),data:m,xAxis:u,yAxis:_,layout:y==="x"?"vertical":"horizontal",dataPointFormatter:function(N,E){return{x:N.cx,y:N.cy,value:y==="x"?+N.node.x:+N.node.y,errorVal:ls(N,E)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,c=r.points,m=r.line,u=r.lineType,_=r.lineJointType,h=js(this.props,!1),a=js(m,!1),p,v;if(u==="joint")p=c.map(function(A){return{x:A.cx,y:A.cy}});else if(u==="fitting"){var b=Bt(c),y=b.xmin,n=b.xmax,x=b.a,N=b.b,E=function(z){return x*z+N};p=[{x:y,y:E(y)},{x:n,y:E(n)}]}var S=xe(xe(xe({},h),{},{fill:"none",stroke:h&&h.fill},a),{},{points:p});return se.isValidElement(m)?v=se.cloneElement(m,S):zt(m)?v=m(S):v=se.createElement(It,Qe({},S,{type:_})),se.createElement(Ue,{className:"recharts-scatter-line",key:"recharts-scatter-line"},v)}},{key:"render",value:function(){var r=this.props,c=r.hide,m=r.points,u=r.line,_=r.className,h=r.xAxis,a=r.yAxis,p=r.left,v=r.top,b=r.width,y=r.height,n=r.id,x=r.isAnimationActive;if(c||!m||!m.length)return null;var N=this.state.isAnimationFinished,E=ot("recharts-scatter",_),S=h&&h.allowDataOverflow,A=a&&a.allowDataOverflow,z=S||A,C=Re(n)?this.id:n;return se.createElement(Ue,{className:E,clipPath:z?"url(#clipPath-".concat(C,")"):null},S||A?se.createElement("defs",null,se.createElement("clipPath",{id:"clipPath-".concat(C)},se.createElement("rect",{x:S?p:p-b/2,y:A?v:v-y/2,width:S?b:b*2,height:A?y:y*2}))):null,u&&this.renderLine(),this.renderErrorBar(),se.createElement(Ue,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!x||N)&&Lt.renderCallByParent(this.props,m))}}],[{key:"getDerivedStateFromProps",value:function(r,c){return r.animationId!==c.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:c.curPoints}:r.points!==c.curPoints?{curPoints:r.points}:null}}])})(j.PureComponent);Ce(Me,"displayName","Scatter");Ce(Me,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Kt.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});Ce(Me,"getComposedData",function(s){var t=s.xAxis,o=s.yAxis,r=s.zAxis,c=s.item,m=s.displayedData,u=s.xAxisTicks,_=s.yAxisTicks,h=s.offset,a=c.props.tooltipType,p=Vs(c.props.children,Ws),v=Re(t.dataKey)?c.props.dataKey:t.dataKey,b=Re(o.dataKey)?c.props.dataKey:o.dataKey,y=r&&r.dataKey,n=r?r.range:ss.defaultProps.range,x=n&&n[0],N=t.scale.bandwidth?t.scale.bandwidth():0,E=o.scale.bandwidth?o.scale.bandwidth():0,S=m.map(function(A,z){var C=ls(A,v),ie=ls(A,b),M=!Re(y)&&ls(A,y)||"-",ye=[{name:Re(t.dataKey)?c.props.name:t.name||t.dataKey,unit:t.unit||"",value:C,payload:A,dataKey:v,type:a},{name:Re(o.dataKey)?c.props.name:o.name||o.dataKey,unit:o.unit||"",value:ie,payload:A,dataKey:b,type:a}];M!=="-"&&ye.push({name:r.name||r.dataKey,unit:r.unit||"",value:M,payload:A,dataKey:y,type:a});var oe=$s({axis:t,ticks:u,bandSize:N,entry:A,index:z,dataKey:v}),je=$s({axis:o,ticks:_,bandSize:E,entry:A,index:z,dataKey:b}),be=M!=="-"?r.scale(M):x,ve=Math.sqrt(Math.max(be,0)/Math.PI);return xe(xe({},A),{},{cx:oe,cy:je,x:oe-ve,y:je-ve,xAxis:t,yAxis:o,zAxis:r,width:2*ve,height:2*ve,size:be,node:{x:C,y:ie,z:M},tooltipPayload:ye,tooltipPosition:{x:oe,y:je},payload:A},p&&p[z]&&p[z].props)});return xe({points:S},h)});var et=Gs({chartName:"ScatterChart",GraphicalChild:Me,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:Be},{axisType:"yAxis",AxisComp:ze},{axisType:"zAxis",AxisComp:ss}],formatAxisMap:Hs}),wr=Gs({chartName:"ComposedChart",GraphicalChild:[Je,Xs,Vt,Me],axisComponents:[{axisType:"xAxis",AxisComp:Be},{axisType:"yAxis",AxisComp:ze},{axisType:"zAxis",AxisComp:ss}],formatAxisMap:Hs});const _r=({data:s=[]})=>{if(s.length===0)return e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Evolução de IMC"}),e.jsx(we,{children:"Acompanhamento do Índice de Massa Corporal"})]}),e.jsx(ge,{children:e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Sem dados para exibir o gráfico"})})]});const t=s.filter(h=>h.bmi||h.calculatedBmi).map(h=>({date:es(new Date(h.record_date),"dd/MM/yy"),fullDate:es(new Date(h.record_date),"dd 'de' MMM",{locale:ys}),bmi:parseFloat((h.bmi||h.calculatedBmi).toFixed(1)),originalDate:h.record_date}));if(t.length===0)return e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Evolução de IMC"}),e.jsx(we,{children:"Acompanhamento do Índice de Massa Corporal"})]}),e.jsx(ge,{children:e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Sem dados suficientes para calcular IMC"})})]});const o=t[0]?.bmi,r=t[t.length-1]?.bmi,c=r-o,m=h=>h<18.5?{label:"Abaixo do peso",variant:"secondary",color:"#3b82f6"}:h<25?{label:"Peso normal",variant:"success",color:"#10b981"}:h<30?{label:"Sobrepeso",variant:"warning",color:"#f59e0b"}:{label:"Obesidade",variant:"destructive",color:"#ef4444"},u=m(r),_=({active:h,payload:a})=>{if(h&&a&&a.length){const p=a[0].value,v=m(p);return e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold",children:a[0].payload.fullDate}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["IMC: ",e.jsx("span",{className:"font-bold text-foreground",children:p})]}),e.jsx(Y,{variant:v.variant,className:"mt-1",children:v.label})]})}return null};return e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(fe,{children:"Evolução de IMC"}),e.jsx(we,{children:"Índice de Massa Corporal ao longo do tempo"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"IMC Atual"}),e.jsx("p",{className:"text-2xl font-bold",children:r}),e.jsx(Y,{variant:u.variant,className:"mt-1",children:u.label})]})]})}),e.jsxs(ge,{children:[e.jsx(xs,{width:"100%",height:300,children:e.jsxs(wr,{data:t,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(hs,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Be,{dataKey:"date",tick:{fontSize:12},className:"text-muted-foreground"}),e.jsx(ze,{domain:[16,35],tick:{fontSize:12},className:"text-muted-foreground",label:{value:"IMC",angle:-90,position:"insideLeft",fontSize:12}}),e.jsx(ps,{content:e.jsx(_,{})}),e.jsx(Ns,{}),e.jsx(Ee,{y:18.5,stroke:"#3b82f6",strokeDasharray:"3 3",label:{value:"Abaixo",position:"insideTopLeft",fontSize:10}}),e.jsx(Ee,{y:25,stroke:"#10b981",strokeDasharray:"3 3",label:{value:"Normal",position:"insideTopLeft",fontSize:10}}),e.jsx(Ee,{y:30,stroke:"#f59e0b",strokeDasharray:"3 3",label:{value:"Sobrepeso",position:"insideTopLeft",fontSize:10}}),e.jsx(Xs,{type:"monotone",dataKey:"bmi",fill:u.color,fillOpacity:.1,stroke:"none"}),e.jsx(Je,{type:"monotone",dataKey:"bmi",name:"IMC",stroke:u.color,strokeWidth:2,dot:{fill:u.color,r:4},activeDot:{r:6}})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Primeiro"}),e.jsx("p",{className:"text-lg font-semibold",children:o})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Atual"}),e.jsx("p",{className:"text-lg font-semibold",children:r})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Variação"}),e.jsxs("p",{className:`text-lg font-semibold ${c>=0?"text-red-600":"text-green-600"}`,children:[c>=0?"+":"",c.toFixed(1)]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-semibold",children:"Classificação IMC:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-500"}),e.jsxs("span",{children:["< 18.5"," Abaixo"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{children:"18.5-25 Normal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500"}),e.jsx("span",{children:"25-30 Sobrepeso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsxs("span",{children:["> 30"," Obesidade"]})]})]})]})]})]})};function kr({data:s=[]}){const t=j.useMemo(()=>!s||s.length===0?[]:s.filter(m=>m.weight&&m.record_date).map(m=>{const u=new Date(m.record_date),_=parseFloat(m.weight)||0,h=m.results||{},a=h.body_fat_percent||null,p=h.lean_mass_kg||null,v=h.fat_mass_kg||null;let b=p,y=v;if(!p&&a)y=_*a/100,b=_-y;else if(!p&&m.bioimpedance?.percent_gordura){const n=parseFloat(m.bioimpedance.percent_gordura);y=_*n/100,b=_-y}return{date:es(u,"dd/MM/yyyy",{locale:ys}),dateValue:u,weight:_.toFixed(1),leanMass:b?b.toFixed(1):null,fatMass:y?y.toFixed(1):null}}).sort((m,u)=>m.dateValue-u.dateValue),[s]);if(t.length===0)return e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Composição Corporal"}),e.jsx(we,{children:"Evolução de peso, massa magra e massa gorda"})]}),e.jsx(ge,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:e.jsx("p",{children:"Nenhum dado disponível para exibir"})})})]});const o=t.some(m=>m.leanMass!==null||m.fatMass!==null),r=j.useMemo(()=>!s||s.length===0?[]:s.filter(m=>m.results?.somatotype).map(m=>{const u=m.results.somatotype,_=new Date(m.record_date);return{date:es(_,"dd/MM/yyyy",{locale:ys}),dateValue:_,x:u.x||u.ecto-u.endo,y:u.y||2*u.meso-(u.endo+u.ecto),endo:u.endo,meso:u.meso,ecto:u.ecto}}).sort((m,u)=>m.dateValue-u.dateValue),[s]),c=r.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Composição Corporal"}),e.jsx(we,{children:"Evolução de peso, massa magra e massa gorda ao longo do tempo"})]}),e.jsxs(ge,{children:[e.jsx(xs,{width:"100%",height:400,children:e.jsxs(Wt,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(hs,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Be,{dataKey:"date",className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},angle:-45,textAnchor:"end",height:80}),e.jsx(ze,{className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},label:{value:"Peso (kg)",angle:-90,position:"insideLeft"}}),e.jsx(ps,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(m,u)=>m===null||m==="null"?["N/A",u]:[`${m} kg`,u]}),e.jsx(Ns,{formatter:m=>({weight:"Peso Total",leanMass:"Massa Magra",fatMass:"Massa Gorda"})[m]||m}),e.jsx(Je,{type:"monotone",dataKey:"weight",stroke:"#ffffff",strokeWidth:2,dot:{fill:"#ffffff",r:4},name:"weight"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{type:"monotone",dataKey:"leanMass",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:4},strokeDasharray:"5 5",name:"leanMass"}),e.jsx(Je,{type:"monotone",dataKey:"fatMass",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:4},strokeDasharray:"5 5",name:"fatMass"})]})]})}),!o&&e.jsx("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:"Preencha dados de composição corporal (dobras cutâneas ou bioimpedância) para visualizar massa magra e massa gorda."})})]})]}),c&&e.jsxs(pe,{children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Somatochart (Heath-Carter)"}),e.jsx(we,{children:"Visualização do somatotipo ao longo do tempo. Cada ponto representa um registro."})]}),e.jsxs(ge,{children:[e.jsx(xs,{width:"100%",height:400,children:e.jsxs(et,{margin:{top:20,right:20,bottom:60,left:60},children:[e.jsx(hs,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Be,{type:"number",dataKey:"x",name:"X",domain:[-8,8],label:{value:"Ectomorfia - Endomorfia",position:"insideBottom",offset:-5},className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(ze,{type:"number",dataKey:"y",name:"Y",domain:[-8,8],label:{value:"2×Mesomorfia - (Endomorfia + Ectomorfia)",angle:-90,position:"insideLeft"},className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(ps,{cursor:{strokeDasharray:"3 3"},contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(m,u,_)=>u==="x"?[`X: ${_.payload.x.toFixed(2)}`,"Coordenada X"]:u==="y"?[`Y: ${_.payload.y.toFixed(2)}`,"Coordenada Y"]:u==="endo"?[`Endo: ${_.payload.endo}`,"Endomorfia"]:u==="meso"?[`Meso: ${_.payload.meso}`,"Mesomorfia"]:u==="ecto"?[`Ecto: ${_.payload.ecto}`,"Ectomorfia"]:[m,u]}),e.jsx(Ns,{}),e.jsx(Ee,{x:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(Ee,{y:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(Me,{name:"Somatotipo",data:r,fill:"#8b5cf6",children:r.map((m,u)=>e.jsx("circle",{cx:m.x,cy:m.y,r:6,fill:"#8b5cf6",stroke:"#fff",strokeWidth:2},u))})]})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{children:"Endomorfia (Gordura)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{children:"Mesomorfia (Músculo)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"Ectomorfia (Linearidade)"})]})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"O gráfico mostra a evolução do somatotipo. Pontos mais à esquerda indicam maior endomorfia, à direita maior ectomorfia, e acima maior mesomorfia."})]})]})]})]})}const Cr=({somatotype:s,className:t=""})=>{if(!s||!s.x||!s.y)return e.jsxs(pe,{className:t,children:[e.jsxs(he,{children:[e.jsx(fe,{className:"text-lg",children:"Somatotipo (Heath-Carter)"}),e.jsx(we,{children:"Gráfico de classificação corporal"})]}),e.jsx(ge,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm",children:"Preencha os dados necessários para calcular o somatotipo"}),e.jsxs("p",{className:"text-xs mt-2 text-muted-foreground",children:["Requer: Altura, Peso, Dobras (Tríceps, Subescapular, Suprailíaca),",e.jsx("br",{}),"Diâmetros Ósseos (Úmero, Fêmur) e Circunferências (Braço, Panturrilha)"]})]})})})]});const o=[{x:s.x,y:s.y}],r=({active:m,payload:u})=>m&&u&&u.length?(u[0].payload,e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:"Somatotipo"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Endomorfia:"})," ",s.endo]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Mesomorfia:"})," ",s.meso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Ectomorfia:"})," ",s.ecto]}),e.jsxs("p",{className:"pt-2 border-t border-border mt-2",children:[e.jsx("span",{className:"font-medium",children:"Classificação:"})," ",ws(s.endo,s.meso,s.ecto)]})]})]})):null,c=()=>{const{endo:m,meso:u,ecto:_}=s,h=Math.max(m,u,_);return h===m?"#ef4444":h===u?"#22c55e":"#3b82f6"};return e.jsxs(pe,{className:t,children:[e.jsxs(he,{children:[e.jsxs(fe,{className:"text-lg flex items-center justify-between",children:[e.jsx("span",{children:"Somatotipo (Heath-Carter)"}),e.jsx(Y,{variant:"outline",className:"ml-2",children:ws(s.endo,s.meso,s.ecto)})]}),e.jsx(we,{children:"Gráfico de classificação corporal baseado no método Heath-Carter (1967)"})]}),e.jsx(ge,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xs,{width:"100%",height:400,children:e.jsxs(et,{margin:{top:20,right:20,bottom:20,left:20},data:o,children:[e.jsx(hs,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(Be,{type:"number",dataKey:"x",name:"X",domain:[-8,8],ticks:[-8,-6,-4,-2,0,2,4,6,8],label:{value:"Ectomorfia - Endomorfia",position:"insideBottom",offset:-10,style:{fontSize:12}},className:"text-muted-foreground"}),e.jsx(ze,{type:"number",dataKey:"y",name:"Y",domain:[-5,10],ticks:[-5,-2.5,0,2.5,5,7.5,10],label:{value:"2×Mesomorfia - (Endomorfia + Ectomorfia)",angle:-90,position:"insideLeft",style:{fontSize:12}},className:"text-muted-foreground"}),e.jsx(ps,{content:e.jsx(r,{})}),e.jsx(Ee,{x:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(Ee,{y:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(Me,{name:"Somatotipo",data:o,fill:c(),children:o.map((m,u)=>e.jsx(Ws,{fill:c()},`cell-${u}`))})]})}),e.jsx("div",{className:"absolute top-4 left-4 text-xs font-semibold text-red-600 dark:text-red-400",children:"Endomorfo"}),e.jsx("div",{className:"absolute top-4 right-4 text-xs font-semibold text-blue-600 dark:text-blue-400",children:"Ectomorfo"}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-green-600 dark:text-green-400",children:"Mesomorfo"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Endomorfia"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:s.endo}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Gordura relativa"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Mesomorfia"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:s.meso}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Massa muscular/óssea"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Ectomorfia"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:s.ecto}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Linearidade"})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center pt-2",children:["Coordenadas: X = ",s.x,", Y = ",s.y]})]})})]})},ya=()=>{const{patientId:s}=nt(),t=lt(),{toast:o}=Is(),{user:r}=ct(),[c,m]=j.useState(!0),[u,_]=j.useState(!1),[h,a]=j.useState([]),[p,v]=j.useState([]),[b,y]=j.useState(null),[n,x]=j.useState(null),[N,E]=j.useState(null),[S,A]=j.useState(null),[z,C]=j.useState(null),[ie,M]=j.useState(""),[ye,oe]=j.useState("maintenance"),[je,be]=j.useState(null),[ve,ne]=j.useState(null),[F,qe]=j.useState(null),[te,Oe]=j.useState(!1),[Ke,Ve]=j.useState(""),[de,Se]=j.useState("all"),[ts,We]=j.useState([]),V=i=>Object.values(i||{}).filter(d=>d!=null&&d!=="").length,l=(i,d,f)=>{const g=String(i||"").toLowerCase();if(["weight_loss","perda_peso","emagrecimento"].includes(g))return"weight_loss";if(["weight_gain","ganho_peso","hipertrofia"].includes(g))return"weight_gain";if(["maintenance","manutencao","manutenção","recomposition","recomposicao"].includes(g))return"maintenance";const O=String(d||"").toLowerCase();if(O.includes("perder")||O.includes("emagrec"))return"weight_loss";if(O.includes("ganhar")||O.includes("hipertrof"))return"weight_gain";if(O.includes("manter")||O.includes("recompos"))return"maintenance";if(f!=null){if(f>=25)return"weight_loss";if(f<18.5)return"weight_gain"}return"maintenance"},w=i=>({basico:!!(i?.weight||i?.height),circunferencias:V(i?.circumferences)>0,dobras:V(i?.skinfolds)>0||V(i?.bioimpedance)>0,diametros:V(i?.bone_diameters)>0,fotos:Array.isArray(i?.photos)&&i.photos.length>0}),k=i=>Object.values(w(i)).filter(Boolean).length,D=(i,d)=>{if(!i||!d)return null;const f=i.height&&i.weight?i.weight/Math.pow(i.height/100,2):null,g=d.height&&d.weight?d.weight/Math.pow(d.height/100,2):null,O=(I,J)=>I==null||J===null||J===void 0?null:Number((I-J).toFixed(2));return{weight:O(i.weight,d.weight),height:O(i.height,d.height),bmi:O(f,g),circumferenceFields:V(i.circumferences)-V(d.circumferences),skinfoldFields:V(i.skinfolds)-V(d.skinfolds),diameterFields:V(i.bone_diameters)-V(d.bone_diameters),photoFields:(i.photos?.length||0)-(d.photos?.length||0)}},U=i=>{if(!i)return null;const d=H.findIndex(f=>f.id===i.id);return d<0?null:H[d+1]||null},R=(i={},d={})=>Array.from(new Set([...Object.keys(i||{}),...Object.keys(d||{})])).map(g=>{const O=i?.[g],I=d?.[g],J=Number(O),X=Number(I),Z=O!=null&&O!=="",ce=I!=null&&I!=="",$=Z&&ce&&Number.isFinite(J)&&Number.isFinite(X)?Number((J-X).toFixed(2)):null;return Z!==ce||String(O??"")!==String(I??"")?{key:g,currentValue:Z?O:"N/A",previousValue:ce?I:"N/A",delta:$}:null}).filter(Boolean),W=i=>{if(!i)return[];const d=[];let f=i;const g=new Set;for(;f&&!g.has(f.id);){g.add(f.id),d.push(f);const O=f?.supersedes_record_id||f?.results?.audit?.source_record_id;if(!O)break;f=h.find(I=>String(I.id)===String(O))}return d.reverse()},G=(i,d,f)=>{if(!i||!d)return null;const g=rs=>{const as=Number(rs);return Number.isFinite(as)?as:null},O=i.height&&i.weight?g(i.weight/Math.pow(i.height/100,2)):null,I=d.height&&d.weight?g(d.weight/Math.pow(d.height/100,2)):null,J=g(i?.results?.body_fat_percent??i?.bioimpedance?.percent_gordura),X=g(d?.results?.body_fat_percent??d?.bioimpedance?.percent_gordura),Z=g((i.weight??0)-(d.weight??0)),ce=O!==null&&I!==null?g(O-I):null,ue=J!==null&&X!==null?g(J-X):null;let $=0;const Q=[];return f==="weight_loss"?(Z!==null&&(Z<-.2?($+=2,Q.push("Redução de peso coerente com objetivo.")):Z>.2&&($-=2,Q.push("Aumento de peso fora do objetivo principal."))),ce!==null&&(ce<-.1?$+=1:ce>.1&&($-=1)),ue!==null&&(ue<-.2?($+=2,Q.push("Percentual de gordura em queda.")):ue>.2&&($-=2,Q.push("Percentual de gordura em alta.")))):f==="weight_gain"?(Z!==null&&(Z>.2?($+=2,Q.push("Ganho de peso compatível com objetivo.")):Z<-.2&&($-=2,Q.push("Perda de peso fora do objetivo principal."))),ue!==null&&(ue<=.2?$+=1:$-=1),ce!==null&&(ce>.1?$+=1:ce<-.1&&($-=1))):(Z!==null&&(Math.abs(Z)<=.5?($+=1,Q.push("Peso estável (boa manutenção).")):$-=1),ue!==null&&(ue<-.2?($+=2,Q.push("Redução de gordura em manutenção/recomposição.")):ue>.2&&($-=1))),{status:$>=2?"improved":$<=-2?"worsened":"stable",score:$,reasons:Q,weightDelta:Z,bmiDelta:ce,fatDelta:ue}},B=j.useCallback(async()=>{m(!0),x(null);try{const{data:i}=await os.from("user_profiles").select("name, gender, birth_date").eq("id",s).single();i&&(C(i),M(i.name||""));const[d,f,g,O,I,J]=await Promise.all([Nt(s,{limit:50}),yt(s),Gt(s),Ht(s,!0),wt(s),_t(s)]);if(d.error)throw console.error("Erro ao buscar registros:",d.error),new Error("Erro ao buscar registros antropométricos");if(f.error)throw console.error("Erro ao buscar dados de gráficos:",f.error),new Error("Erro ao buscar dados de gráficos");a(d.data||[]),v(f.data||[]),be(I.data||null),ne(J.data||null);let X=null;if(d.data&&d.data.length>0)if(X=[...d.data].sort(($,Q)=>{const He=new Date($.record_date||0).getTime(),rs=new Date(Q.record_date||0).getTime();if(He!==rs)return rs-He;const as=Number($.revision_number||1);return Number(Q.revision_number||1)-as})[0],E(X),X.height&&X.weight){const $=parseFloat(X.height)/100,Q=18.5*Math.pow($,2),He=24.9*Math.pow($,2);A({min:Q,max:He,current:parseFloat(X.weight)})}else A(null);else E(null),A(null);const Z=X?.height&&X?.weight?X.weight/Math.pow(X.height/100,2):null,ce=O?.data?.content?.objetivos?.objetivo_principal,ue=g?.data?.goal_type;oe(l(ue,ce,Z))}catch(i){console.error("Erro ao carregar dados:",i);const d=i.message||"Erro ao carregar dados";x(d),o({title:"Erro",description:d,variant:"destructive"})}finally{m(!1)}},[s,o]);j.useEffect(()=>{B()},[B]);const T=async(i,d=null)=>{_(!0);try{let f;if(d?f=await Ps({...i,supersedes_record_id:d,change_reason:"Revisão clínica via módulo de antropometria",created_by_user_id:r?.id||null,results:{...i.results||{},audit:{type:"revision_copy",source_record_id:d,created_at:new Date().toISOString()}}}):f=await Ps(i),f.error)throw f.error;o({title:"Sucesso",description:d?"Nova versão criada com sucesso (registro anterior preservado)":"Registro criado com sucesso",variant:"success"}),y(null),await B()}catch(f){console.error("Erro ao salvar registro:",f),o({title:"Erro",description:f.message||"Não foi possível salvar o registro",variant:"destructive"})}finally{_(!1)}},le=i=>{y(i),window.scrollTo({top:0,behavior:"smooth"})},Ne=i=>{qe(i);const d=H.findIndex(g=>g.id===i.id),f=d>=0?H[d+1]:null;Ve(f?String(f.id):""),Oe(!0)},re=()=>{F&&(Oe(!1),le(F))},De=async i=>{if(window.confirm("Tem certeza que deseja excluir este registro?"))try{const d=await kt(i.id);if(d.error)throw d.error;o({title:"Sucesso",description:"Registro excluído com sucesso",variant:"success"}),await B()}catch(d){console.error("Erro ao deletar registro:",d),o({title:"Erro",description:d.message||"Não foi possível excluir o registro",variant:"destructive"})}},Ae=()=>{y(null)},H=j.useMemo(()=>[...h].sort((i,d)=>{const f=new Date(i.record_date||0).getTime(),g=new Date(d.record_date||0).getTime();if(f!==g)return g-f;const O=Number(i.revision_number||1);return Number(d.revision_number||1)-O}),[h]),K=Ke?H.find(i=>String(i.id)===String(Ke)):null,P=D(F,K),me=j.useMemo(()=>G(F,K,ye),[F,K,ye]),Ge=j.useMemo(()=>!F||!K?null:{circumferences:R(F.circumferences,K.circumferences),skinfolds:R(F.skinfolds,K.skinfolds),bone_diameters:R(F.bone_diameters,K.bone_diameters),bioimpedance:R(F.bioimpedance,K.bioimpedance)},[F,K]),bs=j.useMemo(()=>W(F),[F,H]),$e=(i,d="")=>{if(i==null)return"N/A";const f=Number(i);return`${f>0?"+":""}${f.toFixed(2)}${d?` ${d}`:""}`},Ss=i=>i==="weight_loss"?"Perda de peso":i==="weight_gain"?"Ganho de peso":"Manutenção/Recomposição",st=i=>i==="improved"?"Favorável":i==="worsened"?"Desfavorável":"Estável",tt=i=>i==="improved"?"bg-green-100 text-green-700":i==="worsened"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700",rt=i=>{We(d=>d.includes(i)?d.filter(f=>f!==i):[...d,i])},at=()=>{if(!F||!K||!P)return;const i=new Xt,d="Comparativo Antropométrico",f=ie||`Paciente ${s}`;let g=16;i.setFontSize(16),i.text(d,14,g),g+=8,i.setFontSize(11),i.text(`Paciente: ${f}`,14,g),g+=6,i.text(`Registro atual: ${F.record_date}`,14,g),g+=6,i.text(`Registro comparado: ${K.record_date}`,14,g),g+=8,i.text(`Objetivo clínico: ${Ss(ye)}`,14,g),g+=8;const O=[`Peso: ${$e(P.weight,"kg")}`,`Altura: ${$e(P.height,"cm")}`,`IMC: ${$e(P.bmi)}`,`Fotos: ${P.photoFields>0?`+${P.photoFields}`:P.photoFields}`,`Circunferências (campos): ${P.circumferenceFields>0?`+${P.circumferenceFields}`:P.circumferenceFields}`,`Dobras (campos): ${P.skinfoldFields>0?`+${P.skinfoldFields}`:P.skinfoldFields}`,`Diâmetros (campos): ${P.diameterFields>0?`+${P.diameterFields}`:P.diameterFields}`];me&&(g+=2,i.text(`Indicador clínico: ${me.status==="improved"?"Melhora":me.status==="worsened"?"Piora":"Estável"}`,14,g),g+=6),O.forEach(J=>{i.text(J,14,g),g+=6}),me?.reasons?.length&&(g+=2,i.text("Notas clínicas:",14,g),g+=6,me.reasons.forEach(J=>{i.text(`- ${J}`,14,g),g+=6}));const I=`comparativo_antropometria_${f.replace(/\s+/g,"_")}_${F.record_date}.pdf`;i.save(I)},As=j.useMemo(()=>de==="all"?H:de==="complete"?H.filter(i=>k(i)===5):de==="partial"?H.filter(i=>k(i)>0&&k(i)<5):de==="versioned"?H.filter(i=>i?.supersedes_record_id||i?.results?.audit?.source_record_id):H,[H,de]);return e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>t(`/nutritionist/patients/${s}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(Yt,{className:"w-4 h-4 mr-1"}),"Voltar"]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:B,disabled:c,className:"flex-shrink-0",children:[e.jsx(Ut,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(Jt,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"break-words",children:"Avaliação Antropométrica"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Acompanhamento de peso, altura e IMC"}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2.5",children:[e.jsxs("div",{className:"rounded-md border bg-muted/30 px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:"Objetivo clínico"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:Ss(ye)})]}),N&&N.weight&&e.jsxs("div",{className:"rounded-md border bg-card px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:"Peso atual"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[N.weight," kg"]})]}),S&&e.jsxs("div",{className:"rounded-md border bg-primary/5 border-primary/20 px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:"Faixa de peso ideal"}),e.jsxs("p",{className:"text-sm font-semibold text-[#5f6f52]",children:[S.min.toFixed(1)," - ",S.max.toFixed(1)," kg"]})]}),S?.current&&e.jsxs("div",{className:"rounded-md border bg-card px-3 py-2 shadow-sm",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-muted-foreground",children:"Status atual"}),e.jsx(Y,{className:`text-xs ${S.current<S.min?"bg-blue-100 text-blue-700 hover:bg-blue-100":S.current>S.max?"bg-yellow-100 text-yellow-700 hover:bg-yellow-100":"bg-green-100 text-green-700 hover:bg-green-100"}`,children:S.current<S.min?"Abaixo do ideal":S.current>S.max?"Acima do ideal":"Na faixa ideal"})]})]}),je?.has_data&&e.jsxs("div",{className:"mt-3 rounded-md border bg-card p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground mb-2",children:"Score longitudinal (30/60/90 dias)"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[30,60,90].map(i=>{const d=je?.[`d${i}`];return d?.has_data?e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i," dias"]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx(Y,{className:`text-xs ${tt(d.status)}`,children:st(d.status)}),e.jsxs("span",{className:"text-xs font-semibold",children:["Score ",d.score]})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-1",children:["Delta peso: ",d.weight_delta??"N/A"," kg"]})]},i):e.jsxs("div",{className:"rounded-md border bg-muted/30 p-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i," dias"]}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Sem base"})]},i)})})]}),(ve?.needs_energy_recalc||ve?.needs_meal_plan_review)&&e.jsxs("div",{className:"mt-3 rounded-md border border-amber-200 bg-amber-50 px-3 py-2",children:[e.jsx("p",{className:"text-xs font-semibold text-amber-800",children:"Sincronização clínica pendente"}),e.jsx("p",{className:"text-xs text-amber-700 mt-0.5",children:"Há atualização antropométrica pendente de revisão em GET/Plano alimentar."})]})]})]}),n&&e.jsxs(Fe,{variant:"destructive",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx(Pe,{children:n})]}),e.jsx(tr,{patientId:s,initialData:b,onSubmit:T,onCancel:Ae,loading:u,patientGender:z?.gender,patientBirthDate:z?.birth_date}),e.jsxs("div",{className:"space-y-6",children:[h.some(i=>i.results||i.bioimpedance)&&e.jsx(kr,{data:h}),N?.results?.somatotype&&e.jsx(Cr,{somatotype:N.results.somatotype}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Mt,{data:p}),e.jsx(_r,{data:p})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Histórico de Registros"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-4",children:"Consulte a evolução por data, compare resultados e abra os detalhes completos de cada avaliação."}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"hidden sm:flex flex-wrap gap-2",children:[e.jsx(L,{variant:de==="all"?"default":"outline",size:"sm",onClick:()=>Se("all"),children:"Todos"}),e.jsx(L,{variant:de==="complete"?"default":"outline",size:"sm",onClick:()=>Se("complete"),children:"Completos"}),e.jsx(L,{variant:de==="partial"?"default":"outline",size:"sm",onClick:()=>Se("partial"),children:"Parciais"}),e.jsx(L,{variant:de==="versioned"?"default":"outline",size:"sm",onClick:()=>Se("versioned"),children:"Versões"})]}),e.jsx("div",{className:"sm:hidden",children:e.jsxs(cs,{value:de,onValueChange:Se,children:[e.jsx(ds,{children:e.jsx(ms,{placeholder:"Filtrar histórico"})}),e.jsxs(us,{children:[e.jsx(ae,{value:"all",children:"Todos"}),e.jsx(ae,{value:"complete",children:"Completos"}),e.jsx(ae,{value:"partial",children:"Parciais"}),e.jsx(ae,{value:"versioned",children:"Versões auditáveis"})]})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[As.length," registro(s)"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Destaque de seções no histórico"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[["basico","Básico"],["circunferencias","Circunferências"],["dobras","Dobras"],["diametros","Diâmetros"],["fotos","Fotos"]].map(([i,d])=>{const f=ts.includes(i);return e.jsx(L,{type:"button",size:"sm",variant:f?"default":"outline",className:f?"bg-[#5f6f52] hover:bg-[#4c5a41]":"",onClick:()=>rt(i),children:d},i)})})]}),e.jsx(rr,{records:As,onEdit:le,onView:Ne,onDelete:De,highlightSections:ts,loading:c})]}),e.jsx(dt,{open:te,onOpenChange:Oe,children:e.jsxs(mt,{className:"w-[calc(100vw-2rem)] max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ut,{children:[e.jsx(xt,{children:"Detalhes do Registro"}),e.jsx(pt,{children:"Visualize todos os dados da avaliação, compare com outra data e gere nova versão editada."})]}),F&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Y,{variant:"outline",children:["Data: ",F.record_date]}),(F?.supersedes_record_id||F?.results?.audit?.source_record_id)&&e.jsx(Y,{className:"bg-violet-100 text-violet-700 hover:bg-violet-100",children:"Versão auditável"})]}),bs.length>1&&e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground mb-2",children:"Timeline de versões"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:bs.map((i,d)=>e.jsxs(se.Fragment,{children:[e.jsxs(Y,{variant:i.id===F.id?"default":"outline",className:i.id===F.id?"bg-[#5f6f52] hover:bg-[#5f6f52]":"",children:[d===0?"Original":`V${d}`," • ",i.record_date]}),d<bs.length-1&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"→"})]},i.id))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground mb-2",children:"Seções preenchidas"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(w(F)).map(([i,d])=>e.jsxs(Y,{variant:d?"default":"outline",className:d?"bg-[#5f6f52] hover:bg-[#5f6f52]":"",children:[i==="basico"&&"Básico",i==="circunferencias"&&"Circunferências",i==="dobras"&&"Dobras/Composição",i==="diametros"&&"Diâmetros",i==="fotos"&&"Fotos"]},i))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsx("p",{className:"text-[11px] uppercase text-muted-foreground",children:"Peso"}),e.jsxs("p",{className:"font-semibold",children:[F.weight??"N/A"," ",F.weight?"kg":""]})]}),e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsx("p",{className:"text-[11px] uppercase text-muted-foreground",children:"Altura"}),e.jsxs("p",{className:"font-semibold",children:[F.height??"N/A"," ",F.height?"cm":""]})]}),e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsx("p",{className:"text-[11px] uppercase text-muted-foreground",children:"Circ."}),e.jsxs("p",{className:"font-semibold",children:[V(F.circumferences)," campos"]})]}),e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsx("p",{className:"text-[11px] uppercase text-muted-foreground",children:"Dobras"}),e.jsxs("p",{className:"font-semibold",children:[V(F.skinfolds)," campos"]})]})]}),F.notes&&e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground mb-1",children:"Observações"}),e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:F.notes})]}),e.jsxs("div",{className:"rounded-md border p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Comparar com outro registro"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>{const i=U(F);Ve(i?String(i.id):"")},children:"Comparar com anterior automaticamente"}),e.jsxs(cs,{value:Ke,onValueChange:Ve,children:[e.jsx(ds,{children:e.jsx(ms,{placeholder:"Selecione uma data para comparar"})}),e.jsx(us,{children:H.filter(i=>i.id!==F.id).map(i=>e.jsx(ae,{value:String(i.id),children:i.record_date},i.id))})]})]}),P&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Peso"}),e.jsx("p",{className:`font-semibold ${(P.weight??0)>0?"text-red-600":"text-green-600"}`,children:$e(P.weight,"kg")})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Altura"}),e.jsx("p",{className:"font-semibold",children:$e(P.height,"cm")})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"IMC"}),e.jsx("p",{className:"font-semibold",children:$e(P.bmi)})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Fotos"}),e.jsx("p",{className:"font-semibold",children:P.photoFields>0?`+${P.photoFields}`:P.photoFields})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Circ. (campos)"}),e.jsx("p",{className:"font-semibold",children:P.circumferenceFields>0?`+${P.circumferenceFields}`:P.circumferenceFields})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Dobras (campos)"}),e.jsx("p",{className:"font-semibold",children:P.skinfoldFields>0?`+${P.skinfoldFields}`:P.skinfoldFields})]}),e.jsxs("div",{className:"rounded-md bg-muted/40 p-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Diâmetros (campos)"}),e.jsx("p",{className:"font-semibold",children:P.diameterFields>0?`+${P.diameterFields}`:P.diameterFields})]})]}),me&&e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground mb-2",children:"Indicador clínico (baseado no objetivo do paciente)"}),e.jsx(Y,{className:me.status==="improved"?"bg-green-100 text-green-700 hover:bg-green-100":me.status==="worsened"?"bg-red-100 text-red-700 hover:bg-red-100":"bg-amber-100 text-amber-700 hover:bg-amber-100",children:me.status==="improved"?"Evolução favorável":me.status==="worsened"?"Atenção: evolução desfavorável":"Evolução estável"}),me.reasons?.length>0&&e.jsx("ul",{className:"mt-2 space-y-1",children:me.reasons.map((i,d)=>e.jsxs("li",{className:"text-xs text-muted-foreground",children:["- ",i]},`${i}-${d}`))})]}),Ge&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Comparação campo a campo"}),[["Circunferências",Ge.circumferences],["Dobras",Ge.skinfolds],["Diâmetros",Ge.bone_diameters],["Bioimpedância",Ge.bioimpedance]].map(([i,d])=>e.jsxs("div",{className:"rounded-md border p-2",children:[e.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:i}),d.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Sem mudanças detectadas."}):e.jsxs("div",{className:"space-y-1",children:[d.slice(0,6).map(f=>{const g=f.delta,O=g!==null&&g>0,I=g!==null&&g<0;return e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:f.key}),e.jsxs("span",{className:"font-medium",children:[String(f.previousValue)," → ",String(f.currentValue)]}),g===null?e.jsx(vs,{className:"w-3.5 h-3.5 text-muted-foreground"}):O?e.jsx(qs,{className:"w-3.5 h-3.5 text-red-600"}):I?e.jsx(Ks,{className:"w-3.5 h-3.5 text-green-600"}):e.jsx(vs,{className:"w-3.5 h-3.5 text-muted-foreground"})]},`${i}-${f.key}`)}),d.length>6&&e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["+",d.length-6," mudanças adicionais..."]})]})]},i))]})]})]}),e.jsxs(ht,{children:[e.jsx(L,{variant:"outline",onClick:()=>Oe(!1),children:"Fechar"}),e.jsx(L,{variant:"outline",onClick:at,disabled:!K||!P,children:"Exportar comparativo (PDF)"}),e.jsx(L,{onClick:re,children:"Editar criando nova versão"})]})]})})]})};export{ya as default};
