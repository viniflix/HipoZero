import{u as w,b as E,a as F,r as h,j as e,B as x,m as S,C as z,c as P,d as _,w as L,e as D,L as b,s as A}from"./index-CjuzupBo.js";import{I as i}from"./input-BW5PO48F.js";import{L as r}from"./label-Du8MEY0y.js";import{S as T,a as k,b as I,c as q,d as m}from"./select-zYRSAzvt.js";import{A as B}from"./arrow-left-1D7xGp73.js";import{S as V}from"./save-DQlrm3n5.js";import"./extends-CF3RwP-h.js";function J(){const{user:l}=w(),p=E(),{toast:d}=F(),[u,j]=h.useState(!1),[v,f]=h.useState(!1),[s,g]=h.useState({name:"",phone:"",birth_date:"",gender:"",height:"",weight:"",zipcode:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""});h.useEffect(()=>{if(l?.profile){const a=l.profile.address||{};g({name:l.profile.name||"",phone:l.profile.phone||"",birth_date:l.profile.birth_date||"",gender:l.profile.gender||"",height:l.profile.height||"",weight:l.profile.weight||"",zipcode:a.zipcode||"",street:a.street||"",number:a.number||"",complement:a.complement||"",neighborhood:a.neighborhood||"",city:a.city||"",state:a.state||""})}},[l]);const t=(a,o)=>{g(n=>({...n,[a]:o}))},N=async a=>{const o=a.replace(/\D/g,"");if(t("zipcode",o),o.length===8){f(!0);try{const c=await(await fetch(`https://viacep.com.br/ws/${o}/json/`)).json();if(c.erro){d({title:"CEP não encontrado",description:"Verifique o CEP digitado.",variant:"destructive"});return}g(C=>({...C,street:c.logradouro||"",neighborhood:c.bairro||"",city:c.localidade||"",state:c.uf||""})),d({title:"CEP encontrado!",description:"Endereço preenchido automaticamente."})}catch(n){console.error("Erro ao buscar CEP:",n),d({title:"Erro",description:"Não foi possível buscar o CEP.",variant:"destructive"})}finally{f(!1)}}},y=async a=>{if(a.preventDefault(),!s.name.trim()){d({title:"Erro",description:"O nome é obrigatório.",variant:"destructive"});return}j(!0);try{const o={zipcode:s.zipcode||null,street:s.street||null,number:s.number||null,complement:s.complement||null,neighborhood:s.neighborhood||null,city:s.city||null,state:s.state||null},{error:n}=await A.from("user_profiles").update({name:s.name,phone:s.phone,birth_date:s.birth_date||null,gender:s.gender||null,height:s.height?parseFloat(s.height):null,weight:s.weight?parseFloat(s.weight):null,address:o}).eq("id",l.id);if(n)throw n;d({title:"Sucesso!",description:"Suas informações foram atualizadas."}),p("/patient/perfil"),setTimeout(()=>{window.location.reload()},500)}catch(o){console.error("Erro ao atualizar perfil:",o),d({title:"Erro",description:"Não foi possível atualizar suas informações.",variant:"destructive"})}finally{j(!1)}};return e.jsx("div",{className:"flex flex-col min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-3xl mx-auto w-full px-4 md:px-8 py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>p("/patient/perfil"),children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Editar Perfil"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Atualize suas informações pessoais"})]})]}),e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx("form",{onSubmit:y,children:e.jsxs(z,{children:[e.jsxs(P,{children:[e.jsx(_,{children:"Informações Pessoais"}),e.jsx(L,{children:"Mantenha seus dados atualizados para um melhor acompanhamento"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Nome Completo *"}),e.jsx(i,{id:"name",placeholder:"Digite seu nome completo",value:s.name,onChange:a=>t("name",a.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone",children:"Telefone"}),e.jsx(i,{id:"phone",type:"tel",placeholder:"(00) 00000-0000",value:s.phone,onChange:a=>t("phone",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"birth_date",children:"Data de Nascimento"}),e.jsx(i,{id:"birth_date",type:"date",value:s.birth_date,onChange:a=>t("birth_date",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"gender",children:"Gênero"}),e.jsxs(T,{value:s.gender,onValueChange:a=>t("gender",a),children:[e.jsx(k,{children:e.jsx(I,{placeholder:"Selecione seu gênero"})}),e.jsxs(q,{children:[e.jsx(m,{value:"male",children:"Masculino"}),e.jsx(m,{value:"female",children:"Feminino"}),e.jsx(m,{value:"other",children:"Outro"}),e.jsx(m,{value:"prefer_not_to_say",children:"Prefiro não informar"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"height",children:"Altura (cm)"}),e.jsx(i,{id:"height",type:"number",step:"0.1",placeholder:"170",value:s.height,onChange:a=>t("height",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(i,{id:"weight",type:"number",step:"0.1",placeholder:"70",value:s.weight,onChange:a=>t("weight",a.target.value)})]})]}),e.jsx("hr",{className:"border-t"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Endereço"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"zipcode",children:"CEP"}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{id:"zipcode",type:"text",placeholder:"00000-000",maxLength:8,value:s.zipcode,onChange:a=>N(a.target.value),disabled:v}),v&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx(b,{className:"w-4 h-4 animate-spin text-primary"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Digite o CEP para preencher automaticamente"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(r,{htmlFor:"street",children:"Rua/Logradouro"}),e.jsx(i,{id:"street",placeholder:"Nome da rua",value:s.street,onChange:a=>t("street",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"number",children:"Número"}),e.jsx(i,{id:"number",placeholder:"123",value:s.number,onChange:a=>t("number",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"complement",children:"Complemento"}),e.jsx(i,{id:"complement",placeholder:"Apto, bloco, etc.",value:s.complement,onChange:a=>t("complement",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"neighborhood",children:"Bairro"}),e.jsx(i,{id:"neighborhood",placeholder:"Nome do bairro",value:s.neighborhood,onChange:a=>t("neighborhood",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"city",children:"Cidade"}),e.jsx(i,{id:"city",placeholder:"Nome da cidade",value:s.city,onChange:a=>t("city",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"state",children:"Estado"}),e.jsx(i,{id:"state",placeholder:"UF",maxLength:2,value:s.state,onChange:a=>t("state",a.target.value.toUpperCase())})]})]})]}),e.jsx("hr",{className:"border-t"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(x,{type:"button",variant:"outline",className:"flex-1",onClick:()=>p("/patient/perfil"),disabled:u,children:"Cancelar"}),e.jsx(x,{type:"submit",className:"flex-1",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})})]})]})]})})})]})})}export{J as default};
