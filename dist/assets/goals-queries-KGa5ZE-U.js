import{s as l}from"./index-qjbGaV1R.js";import{g as x}from"./date-C2sroe8F.js";import{l as u}from"./query-helpers-CC2p4I3d.js";const h=7700,P=1e3,G=200,T=500,C=async(t,e)=>{const{goal_type:a,initial_weight:r,target_weight:n,start_date:d,target_date:m}=t,_=n-r,y=_<0,f=_>0,v=new Date(d).getTime(),b=new Date(m).getTime(),w=Math.ceil((b-v)/(1e3*60*60*24));if(w<=0)return{is_realistic:!1,viability_score:1,viability_notes:"Data alvo deve ser posterior √† data de in√≠cio.",warnings:[{type:"invalid_dates",message:"Data alvo inv√°lida"}],required_daily_deficit:0,daily_calorie_goal:null};const o=_/w*h,{data:E}=await l.from("energy_expenditure_calculations").select("*").eq("patient_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle(),{data:q}=await l.from("meal_plans").select("*").eq("patient_id",e).eq("is_active",!0).maybeSingle(),p=E?.get||null,g=q?.daily_calories||null,i={is_realistic:!0,viability_score:5,viability_notes:"",warnings:[],required_daily_deficit:Math.round(o),daily_calorie_goal:null,energy_expenditure_id:E?.id||null,meal_plan_id:q?.id||null},s=[],c=[];if(y&&Math.abs(o)>P&&(i.is_realistic=!1,i.viability_score=1,c.push({type:"too_aggressive",message:`D√©ficit de ${Math.abs(Math.round(o))} kcal/dia √© muito agressivo e pode ser prejudicial √† sa√∫de.`}),s.push("‚ö†Ô∏è Meta extremamente agressiva. Recomendamos estender o prazo ou reduzir o objetivo de peso.")),y&&Math.abs(o)<G&&(i.viability_score=Math.min(i.viability_score,3),c.push({type:"too_slow",message:`D√©ficit de apenas ${Math.abs(Math.round(o))} kcal/dia resultar√° em perda muito lenta.`}),s.push("üìä Meta pode ser muito conservadora. Considere reduzir o prazo para resultados mais vis√≠veis.")),f&&o>T&&(i.is_realistic=!1,i.viability_score=1,c.push({type:"gain_too_fast",message:`Super√°vit de ${Math.round(o)} kcal/dia √© excessivo.`}),s.push("‚ö†Ô∏è Ganho de peso muito r√°pido. Pode resultar em ac√∫mulo excessivo de gordura.")),p&&g){const M=p-g,D=p-o;i.daily_calorie_goal=Math.round(D),Math.abs(M-o)>300?(i.viability_score=Math.min(i.viability_score,3),M<o?(c.push({type:"plan_too_high_calories",message:`Plano atual fornece ${Math.round(g)} kcal/dia. Para atingir a meta, deveria fornecer aproximadamente ${Math.round(D)} kcal/dia.`}),s.push("üìã Plano alimentar atual fornece mais calorias que o necess√°rio. Considere ajustar o plano.")):(c.push({type:"plan_too_low_calories",message:`Plano atual fornece ${Math.round(g)} kcal/dia. Est√° abaixo do necess√°rio para a meta (${Math.round(D)} kcal/dia).`}),s.push("üìã Plano alimentar atual fornece menos calorias que o necess√°rio. Meta pode ser atingida mais rapidamente."))):s.push("‚úÖ Plano alimentar atual est√° adequado para atingir a meta no prazo estabelecido."),s.push(`
**Dados nutricionais:**`),s.push(`‚Ä¢ Gasto energ√©tico total: ${Math.round(p)} kcal/dia`),s.push(`‚Ä¢ Plano alimentar atual: ${Math.round(g)} kcal/dia`),s.push(`‚Ä¢ D√©ficit atual: ${Math.round(M)} kcal/dia`),s.push(`‚Ä¢ D√©ficit necess√°rio: ${Math.round(o)} kcal/dia`)}else i.viability_score=Math.min(i.viability_score,3),c.push({type:"missing_data",message:"Faltam dados de gasto energ√©tico ou plano alimentar para valida√ß√£o completa."}),p||s.push("‚ö†Ô∏è Gasto energ√©tico n√£o calculado. Recomendamos calcular antes de criar a meta."),g||s.push("‚ö†Ô∏è Nenhum plano alimentar ativo. Crie um plano adequado √† meta.");return w<7&&(i.viability_score=Math.min(i.viability_score,2),c.push({type:"too_short_deadline",message:"Prazo muito curto. Metas saud√°veis requerem mais tempo."})),w>365&&(i.viability_score=Math.min(i.viability_score,4),c.push({type:"long_deadline",message:"Prazo muito longo. Considere criar metas intermedi√°rias."})),i.viability_notes=s.join(`
`),i.warnings=c,i},I=async(t,e,a)=>{try{const r=await C(t,e),n={patient_id:e,nutritionist_id:a,goal_type:t.goal_type,title:t.title,description:t.description||null,initial_weight:t.initial_weight,target_weight:t.target_weight,current_weight:t.initial_weight,start_date:t.start_date,target_date:t.target_date,...r,status:"active"},{data:d,error:m}=await l.from("patient_goals").insert([n]).select().single();if(m)throw m;return{data:d,error:null}}catch(r){return u("Erro ao criar meta",r),{data:null,error:r}}},N=async(t,e={})=>{try{let a=l.from("patient_goals").select("*").eq("patient_id",t);e.status&&(Array.isArray(e.status)?a=a.in("status",e.status):a=a.eq("status",e.status)),a=a.order("created_at",{ascending:!1}),e.limit&&(a=a.limit(e.limit));const{data:r,error:n}=await a;if(n)throw n;return{data:r,error:null}}catch(a){return u("Erro ao buscar metas",a),{data:null,error:a}}},R=async t=>{try{const{data:e,error:a}=await l.from("patient_goals").select("*").eq("patient_id",t).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(a)throw a;return{data:e,error:null}}catch(e){return u("Erro ao buscar meta ativa",e),{data:null,error:e}}},k=async t=>{try{const{data:e,error:a}=await l.from("patient_goals").select("*").eq("id",t).single();if(a)throw a;return{data:e,error:null}}catch(e){return u("Erro ao buscar meta",e),{data:null,error:e}}},j=async(t,e)=>{try{const{data:a}=await k(t);if(!a)throw new Error("Meta n√£o encontrada");const r=Number(a.initial_weight),n=Number(a.target_weight),d=Number(e),m=r-n,_=r-d,y=m===0?100:_/m*100,f=Math.max(0,Number(y.toFixed(2))),{data:v,error:b}=await l.from("patient_goals").update({current_weight:e,progress_percentage:f}).eq("id",t).select().single();if(b)throw b;return f>=100&&await $(t),{data:v,error:null}}catch(a){return u("Erro ao atualizar progresso",a),{data:null,error:a}}},$=async t=>{try{const{data:e,error:a}=await l.from("patient_goals").update({status:"completed",completion_date:x()}).eq("id",t).select().single();if(a)throw a;return{data:e,error:null}}catch(e){return u("Erro ao completar meta",e),{data:null,error:e}}},L=async(t,e="")=>{try{const{data:a,error:r}=await l.from("patient_goals").update({status:"cancelled",description:e?`${e}`:void 0}).eq("id",t).select().single();if(r)throw r;return{data:a,error:null}}catch(a){return u("Erro ao cancelar meta",a),{data:null,error:a}}},U=async t=>{try{const{data:e,error:a}=await l.from("patient_goals").update({status:"paused"}).eq("id",t).select().single();if(a)throw a;return{data:e,error:null}}catch(e){return u("Erro ao pausar meta",e),{data:null,error:e}}},V=t=>{const e=t<0,a=Math.abs(t);return a===0?1:Math.ceil(e?a*h/P:a*h/T)},X=t=>{const e=t<0,a=Math.abs(t);return a===0?1:Math.ceil(e?a*h/500:a*h/300)},B=t=>{const e=new Date,r=new Date(t).getTime()-e.getTime();return Math.ceil(r/(1e3*60*60*24))},K=t=>{if(!t||t.status!=="active")return null;const e=Math.ceil((new Date(t.target_date).getTime()-new Date(t.start_date).getTime())/(1e3*60*60*24)),r=Math.ceil((new Date().getTime()-new Date(t.start_date).getTime())/(1e3*60*60*24))/e*100,d=(t.progress_percentage||0)-r;return d>=10?{status:"ahead",label:"Adiantado",color:"text-green-600"}:d<=-10?{status:"behind",label:"Atrasado",color:"text-red-600"}:{status:"on_track",label:"No prazo",color:"text-blue-600"}};export{B as a,K as b,N as c,X as d,V as e,C as f,R as g,I as h,$ as i,L as j,U as p,j as u};
