import{q as Ve,s as V,a as et,r as f,j as e,C as G,c as U,d as X,w as re,e as Y,B as te,L as ft,X as tt,F as bt,ar as gt,O as je,H as Ee,ae as $,aE as jt,as as vt,b as yt}from"./index-CcAkuQOE.js";import{A as ie,a as ne}from"./alert-DVKwzpnq.js";import{I as T}from"./input-D9F4g-Hh.js";import{L as M}from"./label-Bd-4jfJh.js";import{T as Nt}from"./textarea-Bd9gTp9v.js";import{T as _t,a as wt,b as Ce,c as Ae}from"./tabs-Cly3-Txn.js";import{B as ve}from"./badge-DaJMa4dF.js";import{S as kt,a as Ct,b as At,c as St,d as Se}from"./select-oDZE1VMR.js";import{U as Pt}from"./upload-7SpNhT9A.js";import{C as oe}from"./calculator-CVOuQlBZ.js";import{R as Ue}from"./ruler-BNIY-s0P.js";import{A as rt}from"./alert-circle-Mfg_tzdv.js";import{S as Ft}from"./save-B70MTjSB.js";import{d as Et}from"./differenceInYears-C1W8AmWC.js";import{T as Mt,a as Ot,b as Xe,c as J,d as Tt,e as Q}from"./table-CCzm9ONh.js";import{M as Dt}from"./minus-B0TnmZm7.js";import{T as Rt}from"./trending-down-BHP_6waT.js";import{W as $t}from"./WeightChart-DCgDPkum.js";import{S as Ye,a as zt,f as ze,L as he,b as It,A as Bt,i as Pe,c as qt,d as at,E as Lt,g as Fe,e as Kt,h as Wt,C as Vt,j as le,k as Gt,u as Ut,G as Xt,l as Yt,m as He,n as st,o as ot,B as Ht,R as Ie,T as Be,p as qe,q as xe}from"./generateCategoricalChart-C6FYobBx.js";import{A as it}from"./Area-CXYwk9eu.js";import{L as fe,a as Zt}from"./LineChart-CldOBDij.js";import{X as ye,Y as Ne}from"./YAxis-CdK5_BKY.js";import{C as Le}from"./CartesianGrid-C5kvVCPl.js";import{A as Jt}from"./arrow-left-BUlR4enJ.js";import{R as Qt}from"./refresh-cw-CwTYHU3p.js";import{B as er}from"./bar-chart-3-Bb9Y31dB.js";import"./extends-CF3RwP-h.js";const Ze=Ve("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),tr=Ve("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),rr=Ve("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),ar=async(r,t={})=>{const{limit:o=50,offset:s=0,orderBy:i="record_date",ascending:l=!1}=t;try{const{data:c,error:a}=await V.from("growth_records").select("*").eq("patient_id",r).order(i,{ascending:l}).range(s,s+o-1);if(a)throw a;return{data:c||[],error:null}}catch(c){return console.error("Erro ao buscar registros antropométricos:",c),{data:[],error:c}}},sr=async r=>{try{const{data:t,error:o}=await V.from("growth_records").select("id, weight, height, record_date").eq("patient_id",r).order("record_date",{ascending:!0});if(o)throw o;return{data:(t||[]).map(i=>{const l=i.height&&i.weight?i.weight/Math.pow(i.height/100,2):null;return{...i,bmi:l,calculatedBmi:l}}),error:null}}catch(t){return console.error("Erro ao buscar dados para gráficos:",t),{data:[],error:t}}},or=async r=>{try{const{patient_id:t,weight:o,height:s,record_date:i,notes:l,circumferences:c,skinfolds:a,bone_diameters:u,bioimpedance:x,photos:p,results:h}=r,d={patient_id:t,weight:o,height:s,record_date:i,notes:l||null,...c&&{circumferences:c},...a&&{skinfolds:a},...u&&{bone_diameters:u},...x&&{bioimpedance:x},...p&&{photos:p},...h&&{results:h}},{data:m,error:y}=await V.from("growth_records").insert([d]).select().single();if(y)throw y;return{data:m,error:null}}catch(t){return console.error("Erro ao criar registro antropométrico:",t),{data:null,error:t}}},ir=async(r,t)=>{try{const{weight:o,height:s,record_date:i,notes:l,circumferences:c,skinfolds:a,bone_diameters:u,bioimpedance:x,photos:p,results:h}=t,d={...o!==void 0&&{weight:o},...s!==void 0&&{height:s},...i!==void 0&&{record_date:i},...l!==void 0&&{notes:l},...c!==void 0&&{circumferences:c},...a!==void 0&&{skinfolds:a},...u!==void 0&&{bone_diameters:u},...x!==void 0&&{bioimpedance:x},...p!==void 0&&{photos:p},...h!==void 0&&{results:h}},{data:m,error:y}=await V.from("growth_records").update(d).eq("id",r).select().single();if(y)throw y;return{data:m,error:null}}catch(o){return console.error("Erro ao atualizar registro antropométrico:",o),{data:null,error:o}}},nr=async r=>{try{const{data:t,error:o}=await V.from("growth_records").delete().eq("id",r).select().single();if(o)throw o;return{data:t,error:null}}catch(t){return console.error("Erro ao deletar registro antropométrico:",t),{data:null,error:t}}},lr=async r=>{try{const{data:t,error:o}=await V.from("growth_records").select("weight, height, notes").eq("patient_id",r).order("record_date",{ascending:!1}).limit(1).maybeSingle();if(o)throw o;return{data:t,error:null}}catch(t){return console.error("Erro ao buscar último registro:",t),{data:null,error:t}}};function cr({recordId:r,initialPhotos:t=[],onPhotosChange:o}){const{toast:s}=et(),[i,l]=f.useState(t||[]),[c,a]=f.useState(!1),u=!r||r.toString().startsWith("temp-"),x=async h=>{const d=h.target.files?.[0];if(d){if(u){s({title:"Atenção",description:"Salve o registro primeiro antes de adicionar fotos.",variant:"destructive"}),h.target.value="";return}if(!d.type.startsWith("image/")){s({title:"Erro",description:"Por favor, selecione um arquivo de imagem.",variant:"destructive"});return}if(d.size>5*1024*1024){s({title:"Erro",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}a(!0);try{const m=d.name.split(".").pop(),y=`${r}-${Date.now()}.${m}`,b=`${r}/${y}`,{error:_}=await V.storage.from("patient-photos").upload(b,d,{cacheControl:"3600",upsert:!1});if(_)throw console.error("Erro no upload:",_),_;const{data:{publicUrl:k}}=V.storage.from("patient-photos").getPublicUrl(b),C=[...i,k];l(C),o&&o(C),s({title:"Sucesso",description:"Foto enviada com sucesso!"})}catch(m){console.error("Erro ao fazer upload da foto:",m),s({title:"Erro",description:"Não foi possível fazer upload da foto. Tente novamente.",variant:"destructive"})}finally{a(!1),h.target.value=""}}},p=async(h,d)=>{try{const m=h.split("/"),y=m.slice(m.indexOf("patient-photos")+1).join("/"),{error:b}=await V.storage.from("patient-photos").remove([y]);b&&console.error("Erro ao deletar foto:",b);const _=i.filter((k,C)=>C!==d);l(_),o&&o(_),s({title:"Sucesso",description:"Foto removida com sucesso!"})}catch(m){console.error("Erro ao deletar foto:",m),s({title:"Erro",description:"Não foi possível remover a foto.",variant:"destructive"})}};return e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsxs(X,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Fotos de Progresso"]}),e.jsx(re,{children:"Adicione fotos antes/depois para acompanhar a evolução do paciente"})]}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"photo-upload",children:e.jsx(te,{type:"button",variant:"outline",className:"cursor-pointer",disabled:c||u,asChild:!0,children:e.jsx("span",{children:c?e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pt,{className:"w-4 h-4 mr-2"}),"Adicionar Foto"]})})})}),u&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Salve o registro primeiro"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",onChange:x,className:"hidden",disabled:c}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Máximo 5MB por foto"})]}),i.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map((h,d)=>e.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-border bg-muted",children:[e.jsx("img",{src:h,alt:`Foto ${d+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs(te,{type:"button",variant:"destructive",size:"sm",onClick:()=>p(h,d),className:"opacity-100",children:[e.jsx(tt,{className:"w-4 h-4 mr-1"}),"Remover"]})})]},d))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center border-2 border-dashed border-muted rounded-lg",children:[e.jsx(Ze,{className:"w-12 h-12 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma foto adicionada ainda"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Clique em "Adicionar Foto" para começar'})]})]})]})}function dr(r,t,o){if(!r||!t||r<=0||t<=0)return null;const s=r/t;return o?s>10.9?{size:"Pequena",ratio:s,label:"Pequena"}:s>9.9?{size:"Média",ratio:s,label:"Média"}:{size:"Grande",ratio:s,label:"Grande"}:s>11?{size:"Pequena",ratio:s,label:"Pequena"}:s>10.1?{size:"Média",ratio:s,label:"Média"}:{size:"Grande",ratio:s,label:"Grande"}}function mr(r){const{height:t,weight:o,triceps:s,subscapular:i,suprailiac:l,humerusWidth:c,femurWidth:a,armCirc:u,calfCirc:x}=r;if(!t||!o)return null;let p=null;if(s&&i&&l){const b=s+i+l;p=-.7182+.1451*b-68e-5*b*b+14e-7*b*b*b,p<0&&(p=0)}let h=null;if(t&&c&&a&&u&&x){const b=t/100,_=u-(s||0)/10,k=x-(i||0)/10;h=.858*c+.601*a+.188*_+.161*k-b*.131+4.5,h<0&&(h=0)}let d=null;if(t&&o){const _=t/100/Math.pow(o,1/3);_>=.462?d=.732*_-28.58:_>=.231?d=.463*_-5.5:d=.1,d<0&&(d=0)}if(p===null||h===null||d===null)return null;const m=d-p,y=2*h-(p+d);return{endo:parseFloat(p.toFixed(2)),meso:parseFloat(h.toFixed(2)),ecto:parseFloat(d.toFixed(2)),x:parseFloat(m.toFixed(2)),y:parseFloat(y.toFixed(2))}}function ur(r,t,o){if(!r||!t||!o)return"Incompleto";const s=Math.max(r,t,o);return s===r?t>o?"Endomorfo-Mesomorfo":"Endomorfo":s===t?r>o?"Mesomorfo-Endomorfo":o>r?"Mesomorfo-Ectomorfo":"Mesomorfo":t>r?"Ectomorfo-Mesomorfo":"Ectomorfo"}const pr=({patientId:r,initialData:t=null,onSubmit:o,onCancel:s,loading:i=!1,patientGender:l=null,patientBirthDate:c=null})=>{const[a,u]=f.useState({weight:"",height:"",record_date:new Date().toISOString().split("T")[0],notes:"",circumferences:{ombro:"",peito:"",cintura:"",abdomen:"",quadril:"",braco_relaxado_e:"",braco_relaxado_d:"",braco_contraido_e:"",braco_contraido_d:"",coxa_proximal_e:"",coxa_proximal_d:"",coxa_medial_e:"",coxa_medial_d:"",panturrilha_e:"",panturrilha_d:""},skinfolds:{triceps:"",biceps:"",subescapular:"",suprailiaca:"",abdominal:"",coxa:"",panturrilha:"",peito:"",axilar:""},bone_diameters:{punho:"",femur:"",umero:""},bioimpedance:{percent_gordura:"",percent_massa_magra:"",gordura_visceral:""},photos:[]}),[x,p]=f.useState(null),[h,d]=f.useState(null),[m,y]=f.useState(null),[b,_]=f.useState(null),[k,C]=f.useState(null),[N,O]=f.useState({}),[g,ae]=f.useState("pollock7"),[D,H]=f.useState(null),[z,S]=f.useState(null),[w,E]=f.useState(null);f.useEffect(()=>{(async()=>{if(!t&&r){const{data:j}=await lr(r);j&&p(j)}})()},[r,t]),f.useEffect(()=>{t&&u({weight:t.weight||"",height:t.height||"",record_date:t.record_date||new Date().toISOString().split("T")[0],notes:t.notes||"",circumferences:t.circumferences||a.circumferences,skinfolds:t.skinfolds||a.skinfolds,bone_diameters:t.bone_diameters||{punho:"",femur:"",umero:""},bioimpedance:t.bioimpedance||a.bioimpedance,photos:t.photos||[]})},[t]),f.useEffect(()=>{const{weight:n,height:j}=a;if(n&&j){const v=parseFloat(j)/100,A=parseFloat(n)/Math.pow(v,2);d(A);const L=18.5*Math.pow(v,2),F=24.9*Math.pow(v,2);y({min:L,max:F,current:parseFloat(n)})}else d(null),y(null)},[a.weight,a.height]),f.useEffect(()=>{const{cintura:n,quadril:j}=a.circumferences;if(n&&j){const v=parseFloat(n)/parseFloat(j);_(v)}else _(null)},[a.circumferences.cintura,a.circumferences.quadril]),f.useEffect(()=>{const n=parseFloat(a.weight),j=parseFloat(a.height),v=c?Et(new Date,new Date(c)):null,A=l?.toLowerCase()||"",L=A.includes("m")||A==="masculino"||A==="male";if(!n||!j){H(null),C(null);return}let F=null,P=null,ue=null,we=null;if(g==="bioimpedance"&&a.bioimpedance?.percent_gordura)P=parseFloat(a.bioimpedance.percent_gordura);else if(g==="pollock3"){const I=parseFloat(a.skinfolds.triceps),W=parseFloat(a.skinfolds.subescapular),Z=parseFloat(a.skinfolds.suprailiaca);if(I&&W&&Z&&v){const B=I+W+Z;L?F=1.10938-8267e-7*B+16e-7*B*B-2574e-7*v:F=1.0994921-9929e-7*B+23e-7*B*B-1392e-7*v}}else if(g==="pollock7"){const I=parseFloat(a.skinfolds.peito),W=parseFloat(a.skinfolds.axilar),Z=parseFloat(a.skinfolds.triceps),B=parseFloat(a.skinfolds.subescapular),ke=parseFloat(a.skinfolds.abdominal),pe=parseFloat(a.skinfolds.suprailiaca),Ge=parseFloat(a.skinfolds.coxa);if(I&&W&&Z&&B&&ke&&pe&&Ge&&v){const se=I+W+Z+B+ke+pe+Ge;L?F=1.112-43499e-8*se+55e-8*se*se-28826e-8*v:F=1.097-46971e-8*se+56e-8*se*se-12828e-8*v}}else if(g==="weltman"){const I=parseFloat(a.skinfolds.triceps),W=parseFloat(a.skinfolds.biceps),Z=parseFloat(a.skinfolds.subescapular),B=parseFloat(a.skinfolds.suprailiaca);if(I&&W&&Z&&B&&v){const ke=I+W+Z+B,pe=Math.log10(ke);L?F=1.1714-.0671*pe:F=1.1665-.0706*pe}}F&&F>0&&(P=(4.95/F-4.5)*100),P&&P>0&&P<100?(ue=n*P/100,we=n-ue,H({body_density:F,body_fat_percent:P,fat_mass_kg:ue,lean_mass_kg:we,protocol:g}),C(P)):(H(null),C(null))},[a.weight,a.height,a.skinfolds,a.bioimpedance,g,l,c]),f.useEffect(()=>{const n=parseFloat(a.height),j=parseFloat(a.bone_diameters?.punho),v=l?.toLowerCase()||"",A=v.includes("m")||v==="masculino"||v==="male";if(n&&j){const L=dr(n,j,A);S(L)}else S(null)},[a.height,a.bone_diameters?.punho,l]),f.useEffect(()=>{const n=parseFloat(a.height),j=parseFloat(a.weight),v=parseFloat(a.skinfolds.triceps),A=parseFloat(a.skinfolds.subescapular),L=parseFloat(a.skinfolds.suprailiaca),F=parseFloat(a.bone_diameters?.umero),P=parseFloat(a.bone_diameters?.femur),ue=a.circumferences.braco_contraido_e||a.circumferences.braco_contraido_d,we=a.circumferences.panturrilha_e||a.circumferences.panturrilha_d,I=l?.toLowerCase()||"";if(I.includes("m"),n&&j){const W=mr({height:n,weight:j,triceps:v,subscapular:A,suprailiac:L,humerusWidth:F,femurWidth:P,armCirc:parseFloat(ue),calfCirc:parseFloat(we)});E(W)}else E(null)},[a.height,a.weight,a.skinfolds.triceps,a.skinfolds.subescapular,a.skinfolds.suprailiaca,a.bone_diameters?.umero,a.bone_diameters?.femur,a.circumferences.braco_contraido_e,a.circumferences.braco_contraido_d,a.circumferences.panturrilha_e,a.circumferences.panturrilha_d,l]);const K=n=>{const{name:j,value:v}=n.target;u(A=>({...A,[j]:v})),N[j]&&O(A=>({...A,[j]:null}))},R=(n,j,v)=>{u(A=>({...A,[n]:{...A[n],[j]:v}}))},Te=n=>{u(j=>({...j,photos:n}))},De=()=>{const n={};return(!a.weight||parseFloat(a.weight)<=0)&&(n.weight="Peso é obrigatório e deve ser maior que zero"),(!a.height||parseFloat(a.height)<=0)&&(n.height="Altura é obrigatória e deve ser maior que zero"),a.record_date||(n.record_date="Data é obrigatória"),O(n),Object.keys(n).length===0},ut=n=>{if(n.preventDefault(),!De())return;const j=Object.fromEntries(Object.entries(a.circumferences).filter(([F,P])=>P&&P!=="")),v=Object.fromEntries(Object.entries(a.skinfolds).filter(([F,P])=>P&&P!=="")),A=Object.fromEntries(Object.entries(a.bioimpedance).filter(([F,P])=>P&&P!=="")),L={patient_id:r,weight:parseFloat(a.weight),height:parseFloat(a.height),record_date:a.record_date,notes:a.notes.trim()||null,circumferences:Object.keys(j).length>0?j:null,skinfolds:Object.keys(v).length>0?v:null,bone_diameters:Object.keys(a.bone_diameters||{}).filter(F=>a.bone_diameters[F]&&a.bone_diameters[F]!=="").length>0?Object.fromEntries(Object.entries(a.bone_diameters).filter(([F,P])=>P&&P!=="")):null,bioimpedance:Object.keys(A).length>0?A:null,photos:a.photos.length>0?a.photos:null,results:{...D||{},...z&&{frame_size:z.size,frame_ratio:z.ratio},...w&&{somatotype:w}}};o(L,t?.id)},pt=()=>{u({weight:"",height:"",record_date:new Date().toISOString().split("T")[0],notes:"",circumferences:{ombro:"",peito:"",cintura:"",abdomen:"",quadril:"",braco_relaxado_e:"",braco_relaxado_d:"",braco_contraido_e:"",braco_contraido_d:"",coxa_proximal_e:"",coxa_proximal_d:"",coxa_medial_e:"",coxa_medial_d:"",panturrilha_e:"",panturrilha_d:""},skinfolds:{triceps:"",biceps:"",subescapular:"",suprailiaca:"",abdominal:"",coxa:"",panturrilha:""},bone_diameters:{punho:"",femur:"",umero:""},bioimpedance:{percent_gordura:"",percent_massa_magra:"",gordura_visceral:""},photos:[]}),O({}),d(null),y(null),_(null),C(null),s&&s()},ht=n=>n?n<18.5?{label:"Abaixo do peso",color:"text-blue-600"}:n<25?{label:"Peso normal",color:"text-green-600"}:n<30?{label:"Sobrepeso",color:"text-yellow-600"}:{label:"Obesidade",color:"text-red-600"}:null,xt=n=>n?n<.85?{label:"Baixo risco",color:"text-green-600"}:n<.95?{label:"Risco moderado",color:"text-yellow-600"}:{label:"Alto risco",color:"text-red-600"}:null,Re=ht(h),$e=xt(b);return e.jsxs(G,{children:[e.jsx(U,{children:e.jsx(X,{className:"text-lg",children:t?"Editar Registro":"Novo Registro Antropométrico"})}),e.jsx(Y,{children:e.jsxs("form",{onSubmit:ut,className:"space-y-6",children:[e.jsxs(_t,{defaultValue:"basico",className:"w-full",children:[e.jsxs(wt,{className:"grid w-full grid-cols-4",children:[e.jsx(Ce,{value:"basico",children:"Básico"}),e.jsx(Ce,{value:"circunferencias",children:"Circunferências"}),e.jsx(Ce,{value:"dobras",children:"Dobras & Composição"}),e.jsx(Ce,{value:"fotos",children:"Fotos"})]}),e.jsxs(Ae,{value:"basico",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"weight",children:["Peso (kg) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:"weight",name:"weight",type:"number",step:"0.1",min:"0",placeholder:x?.weight?`Último: ${x.weight} kg`:"Ex: 70.5",value:a.weight,onChange:K,className:N.weight?"border-destructive":"",disabled:i}),N.weight&&e.jsx("p",{className:"text-xs text-destructive",children:N.weight})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"height",children:["Altura (cm) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:"height",name:"height",type:"number",step:"0.1",min:"0",placeholder:x?.height?`Último: ${x.height} cm`:"Ex: 170",value:a.height,onChange:K,className:N.height?"border-destructive":"",disabled:i}),N.height&&e.jsx("p",{className:"text-xs text-destructive",children:N.height})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"record_date",children:["Data ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:"record_date",name:"record_date",type:"date",value:a.record_date,onChange:K,className:N.record_date?"border-destructive":"",disabled:i}),N.record_date&&e.jsx("p",{className:"text-xs text-destructive",children:N.record_date})]})]}),h&&e.jsxs(ie,{className:"bg-muted/50",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"IMC Calculado:"}),e.jsx("span",{className:"text-lg font-bold",children:h.toFixed(1)}),Re&&e.jsx(ve,{variant:"outline",className:Re.color,children:Re.label})]})})]}),m&&e.jsxs(ie,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800",children:[e.jsx(oe,{className:"h-4 w-4 text-blue-600"}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Faixa de Peso Ideal (IMC 18.5-24.9):"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[m.min.toFixed(1)," kg - ",m.max.toFixed(1)," kg"]}),m.current&&e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Peso atual: ",m.current.toFixed(1)," kg",m.current<m.min&&e.jsx("span",{className:"ml-2",children:"(Abaixo do ideal)"}),m.current>m.max&&e.jsx("span",{className:"ml-2",children:"(Acima do ideal)"}),m.current>=m.min&&m.current<=m.max&&e.jsx("span",{className:"ml-2",children:"(Dentro do ideal)"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"notes",children:"Observações (opcional)"}),e.jsx(Nt,{id:"notes",name:"notes",rows:3,placeholder:"Adicione observações sobre o registro...",value:a.notes,onChange:K,disabled:i})]})]}),e.jsx(Ae,{value:"circunferencias",className:"space-y-6 mt-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Tronco"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:["ombro","peito","cintura","abdomen","quadril"].map(n=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:`circ_${n}`,children:[n.charAt(0).toUpperCase()+n.slice(1).replace("_"," ")," (cm)"]}),e.jsx(T,{id:`circ_${n}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[n]||"",onChange:j=>R("circumferences",n,j.target.value),disabled:i})]},n))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Membros (E/D)"}),e.jsx("div",{className:"space-y-4",children:[{key:"braco_relaxado",label:"Braço Relaxado"},{key:"braco_contraido",label:"Braço Contraído"},{key:"coxa_proximal",label:"Coxa Proximal"},{key:"coxa_medial",label:"Coxa Medial"},{key:"panturrilha",label:"Panturrilha"}].map(({key:n,label:j})=>e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(M,{className:"col-span-3 text-xs text-muted-foreground",children:j}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:`circ_${n}_e`,children:"Esquerdo (cm)"}),e.jsx(T,{id:`circ_${n}_e`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[`${n}_e`]||"",onChange:v=>R("circumferences",`${n}_e`,v.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:`circ_${n}_d`,children:"Direito (cm)"}),e.jsx(T,{id:`circ_${n}_d`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.circumferences[`${n}_d`]||"",onChange:v=>R("circumferences",`${n}_d`,v.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:`circ_${n}_media`,children:"Média (cm)"}),e.jsx(T,{id:`circ_${n}_media`,type:"number",step:"0.1",disabled:!0,value:a.circumferences[`${n}_e`]&&a.circumferences[`${n}_d`]?((parseFloat(a.circumferences[`${n}_e`])+parseFloat(a.circumferences[`${n}_d`]))/2).toFixed(1):"",className:"bg-muted"})]})]},n))})]}),b&&e.jsxs(ie,{className:"bg-muted/50",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold",children:"RCQ (Relação Cintura-Quadril):"}),e.jsx("span",{className:"text-lg font-bold",children:b.toFixed(2)}),$e&&e.jsx(ve,{variant:"outline",className:$e.color,children:$e.label})]})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Diâmetros Ósseos (cm)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"bone_punho",children:"Punho (Estiloide) (cm)"}),e.jsx(T,{id:"bone_punho",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.punho||"",onChange:n=>R("bone_diameters","punho",n.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"bone_femur",children:"Fêmur (Biepicondilar) (cm)"}),e.jsx(T,{id:"bone_femur",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.femur||"",onChange:n=>R("bone_diameters","femur",n.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"bone_umero",children:"Úmero (Biepicondilar) (cm)"}),e.jsx(T,{id:"bone_umero",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bone_diameters?.umero||"",onChange:n=>R("bone_diameters","umero",n.target.value),disabled:i})]})]}),z&&e.jsxs(ie,{className:"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800 mt-4",children:[e.jsx(oe,{className:"h-4 w-4 text-blue-600"}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Compleição Óssea (Frame Size):"}),e.jsx("div",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:z.label}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:["Ratio Altura/Punho: ",z.ratio.toFixed(2)]})]})})]})]})]})}),e.jsxs(Ae,{value:"dobras",className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"protocol",children:"Protocolo de Cálculo"}),e.jsxs(kt,{value:g,onValueChange:ae,children:[e.jsx(Ct,{id:"protocol",children:e.jsx(At,{placeholder:"Selecione o protocolo"})}),e.jsxs(St,{children:[e.jsx(Se,{value:"pollock3",children:"Pollock 3 Dobras (Tríceps, Subescapular, Suprailíaca)"}),e.jsx(Se,{value:"pollock7",children:"Pollock 7 Dobras (Peito, Axilar, Tríceps, Subescapular, Abdominal, Suprailíaca, Coxa)"}),e.jsx(Se,{value:"weltman",children:"Weltman 4 Dobras (Tríceps, Bíceps, Subescapular, Suprailíaca)"}),e.jsx(Se,{value:"bioimpedance",children:"Bioimpedância (Direto)"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[g==="pollock3"&&"Requer: Tríceps, Subescapular, Suprailíaca, Idade, Gênero",g==="pollock7"&&"Requer: Peito, Axilar, Tríceps, Subescapular, Abdominal, Suprailíaca, Coxa, Idade, Gênero",g==="weltman"&&"Requer: Tríceps, Bíceps, Subescapular, Suprailíaca, Idade, Gênero",g==="bioimpedance"&&"Use os valores de bioimpedância diretamente"]})]}),g!=="bioimpedance"&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(rr,{className:"w-4 h-4"}),"Dobras Cutâneas (mm)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[g==="pollock3"&&[{key:"triceps",label:"Tríceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0}].map(({key:n,label:j,required:v})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:`fold_${n}`,children:[j," (mm) ",v&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:`fold_${n}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[n]||"",onChange:A=>R("skinfolds",n,A.target.value),disabled:i})]},n)),g==="pollock7"&&[{key:"peito",label:"Peito",required:!0},{key:"axilar",label:"Axilar",required:!0},{key:"triceps",label:"Tríceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"abdominal",label:"Abdominal",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0},{key:"coxa",label:"Coxa",required:!0}].map(({key:n,label:j,required:v})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:`fold_${n}`,children:[j," (mm) ",v&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:`fold_${n}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[n]||"",onChange:A=>R("skinfolds",n,A.target.value),disabled:i})]},n)),g==="weltman"&&[{key:"triceps",label:"Tríceps",required:!0},{key:"biceps",label:"Bíceps",required:!0},{key:"subescapular",label:"Subescapular",required:!0},{key:"suprailiaca",label:"Suprailíaca",required:!0}].map(({key:n,label:j,required:v})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:`fold_${n}`,children:[j," (mm) ",v&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:`fold_${n}`,type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.skinfolds[n]||"",onChange:A=>R("skinfolds",n,A.target.value),disabled:i})]},n))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Bioimpedância"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"bio_percent_gordura",children:["% Gordura Corporal ",g==="bioimpedance"&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:"bio_percent_gordura",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0.0",value:a.bioimpedance.percent_gordura||"",onChange:n=>R("bioimpedance","percent_gordura",n.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"bio_percent_massa_magra",children:"% Massa Magra"}),e.jsx(T,{id:"bio_percent_massa_magra",type:"number",step:"0.1",min:"0",max:"100",placeholder:"0.0",value:a.bioimpedance.percent_massa_magra||"",onChange:n=>R("bioimpedance","percent_massa_magra",n.target.value),disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"bio_gordura_visceral",children:"Gordura Visceral"}),e.jsx(T,{id:"bio_gordura_visceral",type:"number",step:"0.1",min:"0",placeholder:"0.0",value:a.bioimpedance.gordura_visceral||"",onChange:n=>R("bioimpedance","gordura_visceral",n.target.value),disabled:i})]})]})]}),D&&e.jsxs(G,{className:"bg-gradient-to-br from-emerald-50 to-blue-50 dark:from-emerald-950/20 dark:to-blue-950/20 border-emerald-200 dark:border-emerald-800",children:[e.jsxs(U,{children:[e.jsxs(X,{className:"text-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-emerald-600"}),"Resultados Calculados"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Protocolo: ",g==="pollock3"?"Pollock 3 Dobras":g==="pollock7"?"Pollock 7 Dobras":g==="weltman"?"Weltman 4 Dobras":"Bioimpedância"]})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Densidade Corporal"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:D.body_density?.toFixed(4)||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"% Gordura Corporal"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[D.body_fat_percent?.toFixed(1)||"N/A","%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa Gorda"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:[D.fat_mass_kg?.toFixed(1)||"N/A"," kg"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa Magra"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:[D.lean_mass_kg?.toFixed(1)||"N/A"," kg"]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-emerald-200 dark:border-emerald-800",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["*Cálculos baseados em ",g==="pollock3"?"Jackson & Pollock (1985) - 3 dobras":g==="pollock7"?"Jackson & Pollock (1985) - 7 dobras":g==="weltman"?"Weltman et al. (1988)":"Bioimpedância direta"," e equação de Siri (1961) para conversão de densidade em % de gordura."]})})]})]}),!D&&g!=="bioimpedance"&&e.jsxs(ie,{className:"bg-amber-50 dark:bg-amber-950/20 border-amber-200 dark:border-amber-800",children:[e.jsx(rt,{className:"h-4 w-4 text-amber-600"}),e.jsx(ne,{children:e.jsx("p",{className:"text-sm text-amber-900 dark:text-amber-100",children:"Preencha todas as dobras cutâneas necessárias para o protocolo selecionado e certifique-se de que o paciente tem idade e gênero cadastrados no perfil."})})]}),w&&e.jsxs(G,{className:"bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-950/20 dark:to-indigo-950/20 border-purple-200 dark:border-purple-800",children:[e.jsxs(U,{children:[e.jsxs(X,{className:"text-lg flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-purple-600"}),"Somatotipo (Heath-Carter)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Classificação da composição corporal"})]}),e.jsx(Y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1 text-center p-4 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Endomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:w.endo}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Gordura relativa"})]}),e.jsxs("div",{className:"space-y-1 text-center p-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mesomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:w.meso}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Massa muscular/óssea"})]}),e.jsxs("div",{className:"space-y-1 text-center p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ectomorfia"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:w.ecto}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Linearidade"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-purple-200 dark:border-purple-800",children:[e.jsx("p",{className:"text-sm font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"Classificação:"}),e.jsx("p",{className:"text-lg font-bold text-purple-800 dark:text-purple-200",children:ur(w.endo,w.meso,w.ecto)}),e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 mt-2",children:["Coordenadas para Somatochart: X = ",w.x,", Y = ",w.y]})]})]})})]})]}),e.jsx(Ae,{value:"fotos",className:"mt-4",children:e.jsx(cr,{recordId:t?.id||`temp-${Date.now()}`,initialPhotos:a.photos,onPhotosChange:Te})})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4 border-t",children:[e.jsxs(te,{type:"button",variant:"outline",onClick:pt,disabled:i,children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),t?"Cancelar":"Limpar"]}),e.jsxs(te,{type:"submit",disabled:i,children:[e.jsx(Ft,{className:"w-4 h-4 mr-2"}),i?"Salvando...":t?"Atualizar":"Salvar"]})]})]})})]})},hr=({records:r=[],onEdit:t,onDelete:o,loading:s=!1})=>{const i=a=>a?a<18.5?{label:"Abaixo do peso",variant:"secondary"}:a<25?{label:"Peso normal",variant:"success"}:a<30?{label:"Sobrepeso",variant:"warning"}:{label:"Obesidade",variant:"destructive"}:{label:"N/A",variant:"outline"},l=(a,u)=>{if(!u)return null;const x=a-u;return Math.abs(x)<.1?{icon:Dt,color:"text-gray-500",text:"Estável"}:x>0?{icon:gt,color:"text-red-500",text:`+${x.toFixed(1)} kg`}:{icon:Rt,color:"text-green-500",text:`${x.toFixed(1)} kg`}},c=a=>{try{return je(new Date(a),"dd 'de' MMMM 'de' yyyy",{locale:Ee})}catch{return a}};return s?e.jsx("div",{className:"border rounded-lg p-8 text-center text-muted-foreground",children:"Carregando registros..."}):r.length===0?e.jsxs("div",{className:"border rounded-lg p-8 text-center",children:[e.jsx("p",{className:"text-muted-foreground font-medium",children:"Nenhum registro encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Adicione o primeiro registro usando o formulário acima"})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Mt,{children:[e.jsx(Ot,{children:e.jsxs(Xe,{children:[e.jsx(J,{children:"Data"}),e.jsx(J,{children:"Peso (kg)"}),e.jsx(J,{children:"Altura (cm)"}),e.jsx(J,{children:"IMC"}),e.jsx(J,{children:"Classificação"}),e.jsx(J,{children:"Tendência"}),e.jsx(J,{children:"Observações"}),e.jsx(J,{className:"text-right",children:"Ações"})]})}),e.jsx(Tt,{children:r.map((a,u)=>{const x=a.bmi||(a.height?a.weight/Math.pow(a.height/100,2):null),p=i(x),h=u<r.length-1?r[u+1].weight:null,d=l(a.weight,h),m=d?.icon;return e.jsxs(Xe,{children:[e.jsx(Q,{className:"font-medium",children:c(a.record_date)}),e.jsxs(Q,{children:[e.jsx("span",{className:"font-semibold",children:a.weight})," kg"]}),e.jsx(Q,{children:a.height?`${a.height} cm`:"N/A"}),e.jsx(Q,{children:x?e.jsx("span",{className:"font-semibold",children:x.toFixed(1)}):e.jsx("span",{className:"text-muted-foreground",children:"N/A"})}),e.jsx(Q,{children:e.jsx(ve,{variant:p.variant,children:p.label})}),e.jsx(Q,{children:d&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{className:`w-4 h-4 ${d.color}`}),e.jsx("span",{className:`text-sm ${d.color}`,children:d.text})]})}),e.jsx(Q,{className:"max-w-xs",children:a.notes?e.jsx("span",{className:"text-sm text-muted-foreground line-clamp-2",children:a.notes}):e.jsx("span",{className:"text-xs text-muted-foreground italic",children:"Sem observações"})}),e.jsx(Q,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>t(a),className:"h-8 w-8 p-0",children:e.jsx(tr,{className:"h-4 w-4"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>o(a),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(bt,{className:"h-4 w-4"})})]})})]},a.id)})})]})})};function ce(r){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ce(r)}function xr(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function fr(r,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,ct(s.key),s)}}function br(r,t,o){return t&&fr(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function gr(r,t,o){return t=Me(t),jr(r,nt()?Reflect.construct(t,o||[],Me(r).constructor):t.apply(r,o))}function jr(r,t){if(t&&(ce(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vr(r)}function vr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function nt(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nt=function(){return!!r})()}function Me(r){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Me(r)}function yr(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&Ke(r,t)}function Ke(r,t){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,i){return s.__proto__=i,s},Ke(r,t)}function lt(r,t,o){return t=ct(t),t in r?Object.defineProperty(r,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[t]=o,r}function ct(r){var t=Nr(r,"string");return ce(t)=="symbol"?t:t+""}function Nr(r,t){if(ce(r)!="object"||!r)return r;var o=r[Symbol.toPrimitive];if(o!==void 0){var s=o.call(r,t);if(ce(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var _e=(function(r){function t(){return xr(this,t),gr(this,t,arguments)}return yr(t,r),br(t,[{key:"render",value:function(){return null}}])})(f.Component);lt(_e,"displayName","ZAxis");lt(_e,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var _r=["option","isActive"];function be(){return be=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r},be.apply(this,arguments)}function wr(r,t){if(r==null)return{};var o=kr(r,t),s,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);for(i=0;i<l.length;i++)s=l[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(r,s)&&(o[s]=r[s])}return o}function kr(r,t){if(r==null)return{};var o={};for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){if(t.indexOf(s)>=0)continue;o[s]=r[s]}return o}function Cr(r){var t=r.option,o=r.isActive,s=wr(r,_r);return typeof t=="string"?f.createElement(Ye,be({option:f.createElement(zt,be({type:t},s)),isActive:o,shapeType:"symbols"},s)):f.createElement(Ye,be({option:t,isActive:o,shapeType:"symbols"},s))}function de(r){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(r)}function ge(){return ge=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r},ge.apply(this,arguments)}function Je(r,t){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),o.push.apply(o,s)}return o}function q(r){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Je(Object(o),!0).forEach(function(s){ee(r,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Je(Object(o)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(o,s))})}return r}function Ar(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(r,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,mt(s.key),s)}}function Sr(r,t,o){return t&&Qe(r.prototype,t),o&&Qe(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r}function Pr(r,t,o){return t=Oe(t),Fr(r,dt()?Reflect.construct(t,o||[],Oe(r).constructor):t.apply(r,o))}function Fr(r,t){if(t&&(de(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Er(r)}function Er(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function dt(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dt=function(){return!!r})()}function Oe(r){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Oe(r)}function Mr(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&We(r,t)}function We(r,t){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,i){return s.__proto__=i,s},We(r,t)}function ee(r,t,o){return t=mt(t),t in r?Object.defineProperty(r,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[t]=o,r}function mt(r){var t=Or(r,"string");return de(t)=="symbol"?t:t+""}function Or(r,t){if(de(r)!="object"||!r)return r;var o=r[Symbol.toPrimitive];if(o!==void 0){var s=o.call(r,t);if(de(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var me=(function(r){function t(){var o;Ar(this,t);for(var s=arguments.length,i=new Array(s),l=0;l<s;l++)i[l]=arguments[l];return o=Pr(this,t,[].concat(i)),ee(o,"state",{isAnimationFinished:!1}),ee(o,"handleAnimationEnd",function(){o.setState({isAnimationFinished:!0})}),ee(o,"handleAnimationStart",function(){o.setState({isAnimationFinished:!1})}),ee(o,"id",Ut("recharts-scatter-")),o}return Mr(t,r),Sr(t,[{key:"renderSymbolsStatically",value:function(s){var i=this,l=this.props,c=l.shape,a=l.activeShape,u=l.activeIndex,x=ze(this.props,!1);return s.map(function(p,h){var d=u===h,m=d?a:c,y=q(q({},x),p);return $.createElement(he,ge({className:"recharts-scatter-symbol",key:"symbol-".concat(p?.cx,"-").concat(p?.cy,"-").concat(p?.size,"-").concat(h)},It(i.props,p,h),{role:"img"}),$.createElement(Cr,ge({option:m,isActive:d,key:"symbol-".concat(h)},y)))})}},{key:"renderSymbolsWithAnimation",value:function(){var s=this,i=this.props,l=i.points,c=i.isAnimationActive,a=i.animationBegin,u=i.animationDuration,x=i.animationEasing,p=i.animationId,h=this.state.prevPoints;return $.createElement(Bt,{begin:a,duration:u,isActive:c,easing:x,from:{t:0},to:{t:1},key:"pie-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(d){var m=d.t,y=l.map(function(b,_){var k=h&&h[_];if(k){var C=Pe(k.cx,b.cx),N=Pe(k.cy,b.cy),O=Pe(k.size,b.size);return q(q({},b),{},{cx:C(m),cy:N(m),size:O(m)})}var g=Pe(0,b.size);return q(q({},b),{},{size:g(m)})});return $.createElement(he,null,s.renderSymbolsStatically(y))})}},{key:"renderSymbols",value:function(){var s=this.props,i=s.points,l=s.isAnimationActive,c=this.state.prevPoints;return l&&i&&i.length&&(!c||!qt(c,i))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(i)}},{key:"renderErrorBar",value:function(){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var i=this.props,l=i.points,c=i.xAxis,a=i.yAxis,u=i.children,x=at(u,Lt);return x?x.map(function(p,h){var d=p.props,m=d.direction,y=d.dataKey;return $.cloneElement(p,{key:"".concat(m,"-").concat(y,"-").concat(l[h]),data:l,xAxis:c,yAxis:a,layout:m==="x"?"vertical":"horizontal",dataPointFormatter:function(_,k){return{x:_.cx,y:_.cy,value:m==="x"?+_.node.x:+_.node.y,errorVal:Fe(_,k)}}})}):null}},{key:"renderLine",value:function(){var s=this.props,i=s.points,l=s.line,c=s.lineType,a=s.lineJointType,u=ze(this.props,!1),x=ze(l,!1),p,h;if(c==="joint")p=i.map(function(N){return{x:N.cx,y:N.cy}});else if(c==="fitting"){var d=Kt(i),m=d.xmin,y=d.xmax,b=d.a,_=d.b,k=function(O){return b*O+_};p=[{x:m,y:k(m)},{x:y,y:k(y)}]}var C=q(q(q({},u),{},{fill:"none",stroke:u&&u.fill},x),{},{points:p});return $.isValidElement(l)?h=$.cloneElement(l,C):Wt(l)?h=l(C):h=$.createElement(Vt,ge({},C,{type:a})),$.createElement(he,{className:"recharts-scatter-line",key:"recharts-scatter-line"},h)}},{key:"render",value:function(){var s=this.props,i=s.hide,l=s.points,c=s.line,a=s.className,u=s.xAxis,x=s.yAxis,p=s.left,h=s.top,d=s.width,m=s.height,y=s.id,b=s.isAnimationActive;if(i||!l||!l.length)return null;var _=this.state.isAnimationFinished,k=jt("recharts-scatter",a),C=u&&u.allowDataOverflow,N=x&&x.allowDataOverflow,O=C||N,g=le(y)?this.id:y;return $.createElement(he,{className:k,clipPath:O?"url(#clipPath-".concat(g,")"):null},C||N?$.createElement("defs",null,$.createElement("clipPath",{id:"clipPath-".concat(g)},$.createElement("rect",{x:C?p:p-d/2,y:N?h:h-m/2,width:C?d:d*2,height:N?m:m*2}))):null,c&&this.renderLine(),this.renderErrorBar(),$.createElement(he,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!b||_)&&Gt.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(s,i){return s.animationId!==i.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:i.curPoints}:s.points!==i.curPoints?{curPoints:s.points}:null}}])})(f.PureComponent);ee(me,"displayName","Scatter");ee(me,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Xt.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});ee(me,"getComposedData",function(r){var t=r.xAxis,o=r.yAxis,s=r.zAxis,i=r.item,l=r.displayedData,c=r.xAxisTicks,a=r.yAxisTicks,u=r.offset,x=i.props.tooltipType,p=at(i.props.children,Yt),h=le(t.dataKey)?i.props.dataKey:t.dataKey,d=le(o.dataKey)?i.props.dataKey:o.dataKey,m=s&&s.dataKey,y=s?s.range:_e.defaultProps.range,b=y&&y[0],_=t.scale.bandwidth?t.scale.bandwidth():0,k=o.scale.bandwidth?o.scale.bandwidth():0,C=l.map(function(N,O){var g=Fe(N,h),ae=Fe(N,d),D=!le(m)&&Fe(N,m)||"-",H=[{name:le(t.dataKey)?i.props.name:t.name||t.dataKey,unit:t.unit||"",value:g,payload:N,dataKey:h,type:x},{name:le(o.dataKey)?i.props.name:o.name||o.dataKey,unit:o.unit||"",value:ae,payload:N,dataKey:d,type:x}];D!=="-"&&H.push({name:s.name||s.dataKey,unit:s.unit||"",value:D,payload:N,dataKey:m,type:x});var z=He({axis:t,ticks:c,bandSize:_,entry:N,index:O,dataKey:h}),S=He({axis:o,ticks:a,bandSize:k,entry:N,index:O,dataKey:d}),w=D!=="-"?s.scale(D):b,E=Math.sqrt(Math.max(w,0)/Math.PI);return q(q({},N),{},{cx:z,cy:S,x:z-E,y:S-E,xAxis:t,yAxis:o,zAxis:s,width:2*E,height:2*E,size:w,node:{x:g,y:ae,z:D},tooltipPayload:H,tooltipPosition:{x:z,y:S},payload:N},p&&p[O]&&p[O].props)});return q({points:C},u)});var Tr=st({chartName:"ScatterChart",GraphicalChild:me,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:ye},{axisType:"yAxis",AxisComp:Ne},{axisType:"zAxis",AxisComp:_e}],formatAxisMap:ot}),Dr=st({chartName:"ComposedChart",GraphicalChild:[fe,it,Ht,me],axisComponents:[{axisType:"xAxis",AxisComp:ye},{axisType:"yAxis",AxisComp:Ne},{axisType:"zAxis",AxisComp:_e}],formatAxisMap:ot});const Rr=({data:r=[]})=>{if(r.length===0)return e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Evolução de IMC"}),e.jsx(re,{children:"Acompanhamento do Índice de Massa Corporal"})]}),e.jsx(Y,{children:e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Sem dados para exibir o gráfico"})})]});const t=r.filter(u=>u.bmi||u.calculatedBmi).map(u=>({date:je(new Date(u.record_date),"dd/MM/yy"),fullDate:je(new Date(u.record_date),"dd 'de' MMM",{locale:Ee}),bmi:parseFloat((u.bmi||u.calculatedBmi).toFixed(1)),originalDate:u.record_date}));if(t.length===0)return e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Evolução de IMC"}),e.jsx(re,{children:"Acompanhamento do Índice de Massa Corporal"})]}),e.jsx(Y,{children:e.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"Sem dados suficientes para calcular IMC"})})]});const o=t[0]?.bmi,s=t[t.length-1]?.bmi,i=s-o,l=u=>u<18.5?{label:"Abaixo do peso",variant:"secondary",color:"#3b82f6"}:u<25?{label:"Peso normal",variant:"success",color:"#10b981"}:u<30?{label:"Sobrepeso",variant:"warning",color:"#f59e0b"}:{label:"Obesidade",variant:"destructive",color:"#ef4444"},c=l(s),a=({active:u,payload:x})=>{if(u&&x&&x.length){const p=x[0].value,h=l(p);return e.jsxs("div",{className:"bg-background border border-border rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold",children:x[0].payload.fullDate}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["IMC: ",e.jsx("span",{className:"font-bold text-foreground",children:p})]}),e.jsx(ve,{variant:h.variant,className:"mt-1",children:h.label})]})}return null};return e.jsxs(G,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(X,{children:"Evolução de IMC"}),e.jsx(re,{children:"Índice de Massa Corporal ao longo do tempo"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"IMC Atual"}),e.jsx("p",{className:"text-2xl font-bold",children:s}),e.jsx(ve,{variant:c.variant,className:"mt-1",children:c.label})]})]})}),e.jsxs(Y,{children:[e.jsx(Ie,{width:"100%",height:300,children:e.jsxs(Dr,{data:t,margin:{top:5,right:20,left:0,bottom:5},children:[e.jsx(Le,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ye,{dataKey:"date",tick:{fontSize:12},className:"text-muted-foreground"}),e.jsx(Ne,{domain:[16,35],tick:{fontSize:12},className:"text-muted-foreground",label:{value:"IMC",angle:-90,position:"insideLeft",fontSize:12}}),e.jsx(Be,{content:e.jsx(a,{})}),e.jsx(qe,{}),e.jsx(xe,{y:18.5,stroke:"#3b82f6",strokeDasharray:"3 3",label:{value:"Abaixo",position:"insideTopLeft",fontSize:10}}),e.jsx(xe,{y:25,stroke:"#10b981",strokeDasharray:"3 3",label:{value:"Normal",position:"insideTopLeft",fontSize:10}}),e.jsx(xe,{y:30,stroke:"#f59e0b",strokeDasharray:"3 3",label:{value:"Sobrepeso",position:"insideTopLeft",fontSize:10}}),e.jsx(it,{type:"monotone",dataKey:"bmi",fill:c.color,fillOpacity:.1,stroke:"none"}),e.jsx(fe,{type:"monotone",dataKey:"bmi",name:"IMC",stroke:c.color,strokeWidth:2,dot:{fill:c.color,r:4},activeDot:{r:6}})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Primeiro"}),e.jsx("p",{className:"text-lg font-semibold",children:o})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Atual"}),e.jsx("p",{className:"text-lg font-semibold",children:s})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Variação"}),e.jsxs("p",{className:`text-lg font-semibold ${i>=0?"text-red-600":"text-green-600"}`,children:[i>=0?"+":"",i.toFixed(1)]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 font-semibold",children:"Classificação IMC:"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-500"}),e.jsxs("span",{children:["< 18.5"," Abaixo"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{children:"18.5-25 Normal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500"}),e.jsx("span",{children:"25-30 Sobrepeso"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsxs("span",{children:["> 30"," Obesidade"]})]})]})]})]})]})};function $r({data:r=[]}){const t=f.useMemo(()=>!r||r.length===0?[]:r.filter(l=>l.weight&&l.record_date).map(l=>{const c=new Date(l.record_date),a=parseFloat(l.weight)||0,u=l.results||{},x=u.body_fat_percent||null,p=u.lean_mass_kg||null,h=u.fat_mass_kg||null;let d=p,m=h;if(!p&&x)m=a*x/100,d=a-m;else if(!p&&l.bioimpedance?.percent_gordura){const y=parseFloat(l.bioimpedance.percent_gordura);m=a*y/100,d=a-m}return{date:je(c,"dd/MM/yyyy",{locale:Ee}),dateValue:c,weight:a.toFixed(1),leanMass:d?d.toFixed(1):null,fatMass:m?m.toFixed(1):null}}).sort((l,c)=>l.dateValue-c.dateValue),[r]);if(t.length===0)return e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Composição Corporal"}),e.jsx(re,{children:"Evolução de peso, massa magra e massa gorda"})]}),e.jsx(Y,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:e.jsx("p",{children:"Nenhum dado disponível para exibir"})})})]});const o=t.some(l=>l.leanMass!==null||l.fatMass!==null),s=f.useMemo(()=>!r||r.length===0?[]:r.filter(l=>l.results?.somatotype).map(l=>{const c=l.results.somatotype,a=new Date(l.record_date);return{date:je(a,"dd/MM/yyyy",{locale:Ee}),dateValue:a,x:c.x||c.ecto-c.endo,y:c.y||2*c.meso-(c.endo+c.ecto),endo:c.endo,meso:c.meso,ecto:c.ecto}}).sort((l,c)=>l.dateValue-c.dateValue),[r]),i=s.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Composição Corporal"}),e.jsx(re,{children:"Evolução de peso, massa magra e massa gorda ao longo do tempo"})]}),e.jsxs(Y,{children:[e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(Zt,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Le,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ye,{dataKey:"date",className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},angle:-45,textAnchor:"end",height:80}),e.jsx(Ne,{className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"},label:{value:"Peso (kg)",angle:-90,position:"insideLeft"}}),e.jsx(Be,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(l,c)=>l===null||l==="null"?["N/A",c]:[`${l} kg`,c]}),e.jsx(qe,{formatter:l=>({weight:"Peso Total",leanMass:"Massa Magra",fatMass:"Massa Gorda"})[l]||l}),e.jsx(fe,{type:"monotone",dataKey:"weight",stroke:"#ffffff",strokeWidth:2,dot:{fill:"#ffffff",r:4},name:"weight"}),o&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{type:"monotone",dataKey:"leanMass",stroke:"#10b981",strokeWidth:2,dot:{fill:"#10b981",r:4},strokeDasharray:"5 5",name:"leanMass"}),e.jsx(fe,{type:"monotone",dataKey:"fatMass",stroke:"#ef4444",strokeWidth:2,dot:{fill:"#ef4444",r:4},strokeDasharray:"5 5",name:"fatMass"})]})]})}),!o&&e.jsx("div",{className:"mt-4 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:"Preencha dados de composição corporal (dobras cutâneas ou bioimpedância) para visualizar massa magra e massa gorda."})})]})]}),i&&e.jsxs(G,{children:[e.jsxs(U,{children:[e.jsx(X,{children:"Somatochart (Heath-Carter)"}),e.jsx(re,{children:"Visualização do somatotipo ao longo do tempo. Cada ponto representa um registro."})]}),e.jsxs(Y,{children:[e.jsx(Ie,{width:"100%",height:400,children:e.jsxs(Tr,{margin:{top:20,right:20,bottom:60,left:60},children:[e.jsx(Le,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ye,{type:"number",dataKey:"x",name:"X",domain:[-8,8],label:{value:"Ectomorfia - Endomorfia",position:"insideBottom",offset:-5},className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Ne,{type:"number",dataKey:"y",name:"Y",domain:[-8,8],label:{value:"2×Mesomorfia - (Endomorfia + Ectomorfia)",angle:-90,position:"insideLeft"},className:"text-xs",tick:{fill:"hsl(var(--muted-foreground))"}}),e.jsx(Be,{cursor:{strokeDasharray:"3 3"},contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px"},formatter:(l,c,a)=>c==="x"?[`X: ${a.payload.x.toFixed(2)}`,"Coordenada X"]:c==="y"?[`Y: ${a.payload.y.toFixed(2)}`,"Coordenada Y"]:c==="endo"?[`Endo: ${a.payload.endo}`,"Endomorfia"]:c==="meso"?[`Meso: ${a.payload.meso}`,"Mesomorfia"]:c==="ecto"?[`Ecto: ${a.payload.ecto}`,"Ectomorfia"]:[l,c]}),e.jsx(qe,{}),e.jsx(xe,{x:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(xe,{y:0,stroke:"#888",strokeDasharray:"2 2"}),e.jsx(me,{name:"Somatotipo",data:s,fill:"#8b5cf6",children:s.map((l,c)=>e.jsx("circle",{cx:l.x,cy:l.y,r:6,fill:"#8b5cf6",stroke:"#fff",strokeWidth:2},c))})]})}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{children:"Endomorfia (Gordura)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{children:"Mesomorfia (Músculo)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{children:"Ectomorfia (Linearidade)"})]})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"O gráfico mostra a evolução do somatotipo. Pontos mais à esquerda indicam maior endomorfia, à direita maior ectomorfia, e acima maior mesomorfia."})]})]})]})]})}const ma=()=>{const{patientId:r}=vt(),t=yt(),{toast:o}=et(),[s,i]=f.useState(!0),[l,c]=f.useState(!1),[a,u]=f.useState([]),[x,p]=f.useState([]),[h,d]=f.useState(null),[m,y]=f.useState(null),[b,_]=f.useState(null),[k,C]=f.useState(null),[N,O]=f.useState(null),g=f.useCallback(async()=>{i(!0),y(null);try{const{data:S}=await V.from("user_profiles").select("gender, birth_date").eq("id",r).single();S&&O(S);const[w,E]=await Promise.all([ar(r,{limit:50}),sr(r)]);if(w.error)throw console.error("Erro ao buscar registros:",w.error),new Error("Erro ao buscar registros antropométricos");if(E.error)throw console.error("Erro ao buscar dados de gráficos:",E.error),new Error("Erro ao buscar dados de gráficos");if(u(w.data||[]),p(E.data||[]),w.data&&w.data.length>0){const K=w.data[0];if(_(K),K.height&&K.weight){const R=parseFloat(K.height)/100,Te=18.5*Math.pow(R,2),De=24.9*Math.pow(R,2);C({min:Te,max:De,current:parseFloat(K.weight)})}else C(null)}else _(null),C(null)}catch(S){console.error("Erro ao carregar dados:",S);const w=S.message||"Erro ao carregar dados";y(w),o({title:"Erro",description:w,variant:"destructive"})}finally{i(!1)}},[r,o]);f.useEffect(()=>{g()},[g]);const ae=async(S,w=null)=>{c(!0);try{let E;if(w?E=await ir(w,S):E=await or(S),E.error)throw E.error;o({title:"Sucesso",description:w?"Registro atualizado com sucesso":"Registro criado com sucesso",variant:"success"}),d(null),await g()}catch(E){console.error("Erro ao salvar registro:",E),o({title:"Erro",description:E.message||"Não foi possível salvar o registro",variant:"destructive"})}finally{c(!1)}},D=S=>{d(S),window.scrollTo({top:0,behavior:"smooth"})},H=async S=>{if(window.confirm("Tem certeza que deseja excluir este registro?"))try{const w=await nr(S.id);if(w.error)throw w.error;o({title:"Sucesso",description:"Registro excluído com sucesso",variant:"success"}),await g()}catch(w){console.error("Erro ao deletar registro:",w),o({title:"Erro",description:w.message||"Não foi possível excluir o registro",variant:"destructive"})}},z=()=>{d(null)};return e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{variant:"ghost",size:"sm",onClick:()=>t(`/nutritionist/patients/${r}/hub`),className:"-ml-2 text-[#5f6f52] hover:text-[#5f6f52] hover:bg-[#5f6f52]/10",children:[e.jsx(Jt,{className:"w-4 h-4 mr-1"}),"Voltar"]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:g,disabled:s,className:"flex-shrink-0",children:[e.jsx(Qt,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),e.jsx("span",{className:"hidden sm:inline",children:"Atualizar"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(er,{className:"w-6 h-6 sm:w-8 sm:h-8 text-[#5f6f52]"}),e.jsx("span",{className:"truncate",children:"Avaliação Antropométrica"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Acompanhamento de peso, altura e IMC"}),b&&b.weight&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Peso atual:"}),e.jsxs("span",{className:"font-semibold",children:[b.weight," kg"]})]}),k&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Peso ideal:"}),e.jsxs("span",{className:"font-semibold text-[#5f6f52]",children:[k.min.toFixed(1)," - ",k.max.toFixed(1)," kg"]}),k.current&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${k.current<k.min?"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300":k.current>k.max?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300":"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"}`,children:k.current<k.min?"Abaixo":k.current>k.max?"Acima":"Ideal"})]})]})]})]}),m&&e.jsxs(ie,{variant:"destructive",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx(ne,{children:m})]}),e.jsx(pr,{patientId:r,initialData:h,onSubmit:ae,onCancel:z,loading:l,patientGender:N?.gender,patientBirthDate:N?.birth_date}),e.jsxs("div",{className:"space-y-6",children:[a.some(S=>S.results||S.bioimpedance)&&e.jsx($r,{data:a}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx($t,{data:x}),e.jsx(Rr,{data:x})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Histórico de Registros"}),e.jsx(hr,{records:a,onEdit:D,onDelete:H,loading:s})]})]})};export{ma as default};
