import{q as J,j as e,C as _,c as L,d as B,e as D,B as H,Q as Re,$ as w,r as h,w as V,a5 as ze,b as Oe,a as He,s as E,L as je,U as Ve}from"./index-qjbGaV1R.js";import{I as W}from"./input-DMmXNW5d.js";import{L as k}from"./label-TnYOms6c.js";import{S as Ue}from"./slider-Nh4D61pV.js";import{S as be,a as ve,b as Ne,c as ye,d as le}from"./select-DG44e7yv.js";import{B as v}from"./badge-Du_-s9xo.js";import{A as We,a as Ye}from"./alert-DBEptxdU.js";import{T as Ze,a as Je,b as Se,c as Y,d as Qe,e as Z}from"./table-B7W2DKKf.js";import{P as Me,a as we,b as Ce}from"./popover-BDxVETTl.js";import{I as Ae}from"./info-CuZxRFa3.js";import{S as Xe}from"./star-DFj09U19.js";import{A as Te}from"./activity-DyXgAM1j.js";import{M as Ke}from"./minus-CUHDNZLM.js";import{T as ea}from"./trending-down-BMVfUuJI.js";import{T as $e}from"./trending-up-Bjnf_8I8.js";import{f as aa,h as sa}from"./patient-queries-BD-xdZDl.js";import{d as ta,h as Fe}from"./anthropometry-queries-BKcJ2V2y.js";import{A as ra}from"./arrow-left-DncQmOX0.js";import{A as na}from"./alert-circle-Bmhv_HxM.js";import{C as la}from"./calculator-Cvkr22Mi.js";import{T as ia}from"./target-BHcfsEYQ.js";import{S as oa}from"./save-BFnQGCtf.js";import{D as ca}from"./database-Dimt_sH2.js";import"./index-DXPfCx4s.js";import"./extends-CF3RwP-h.js";import"./mealTranslations-B1KHhmEq.js";import"./query-helpers-CC2p4I3d.js";const da=J("Dumbbell",[["path",{d:"m6.5 6.5 11 11",key:"f7oqzb"}],["path",{d:"m21 21-1-1",key:"cpc6if"}],["path",{d:"m3 3 1 1",key:"d3rpuf"}],["path",{d:"m18 22 4-4",key:"1e32o6"}],["path",{d:"m2 6 4-4",key:"189tqz"}],["path",{d:"m3 10 7-7",key:"1bxui2"}],["path",{d:"m14 21 7-7",key:"16x78n"}]]),ma=J("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]),ua=J("Sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 11v5a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H6v-2a2 2 0 0 0-4 0Z",key:"u5qfb7"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]),xa=J("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function _e({breakdown:a,variant:i="default"}){if(!a)return null;const s=()=>e.jsx(Ae,{className:"w-3.5 h-3.5 text-muted-foreground hover:text-foreground transition-colors cursor-help"});return i==="compact"?e.jsxs(Me,{children:[e.jsx(we,{asChild:!0,children:e.jsx("span",{className:"inline-flex items-center",children:e.jsx(s,{})})}),e.jsx(Ce,{className:"w-80 p-0",side:"top",align:"start",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:a.formulaName}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono bg-muted/50 p-2 rounded",children:a.appliedStr})]}),a.baseData&&e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Baseado em:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.baseData.weight&&e.jsxs(v,{variant:"outline",className:"text-[10px]",children:["Peso: ",a.baseData.weight,"kg"]}),a.baseData.height&&e.jsxs(v,{variant:"outline",className:"text-[10px]",children:["Altura: ",a.baseData.height,"cm"]}),a.baseData.age&&e.jsxs(v,{variant:"outline",className:"text-[10px]",children:["Idade: ",a.baseData.age," anos"]}),a.baseData.leanMass&&e.jsxs(v,{variant:"outline",className:"text-[10px]",children:["MM: ",a.baseData.leanMass,"kg"]}),a.baseData.gender&&e.jsx(v,{variant:"outline",className:"text-[10px]",children:a.baseData.gender})]})]})]})})]}):e.jsxs(Me,{children:[e.jsx(we,{asChild:!0,children:e.jsx("span",{className:"inline-flex items-center",children:e.jsx(s,{})})}),e.jsx(Ce,{className:"w-96 p-0",side:"top",align:"start",children:e.jsxs(_,{className:"border-0 shadow-none",children:[e.jsx(L,{className:"pb-3",children:e.jsxs(B,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-primary"}),a.formulaName]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:"F√≥rmula:"}),e.jsx("p",{className:"text-sm font-mono bg-muted/50 p-2 rounded",children:a.equationStr})]}),e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5",children:"C√°lculo Aplicado:"}),e.jsx("p",{className:"text-sm font-mono bg-primary/10 p-2 rounded border border-primary/20",children:a.appliedStr})]}),a.steps&&a.steps.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Passos:"}),e.jsx("div",{className:"space-y-1.5",children:a.steps.map((r,l)=>e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:[r.label,":"]}),e.jsx("span",{className:"font-mono font-medium",children:r.value})]},l))})]})]}),a.baseData&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t my-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Dados Utilizados:"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[a.baseData.weight&&e.jsxs(v,{variant:"secondary",className:"text-[10px]",children:["Peso: ",a.baseData.weight,"kg"]}),a.baseData.height&&e.jsxs(v,{variant:"secondary",className:"text-[10px]",children:["Altura: ",a.baseData.height,"cm"]}),a.baseData.age&&e.jsxs(v,{variant:"secondary",className:"text-[10px]",children:["Idade: ",a.baseData.age," anos"]}),a.baseData.leanMass&&e.jsxs(v,{variant:"default",className:"text-[10px]",children:["MM: ",a.baseData.leanMass,"kg"]}),a.baseData.gender&&e.jsx(v,{variant:"secondary",className:"text-[10px]",children:a.baseData.gender}),a.baseData.activityLabel&&e.jsx(v,{variant:"outline",className:"text-[10px]",children:a.baseData.activityLabel})]})]})]})]})]})})]})}const ha=(a,i,s,r)=>r==="male"||r==="masculino"||r==="m"?88.362+13.397*a+4.799*i-5.677*s:447.593+9.247*a+3.098*i-4.33*s,ga=(a,i,s,r)=>{const l=r==="male"||r==="masculino"||r==="m"?5:-161;return 10*a+6.25*i-5*s+l},pa=a=>!a||a<=0?null:500+22*a,fa=(a,i)=>!i||i<=0?null:25.9*i+284,ja=(a,i,s,r)=>r==="male"||r==="masculino"||r==="m"?15.3*a+679:14.7*a+496,ie=[{value:1.2,label:"Sedent√°rio",desc:"Pouco ou nenhum exerc√≠cio",short:"Sedent√°rio"},{value:1.375,label:"Levemente Ativo",desc:"Exerc√≠cio leve 1-3 dias/semana",short:"Leve"},{value:1.55,label:"Moderadamente Ativo",desc:"Exerc√≠cio moderado 3-5 dias/semana",short:"Moderado"},{value:1.725,label:"Muito Ativo",desc:"Exerc√≠cio pesado 6-7 dias/semana",short:"Muito Ativo"},{value:1.9,label:"Extremamente Ativo",desc:"Trabalho f√≠sico pesado ou treino 2x ao dia",short:"Extremo"}],ba=(a,i)=>!a||a<=0||!i||i<=0?0:a*i,va=a=>{const{weight:i,height:s,age:r,gender:l,leanMass:x}=a;if(!i||!s||!r||!l)return[];const o=[{id:"harris",name:"Harris-Benedict (1984)",description:"Cl√°ssico. Bom para popula√ß√£o geral.",bmr:ha(i,s,r,l),category:"general"},{id:"mifflin",name:"Mifflin-St Jeor",description:"Padr√£o ouro cl√≠nico. Mais preciso para sobrepeso.",recommended:!0,bmr:ga(i,s,r,l),category:"clinical"},{id:"fao",name:"FAO/WHO",description:"Padr√£o da Organiza√ß√£o Mundial da Sa√∫de.",bmr:ja(i,s,r,l),category:"general"}];if(x&&x>0){const m=pa(x),u=fa(i,x);m!==null&&o.push({id:"cunningham",name:"Cunningham (Atletas)",description:"Baseado na Massa Magra. Ideal para alta performance.",bmr:m,category:"athlete"}),u!==null&&o.push({id:"tinsley",name:"Tinsley (Bodybuilding)",description:"Espec√≠fico para treinamento de for√ßa.",bmr:u,category:"athlete"})}return o},Na=(a,i)=>{const{weight:s,height:r,age:l,gender:x,leanMass:o}=i,m=x==="male"||x==="masculino"||x==="m";switch(a){case"harris":{if(!s||!r||!l||!x)return null;const u=m?88.362:447.593,d=m?13.397:9.247,p=m?4.799:3.098,b=m?5.677:4.33,C=d*s,y=p*r,q=b*l,S=u+C+y-q;return{formulaName:`Harris-Benedict (${m?"Masculino":"Feminino"})`,equationStr:m?"88.362 + (13.397 √ó P) + (4.799 √ó A) - (5.677 √ó I)":"447.593 + (9.247 √ó P) + (3.098 √ó A) - (4.330 √ó I)",appliedStr:`${u.toFixed(3)} + (${d.toFixed(3)} √ó ${s}) + (${p.toFixed(3)} √ó ${r}) - (${b.toFixed(3)} √ó ${l})`,steps:[{label:"Constante",value:u.toFixed(3)},{label:"Peso",value:`${d.toFixed(3)} √ó ${s} = ${C.toFixed(2)}`},{label:"Altura",value:`${p.toFixed(3)} √ó ${r} = ${y.toFixed(2)}`},{label:"Idade",value:`${b.toFixed(3)} √ó ${l} = ${q.toFixed(2)}`},{label:"Resultado",value:`${S.toFixed(0)} kcal`}],baseData:{weight:s,height:r,age:l,gender:m?"Masculino":"Feminino"}}}case"mifflin":{if(!s||!r||!l||!x)return null;const u=m?5:-161,d=10*s,p=6.25*r,b=5*l,C=d+p-b+u;return{formulaName:`Mifflin-St Jeor (${m?"Masculino":"Feminino"})`,equationStr:"(10 √ó P) + (6.25 √ó A) - (5 √ó I) + S",appliedStr:`(10 √ó ${s}) + (6.25 √ó ${r}) - (5 √ó ${l}) + ${u}`,steps:[{label:"Peso",value:`10 √ó ${s} = ${d}`},{label:"Altura",value:`6.25 √ó ${r} = ${p.toFixed(2)}`},{label:"Idade",value:`5 √ó ${l} = ${b}`},{label:"Constante (S)",value:u.toString()},{label:"Resultado",value:`${C.toFixed(0)} kcal`}],baseData:{weight:s,height:r,age:l,gender:m?"Masculino":"Feminino"}}}case"cunningham":{if(!o||o<=0)return null;const u=500,d=22*o,p=u+d;return{formulaName:"Cunningham (Atletas)",equationStr:"500 + (22 √ó MM)",appliedStr:`500 + (22 √ó ${o})`,steps:[{label:"Constante",value:"500"},{label:"Massa Magra",value:`22 √ó ${o} = ${d.toFixed(2)}`},{label:"Resultado",value:`${p.toFixed(0)} kcal`}],baseData:{leanMass:o,weight:s,height:r,age:l,gender:m?"Masculino":"Feminino"}}}case"tinsley":{if(!s||!o||o<=0)return null;const u=284,d=25.9*o,p=d+u;return{formulaName:"Tinsley (Bodybuilding)",equationStr:"(25.9 √ó MM) + 284",appliedStr:`(25.9 √ó ${o}) + 284`,steps:[{label:"Massa Magra",value:`25.9 √ó ${o} = ${d.toFixed(2)}`},{label:"Constante",value:"284"},{label:"Resultado",value:`${p.toFixed(0)} kcal`}],baseData:{leanMass:o,weight:s,height:r,age:l,gender:m?"Masculino":"Feminino"}}}case"fao":{if(!s||!x)return null;const u=m?15.3:14.7,d=m?679:496,p=u*s,b=p+d;return{formulaName:`FAO/WHO (${m?"Masculino":"Feminino"})`,equationStr:m?"(15.3 √ó P) + 679":"(14.7 √ó P) + 496",appliedStr:`(${u} √ó ${s}) + ${d}`,steps:[{label:"Peso",value:`${u} √ó ${s} = ${p.toFixed(2)}`},{label:"Constante",value:d.toString()},{label:"Resultado",value:`${b.toFixed(0)} kcal`}],baseData:{weight:s,height:r,age:l,gender:m?"Masculino":"Feminino"}}}default:return null}},ya=(a,i,s=null)=>{if(!a||!i)return null;const r=a*i,l=ie.find(x=>x.value===i);return{formulaName:"Gasto Energ√©tico Total (GET)",equationStr:"TMB √ó NAF",appliedStr:`${Math.round(a)} √ó ${i} = ${Math.round(r)}`,steps:[{label:"Taxa Metab√≥lica Basal (TMB)",value:`${Math.round(a)} kcal`},{label:"N√≠vel de Atividade (NAF)",value:`${i}${s?` (${s})`:""}`},{label:"GET",value:`${Math.round(r)} kcal/dia`}],baseData:{bmr:Math.round(a),activityFactor:i,activityLabel:s||l?.label||"N/A"}}};function Sa({protocols:a,activityFactor:i,selectedProtocolId:s,onSelect:r,patientData:l}){if(!a||a.length===0)return null;const x=a.reduce((o,m)=>o+(m.bmr||0),0)/a.length;return e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-card shadow-sm",children:[e.jsxs("div",{className:"p-4 bg-muted/50 border-b flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-primary"}),"Comparativo Cient√≠fico"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Fator de Atividade: ",e.jsxs("strong",{className:"text-foreground",children:["x",i||1]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ze,{children:[e.jsx(Je,{children:e.jsxs(Se,{children:[e.jsx(Y,{children:"Protocolo"}),e.jsx(Y,{children:"TMB (Basal)"}),e.jsx(Y,{children:"GET (Total)"}),e.jsx(Y,{className:"text-right",children:"A√ß√£o"})]})}),e.jsx(Qe,{children:a.map(o=>{if(!o.bmr||o.bmr<=0)return null;const m=Math.round(o.bmr*(i||1)),u=s===o.id,d=x>0?Math.round((o.bmr-x)/x*100):0;return e.jsxs(Se,{className:u?"bg-primary/5 border-primary/20":"",children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"font-medium flex items-center gap-2",children:[o.name,o.recommended&&e.jsx(v,{variant:"default",className:"text-[10px] h-5 px-1.5",children:"Recomendado"}),(o.category==="athlete"||o.id==="cunningham"||o.id==="tinsley")&&e.jsx(v,{variant:"secondary",className:"text-[10px] h-5 px-1.5",children:"Atleta"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o.description})]})}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-mono text-base font-semibold",children:[Math.round(o.bmr)," kcal"]}),x>0&&e.jsxs("span",{className:`text-[10px] ${d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-muted-foreground"}`,children:[d>0?"+":"",d,"% da m√©dia"]})]}),l&&(()=>{const p=Na(o.id,l);return p?e.jsx(_e,{breakdown:p,variant:"compact"}):null})()]})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"font-bold text-primary text-lg",children:[m," kcal"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Gasto Energ√©tico Total"})]}),e.jsx(Z,{className:"text-right",children:e.jsx(H,{size:"sm",variant:u?"default":"outline",onClick:()=>r&&r(o),className:"gap-2 transition-all",disabled:!r,children:u?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Selecionado"})]}):"Usar este"})})]},o.id)})})]})})]})}const Ma={1.2:ua,1.375:ma,1.55:Te,1.725:da,1.9:xa},wa={1.2:"border-gray-300 bg-gray-50 hover:bg-gray-100",1.375:"border-blue-300 bg-blue-50 hover:bg-blue-100",1.55:"border-green-300 bg-green-50 hover:bg-green-100",1.725:"border-orange-300 bg-orange-50 hover:bg-orange-100",1.9:"border-purple-300 bg-purple-50 hover:bg-purple-100"},Ca={1.2:"border-gray-500 bg-gray-100 ring-2 ring-gray-400",1.375:"border-blue-500 bg-blue-100 ring-2 ring-blue-400",1.55:"border-green-500 bg-green-100 ring-2 ring-green-400",1.725:"border-orange-500 bg-orange-100 ring-2 ring-orange-400",1.9:"border-purple-500 bg-purple-100 ring-2 ring-purple-400"};function Aa({value:a,onChange:i}){return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3",children:ie.map(s=>{const r=Ma[s.value]||Te,l=a===s.value;return e.jsx(_,{className:w("cursor-pointer transition-all duration-200",l?Ca[s.value]:wa[s.value]),onClick:()=>i&&i(s.value),children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[e.jsx(r,{className:w("w-8 h-8",l?"text-primary":"text-muted-foreground")}),e.jsxs("div",{children:[e.jsx("p",{className:w("font-semibold text-sm",l?"text-foreground":"text-muted-foreground"),children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.desc})]}),e.jsxs("div",{className:w("text-xs font-mono px-2 py-1 rounded",l?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:["x",s.value]})]})})},s.value)})})}function Fa({dailyDeficit:a=0}){const s=h.useMemo(()=>{if(!a||a===0)return{weeklyMin:0,weeklyMax:0,weeklyAvg:0,monthlyEstimate:0,isLoss:!1,isGain:!1};const r=a<0,l=Math.abs(a)*7/7700,x=l*.1,o=Math.max(0,l-x),m=l+x,u=l*4.33;return{weeklyMin:o,weeklyMax:m,weeklyAvg:l,monthlyEstimate:u,isLoss:r,isGain:!r}},[a]);return a===0?e.jsx(_,{className:"border-dashed",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsx("p",{className:"text-sm",children:"Ajuste o slider para ver a proje√ß√£o"})]})})}):e.jsxs(_,{className:w("border-2",s.isLoss?"border-green-500/50 bg-green-50/50 dark:bg-green-950/20":"border-blue-500/50 bg-blue-50/50 dark:bg-blue-950/20"),children:[e.jsxs(L,{className:"pb-3",children:[e.jsxs(B,{className:"text-base flex items-center gap-2",children:[s.isLoss?e.jsx(ea,{className:"w-5 h-5 text-green-600"}):e.jsx($e,{className:"w-5 h-5 text-blue-600"}),"Proje√ß√£o de Mudan√ßa de Peso"]}),e.jsxs(V,{className:"text-xs",children:["Baseado em ",Math.abs(a)," kcal ",s.isLoss?"de d√©ficit":"de super√°vit"," di√°rio"]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:w("p-4 rounded-lg",s.isLoss?"bg-green-100 dark:bg-green-900/30":"bg-blue-100 dark:bg-blue-900/30"),children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2 text-center",children:"Ritmo Estimado"}),e.jsxs("p",{className:w("text-2xl font-bold text-center",s.isLoss?"text-green-700 dark:text-green-400":"text-blue-700 dark:text-blue-400"),children:[s.isLoss?"-":"+",s.weeklyMin.toFixed(2),"kg - ",s.weeklyMax.toFixed(2),"kg"]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-1",children:"por semana"})]}),e.jsxs("div",{className:w("p-3 rounded-lg text-center",s.isLoss?"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800":"bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800"),children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Em 1 m√™s"}),e.jsxs("p",{className:w("text-xl font-semibold",s.isLoss?"text-green-700 dark:text-green-400":"text-blue-700 dark:text-blue-400"),children:["~",s.isLoss?"-":"+",s.monthlyEstimate.toFixed(1)," kg"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:[e.jsx("span",{className:"font-medium",children:"‚ö†Ô∏è Estimativa matem√°tica."})," Resultados variam conforme ades√£o, metabolismo e adapta√ß√£o metab√≥lica."]})})]})]})}const ts=()=>{const{patientId:a}=ze(),i=Oe(),{toast:s}=He(),[r,l]=h.useState(!0),[x,o]=h.useState(!1),[m,u]=h.useState(""),[d,p]=h.useState(""),[b,C]=h.useState(""),[y,q]=h.useState(""),[S,oe]=h.useState(""),[I,ce]=h.useState(""),[de,A]=h.useState({weight:null,height:null,leanMass:null}),[F,P]=h.useState(1.55),[G,Q]=h.useState("mifflin"),[T,R]=h.useState(0),[Ta,z]=h.useState(null),[me,X]=h.useState(null),[De,K]=h.useState(null),[ee,ae]=h.useState(null),[U,ue]=h.useState([]),[M,se]=h.useState(null),[xe,Pe]=h.useState(0),[he,Ee]=h.useState(0);h.useEffect(()=>{ge()},[a]),h.useEffect(()=>{d&&b&&y&&S&&ke()},[d,b,y,S,I]),h.useEffect(()=>{if(M){const t=ba(M.bmr,F);Pe(t),Ee(t+T)}},[M,F,T]);const ge=async()=>{l(!0);try{let t=!1,c=!1;const{data:g,error:f}=await E.from("user_profiles").select("name, birth_date, gender, weight, height").eq("id",a).single();if(f)throw f;if(u(g.name||"Paciente"),oe(g.gender||""),g.birth_date){const n=new Date(g.birth_date),O=new Date,ne=O.getFullYear()-n.getFullYear(),fe=O.getMonth()-n.getMonth(),Ge=fe<0||fe===0&&O.getDate()<n.getDate()?ne-1:ne;q(Ge.toString())}let j=null;{const{data:n,error:O}=await E.from("growth_records").select("weight, height, results, record_date").eq("patient_id",a).eq("is_latest_revision",!0).order("record_date",{ascending:!1}).limit(1).maybeSingle();O?j=(await E.from("growth_records").select("weight, height, results, record_date").eq("patient_id",a).order("record_date",{ascending:!1}).limit(1).maybeSingle()).data||null:j=n}j?.weight?(p(j.weight.toString()),A(n=>({...n,weight:"anthropometry"}))):g.weight&&(p(g.weight.toString()),A(n=>({...n,weight:"profile"}))),j?.height?(C(j.height.toString()),A(n=>({...n,height:"anthropometry"}))):g.height&&(C(g.height.toString()),A(n=>({...n,height:"profile"}))),j?.results?.lean_mass_kg&&(ce(j.results.lean_mass_kg.toString()),A(n=>({...n,leanMass:"anthropometry"})));const[N,re]=await Promise.all([aa(a),sa(a)]);if(N.data?.exerciseFrequency){const n=N.data.exerciseFrequency.toString().toLowerCase();n.includes("sedent")||n.includes("n√£o")||n.includes("nao")||n==="0"?(P(1.2),z("Sedent√°rio (baseado na anamnese)"),t=!0):n.includes("1-3")||n.includes("1 a 3")||n.includes("leve")?(P(1.375),z("Levemente Ativo (baseado na anamnese)"),t=!0):n.includes("3-5")||n.includes("3 a 5")||n.includes("moder")?(P(1.55),z("Moderadamente Ativo (baseado na anamnese)"),t=!0):n.includes("6-7")||n.includes("6 a 7")||n.includes("muito")?(P(1.725),z("Muito Ativo (baseado na anamnese)"),t=!0):(n.includes("2x")||n.includes("duas")||n.includes("extremo"))&&(P(1.9),z("Extremamente Ativo (baseado na anamnese)"),t=!0)}if(re.data){const n=(re.data.goal_type||re.data.type||"").toLowerCase();n==="weight_loss"||n==="perda_peso"||n==="emagrecimento"?(R(-500),X("Perda de Peso"),K("goal"),c=!0):n==="hypertrophy"||n==="hipertrofia"||n==="ganho_massa"?(R(300),X("Hipertrofia"),K("goal"),c=!0):(n==="maintenance"||n==="manutencao")&&(R(0),X("Manuten√ß√£o"),K("goal"),c=!0)}const{data:$}=await E.from("energy_expenditure_calculations").select("*").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();$&&(t||P(parseFloat($.activity_level)||1.55),!c&&$.get_with_activities&&$.get&&R($.get_with_activities-$.get),$.protocol&&Q({"harris-benedict":"harris","mifflin-st-jeor":"mifflin","fao-who":"fao",harris:"harris",mifflin:"mifflin",fao:"fao",cunningham:"cunningham",tinsley:"tinsley"}[$.protocol]||"mifflin"));const{data:qe}=await ta(a);ae(qe||null)}catch(t){console.error("Erro ao carregar dados:",t),s({title:"Erro",description:"N√£o foi poss√≠vel carregar os dados do paciente.",variant:"destructive"})}finally{l(!1)}},ke=()=>{const t={weight:parseFloat(d),height:parseFloat(b),age:parseInt(y),gender:S,leanMass:I?parseFloat(I):null};if(!t.weight||!t.height||!t.age||!t.gender){ue([]);return}const c=va(t);ue(c);const g=c.find(f=>f.id===G);if(!g&&c.length>0){const f=c.find(j=>j.recommended)||c[0];Q(f.id),se(f)}else g&&se(g)},pe=t=>{Q(t.id),se(t)},Ie=async()=>{if(!M||!d||!b||!y||!S){s({title:"Dados incompletos",description:"Preencha todos os campos obrigat√≥rios.",variant:"destructive"});return}o(!0);try{const t={harris:"harris-benedict",mifflin:"mifflin-st-jeor",fao:"fao-who",cunningham:"cunningham",tinsley:"tinsley"},c={patient_id:a,weight:parseFloat(d),height:parseFloat(b),age:parseInt(y),gender:S,protocol:t[G]||G,activity_level:F,tmb:M.bmr,get:xe,get_with_activities:he,updated_at:new Date().toISOString()},{data:g}=await E.from("energy_expenditure_calculations").select("id").eq("patient_id",a).order("created_at",{ascending:!1}).limit(1).maybeSingle();let f;if(g){const{error:N}=await E.from("energy_expenditure_calculations").update(c).eq("id",g.id);f=N}else{const{error:N}=await E.from("energy_expenditure_calculations").insert(c);f=N}if(f)throw f;const{error:j}=await Fe(a,{energy:!0});j?console.warn("N√£o foi poss√≠vel limpar flag de energia automaticamente:",j):ae(N=>({...N||{},needs_energy_recalc:!1})),s({title:"Salvo!",description:"Planejamento energ√©tico salvo com sucesso."})}catch(t){console.error("Erro ao salvar:",t),s({title:"Erro",description:"N√£o foi poss√≠vel salvar o c√°lculo.",variant:"destructive"})}finally{o(!1)}},Le=t=>{if(!t)return null;const c=new Date(t);if(Number.isNaN(c.getTime()))return null;const g=Date.now()-c.getTime();if(g<0)return`atualizado em ${c.toLocaleString("pt-BR")}`;const f=Math.floor(g/6e4);if(f<1)return"atualizado agora";if(f<60)return`atualizado h√° ${f} min`;const j=Math.floor(f/60);if(j<24)return`atualizado h√° ${j}h`;const N=Math.floor(j/24);return N<=7?`atualizado h√° ${N} dia${N>1?"s":""}`:`atualizado em ${c.toLocaleDateString("pt-BR")} √†s ${c.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}`},Be=async()=>{const{error:t}=await Fe(a,{energy:!0});if(t){s({title:"N√£o foi poss√≠vel marcar como revisado",description:"Tente novamente em instantes.",variant:"destructive"});return}ae(c=>({...c||{},needs_energy_recalc:!1})),s({title:"Pend√™ncia removida",description:"O m√≥dulo de GET foi marcado como revisado.",variant:"success"})},te=t=>{const c=de[t];return c==="anthropometry"?e.jsxs(v,{variant:"secondary",className:"text-xs ml-2",children:[e.jsx(ca,{className:"w-3 h-3 mr-1"}),"Auto"]}):c==="profile"?e.jsxs(v,{variant:"outline",className:"text-xs ml-2",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Perfil"]}):null};return r?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(je,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"min-h-screen bg-background overflow-x-hidden",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 mb-6 min-w-0",children:[e.jsx(H,{variant:"ghost",size:"icon",onClick:()=>i(-1),className:"shrink-0",children:e.jsx(ra,{className:"w-5 h-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold break-words",children:"Centro de Controle Metab√≥lico"}),e.jsxs("p",{className:"text-muted-foreground text-sm md:text-base truncate",children:[m," - An√°lise e Planejamento Energ√©tico"]})]})]}),ee?.needs_energy_recalc&&e.jsxs(We,{className:"mb-6 border-amber-200 bg-amber-50",children:[e.jsx(na,{className:"h-4 w-4 text-amber-700"}),e.jsx(Ye,{className:"text-amber-800",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{children:"A antropometria foi atualizada recentemente. Recomendamos revisar/recalcular o GET e salvar."}),ee?.anthropometry_updated_at&&e.jsx("p",{className:"mt-1 text-xs text-amber-700/90",children:Le(ee.anthropometry_updated_at)})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[e.jsx(H,{type:"button",size:"sm",variant:"outline",className:"border-amber-300 bg-white text-amber-800 hover:bg-amber-100",onClick:ge,children:"Atualizar dados"}),e.jsx(H,{type:"button",size:"sm",variant:"ghost",className:"text-amber-900 hover:bg-amber-100",onClick:Be,children:"Marcar como revisado"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(la,{className:"w-5 h-5"}),"Dados Biol√≥gicos"]}),e.jsx(V,{children:"Par√¢metros para c√°lculo da TMB"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"weight",className:"flex items-center",children:["Peso (kg) *",te("weight")]}),e.jsx(W,{id:"weight",type:"number",step:"0.1",min:"1",value:d,onChange:t=>{p(t.target.value),A(c=>({...c,weight:"manual"}))},placeholder:"70.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"height",className:"flex items-center",children:["Altura (cm) *",te("height")]}),e.jsx(W,{id:"height",type:"number",step:"0.1",min:"50",value:b,onChange:t=>{C(t.target.value),A(c=>({...c,height:"manual"}))},placeholder:"175.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"age",children:"Idade (anos) *"}),e.jsx(W,{id:"age",type:"number",min:"1",max:"120",value:y,onChange:t=>q(t.target.value),placeholder:"30"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"gender",children:"Sexo *"}),e.jsxs(be,{value:S||"",onValueChange:oe,children:[e.jsx(ve,{id:"gender",children:e.jsx(Ne,{placeholder:"Selecione o sexo"})}),e.jsxs(ye,{children:[e.jsx(le,{value:"female",children:"Feminino"}),e.jsx(le,{value:"male",children:"Masculino"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"leanMass",className:"flex items-center",children:["Massa Magra (kg)",te("leanMass")]}),e.jsx(W,{id:"leanMass",type:"number",step:"0.1",min:"0",value:I,onChange:t=>{ce(t.target.value),A(c=>({...c,leanMass:"manual"}))},placeholder:"Opcional - Desbloqueia protocolos de atleta"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:de.leanMass==="anthropometry"?"Valor obtido do √∫ltimo registro de antropometria.":"Preencha para habilitar protocolos Cunningham e Tinsley."})]})]})]}),e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5"}),"N√≠vel de Atividade"]}),e.jsx(V,{children:"Selecione o fator de atividade f√≠sica"})]}),e.jsx(D,{children:e.jsx(Aa,{value:F,onChange:P})})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[U.length>0&&e.jsxs(_,{children:[e.jsxs(L,{children:[e.jsx(B,{children:"Comparativo Cient√≠fico"}),e.jsx(V,{children:"Compare diferentes f√≥rmulas de c√°lculo de TMB"})]}),e.jsx(D,{children:e.jsx(Sa,{protocols:U,activityFactor:F,selectedProtocolId:G,onSelect:pe,patientData:{weight:parseFloat(d)||0,height:parseFloat(b)||0,age:parseInt(y)||0,gender:S||"",leanMass:I?parseFloat(I):null}})})]}),M&&e.jsxs(_,{className:"sticky top-6",children:[e.jsxs(L,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ia,{className:"w-5 h-5"}),"Defini√ß√£o de Meta"]}),e.jsx(V,{children:"Configure o objetivo cal√≥rico final"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"protocolSelect",children:"Protocolo Base"}),e.jsxs(be,{value:G,onValueChange:t=>{const c=U.find(g=>g.id===t);c&&pe(c)},children:[e.jsx(ve,{id:"protocolSelect",children:e.jsx(Ne,{})}),e.jsx(ye,{children:U.map(t=>e.jsxs(le,{value:t.id,children:[t.name,t.recommended&&" (Recomendado)"]},t.id))})]})]}),e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gasto Energ√©tico Total (GET)"}),M&&(()=>{const t=ie.find(g=>g.value===F),c=ya(M.bmr,F,t?.label);return c?e.jsx(_e,{breakdown:c,variant:"compact"}):null})()]}),e.jsxs("p",{className:"text-2xl font-bold text-primary mt-1",children:[Math.round(xe)," ",e.jsx("span",{className:"text-base font-normal",children:"kcal/dia"})]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["TMB: ",Math.round(M.bmr)," kcal"]}),e.jsxs("p",{children:["NAF: x",F]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(k,{htmlFor:"goalAdjustment",children:"Ajuste de Objetivo (D√©ficit/Super√°vit)"}),e.jsxs("span",{className:`text-sm font-semibold ${T>0?"text-green-600":T<0?"text-red-600":"text-muted-foreground"}`,children:[T>0?"+":"",T," kcal"]})]}),me&&De&&e.jsxs(v,{variant:"outline",className:"self-start text-xs",children:["üí° Sugest√£o baseada no objetivo: ",e.jsx("strong",{children:me})]})]}),e.jsx(Ue,{id:"goalAdjustment",min:-1e3,max:1e3,step:50,value:[T],onValueChange:t=>R(t[0]),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"D√©ficit -1000"}),e.jsx("span",{children:"Equil√≠brio 0"}),e.jsx("span",{children:"Super√°vit +1000"})]})]}),e.jsx("div",{className:"p-6 bg-primary/10 border-2 border-primary/20 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Meta da Dieta"}),e.jsxs("p",{className:"text-5xl font-bold text-primary",children:[Math.round(he)," ",e.jsx("span",{className:"text-3xl font-normal",children:"kcal"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"por dia"})]})}),e.jsx(Fa,{dailyDeficit:T}),e.jsx(H,{onClick:Ie,disabled:x,size:"lg",className:"w-full",children:x?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"w-4 h-4 mr-2"}),"Salvar Planejamento"]})})]})]})]})]})]})})};export{ts as default};
