import{q as Q,V as le,W as Le,Y as Re,Z as Te,u as Ie,a as Ae,r as T,F as je,j as t,J as Be,K as qe,M as Ue,N as ze,U as Ee,_ as He,O as We,B as pe,L as Pe,s as Fe,t as Ye,b as Ze,m as Xe,C as $e,c as Ge,e as Je,g as Ke,E as Qe}from"./index-DL6VMzkS.js";import{I as R}from"./input-CMIeflfg.js";import{S as fe,a as ve,b as ge,c as xe,d as Y}from"./select-BdvFUaSV.js";import{L as E}from"./label-c61kF7fH.js";import"./popover-D1PQqJd4.js";import{p as et}from"./calendar-BOiwl0x6.js";import{T as tt}from"./textarea-D_72FZEz.js";import{T as nt,a as at,b as ye,c as we}from"./tabs-DCPXMA94.js";import{M as st}from"./mail-BUMMEZb5.js";import{P as rt,M as ot}from"./phone-Cu7tAStM.js";import{C as it}from"./calendar-jIa_pVTS.js";import{U as lt}from"./users-Bz7ifqG6.js";import{F as ct}from"./file-text-C4_WSc72.js";import{H as ut}from"./heart-BXXIE1zp.js";import{P as dt}from"./pen-square-BTn1AN_C.js";import{P as ht}from"./plus-D17bPVCi.js";import{S as mt}from"./search-DSoGe5N4.js";import"./extends-CF3RwP-h.js";import"./endOfMonth-fINJXo8H.js";import"./addMonths-Dpdm5UWc.js";import"./isSameDay-CfSWIrxC.js";import"./chevron-left-HK0xeE4r.js";const pt=Q("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),ft=Q("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),vt=Q("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),gt=Q("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),xt=Q("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]),kt=Q("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),bt=Q("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),Ce=p=>{let h;const w=new Set,A=(L,W)=>{const F=typeof L=="function"?L(h):L;if(!Object.is(F,h)){const H=h;h=W??(typeof F!="object"||F===null)?F:Object.assign({},h,F),w.forEach(G=>G(h,H))}},M=()=>h,i={setState:A,getState:M,getInitialState:()=>j,subscribe:L=>(w.add(L),()=>w.delete(L))},j=h=p(A,M,i);return i},jt=(p=>p?Ce(p):Ce),yt=p=>p;function wt(p,h=yt){const w=le.useSyncExternalStore(p.subscribe,le.useCallback(()=>h(p.getState()),[p,h]),le.useCallback(()=>h(p.getInitialState()),[p,h]));return le.useDebugValue(w),w}const Ne=p=>{const h=jt(p),w=A=>wt(h,A);return Object.assign(w,h),w},Ct=(p=>p?Ne(p):Ne),Se={name:"",email:"",birth_date:null,gender:"",phone:"",cpf:"",occupation:"",civil_status:"",observations:"",phone:"",cpf:"",occupation:"",civil_status:"",observations:"",cep:"",street:"",number:"",complement:"",neighborhood:"",city:"",state:""},Nt=Ct(p=>({formData:Se,updateField:(h,w)=>p(A=>({formData:{...A.formData,[h]:w}})),fillAddress:h=>p(w=>({formData:{...w.formData,street:h.logradouro||"",neighborhood:h.bairro||"",city:h.localidade||"",state:h.uf||""}})),resetForm:()=>p({formData:Se})}));var he={exports:{}},me,Me;function St(){if(Me)return me;Me=1;function p(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var h=p(Le()),w=Re();function A(n,s){for(var r=Object.getOwnPropertyNames(s),a=0;a<r.length;a++){var e=r[a],c=Object.getOwnPropertyDescriptor(s,e);c&&c.configurable&&n[e]===void 0&&Object.defineProperty(n,e,c)}return n}function M(){return(M=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n}).apply(this,arguments)}function ee(n,s){n.prototype=Object.create(s.prototype),A(n.prototype.constructor=n,s)}function Z(n,s){if(n==null)return{};var r,a,e={},c=Object.keys(n);for(a=0;a<c.length;a++)r=c[a],0<=s.indexOf(r)||(e[r]=n[r]);return e}function i(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var j=function(n,s,r,a,e,c,x,N){if(!n){var u;if(s===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[r,a,e,c,x,N],f=0;(u=new Error(s.replace(/%s/g,function(){return d[f++]}))).name="Invariant Violation"}throw u.framesToPop=1,u}},L=j;function W(n,s,r){if("selectionStart"in n&&"selectionEnd"in n)n.selectionStart=s,n.selectionEnd=r;else{var a=n.createTextRange();a.collapse(!0),a.moveStart("character",s),a.moveEnd("character",r-s),a.select()}}function F(n){var s=0,r=0;if("selectionStart"in n&&"selectionEnd"in n)s=n.selectionStart,r=n.selectionEnd;else{var a=document.selection.createRange();a.parentElement()===n&&(s=-a.moveStart("character",-n.value.length),r=-a.moveEnd("character",-n.value.length))}return{start:s,end:r,length:r-s}}var H={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},G="_";function y(n,s,r){var a="",e="",c=null,x=[];if(s===void 0&&(s=G),r==null&&(r=H),!n||typeof n!="string")return{maskChar:s,formatChars:r,mask:null,prefix:null,lastEditablePosition:null,permanents:[]};var N=!1;return n.split("").forEach(function(u){N=!N&&u==="\\"||(N||!r[u]?(x.push(a.length),a.length===x.length-1&&(e+=u)):c=a.length+1,a+=u,!1)}),{maskChar:s,formatChars:r,prefix:e,mask:a,lastEditablePosition:c,permanents:x}}function v(n,s){return n.permanents.indexOf(s)!==-1}function U(n,s,r){var a=n.mask,e=n.formatChars;if(!r)return!1;if(v(n,s))return a[s]===r;var c=e[a[s]];return new RegExp(c).test(r)}function te(n,s){return s.split("").every(function(r,a){return v(n,a)||!U(n,a,r)})}function J(n,s){var r=n.maskChar,a=n.prefix;if(!r){for(;s.length>a.length&&v(n,s.length-1);)s=s.slice(0,s.length-1);return s.length}for(var e=a.length,c=s.length;c>=a.length;c--){var x=s[c];if(!v(n,c)&&U(n,c,x)){e=c+1;break}}return e}function oe(n,s){return J(n,s)===n.mask.length}function B(n,s){var r=n.maskChar,a=n.mask,e=n.prefix;if(!r){for((s=ae(n,"",s,0)).length<e.length&&(s=e);s.length<a.length&&v(n,s.length);)s+=a[s.length];return s}if(s)return ae(n,B(n,""),s,0);for(var c=0;c<a.length;c++)v(n,c)?s+=a[c]:s+=r;return s}function ue(n,s,r,a){var e=r+a,c=n.maskChar,x=n.mask,N=n.prefix,u=s.split("");if(c)return u.map(function(f,S){return S<r||e<=S?f:v(n,S)?x[S]:c}).join("");for(var d=e;d<u.length;d++)v(n,d)&&(u[d]="");return r=Math.max(N.length,r),u.splice(r,e-r),s=u.join(""),B(n,s)}function ae(n,s,r,a){var e=n.mask,c=n.maskChar,x=n.prefix,N=r.split(""),u=oe(n,s);return!c&&a>s.length&&(s+=e.slice(s.length,a)),N.every(function(d){for(;D=d,v(n,k=a)&&D!==e[k];){if(a>=s.length&&(s+=e[a]),f=d,S=a,c&&v(n,S)&&f===c)return!0;if(++a>=e.length)return!1}var f,S,k,D;return!U(n,a,d)&&d!==c||(a<s.length?s=c||u||a<x.length?s.slice(0,a)+d+s.slice(a+1):(s=s.slice(0,a)+d+s.slice(a),B(n,s)):c||(s+=d),++a<e.length)}),s}function l(n,s,r,a){var e=n.mask,c=n.maskChar,x=r.split(""),N=a;return x.every(function(u){for(;f=u,v(n,d=a)&&f!==e[d];)if(++a>=e.length)return!1;var d,f;return(U(n,a,u)||u===c)&&a++,a<e.length}),a-N}function q(n,s){for(var r=s;0<=r;--r)if(!v(n,r))return r;return null}function I(n,s){for(var r=n.mask,a=s;a<r.length;++a)if(!v(n,a))return a;return null}function X(n){return n||n===0?n+"":""}function K(n,s,r,a,e){var c=n.mask,x=n.prefix,N=n.lastEditablePosition,u=s,d="",f=0,S=0,k=Math.min(e.start,r.start);return r.end>e.start?S=(f=l(n,a,d=u.slice(e.start,r.end),k))?e.length:0:u.length<a.length&&(S=a.length-u.length),u=a,S&&(S===1&&!e.length&&(k=e.start===r.start?I(n,r.start):q(n,r.start)),u=ue(n,u,k,S)),u=ae(n,u,d,k),(k+=f)>=c.length?k=c.length:k<x.length&&!f?k=x.length:k>=x.length&&k<N&&f&&(k=I(n,k)),d||(d=null),{value:u=B(n,u),enteredString:d,selection:{start:k,end:k}}}function se(){var n=new RegExp("windows","i"),s=new RegExp("phone","i"),r=navigator.userAgent;return n.test(r)&&s.test(r)}function O(n){return typeof n=="function"}function _e(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame}function ke(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame}function be(n){return(ke()?_e():function(){return setTimeout(n,1e3/60)})(n)}function de(n){(ke()||clearTimeout)(n)}var Ve=(function(n){function s(a){var e=n.call(this,a)||this;e.focused=!1,e.mounted=!1,e.previousSelection=null,e.selectionDeferId=null,e.saveSelectionLoopDeferId=null,e.saveSelectionLoop=function(){e.previousSelection=e.getSelection(),e.saveSelectionLoopDeferId=be(e.saveSelectionLoop)},e.runSaveSelectionLoop=function(){e.saveSelectionLoopDeferId===null&&e.saveSelectionLoop()},e.stopSaveSelectionLoop=function(){e.saveSelectionLoopDeferId!==null&&(de(e.saveSelectionLoopDeferId),e.saveSelectionLoopDeferId=null,e.previousSelection=null)},e.getInputDOMNode=function(){if(!e.mounted)return null;var o=w.findDOMNode(i(i(e))),m=typeof window<"u"&&o instanceof window.Element;if(o&&!m)return null;if(o.nodeName!=="INPUT"&&(o=o.querySelector("input")),!o)throw new Error("react-input-mask: inputComponent doesn't contain input node");return o},e.getInputValue=function(){var o=e.getInputDOMNode();return o?o.value:null},e.setInputValue=function(o){var m=e.getInputDOMNode();m&&(e.value=o,m.value=o)},e.setCursorToEnd=function(){var o=J(e.maskOptions,e.value),m=I(e.maskOptions,o);m!==null&&e.setCursorPosition(m)},e.setSelection=function(o,m,b){b===void 0&&(b={});var g=e.getInputDOMNode(),C=e.isFocused();g&&C&&(b.deferred||W(g,o,m),e.selectionDeferId!==null&&de(e.selectionDeferId),e.selectionDeferId=be(function(){e.selectionDeferId=null,W(g,o,m)}),e.previousSelection={start:o,end:m,length:Math.abs(m-o)})},e.getSelection=function(){return F(e.getInputDOMNode())},e.getCursorPosition=function(){return e.getSelection().start},e.setCursorPosition=function(o){e.setSelection(o,o)},e.isFocused=function(){return e.focused},e.getBeforeMaskedValueChangeConfig=function(){var o=e.maskOptions,m=o.mask,b=o.maskChar,g=o.permanents,C=o.formatChars;return{mask:m,maskChar:b,permanents:g,alwaysShowMask:!!e.props.alwaysShowMask,formatChars:C}},e.isInputAutofilled=function(o,m,b,g){var C=e.getInputDOMNode();try{if(C.matches(":-webkit-autofill"))return!0}catch{}return!e.focused||g.end<b.length&&m.end===o.length},e.onChange=function(o){var m=i(i(e)).beforePasteState,b=i(i(e)).previousSelection,g=e.props.beforeMaskedValueChange,C=e.getInputValue(),_=e.value,V=e.getSelection();e.isInputAutofilled(C,V,_,b)&&(_=B(e.maskOptions,""),b={start:0,end:0,length:0}),m&&(b=m.selection,_=m.value,V={start:b.start+C.length,end:b.start+C.length,length:0},C=_.slice(0,b.start)+C+_.slice(b.end),e.beforePasteState=null);var $=K(e.maskOptions,C,V,_,b),ie=$.enteredString,z=$.selection,ne=$.value;if(O(g)){var re=g({value:ne,selection:z},{value:_,selection:b},ie,e.getBeforeMaskedValueChangeConfig());ne=re.value,z=re.selection}e.setInputValue(ne),O(e.props.onChange)&&e.props.onChange(o),e.isWindowsPhoneBrowser?e.setSelection(z.start,z.end,{deferred:!0}):e.setSelection(z.start,z.end)},e.onFocus=function(o){var m=e.props.beforeMaskedValueChange,b=e.maskOptions,g=b.mask,C=b.prefix;if(e.focused=!0,e.mounted=!0,g){if(e.value)J(e.maskOptions,e.value)<e.maskOptions.mask.length&&e.setCursorToEnd();else{var _=B(e.maskOptions,C),V=B(e.maskOptions,_),$=J(e.maskOptions,V),ie=I(e.maskOptions,$),z={start:ie,end:ie};if(O(m)){var ne=m({value:V,selection:z},{value:e.value,selection:null},null,e.getBeforeMaskedValueChangeConfig());V=ne.value,z=ne.selection}var re=V!==e.getInputValue();re&&e.setInputValue(V),re&&O(e.props.onChange)&&e.props.onChange(o),e.setSelection(z.start,z.end)}e.runSaveSelectionLoop()}O(e.props.onFocus)&&e.props.onFocus(o)},e.onBlur=function(o){var m=e.props.beforeMaskedValueChange,b=e.maskOptions.mask;if(e.stopSaveSelectionLoop(),e.focused=!1,b&&!e.props.alwaysShowMask&&te(e.maskOptions,e.value)){var g="";O(m)&&(g=m({value:g,selection:null},{value:e.value,selection:e.previousSelection},null,e.getBeforeMaskedValueChangeConfig()).value);var C=g!==e.getInputValue();C&&e.setInputValue(g),C&&O(e.props.onChange)&&e.props.onChange(o)}O(e.props.onBlur)&&e.props.onBlur(o)},e.onMouseDown=function(o){if(!e.focused&&document.addEventListener){e.mouseDownX=o.clientX,e.mouseDownY=o.clientY,e.mouseDownTime=new Date().getTime();var m=function b(g){if(document.removeEventListener("mouseup",b),e.focused){var C=Math.abs(g.clientX-e.mouseDownX),_=Math.abs(g.clientY-e.mouseDownY),V=Math.max(C,_),$=new Date().getTime()-e.mouseDownTime;(V<=10&&$<=200||V<=5&&$<=300)&&e.setCursorToEnd()}};document.addEventListener("mouseup",m)}O(e.props.onMouseDown)&&e.props.onMouseDown(o)},e.onPaste=function(o){O(e.props.onPaste)&&e.props.onPaste(o),o.defaultPrevented||(e.beforePasteState={value:e.getInputValue(),selection:e.getSelection()},e.setInputValue(""))},e.handleRef=function(o){e.props.children==null&&O(e.props.inputRef)&&e.props.inputRef(o)};var c=a.mask,x=a.maskChar,N=a.formatChars,u=a.alwaysShowMask,d=a.beforeMaskedValueChange,f=a.defaultValue,S=a.value;e.maskOptions=y(c,x,N),f==null&&(f=""),S==null&&(S=f);var k=X(S);if(e.maskOptions.mask&&(u||k)&&(k=B(e.maskOptions,k),O(d))){var D=a.value;a.value==null&&(D=f),k=d({value:k,selection:null},{value:D=X(D),selection:null},null,e.getBeforeMaskedValueChangeConfig()).value}return e.value=k,e}ee(s,n);var r=s.prototype;return r.componentDidMount=function(){this.mounted=!0,this.getInputDOMNode()&&(this.isWindowsPhoneBrowser=se(),this.maskOptions.mask&&this.getInputValue()!==this.value&&this.setInputValue(this.value))},r.componentDidUpdate=function(){var a=this.previousSelection,e=this.props,c=e.beforeMaskedValueChange,x=e.alwaysShowMask,N=e.mask,u=e.maskChar,d=e.formatChars,f=this.maskOptions,S=x||this.isFocused(),k=this.props.value!=null,D=k?X(this.props.value):this.value,o=a?a.start:null;if(this.maskOptions=y(N,u,d),this.maskOptions.mask){!f.mask&&this.isFocused()&&this.runSaveSelectionLoop();var m=this.maskOptions.mask&&this.maskOptions.mask!==f.mask;if(f.mask||k||(D=this.getInputValue()),(m||this.maskOptions.mask&&(D||S))&&(D=B(this.maskOptions,D)),m){var b=J(this.maskOptions,D);(o===null||b<o)&&(o=oe(this.maskOptions,D)?b:I(this.maskOptions,b))}!this.maskOptions.mask||!te(this.maskOptions,D)||S||k&&this.props.value||(D="");var g={start:o,end:o};if(O(c)){var C=c({value:D,selection:g},{value:this.value,selection:this.previousSelection},null,this.getBeforeMaskedValueChangeConfig());D=C.value,g=C.selection}this.value=D;var _=this.getInputValue()!==this.value;_?(this.setInputValue(this.value),this.forceUpdate()):m&&this.forceUpdate();var V=!1;g.start!=null&&g.end!=null&&(V=!a||a.start!==g.start||a.end!==g.end),(V||_)&&this.setSelection(g.start,g.end)}else f.mask&&(this.stopSaveSelectionLoop(),this.forceUpdate())},r.componentWillUnmount=function(){this.mounted=!1,this.selectionDeferId!==null&&de(this.selectionDeferId),this.stopSaveSelectionLoop()},r.render=function(){var a,e=this.props,c=(e.mask,e.alwaysShowMask,e.maskChar,e.formatChars,e.inputRef,e.beforeMaskedValueChange,e.children),x=Z(e,["mask","alwaysShowMask","maskChar","formatChars","inputRef","beforeMaskedValueChange","children"]);if(c){O(c)||L(!1);var N=["onChange","onPaste","onMouseDown","onFocus","onBlur","value","disabled","readOnly"],u=M({},x);N.forEach(function(f){return delete u[f]}),a=c(u),N.filter(function(f){return a.props[f]!=null&&a.props[f]!==x[f]}).length&&L(!1)}else a=h.createElement("input",M({ref:this.handleRef},x));var d={onFocus:this.onFocus,onBlur:this.onBlur};return this.maskOptions.mask&&(x.disabled||x.readOnly||(d.onChange=this.onChange,d.onPaste=this.onPaste,d.onMouseDown=this.onMouseDown),x.value!=null&&(d.value=this.value)),a=h.cloneElement(a,d)},s})(h.Component);return me=Ve,me}var Oe;function Mt(){return Oe||(Oe=1,he.exports=St()),he.exports}var Ot=Mt();const ce=Te(Ot),P=({icon:p,children:h})=>t.jsxs("div",{className:"relative",children:[t.jsx(p,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),h]}),Dt=({isOpen:p,setIsOpen:h,onPatientAdded:w})=>{const{user:A}=Ie(),{toast:M}=Ae(),[ee,Z]=T.useState("1"),{formData:i,updateField:j,resetForm:L,fillAddress:W}=Nt(),[F,H]=T.useState(!1),[G,y]=T.useState(!1),[v,U]=T.useState(""),[te,J]=T.useState(!1);T.useEffect(()=>{if(i.birth_date){const l=je(i.birth_date,"dd/MM/yyyy");v!==l&&U(l)}else U("")},[i.birth_date]);const oe=l=>{const q=l.target.value;if(U(q),q.length===10)try{const I=et(q,"dd/MM/yyyy",new Date);!isNaN(I)&&I.getFullYear()>1900&&I<new Date?j("birth_date",I):j("birth_date",null)}catch{j("birth_date",null)}else q.length===0&&j("birth_date",null)},B=()=>{h(!1),L(),Z("1"),U(""),J(!1)},ue=async l=>{const q=l.replace(/\D/g,"");if(q.length===8){y(!0);try{const I=await fetch(`https://viacep.com.br/ws/${q}/json/`);if(!I.ok)throw new Error("CEP não encontrado");const X=await I.json();X.erro?M({title:"Erro",description:"CEP não encontrado.",variant:"destructive"}):W(X)}catch{M({title:"Erro de Rede",description:"Não foi possível buscar o CEP.",variant:"destructive"})}finally{y(!1)}}},ae=async()=>{if(!A){M({title:"Erro",description:"Você não está logado.",variant:"destructive"});return}if(!i.name||!i.email){M({title:"Campos obrigatórios",description:"Nome e Email são obrigatórios.",variant:"destructive"}),Z("1");return}H(!0);const l=i.cep?{cep:i.cep,street:i.street,number:i.number,complement:i.complement,neighborhood:i.neighborhood,city:i.city,state:i.state}:null,q={name:i.name,user_type:"patient",nutritionist_id:A.id,birth_date:i.birth_date?je(i.birth_date,"yyyy-MM-dd"):null,gender:i.gender,phone:i.phone,cpf:i.cpf,occupation:i.occupation,civil_status:i.civil_status,observations:i.observations};l&&(q.address=l);const I=`${window.location.origin}/update-password`,X={email:i.email,metadata:q,redirectTo:I};try{const{data:K,error:se}=await Fe.functions.invoke("create-patient",{body:JSON.stringify(X)});if(se){if(K&&K.error)throw new Error(K.error);const O=await se.context.json();throw O&&O.error?new Error(O.error):se}M({title:"Sucesso!",description:`Convite enviado para ${i.name}.`,variant:"success"}),L(),w(),B()}catch(K){M({title:"Erro ao enviar convite",description:Ye(K,"Não foi possível enviar o convite."),variant:"destructive"})}finally{H(!1)}};return t.jsx(Be,{open:p,onOpenChange:B,children:t.jsxs(qe,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[t.jsx(Ue,{children:t.jsx(ze,{className:"font-clash text-2xl text-primary",children:"Adicionar Novo Paciente"})}),t.jsxs(nt,{value:ee,onValueChange:Z,className:"w-full",children:[t.jsxs(at,{className:"grid  w-full grid-cols-2",children:[t.jsx(ye,{value:"1",children:"1. Dados Pessoais"}),t.jsx(ye,{value:"2",children:"2. Endereço (Opcional)"})]}),t.jsx(we,{value:"1",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:[t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsxs(E,{htmlFor:"name",className:"font-semibold",children:["Nome Completo ",t.jsx("span",{className:"text-destructive font-normal",children:"(Obrigatório)"})]}),t.jsx(P,{icon:Ee,children:t.jsx(R,{id:"name",value:i.name,onChange:l=>j("name",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(E,{htmlFor:"email",className:"font-semibold",children:["Email ",t.jsx("span",{className:"text-destructive font-normal",children:"(Obrigatório)"})]}),t.jsx(P,{icon:st,children:t.jsx(R,{id:"email",type:"email",value:i.email,onChange:l=>j("email",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{htmlFor:"phone",className:"font-semibold",children:"Telefone"}),t.jsx(P,{icon:rt,children:t.jsx(ce,{mask:"(99) 99999-9999",value:i.phone,onChange:l=>j("phone",l.target.value),children:l=>t.jsx(R,{...l,id:"phone",className:"bg-muted shadow-inner pl-10"})})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{htmlFor:"birth_date",className:"font-semibold",children:"Data de Nascimento"}),t.jsx("div",{className:"flex w-full space-x-2",children:t.jsx("div",{className:"flex-grow",children:t.jsx(P,{icon:it,children:t.jsx(ce,{mask:"99/99/9999",placeholder:"dd/mm/aaaa",value:v,onChange:oe,children:l=>t.jsx(R,{...l,id:"birth_date",className:"bg-muted shadow-inner pl-10"})})})})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{htmlFor:"gender",className:"font-semibold",children:"Gênero"}),t.jsx(P,{icon:lt,children:t.jsxs(fe,{value:i.gender,onValueChange:l=>j("gender",l),children:[t.jsx(ve,{className:"bg-muted shadow-inner pl-10",children:t.jsx(ge,{placeholder:"Selecione..."})}),t.jsxs(xe,{children:[t.jsx(Y,{value:"Masculino",children:"Masculino"}),t.jsx(Y,{value:"Feminino",children:"Feminino"}),t.jsx(Y,{value:"Outro",children:"Outro"})]})]})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{htmlFor:"cpf",className:"font-semibold",children:"CPF"}),t.jsx(P,{icon:ct,children:t.jsx(ce,{mask:"999.999.999-99",value:i.cpf,onChange:l=>j("cpf",l.target.value),children:l=>t.jsx(R,{...l,id:"cpf",className:"bg-muted shadow-inner pl-10"})})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{htmlFor:"occupation",className:"font-semibold",children:"Profissão"}),t.jsx(P,{icon:pt,children:t.jsx(R,{id:"occupation",value:i.occupation,onChange:l=>j("occupation",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx(E,{htmlFor:"civil_status",className:"font-semibold",children:"Estado Civil"}),t.jsx(P,{icon:ut,children:t.jsxs(fe,{value:i.civil_status,onValueChange:l=>j("civil_status",l),children:[t.jsx(ve,{className:"bg-muted shadow-inner pl-10",children:t.jsx(ge,{placeholder:"Selecione..."})}),t.jsxs(xe,{children:[t.jsx(Y,{value:"Solteiro(a)",children:"Solteiro(a)"}),t.jsx(Y,{value:"Casado(a)",children:"Casado(a)"}),t.jsx(Y,{value:"Divorciado(a)",children:"Divorciado(a)"}),t.jsx(Y,{value:"Viúvo(a)",children:"Viúvo(a)"}),t.jsx(Y,{value:"União Estável",children:"União Estável"})]})]})})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx(E,{htmlFor:"observations",className:"font-semibold",children:"Observações Iniciais"}),t.jsx(P,{icon:dt,children:t.jsx(tt,{id:"observations",value:i.observations,onChange:l=>j("observations",l.target.value),className:"bg-muted resize-none shadow-inner pl-10"})})]})]})}),t.jsx(we,{value:"2",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 py-4",children:[t.jsxs("div",{className:"md:col-span-1 space-y-2",children:[t.jsx(E,{htmlFor:"cep",className:"font-semibold",children:"CEP"}),t.jsx(P,{icon:ot,children:t.jsx(ce,{mask:"99999-999",value:i.cep,onChange:l=>j("cep",l.target.value),onBlur:l=>ue(l.target.value),children:l=>t.jsx(R,{...l,id:"cep",className:"bg-muted shadow-inner pl-10"})})})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx(E,{htmlFor:"street",className:"font-semibold",children:"Endereço (Rua, Av.)"}),t.jsx(P,{icon:bt,children:t.jsx(R,{id:"street",value:i.street,onChange:l=>j("street",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-1 space-y-2",children:[t.jsx(E,{htmlFor:"number",className:"font-semibold",children:"Número"}),t.jsx(P,{icon:gt,children:t.jsx(R,{id:"number",value:i.number,onChange:l=>j("number",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx(E,{htmlFor:"complement",className:"font-semibold",children:"Complemento"}),t.jsx(P,{icon:ft,children:t.jsx(R,{id:"complement",value:i.complement,onChange:l=>j("complement",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-1 space-y-2",children:[t.jsx(E,{htmlFor:"neighborhood",className:"font-semibold",children:"Bairro"}),t.jsx(P,{icon:He,children:t.jsx(R,{id:"neighborhood",value:i.neighborhood,onChange:l=>j("neighborhood",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-1 space-y-2",children:[t.jsx(E,{htmlFor:"city",className:"font-semibold",children:"Cidade"}),t.jsx(P,{icon:vt,children:t.jsx(R,{id:"city",value:i.city,onChange:l=>j("city",l.target.value),className:"bg-muted shadow-inner pl-10"})})]}),t.jsxs("div",{className:"md:col-span-1 space-y-2",children:[t.jsx(E,{htmlFor:"state",className:"font-semibold",children:"Estado (UF)"}),t.jsx(P,{icon:xt,children:t.jsx(R,{id:"state",value:i.state,onChange:l=>j("state",l.target.value),className:"bg-muted shadow-inner pl-10"})})]})]})})]}),t.jsxs(We,{children:[t.jsx(pe,{variant:"outline",onClick:B,disabled:F,children:"Cancelar"}),t.jsxs(pe,{onClick:ae,disabled:F,children:[F?t.jsx(Pe,{className:"mr-2 h-4 w-4 animate-spin"}):null,F?"Enviando Convite...":"Salvar e Enviar Convite"]})]})]})})},De={name_asc:{column:"name",ascending:!0,label:"Ordem Alfabética (A-Z)"},created_at_desc:{column:"created_at",ascending:!1,label:"Mais Recentes"},created_at_asc:{column:"created_at",ascending:!0,label:"Mais Antigos"}},Kt=()=>{const{user:p,signOut:h}=Ie();Ze();const[w,A]=T.useState([]),[M,ee]=T.useState(""),[Z,i]=T.useState(!0),[j,L]=T.useState("name_asc"),[W,F]=T.useState(!1),H=T.useCallback(async()=>{if(!p?.id)return;i(!0);const{column:y,ascending:v}=De[j],{data:U,error:te}=await Fe.from("user_profiles").select("*").eq("nutritionist_id",p.id).order(y,{ascending:v}).limit(500);te?console.error("Erro ao buscar pacientes:",te):A(U||[]),i(!1)},[p?.id,j]);T.useEffect(()=>{H()},[H]);const G=T.useMemo(()=>{if(!M.trim())return w;const y=M.toLowerCase();return w.filter(v=>v.name&&v.name.toLowerCase().includes(y)||v.email&&v.email.toLowerCase().includes(y)||v.phone&&v.phone.includes(y)||v.cpf&&v.cpf.includes(y))},[w,M]);return t.jsxs("div",{className:"flex flex-col min-h-screen bg-background",children:[t.jsxs(Xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-4 md:pt-8 min-w-0 overflow-x-hidden",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-6 md:mb-8",children:[t.jsxs("div",{className:"flex flex-col justify-center flex-1 min-w-0 text-center sm:text-left",children:[t.jsxs("h1",{className:"text-2xl md:text-3xl font-bold font-heading uppercase tracking-wide text-primary break-words",children:["Meus Pacientes",t.jsxs("span",{className:"text-2xl md:text-3xl font-medium text-destructive ml-1 md:ml-2",children:["• ",w.length]})]}),t.jsx("p",{className:"text-neutral-600 mt-1 text-sm md:text-base",children:"Gerencie, adicione ou visualize seus pacientes."})]}),t.jsx("div",{className:"flex-shrink-0 flex justify-center sm:justify-end",children:t.jsxs(pe,{onClick:()=>F(!0),className:"bg-primary text-primary-foreground rounded-5px shadow-card font-semibold hover:bg-primary/90",children:[t.jsx(ht,{className:"w-4 h-4 mr-2"}),"Adicionar Paciente"]})})]}),t.jsxs($e,{className:"bg-card shadow-card-dark rounded-xl overflow-hidden",children:[t.jsx(Ge,{className:"pb-2",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1 min-w-0",children:[t.jsx(mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 shrink-0"}),t.jsx(R,{placeholder:"Buscar por nome, email, CPF ou telefone...",value:M,onChange:y=>ee(y.target.value),className:"pl-10 bg-muted min-w-0"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(kt,{className:"w-4 h-4 text-muted-foreground"}),t.jsxs(fe,{value:j,onValueChange:L,children:[t.jsx(ve,{className:"w-full md:w-[200px] bg-muted",children:t.jsx(ge,{placeholder:"Ordenar por..."})}),t.jsx(xe,{children:Object.entries(De).map(([y,{label:v}])=>t.jsx(Y,{value:y,children:v},y))})]})]})]})}),t.jsx(Je,{children:Z?t.jsx("div",{className:"flex justify-center items-center h-40",children:t.jsx(Pe,{className:"w-8 h-8 animate-spin text-primary"})}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.length>0?G.map(y=>t.jsx(Ke,{to:`/nutritionist/patients/${y.id}/hub`,className:"block p-4 border bg-background rounded-lg hover:shadow-lg hover:border-primary transition-all",children:t.jsxs("div",{className:"flex justify-between items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[t.jsx("div",{className:"w-10 h-10 bg-secondary rounded-full flex items-center justify-center font-bold text-primary overflow-hidden flex-shrink-0",children:y.avatar_url?t.jsx("img",{src:y.avatar_url,alt:y.name,className:"w-full h-full object-cover"}):t.jsx(Ee,{className:"w-6 h-6 text-primary/70"})}),t.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[t.jsx("h3",{className:"font-semibold text-base text-foreground truncate",children:y.name}),t.jsx("p",{className:"text-sm text-muted-foreground truncate",children:y.email})]})]}),t.jsx(Qe,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"})]})},y.id)):t.jsx("p",{className:"text-muted-foreground text-center py-8 md:col-span-2 lg:col-span-3",children:M?"Nenhum paciente encontrado.":"Você ainda não cadastrou nenhum paciente."})})})]})]}),t.jsx(Dt,{isOpen:W,setIsOpen:F,onPatientAdded:H})]})};export{Kt as default};
