import{q as v,r as m,a as h,b as x,j as e,C as f,c as j,d as y,w as C,e as b,B as p,s as N}from"./index-BvWB-6Y-.js";import{I as w}from"./input-OBodSLFw.js";import{L as k}from"./label-Dds-NHUC.js";const E=v("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);function _(){const[r,o]=m.useState(""),[t,c]=m.useState(!1),{toast:s}=h(),n=x(),g=async i=>{i.preventDefault();const d=r?.trim();if(!d){s({title:"Código obrigatório",description:"Digite o código que você recebeu.",variant:"destructive"});return}c(!0);try{const{data:a,error:l}=await N.rpc("redeem_invite_code",{input_code:d});if(l)throw l;const u=typeof a=="string"?JSON.parse(a):a;u?.success?(s({title:"Código resgatado!",description:"Você foi vinculado ao nutricionista. Pode acessar o app normalmente.",variant:"success"}),o(""),n("/patient",{replace:!0})):s({title:"Não foi possível resgatar",description:u?.message||"Código inválido ou expirado.",variant:"destructive"})}catch(a){console.error("redeem_invite_code error:",a),s({title:"Erro",description:a.message||"Erro ao resgatar código. Tente novamente.",variant:"destructive"})}finally{c(!1)}};return e.jsx("div",{className:"min-h-screen bg-muted/30 flex items-center justify-center p-4",children:e.jsxs(f,{className:"w-full max-w-md",children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(E,{className:"h-6 w-6"}),e.jsx(y,{children:"Resgatar código de convite"})]}),e.jsx(C,{children:"Se seu nutricionista passou um código de acesso, digite abaixo para vincular sua conta e acessar o acompanhamento."})]}),e.jsx(b,{children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"code",children:"Código"}),e.jsx(w,{id:"code",value:r,onChange:i=>o(i.target.value),placeholder:"Ex: ABC123",className:"font-mono uppercase",disabled:t,autoFocus:!0})]}),e.jsx(p,{type:"submit",className:"w-full",disabled:t,children:t?"Resgatando...":"Resgatar código"}),e.jsx(p,{type:"button",variant:"ghost",className:"w-full",onClick:()=>n("/patient"),disabled:t,children:"Voltar ao início"})]})})]})})}export{_ as default};
