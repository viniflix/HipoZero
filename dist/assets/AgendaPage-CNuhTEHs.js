import{q as Ze,a3 as T,aN as Ee,u as et,a as tt,b as at,r as d,s as V,aO as st,O as i,j as e,m as nt,B as c,ai as re,aM as lt,aj as ie,ak as oe,al as de,C as G,e as Q,M as ce,v as rt,au as be,H as h,c as me,d as xe,w as we,X as it,U as ot,F as dt,an as Te,A as ct,h as mt,i as xt,k as pt,l as ut,n as ht,o as gt,p as ft,ap as jt,a7 as yt,aL as vt}from"./index-yDciBRsX.js";import{i as bt,a as Fe,C as Ne,e as Ce}from"./calendar-Dop_IelQ.js";import{I as F}from"./input-C3FhjpPV.js";import{L as w}from"./label-BhMYCUX6.js";import{S as I,a as W,b as B,c as R,d as N}from"./select-B27K7cRZ.js";import{B as De}from"./badge-C22lv7_N.js";import{b as wt}from"./pdfUtils-BNzotJhm.js";import{i as y}from"./isToday-DpynrWUU.js";import{P as Nt}from"./plus-CrGgCcIt.js";import{C as pe}from"./chevron-left-uw17AqPS.js";import{F as Ct}from"./filter-A8ZBbKyh.js";import{S as ue}from"./search-BXErS8ds.js";import{C as _e}from"./calendar-days-BpMr9AzK.js";import{C as Dt}from"./clock-CvDNriiF.js";import{E as _t}from"./eye-DzuD7eu_.js";import{P as kt}from"./pen-square-DljrFIPv.js";import{i as Mt}from"./isTomorrow-C2cNbh35.js";import{i as ke}from"./isSameDay-Cfzhsn1T.js";import{s as St}from"./subMonths-yh2PjiLT.js";import{a as At}from"./addMonths-CTHHzy50.js";import{s as Et}from"./startOfMonth-BeRBSUqS.js";import"./extends-CF3RwP-h.js";import"./jspdf.plugin.autotable-DgEKfDfv.js";import"./html2canvas.esm-B0tyYwQk.js";const Me=Ze("FileDown",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);function Tt(r,C,p){const L=T(r,p),g=T(C,p);return+L==+g}function Se(r){return bt(r,Ee(r))}function Ae(r,C){return Tt(r,Ee(r),C)}function Ft(r,C){return Fe(r,-1)}const Lt=({appointment:r,patients:C,onSave:p,onCancel:L,preSelectedDate:g})=>{const[j,b]=d.useState({patient_id:r?.patient_id||"",appointment_time_date:r?i(new Date(r.appointment_time),"yyyy-MM-dd"):g?i(g,"yyyy-MM-dd"):"",appointment_time_hour:r?i(new Date(r.appointment_time),"HH:mm"):"",duration:r?.duration||60,appointment_type:r?.appointment_type||"first_appointment",status:r?.status||"scheduled",notes:r?.notes||""}),[k,l]=d.useState(r?.patient_id&&C.find(n=>n.id===r.patient_id)?.name||""),[v,O]=d.useState(!1),D=C.filter(n=>n.name.toLowerCase().includes(k.toLowerCase())).slice(0,5),U=[{value:"first_appointment",label:"Primeira Consulta"},{value:"return",label:"Retorno"},{value:"evaluation",label:"Avaliação"},{value:"online",label:"Online"},{value:"in_person",label:"Presencial"}],P=[{value:"scheduled",label:"Agendada"},{value:"confirmed",label:"Confirmada"},{value:"awaiting_confirmation",label:"Aguardando Confirmação"},{value:"completed",label:"Realizada"},{value:"cancelled",label:"Cancelada"},{value:"no_show",label:"Faltou"}],Y=[{value:30,label:"30 minutos"},{value:45,label:"45 minutos"},{value:60,label:"1 hora"},{value:90,label:"1h 30min"},{value:120,label:"2 horas"}],J=n=>{n.preventDefault();const[m,f,z]=j.appointment_time_date.split("-").map(Number),[Z,H]=j.appointment_time_hour.split(":").map(Number),_=new Date(m,f-1,z,Z,H);p({...r,...j,appointment_time:_.toISOString()})};return e.jsxs("form",{onSubmit:J,className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(w,{htmlFor:"patient_search",children:"Paciente *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{id:"patient_search",type:"text",placeholder:"Buscar paciente pelo nome...",value:k,onChange:n=>{l(n.target.value),O(!0),n.target.value||b(m=>({...m,patient_id:""}))},onFocus:()=>O(!0),className:"pl-9",required:!j.patient_id})]}),v&&k&&D.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-lg max-h-60 overflow-auto",children:D.map(n=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-accent hover:text-accent-foreground text-sm",onClick:()=>{b(m=>({...m,patient_id:n.id})),l(n.name),O(!1)},children:n.name},n.id))}),k&&D.length===0&&v&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border rounded-md shadow-lg px-3 py-2 text-sm text-muted-foreground",children:"Nenhum paciente encontrado"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"date",children:"Data *"}),e.jsx(F,{id:"date",type:"date",required:!0,value:j.appointment_time_date,onChange:n=>b(m=>({...m,appointment_time_date:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"time",children:"Hora *"}),e.jsx(F,{id:"time",type:"time",required:!0,value:j.appointment_time_hour,onChange:n=>b(m=>({...m,appointment_time_hour:n.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"duration",children:"Duração *"}),e.jsxs(I,{required:!0,value:String(j.duration),onValueChange:n=>b(m=>({...m,duration:Number(n)})),children:[e.jsx(W,{children:e.jsx(B,{})}),e.jsx(R,{children:Y.map(n=>e.jsx(N,{value:String(n.value),children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"appointment_type",children:"Tipo *"}),e.jsxs(I,{required:!0,value:j.appointment_type,onValueChange:n=>b(m=>({...m,appointment_type:n})),children:[e.jsx(W,{children:e.jsx(B,{})}),e.jsx(R,{children:U.map(n=>e.jsx(N,{value:n.value,children:n.label},n.value))})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"status",children:"Status *"}),e.jsxs(I,{required:!0,value:j.status,onValueChange:n=>b(m=>({...m,status:n})),children:[e.jsx(W,{children:e.jsx(B,{})}),e.jsx(R,{children:P.map(n=>e.jsx(N,{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"notes",children:"Observações"}),e.jsx(F,{id:"notes",value:j.notes,onChange:n=>b(m=>({...m,notes:n.target.value})),placeholder:"Informações adicionais (opcional)"})]}),e.jsxs(Te,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:L,children:"Cancelar"}),e.jsx(c,{type:"submit",children:"Salvar"})]})]})};function ra(){const{user:r,signOut:C}=et(),{toast:p}=tt(),L=at(),[g,j]=d.useState([]),[b,k]=d.useState([]),[l,v]=d.useState(null),[O,D]=d.useState(!1),[U,P]=d.useState(null),[Y,J]=d.useState(!0),[n,m]=d.useState("all"),[f,z]=d.useState(""),[Z,H]=d.useState(!1),[_,he]=d.useState(null),[Le,ee]=d.useState(!1),[Oe,K]=d.useState(!1),[q,Pe]=d.useState("week"),[M,te]=d.useState(T(new Date,{locale:h})),[S,ae]=d.useState(new Date),X=d.useCallback(async()=>{if(!r)return;J(!0);const{data:t,error:a}=await V.from("appointments").select("*, patient:user_profiles!appointments_patient_id_fkey(name, id)").eq("nutritionist_id",r.id).limit(1e3);a?p({title:"Erro",description:a.message,variant:"destructive"}):j(t||[]);const{data:s,error:o}=await V.from("user_profiles").select("id, name").eq("nutritionist_id",r.id).limit(500);o?p({title:"Erro",description:"Não foi possível carregar os pacientes.",variant:"destructive"}):k(s||[]),J(!1)},[r,p]);d.useEffect(()=>{X()},[X]);const ze=async t=>{const{patient_id:a,appointment_time:s,notes:o,duration:x,appointment_type:u,status:$}=t,E=new Date(s),Qe=new Date(E.getTime()+x*6e4);if(g.some(le=>{if(t.id&&le.id===t.id)return!1;const ve=new Date(le.appointment_time),Ye=new Date(ve.getTime()+(le.duration||60)*6e4);return E<Ye&&Qe>ve})){p({title:"Conflito de Horário",description:"Já existe um agendamento neste horário. Por favor, escolha outro horário.",variant:"destructive"});return}const je={nutritionist_id:r.id,patient_id:a,appointment_time:s,notes:o,duration:x||60,appointment_type:u||"first_appointment",status:$||"scheduled"};let ne;t.id?ne=V.from("appointments").update(je).eq("id",t.id):ne=V.from("appointments").insert(je);const{error:ye}=await ne;ye?p({title:"Erro",description:`Não foi possível salvar o agendamento. ${ye.message}`,variant:"destructive"}):(p({title:"Sucesso!",description:`Agendamento ${t.id?"atualizado":"criado"} com sucesso.`}),D(!1),P(null),X())},He=t=>{he(t),H(!0)},qe=async()=>{if(!_)return;const{error:t}=await V.from("appointments").delete().eq("id",_.id);t?p({title:"Erro",description:"Não foi possível deletar o agendamento.",variant:"destructive"}):(p({title:"Sucesso!",description:"Agendamento deletado com sucesso."}),X()),H(!1),he(null)},ge=d.useMemo(()=>{const t=new Date;let a=[...g].sort((s,o)=>new Date(s.appointment_time)-new Date(o.appointment_time));if(l)a=a.filter(s=>ke(new Date(s.appointment_time),l));else switch(n){case"today":a=a.filter(s=>y(new Date(s.appointment_time)));break;case"week":a=a.filter(s=>Ae(new Date(s.appointment_time),{locale:h}));break;case"month":a=a.filter(s=>Se(new Date(s.appointment_time)));break;default:a=a.filter(s=>new Date(s.appointment_time)>=st(t))}if(f.trim()){const s=f.toLowerCase();a=a.filter(o=>o.patient?.name?.toLowerCase().includes(s))}return a},[g,n,l,f]),fe=d.useMemo(()=>{const t={};return ge.forEach(a=>{const s=i(new Date(a.appointment_time),"yyyy-MM-dd");t[s]||(t[s]=[]),t[s].push(a)}),t},[ge]),A=d.useMemo(()=>{const t={};return g.forEach(a=>{const s=i(new Date(a.appointment_time),"yyyy-MM-dd");t[s]=(t[s]||0)+1}),t},[g]),$e=t=>{const a={scheduled:{label:"Agendada",variant:"outline",color:"text-blue-600 bg-blue-50"},confirmed:{label:"Confirmada",variant:"default",color:"text-green-600 bg-green-50"},awaiting_confirmation:{label:"Aguardando",variant:"secondary",color:"text-yellow-600 bg-yellow-50"},completed:{label:"Realizada",variant:"secondary",color:"text-gray-600 bg-gray-100"},cancelled:{label:"Cancelada",variant:"destructive",color:"text-red-600 bg-red-50"},no_show:{label:"Faltou",variant:"destructive",color:"text-orange-600 bg-orange-50"}};return a[t]||a.scheduled},Ve=t=>{const a={first_appointment:{label:"Primeira Consulta"},return:{label:"Retorno"},evaluation:{label:"Avaliação"},online:{label:"Online"},in_person:{label:"Presencial"}};return a[t]||a.first_appointment},Ie=(t,a)=>{const s=new Date(new Date(t).getTime()+(a||60)*6e4);return i(s,"HH:mm")},We=t=>{const[a,s,o]=t.split("-").map(Number),x=new Date(a,s-1,o),u=i(x,"EEEE",{locale:h}),$=u.charAt(0).toUpperCase()+u.slice(1),E=i(x,"dd 'de' MMMM",{locale:h});return y(x)?`Hoje • ${$}, ${E}`:Mt(x)?`Amanhã • ${$}, ${E}`:`${$}, ${E}`},Be=()=>{v(jt(l||new Date,1))},Re=()=>{v(yt(l||new Date,1))},Ue=()=>{v(new Date)},Je=()=>{v(null)},Ke=t=>{l&&ke(t,l)?v(null):v(t)},Xe=t=>{v(t),ee(!1)},se=t=>t>=5?"text-secondary font-bold":t>=3?"text-yellow-600 font-bold":t>=1?"text-primary font-bold":"text-muted-foreground font-bold",Ge=async()=>{try{let t="",a=[],s,o;if(q==="week"?(s=T(M,{locale:h}),o=Ce(M,{locale:h}),t=`Semana de ${i(s,"dd/MM")} a ${i(o,"dd/MM/yyyy")}`,a=g.filter(x=>{const u=new Date(x.appointment_time);return u>=s&&u<=o}).sort((x,u)=>new Date(x.appointment_time)-new Date(u.appointment_time))):(s=Et(S),o=vt(S),t=i(S,"MMMM 'de' yyyy",{locale:h}),t=t.charAt(0).toUpperCase()+t.slice(1),a=g.filter(x=>{const u=new Date(x.appointment_time);return u>=s&&u<=o}).sort((x,u)=>new Date(x.appointment_time)-new Date(u.appointment_time))),a.length===0){p({title:"Sem agendamentos",description:`Não há agendamentos para ${t.toLowerCase()}.`,variant:"default"});return}await wt(a,q,t,r?.profile?.name||r?.email?.split("@")[0]||null),p({title:"PDF gerado!",description:`Agenda exportada com sucesso (${a.length} consultas).`}),K(!1)}catch(t){console.error("Erro ao exportar PDF:",t),p({title:"Erro ao exportar",description:"Não foi possível gerar o PDF. Tente novamente.",variant:"destructive"})}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs(nt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"max-w-7xl mx-auto w-full px-4 md:px-8 pt-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 text-center sm:text-left",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-heading uppercase tracking-wide text-primary",children:"Agenda de Consultas"}),e.jsx("p",{className:"text-neutral-600 mt-1",children:"Visualize e gerencie todos os seus agendamentos."})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-center sm:justify-end",children:[e.jsxs(c,{variant:"outline",onClick:()=>K(!0),className:"border-primary text-primary hover:bg-primary hover:text-white",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"})," Exportar PDF"]}),e.jsxs(re,{open:O,onOpenChange:D,children:[e.jsx(lt,{asChild:!0,children:e.jsxs(c,{onClick:()=>P(null),className:"bg-primary hover:bg-primary/90",children:[e.jsx(Nt,{className:"w-4 h-4 mr-2"})," Novo Agendamento"]})}),e.jsxs(ie,{children:[e.jsx(oe,{children:e.jsxs(de,{children:[U?"Editar":"Novo"," Agendamento"]})}),e.jsx(Lt,{appointment:U,patients:b,onSave:ze,onCancel:()=>D(!1),preSelectedDate:l})]})]})]})]}),e.jsx("div",{className:"lg:hidden mb-6",children:e.jsx(G,{className:"bg-card shadow-card-dark rounded-xl",children:e.jsxs(Q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:Be,className:"h-10 w-10 flex-shrink-0",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 text-center",children:l?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-primary",children:i(l,"dd 'de' MMMM",{locale:h})}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:i(l,"EEEE",{locale:h})})]}):e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Todos os agendamentos"})}),e.jsx(c,{variant:"outline",size:"icon",onClick:Re,className:"h-10 w-10 flex-shrink-0",children:e.jsx(ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(c,{variant:l&&y(l)?"default":"outline",size:"sm",onClick:Ue,className:"flex-1",children:"Hoje"}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>ee(!0),className:"flex-1",children:[e.jsx(rt,{className:"w-4 h-4 mr-1.5"}),"Calendário"]}),l&&e.jsx(c,{variant:"outline",size:"sm",onClick:Je,className:"flex-1",children:"Ver Todos"})]})]})})}),e.jsx(re,{open:Le,onOpenChange:ee,children:e.jsxs(ie,{className:"max-w-sm",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Selecionar Data"}),e.jsx(be,{children:"Escolha uma data para ver os agendamentos"})]}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Ne,{mode:"single",selected:l,onSelect:Xe,className:"rounded-md border",locale:h,modifiers:{today:t=>y(t),highLoad:t=>(A[i(t,"yyyy-MM-dd")]||0)>=5&&!y(t),mediumLoad:t=>{const a=A[i(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!y(t)},lowLoad:t=>{const a=A[i(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!y(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"space-y-2 pb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground px-2",children:"Legenda:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs px-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground",children:"5+"})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-10 gap-6",children:[e.jsx("div",{className:"lg:col-span-7 order-1",children:e.jsxs(G,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(me,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"font-heading text-base lg:text-lg font-semibold text-primary",children:"Agendamentos"}),e.jsxs(we,{className:"text-xs lg:text-sm",children:[l&&`Agendamentos de ${i(l,"dd/MM/yyyy")}`,!l&&n==="all"&&"Todos os próximos agendamentos",!l&&n==="today"&&"Agendamentos de hoje",!l&&n==="week"&&"Agendamentos desta semana",!l&&n==="month"&&"Agendamentos deste mês"]})]}),e.jsxs("div",{className:"hidden lg:flex flex-col sm:flex-row gap-3",children:[e.jsxs(I,{value:n,onValueChange:m,disabled:!!l,children:[e.jsxs(W,{className:"w-full sm:w-[180px]",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),e.jsx(B,{})]}),e.jsxs(R,{children:[e.jsx(N,{value:"all",children:"Todos"}),e.jsx(N,{value:"today",children:"Hoje"}),e.jsx(N,{value:"week",children:"Esta Semana"}),e.jsx(N,{value:"month",children:"Este Mês"})]})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Buscar paciente...",value:f,onChange:t=>z(t.target.value),className:"pl-9"})]}),(f||l)&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{z(""),v(null)},className:"w-full sm:w-auto",children:[e.jsx(it,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})]}),e.jsxs("div",{className:"lg:hidden relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Buscar paciente...",value:f,onChange:t=>z(t.target.value),className:"pl-9"})]})]})}),e.jsx(Q,{className:"p-3 lg:p-6",children:Y?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:"Carregando agendamentos..."})}):Object.keys(fe).length>0?e.jsx("div",{className:"space-y-4 lg:space-y-6",children:Object.entries(fe).map(([t,a])=>e.jsxs("div",{className:"space-y-2 lg:space-y-3",children:[!l&&e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 pb-2 border-b",children:[e.jsx(_e,{className:"w-4 h-4 lg:w-5 lg:h-5 text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-sm lg:text-base text-foreground capitalize truncate",children:We(t)}),e.jsx(De,{variant:"secondary",className:`ml-auto text-xs whitespace-nowrap border-0 ${a.length>=5?"bg-secondary/80 text-white":a.length>=3?"bg-yellow-400/70 text-yellow-900":"bg-primary/30 text-primary"}`,children:a.length})]}),e.jsx("div",{className:"space-y-2 lg:space-y-3",children:a.map(s=>{const o=$e(s.status||"scheduled"),x=Ve(s.appointment_type||"first_appointment"),u=Ie(s.appointment_time,s.duration);return e.jsxs("div",{className:"flex items-center gap-2 lg:gap-4 p-2.5 lg:p-4 bg-muted/30 hover:bg-muted/50 rounded-lg border border-border/50 transition-all hover:shadow-md",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-primary/10 px-2 lg:px-3 py-1.5 lg:py-2 rounded-lg min-w-[55px] lg:min-w-[70px] flex-shrink-0",children:[e.jsx(Dt,{className:"w-3 h-3 lg:w-4 lg:h-4 mb-0.5 lg:mb-1 text-primary"}),e.jsx("span",{className:"text-xs lg:text-sm font-bold text-primary",children:i(new Date(s.appointment_time),"HH:mm")}),e.jsx("span",{className:"text-[10px] lg:text-xs text-muted-foreground",children:u})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 lg:gap-2 mb-0.5",children:[e.jsx(ot,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"font-semibold text-sm lg:text-base text-foreground truncate",children:s.patient?.name||"Paciente não identificado"})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx(De,{className:`text-xs ${o.color} border-0`,children:o.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.label}),s.notes&&e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1 hidden lg:block",children:["• ",s.notes]})]})]}),e.jsxs("div",{className:"flex gap-1 lg:gap-2 flex-shrink-0",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>L(`/nutritionist/patients/${s.patient_id}/hub`),className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-blue-50 hover:text-blue-600",title:"Ver detalhes do paciente",children:e.jsx(_t,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>{P(s),D(!0)},className:"h-8 w-8 lg:h-9 lg:w-9 hover:bg-primary/10 hover:text-primary",title:"Editar agendamento",children:e.jsx(kt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 lg:h-9 lg:w-9 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>He(s),title:"Excluir agendamento",children:e.jsx(dt,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4"})})]})]},s.id)})})]},t))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 lg:py-12 text-center",children:[e.jsx(_e,{className:"w-12 h-12 lg:w-16 lg:h-16 text-muted-foreground/50 mb-3 lg:mb-4"}),e.jsx("p",{className:"text-muted-foreground font-medium text-sm lg:text-base mb-1 lg:mb-2",children:"Nenhum agendamento encontrado"}),e.jsxs("p",{className:"text-xs lg:text-sm text-muted-foreground",children:[f&&"Nenhum agendamento encontrado para esta busca",!f&&l&&"Não há consultas agendadas para este dia",!f&&!l&&n==="all"&&"Adicione um novo agendamento para começar",!f&&!l&&n==="today"&&"Não há consultas agendadas para hoje",!f&&!l&&n==="week"&&"Não há consultas agendadas para esta semana",!f&&!l&&n==="month"&&"Não há consultas agendadas para este mês"]})]})})]})}),e.jsxs("div",{className:"hidden lg:block lg:col-span-3 order-2 space-y-6",children:[e.jsxs(G,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsxs(me,{className:"pb-3",children:[e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Calendário"}),e.jsx(we,{className:"text-xs",children:"Clique em um dia para filtrar • Clique novamente para limpar"})]}),e.jsxs(Q,{className:"flex flex-col items-center p-0 pb-3",children:[e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(Ne,{mode:"single",selected:l,onSelect:Ke,className:"w-fit",locale:h,modifiers:{today:t=>y(t),highLoad:t=>(A[i(t,"yyyy-MM-dd")]||0)>=5&&!y(t),mediumLoad:t=>{const a=A[i(t,"yyyy-MM-dd")]||0;return a>=3&&a<5&&!y(t)},lowLoad:t=>{const a=A[i(t,"yyyy-MM-dd")]||0;return a>=1&&a<3&&!y(t)}},modifiersClassNames:{today:"bg-primary text-white font-bold ring-2 ring-primary ring-offset-2 hover:bg-primary",highLoad:"bg-secondary/80 text-white font-bold hover:bg-secondary",mediumLoad:"bg-yellow-400/70 text-yellow-900 font-bold hover:bg-yellow-400",lowLoad:"bg-primary/30 text-primary font-bold hover:bg-primary/40"}})}),e.jsxs("div",{className:"w-full px-4 mt-3 border-t pt-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Legenda:"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-primary/30 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"1-2"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-400/70 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"3-4"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-secondary/80 flex-shrink-0"}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:"5+"})]})]})]})]})]}),e.jsxs(G,{className:"bg-card shadow-card-dark rounded-xl",children:[e.jsx(me,{className:"pb-3",children:e.jsx(xe,{className:"font-heading text-lg font-semibold text-primary",children:"Resumo"})}),e.jsx(Q,{className:"space-y-3",children:(()=>{const t=g.filter(o=>y(new Date(o.appointment_time))).length,a=g.filter(o=>Ae(new Date(o.appointment_time),{locale:h})).length,s=g.filter(o=>Se(new Date(o.appointment_time))).length;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Hoje"}),e.jsx("span",{className:se(t),children:t})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Esta Semana"}),e.jsx("span",{className:se(a),children:a})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Este Mês"}),e.jsx("span",{className:se(s),children:s})]})]})})()})]})]})]}),e.jsx(re,{open:Oe,onOpenChange:K,children:e.jsxs(ie,{className:"sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Exportar Agenda em PDF"}),e.jsx(be,{children:"Selecione o período que deseja exportar"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"period-type",children:"Período"}),e.jsxs(I,{value:q,onValueChange:Pe,children:[e.jsx(W,{id:"period-type",children:e.jsx(B,{})}),e.jsxs(R,{children:[e.jsx(N,{value:"week",children:"Semana"}),e.jsx(N,{value:"month",children:"Mês"})]})]})]}),q==="week"&&e.jsxs("div",{children:[e.jsx(w,{children:"Selecionar Semana"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{type:"button",variant:"outline",size:"icon",onClick:()=>te(Ft(M)),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 text-center text-sm font-medium",children:[i(T(M,{locale:h}),"dd/MM")," a"," ",i(Ce(M,{locale:h}),"dd/MM/yyyy")]}),e.jsx(c,{type:"button",variant:"outline",size:"icon",onClick:()=>te(Fe(M,1)),children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>te(T(new Date,{locale:h})),className:"w-full mt-2 text-xs",children:"Semana Atual"})]}),q==="month"&&e.jsxs("div",{children:[e.jsx(w,{children:"Selecionar Mês"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{type:"button",variant:"outline",size:"icon",onClick:()=>ae(St(S,1)),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-center text-sm font-medium capitalize",children:i(S,"MMMM 'de' yyyy",{locale:h})}),e.jsx(c,{type:"button",variant:"outline",size:"icon",onClick:()=>ae(At(S,1)),children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>ae(new Date),className:"w-full mt-2 text-xs",children:"Mês Atual"})]})]}),e.jsxs(Te,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>K(!1),children:"Cancelar"}),e.jsxs(c,{type:"button",onClick:Ge,className:"bg-primary",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Exportar"]})]})]})}),e.jsx(ct,{open:Z,onOpenChange:H,children:e.jsxs(mt,{children:[e.jsxs(xt,{children:[e.jsx(pt,{children:"Confirmar Exclusão"}),e.jsxs(ut,{children:["Tem certeza que deseja excluir o agendamento de"," ",e.jsx("strong",{children:_?.patient?.name})," para"," ",e.jsx("strong",{children:_&&i(new Date(_.appointment_time),"dd/MM/yyyy 'às' HH:mm")}),"?",e.jsx("br",{}),e.jsx("br",{}),"Esta ação não pode ser desfeita."]})]}),e.jsxs(ht,{children:[e.jsx(gt,{children:"Cancelar"}),e.jsx(ft,{onClick:qe,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})})}export{ra as default};
